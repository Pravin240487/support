{\rtf1\ansi\ansicpg1252\cocoartf2513
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue-Bold;\f1\fnil\fcharset0 HelveticaNeue;\f2\fnil\fcharset0 LucidaGrande;
\f3\fnil\fcharset134 PingFangSC-Regular;}
{\colortbl;\red255\green255\blue255;\red18\green19\blue24;\red255\green255\blue255;\red11\green93\blue173;
\red240\green240\blue240;\red18\green19\blue24;}
{\*\expandedcolortbl;;\cssrgb\c8627\c9804\c12157;\cssrgb\c100000\c100000\c100000;\cssrgb\c0\c45098\c73333;
\cssrgb\c95294\c95294\c95294;\cssrgb\c8627\c9804\c12157;}
\paperw11900\paperh16840\margl1440\margr1440\vieww15440\viewh13200\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\b\fs28 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 WorkDocs microsoft AD connectivity:\

\f1\b0 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 Hello,\
\
My name is Mark from the Workdocs support team in Sydney and I have been assigned your case. I see from the last update that you need some clarification on Workdocs and that you attempted to call in to support. \
\
As I am unsure what you need clarification with, all I can do now is ask that you update the case with your questions or start a new live contact so we can work with you in real-time when you are available.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Mark Iveli | Sydney Cloud Support Engineer\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=7972898861&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=7972898861&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Thu Feb 18 2021\cb1 \
\cb3 07:28:40 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Team,\
\
Regarding the setting up of WorkDocs need few clarifications.\
\
Thanks,\
Pravin \
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Thu Feb 18 2021\cb1 \
\cb3 07:12:14 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Team,\
\
Regarding the setting up of WorkDocs need few clarifications.\
\
Thanks,\
Pravin \
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Feb 16 2021\cb1 \
\cb3 10:21:26 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hello,\
\
We haven't heard back from you regarding case 7972898861 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home?#/case/?caseId=7972898861&displayId=7972898861&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home?#/case/?caseId=7972898861&displayId=7972898861&language=en }}\
\
Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.\
\
Best Regards,\
\
Amazon Web Services\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Feb 09 2021\cb1 \
\cb3 10:01:34 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hi, Pravin,\
\
This is Francisco, and I would like to thank you for your time on the chat today. It was a pleasure. Here is a recap of our conversation.\
\
You opened the case with questions regarding Workdocs setup with Microsoft AD, and options to have Workdocs for your users.\
\
As we discussed, you need an Active Directory to manage your users, and the Managed AD is one of the alternatives you can use. Here is the summary of our conversation:\
\
	1. Create your users in Managed AD using an EC2 instance with RSAT tools installed. You can follow the steps in this document:\
		\{+\} {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms_ad_manage_users_groups.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms_ad_manage_users_groups.html }}\
		\
	2. After you create the user, you can set your own user as the Worksdocs site administrator, so you can manage it:\
		\{+\} {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/workdocs/latest/adminguide/manage_set_admin.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/workdocs/latest/adminguide/manage_set_admin.html }}\
		\
	3. With the administrator user, you can manage site settings such as storage, and user settings:\
		\{+\} {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/workdocs/latest/adminguide/manage-sites.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/workdocs/latest/adminguide/manage-sites.html }}\
		\
Finally, we also discussed on pricing [1], and I also recommended the use of the AWS pricing calculator to get an estimate of cost depending on the usage: {\field{\*\fldinst{HYPERLINK "https://calculator.aws/#/"}}{\fldrslt \cf4 \strokec4 https://calculator.aws/#/ }}\
\
Again, it was a pleasure working with you in this request, and if it's ok for you, I can mark this case as resolved, but if you have any question, feel free to contact me. I will be happy to help.\
\
Have a nice day ahead!\
\
[1] {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/workdocs/pricing/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/workdocs/pricing/ }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Francisco F.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=7972898861&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=7972898861&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Feb 09 2021\cb1 \
\cb3 05:38:09 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 11:41:21 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hello, This is Pravin\
11:41:29 AM Francisco: Hello, my name is Francisco.  I'm here to help you today.\
11:41:33 AM Francisco: Hi Pravin\
11:41:48 AM Francisco: please allow me a minute while I at the case\
11:42:17 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Sure\
11:43:39 AM Francisco: Thanks for waiting. You would like to know if there are alternatives to authenticate with Workdocs other than AWS Managed AD, is that correct?\
11:44:49 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes right. Also to understand the overall setup process. Recently I have tried to setup using the aws managed microsoft AD. But I am not clear with this authentication mechanism.\
11:45:10 AM Francisco: You can use AWS Managed AD, AD Connector (in case you already have an Active Directory), or Simple AD, which is a Samba implementation of Directory Services.\
11:45:47 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I can share my screen to show the setup I did.\
11:46:01 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Is it possible for a chime call ?\
11:46:33 AM Francisco: Unfortunately I don't have how to use voice at the moment. But you can share your screen. Let me generate a bomgar link\
11:46:49 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes fine.\
11:47:07 AM Francisco: {\field{\*\fldinst{HYPERLINK "https://screenshare.aws/?ak=d0dc1c21039a6383ae6b4b9f5f2dd7d6"}}{\fldrslt \cf4 \strokec4 https://screenshare.aws/?ak=d0dc1c21039a6383ae6b4b9f5f2dd7d6 }}\
11:48:42 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Is AD mandatory for WorkDocs ? or even with some iam user can we manage connecting to workdocs ?\
11:49:25 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: any flow diagram depicting the WorkDocs ?\
00:49:58 PM Francisco: Thanks for your time in the session over the phone, Pravin. We can close this chat, and I will send you later a recap of our session. Thanks, and have a nice day ahead!\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Feb 09 2021\cb1 \
\cb3 05:37:56 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Team,\
\
I was testing Workdocs setup with AWS managed Microsoft AD connectivity. But need to understand if the AD is mandatory and alternatives options for this.\
\
Thanks,\
Pravin\
9944344850\
\
\'97\'97\'97\

\f0\b \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 Limit Increase: VPC
\f1\b0\fs33\fsmilli16800 \cb1 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb3 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 Hello,\
\
We have approved and processed your limit increase request(s).  It can sometimes take up to 30 minutes for this to propagate and become available for use.  I hope this helps, but please reopen this case if you encounter any issues.\
\
Summary of limit(s) requested for increase:\
\
  [US_EAST_1]: VPC / NAT Gateway per Availability Zone, New Limit = 10\
\
\
\
Best regards,\
Amazon Web Services\
\
We value your feedback. Please rate our response below:\
========================================================\
\
\
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Feb 09 2021\cb1 \
\cb3 06:21:08 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Limit increase request 1\
Service: VPC\
Region: US East (Northern Virginia)\
Limit name: NAT Gateway per Availability Zone\
New limit value: 10\
------------\
Use case description: Hello Team,\
\
Please increase the NAT Gateway limit to 10.\cb1 \
\
\'97\'97\'97\'97\'97\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\b\fs28 \cf6 \cb3 \outl0\strokewidth0 Chat: AWS Backup Tag based Backup\

\f1\b0\fs33\fsmilli16800 \cf2 \cb1 \outl0\strokewidth0 \strokec2 \
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb3 Hi Arun,\
\
Greetings!\
\
This is Kirubahar from AWS Premium Support reaching out to you regarding the recent Backup case on Tag based backup.\
\
Thanks for your time today over chat session, It was a pleasure talking to you. Let me summarize our conversation below,\
\
Chat was raised requesting information about general question on how backup will treat resource assignment, when both individual resource and a tag filter are used in Backup plan. Also, on how to achieve \'93AND\'94 condition for tags when multiple tags are used to choose resources for backup, followed by question on RDS backup type and retention, and also on the pricing. I have checked these queries and have gathered information on this. I will try to answer these questions one by one below,\
\
1. Under "Resource assignments", if i add any resources and also a tags, how does it filter the resources for backup?\
\
Generally, The backup plans allows multiple resources to be added, aiming to make it easier for customer to schedule backup for a large resource set as compared to having to configure a backup plan for each resources individually. That being said, when a resource and Tags are added to the resource assignment, the AWS backup would backup the individual resources and those resources that have the matching tags. \
\
Inorder to confirm this, I created a backup plan in my lab setup where I added an individual Ec2 instance as resource and also used a tag based filtering. I added this tag to another Ec2 instance. I waited for the backup to start and noticed both the EC2 instances.\
\
2. How to select using multiple tags, I mean we have 100 EC2 instances which are tagged with \'93Environment:Production\'94. In there are around 50 instances which has additional tag \'93Backup:True\'94. Is there way to filter the resources only when both of these tags are there?\
\
I checked this requirement and could confirm that AWS backup currently treats the TAGS as \'93OR\'94 condition and not \'93AND\'94 condition, (i.e) If two tag key value pairs are passed to a backup plan, AWS backup will back all the resources that has either of these tags. \
\
Apologies for any inconvenience caused here. I see that a feature request has already been raised for this feature to the Backup service team, I have reached out to your technical account manager \'93George Niece\'94 and have requested him to add your voice to it on your behalf. I hope it helps.\
\
3. As we know RDS already has an Automated backup which retains maximum of 35 days. When I use AWS Backup, does it create different kind of snapshot which can be retained for 1 year?\
\
With RDS we get two methods of backing up the DB instances, automated backups and database snapshots (DB Snapshots). These automated backup feature of Amazon RDS performs a full daily (once in a day) snapshot of your data during the configured maintenance window. Whereas DB Snapshots are user-initiated and enable you to back up your DB instance in a known state as frequently as you wish, and then restore to that specific state at any time.  \
\
The backup that AWS Backup service would create is that of User Snapshot type and hence can be retained for any customizable period of time. Also these snapshot taken using the AWS Backup service will reflect in RDS snapshot page under \'93Backup Service\'94 tab.  For more information please refer to [1]\
\
Regarding the AWS Backup pricing, With AWS Backup, you pay only for the amount of backup storage you use and the amount of backup data you restore in the month. There is no minimum fee and there are no set-up charges. AWS Backup storage pricing is based on the amount of storage space your backup data consumes. For more information on Backup Storage pricing please refer to [2]\
\
I hope this information is of help to you and clarifies your queries.\
\
I will continue to assume the ownership of this case. If you have any other questions or concerns, feel free to add them to your reply,  I will be happy to address them.\
\
Have a pleasant day ahead!\
\
References\
[1] What is the difference between automated backups and DB Snapshots? - {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/rds/faqs/#Automatic_Backups_and_Database_Snapshots"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/rds/faqs/#Automatic_Backups_and_Database_Snapshots }}\
[2] Backup Storage Pricing - {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/backup/pricing/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/backup/pricing/ }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Kirubahar N.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=7977504791&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=7977504791&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Feb 10 2021\cb1 \
\cb3 03:43:39 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 09:44:13 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Hi Kirubahar\
09:44:18 AM Kirubahar : Hello, my name is Kirubahar .  I'm here to help you today.\
09:44:31 AM Kirubahar : Greetings! May I have your name please ?\
09:45:20 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Im Arun\
09:46:08 AM Kirubahar : Hi Arun, Glad to meet you here today!\
09:46:14 AM Kirubahar : How are you doing today ?\
09:46:31 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Im doing good. How are you?\
09:46:48 AM Kirubahar : I am doing good thanks for asking!\
09:46:55 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: I have few queries related to AWS Backup.\
09:46:59 AM Kirubahar : I see that you have few questions related to AWS backup\
09:47:06 AM Kirubahar : ohh nice, I was about to say the same!\
09:47:16 AM Kirubahar : Please let me know your queries\
09:48:38 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: 1. Under "Resource assignments", when we assign the resources, there is an option to add multiple assignment. So, we can either add resources or tags\
09:49:08 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: letsay, if i add any resources and also a tags, how does it filter the resources\
09:50:14 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: does it filter the resources which has that particular tag?\
09:50:20 AM Kirubahar : Let me check this\
09:50:28 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure take your time\
09:58:03 AM Kirubahar : I am still checking this\
09:58:56 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: No. issues. better i will give other queries as well so that you can check and respond later\
09:59:06 AM Kirubahar : Sure\
09:59:10 AM Kirubahar : Please shoot\
09:59:34 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: 2. How to select using multiple tags, I mean we have 100 EC2 instances which are tagged with \'93Environment:Production\'94. In there are around 50 instances which has additional tag \'93Backup:True\'94. Is there way to filter the resources only when both of these tags are there?\
10:00:08 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: 3. As we know RDS already has an Automated backup which retains maximum of 35 days. When I use AWS Backup, does it create different kind of snapshot which can be retained for 1 year?\
10:00:52 AM Kirubahar : Okay\
10:01:10 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Also, do we have any pricing for this service?\
10:01:34 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: These all are the questions from me. please check and respond later. \
10:02:06 AM Kirubahar : Sure, I will\
10:02:16 AM Kirubahar : would you like to take this chat offline for now ?\
10:02:31 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Yeah sure. but please respond today\
10:02:40 AM Kirubahar : Definitely I will\
10:02:50 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Thanks. Thats all from me.\
10:02:52 AM Kirubahar : Thanks for confirming !\
10:03:02 AM Kirubahar : I wish you a pleasant day ahead!\
10:03:05 AM Kirubahar : Bye for now!\
10:03:08 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: You too.\
10:03:17 AM Kirubahar : Thanks!\
\
\
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb3 AWS_165387667510_Owner (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Feb 10 2021\cb1 \
\cb3 03:43:25 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Team,\
\
We are trying to use AWS Backup service. While doing so, we have few queries related to that service.\
\
I will initiate the chat.\
\
\
Regards,\
Arun\
\
\'97\'97\'97\'97\'97\'97\

\f0\b \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 EC2 Image Builder breaking change in Image Pipeline cron schedule expressions [AWS Account: 165387667510]\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Good day,\
\
Alan here from AWS Premium Support and I have the pleasure of assisting you with your case.\
\
Thank you for reaching out to AWS Premium Support with your question about the cron expressions supported by EC2 Image Builder. \
\
From the email it is not really sure what the issue is you are experiencing. Should you still be have issues, please reply on the case with details of issues and the resources that are impacted, and I will gladly assist you further.\
\
You can find more details about supported cron expressions by visiting our documentation page [1].\
\
If you have any further questions, concerns or you need any additional information regarding this case, please feel free to reach out to us at your earliest convenience.\
\
Have a great day further and all the best with your deployments.\
\
[1] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/imagebuilder/latest/userguide/cron-expressions.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/imagebuilder/latest/userguide/cron-expressions.html }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Alan L.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=7978427271&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=7978427271&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Feb 10 2021\cb1 \
\cb3 09:18:23 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hello, \
\
On February 4, 2021 the EC2 Image Builder service team launched support for higher fidelity Image Pipeline schedule expressions. Previously, the cron Scheduling Engine was limited to execute your cron within an hour of the scheduled time. Now, EC2 Image Builder supports cron executions within one minute of the scheduled time.\
\
Additionally, cron expressions supported by EC2 Image Builder now has parity with other AWS Services that support cron schedules, including CloudWatch Events and SageMaker. You now have the ability to use more expressive schedules that include the ability to:\
\
1. Configure the Image Pipeline to run on the last day of the week or month.\
2. Run your cron on the weekday closest to a particular day of the month.\
3. Optionally configure yearly schedules.\
\
Existing pipelines are not impacted because they have been automatically upgraded to use the new scheduling engine and you will immediately notice an improvement in your build cadence.\
\
This change will however, impact creating or updating Image Pipelines with schedules that are considered to be ambiguous.\
\
Ambiguous cron expressions are those that attempt to set conflicting values for day of week and day of month. Below are some common ambiguous cron expressions and their fixes:\
\
A. Every day of month AND Every day of week:\
This needs to be updated to say Every day of month AND Any day of week.\
cron(0 0 * * *) 
\f2 \uc0\u8594 
\f1  cron(0 0 * * ?)\
\
B. Specific day of month AND Every day of week:\
This needs to be updated to say Specific day of month AND Any day of week.\
cron(0 0 1 * *) 
\f2 \uc0\u8594 
\f1  cron(0 0 1 * ?)\
\
C. Every day of month AND Specific day of week:\
This needs to be updated to say Any day of month AND Specific day of week.\
cron(0 0 * * MON) 
\f2 \uc0\u8594 
\f1  cron(0 0 ? * MON)\
\
D. Run every Sunday, where Sunday is specified as a number:\
Sundays were previously the zeroth and seventh day of the day of the week, while now they are first day of the week.\
cron(0 0 * * 0) 
\f2 \uc0\u8594 
\f1  cron(0 0 ? * 1)\
\
We apologize for any inconvenience that this change may have caused. You can find more details about supported cron expressions by visiting our documentation page [1].\
\
[1] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/imagebuilder/latest/userguide/cron-expressions.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/imagebuilder/latest/userguide/cron-expressions.html }}\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Best Practices for EC2 Instance Management\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello Arun, \
\
Thank you for contacting AWS Premium Support. My name is Ryman and I will be assisting you today. \
\
After reviewing the case, I understand that you are looking for some recommendations on best approaches to install all packages and setup EC2 instances. You have been using Terraform to provision AWS resources, and have looked in to EC2 Image Builder. You are currently considering the following approaches: \uc0\u8195 \
1. Install all the packages and bundle it as a Golden AMI\
2. Install the necessary packages using User data properties in the EC2 instance\
3. Install the necessary packages using CI/CD Jenkins pipeline after the provisioning the EC2 instance through terraform.\
\
Before I make any recommendations, it is important to note that all of these are great approaches that fit your needs. It really comes down to preference of methods, the level of management desired, and use case.\
\
Golden AMIs are a great way to package everything up into an image and easily launch an EC2 instance with all required configurations and packages. The image is stored in a known location on AWS, so you have nothing to manage other than the image itself. If you plan to launch a lot of EC2 instances that require the same packages, than this would be an ideal approach.\
\
Using the bootstrapping with user data approach is more of a manual process, but will give you more granular control over the instance that is being launched. If a package is not needed on a particular instance, you can simply remove it from the user data during launch, whereas you would need to manually remove the package form the instance after launching from an AMI.  With user data, you would want to store the user data scripts in a safe location so they can be retrieved and entered quickly during the launch process, which requires a bit more management on your end. This is a great, granular approach to launching your instances with desired configurations if you are not going to be launching a large amount of EC2 instances. \
\
The last approach of using CI/CD Jenkins pipelines would take some configuration to achieve as well. You would need to make sure each instance has Jenkins installed, and you would need to configure them accordingly. A golden image AMI would have all of these configurations in place, and I will detail in the next paragraph my thoughts on golden image AMI pipelines. I do not have much experience with Jenkins, but it does not seem difficult to integrate it with AWS services [1, 2]. \
\
As I noted, this really comes down to use case, business requirements and preference of your organization. With that said, I feel that deploying a golden image AMI pipeline with EC2 Image Builder [3] would be a great overall choice for many use cases. Image Builder is what we at AWS recommend to customers to manage golden images. With this approach, the ability to automatically provision images as new software updates and patches become available is included, so the image would always be up to date when used to launch a new instance. Another benefit to this is that Image Builder is provided no additional cost, so you are only charged for the underlying AWS resources that are used to create, store, and share the images. AWS also offers documentation on building golden AMI pipelines with vulnerability scanning, with Tenable.io for example [4]. \
\
Finally, I would like to add that you can use AWS Systems Manager to install and update packages and patches on instances [5]. You mentioned using Ansible, and Systems Manager works very well with Ansible to manage EC2 instances [6]. \
\
I hope you have found this information helpful. If you have any more questions, please feel free to reach out and I will continue to investigate these options. Have a great rest of your day. \
\
References \
[1] {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/blogs/devops/setting-up-a-ci-cd-pipeline-by-integrating-jenkins-with-aws-codebuild-and-aws-codedeploy/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/blogs/devops/setting-up-a-ci-cd-pipeline-by-integrating-jenkins-with-aws-codebuild-and-aws-codedeploy/ }}\
[2] {\field{\*\fldinst{HYPERLINK "https://medium.com/faun/ci-cd-pipeline-with-jenkins-and-aws-s3-c08a3656d381"}}{\fldrslt \cf4 \strokec4 https://medium.com/faun/ci-cd-pipeline-with-jenkins-and-aws-s3-c08a3656d381 }} \
[3] {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/blogs/aws/automate-os-image-build-pipelines-with-ec2-image-builder/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/blogs/aws/automate-os-image-build-pipelines-with-ec2-image-builder/ }} \
[4] {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/blogs/awsmarketplace/build-a-golden-ami-pipeline-with-tenable-io-available-in-aws-marketplace/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/blogs/awsmarketplace/build-a-golden-ami-pipeline-with-tenable-io-available-in-aws-marketplace/ }}  \
[5] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/systems-manager/latest/userguide/distributor-working-with-packages-deploy.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/systems-manager/latest/userguide/distributor-working-with-packages-deploy.html }} \
[6] {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/blogs/mt/keeping-ansible-effortless-with-aws-systems-manager/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/blogs/mt/keeping-ansible-effortless-with-aws-systems-manager/ }} \
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Ryman M.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=7998428091&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=7998428091&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Owner (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Feb 16 2021\cb1 \
\cb3 07:29:06 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Team,\
\
We have been looking for a best way to manage the patches of the  EC2 instances. We have been using Terraform to provision the AWS resources. We have already started exploring EC2 Image Builder for creating the image. I'm looking for some of the best approaches to install all the packages and setup an EC2 instances. Some of the approaches we are exploring are,\
\
1.Install all the packages and bundle it as a Golden AMI\
2.Install the necessary packages using Userdata properties in the EC2 instance\
3.Install the necessary packages using CI/CD Jenkins pipeline after the provisioning the EC2 instance through terraform.\
\
Also, planning to use Ansible for installing the packages if required.\
It would be great if you can provided your expertise on the above approaches and come with some recommendations which may help us to proceed further.\
\
\
Regards,\
Arun Kumar R\
Instance ID(s): \cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: Fargate spot interruption log\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello Atchaya,\
\
Thank you for contacting AWS Premium Support. It was a pleasure to have a conversation with you earlier.\
\
Please find the summary of our conversation below:\
\
You have reached us as you wanted to know the Fargate task : b83cf0bdc88c4590923f6e6e30ef6e3e was stopped because of the Fargate-Spot interruption and if so if it was a SIGTERM. \
\
During our conversation I have checked the backend logs for the task : b83cf0bdc88c4590923f6e6e30ef6e3e and could confirm the task was stopped with the reason : stoppedReason=Your Spot Task was interrupted and with an exit code 0.\
\
In general an exit code 0 indicates its a graceful termination and the task was killed with a SIGTERM signal.\
\
Later, you wanted to know if the timeout value you mentioned for the fargate task was in place or not, further I could confirm based on the exit code it did respect the timeout value and terminated the task gracefully.\
\
Further, you wanted to know the events in which the task was removed and a new task started, Please find the sequence of events:\
\
1. Fargate task receives a StopTaskAPI from the service scheduler because of the Spot Interruption in place.\
2. As soon as the task starts deregistering in order to honour the desired count mentioned in the service, the ECS Scheduler immediately sends a RunTask API call which launches a new task and register with the Loadbalancer after it starts running.\
3. Meanwhile the old task will be gracefully terminated by respecting the Timeout value configured.\
4. Service makes sure the desired count is met and goes into a steady state after the task is healthy.\
\
Please note the ECS service scheduler does place the tasks honouring the desired count mentioned, it will perform the actions in a simultaneous fashion once the a running task is being stopped.\
\
I hope the above helps in understanding the workflow of the service events. Please let me know if you have any further queries. I would be happy to assist you more.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Amitha L.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8002262751&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8002262751&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Feb 17 2021\cb1 \
\cb3 04:55:13 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 10:57:18 AM Amitha: Hello, my name is Amitha.  I'm here to help you today.\
10:57:29 AM Amitha: May I know your name please\
10:57:52 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Hello Amitha\
10:57:55 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: I'm Atchaya\
10:58:10 AM Amitha: Hello Atchaya, how are you doing today ?\
10:58:42 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: I'm doing good. How about you?\
10:59:00 AM Amitha: I am doing good as well, thanks for asking\
10:59:19 AM Amitha: can you please provide me with your cluster and region details\
10:59:57 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Apache-fargate-spot-autoscale and us-east-1\
11:00:46 AM Amitha: also I see you have seen a sudden scaling events in your tasks and want to know if it was because of Fargate spot or anything else ?\
11:01:25 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: yes\
11:01:28 AM Amitha: ok\
11:01:54 AM Amitha: give me a moment to check your cluster and pull up the details at my end\
11:03:15 AM Amitha: so these are the tasks you would like to know why they where de-registered right -->  (task b83cf0bdc88c4590923f6e6e30ef6e3e) (task 1c97d48f1f7449e1b581370ddecb0883) (task 2b4707e0aa4748a3bc9bb5fe8ed73d7d).\
11:05:51 AM Amitha: so at my end I see the task: b83cf0bdc88c4590923f6e6e30ef6e3e  stopped with the reason --> stoppedReason=Your Spot Task was interrupted.\
11:07:51 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: (task 1c97d48f1f7449e1b581370ddecb0883) (task 2b4707e0aa4748a3bc9bb5fe8ed73d7d) are listing under running tasks.\
11:07:54 AM Amitha: and the task exited with exit code 0 which does mean it is a sigterm\
11:08:38 AM Amitha: yes, the only task which was stopped is b83cf0bdc88c4590923f6e6e30ef6e3e\
11:09:37 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: okay\
11:09:46 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: where are you checking the logs?\
11:12:58 AM Amitha: so these are the task status logs I can see from my end. Please note these task logs will only be available on your ECS console for a task stopped with reason code for 3hours since these task stopped\
11:13:44 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: okay\
11:14:00 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: can you please share me some sample logs of it?\
11:14:40 AM Amitha: so I cannot see any container logs of your application\
11:14:50 AM Amitha: I can just see when the task started and stopped \
11:14:55 AM Amitha: and the reason why it stopped\
11:15:33 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Also, there were 2 deregistration events at the same time. But 1 task only terminated. Could you please check it and let me know the reason behind it?\
11:15:37 AM Amitha: also due to confidentiality reasons I cannot share these timestamps and logs.\
11:16:59 AM Amitha: its the same task it tried to deregister. It first sent the call and then later tried doing the same \
11:17:01 AM Amitha: again\
11:17:04 AM Amitha: on the same task\
11:19:45 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: I have added the stopTimeout 120 seconds in task definition. I want to make sure whether it is worked or not?\
11:19:56 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: how to find it?\
11:21:26 AM Amitha: well that will be applied \
11:22:54 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: will it be logged? Can we see those logs from our end. Or we can see only exit code 0?\
11:23:32 AM Amitha: yes, for a stopped task you can always see the exit code in your ECS console\
11:23:33 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: is service scheduler add new task when it receives the SIGTERM or after the task served with stoptimeout?\
11:24:30 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Can we see the timestamps of both the SIGTERM and deregistration? \
11:27:05 AM Amitha: so once a task is being called a deregister it always makes sure your desired count is satisfied and launches new tasks.\
\
give me a moment to check if the timestamps are available on Ctrail. You can check for DeregisterTarget API call in ctrail to check when the service actually called for deregister \
\
Also, with exit code 0 it does mean its SIGTERM.\
11:32:33 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: When SIGTREM occur, will the service scheduler add the new task immediately? or will it wait for the task to serve their stoptimeout and then add new task?\
11:34:27 AM Amitha: I believe it will wait for the old task to completely stop and then start the new task. As that is what is looks from the service events\
11:35:33 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: okay\
11:40:21 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: So the spot task replacement is not following any rolling/blue green deployment right? I mean it will not stop the old tasks after the new task coming to running status right? running task count will be less than desired count when SIGTERM occurs right?\
11:42:27 AM Amitha: do you have any deployment configuration setup ? during creating the service?\
11:44:23 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: By default it is chosen for rolling deployment\
11:46:50 AM Amitha: I mean it will not stop the old tasks after the new task coming to running status right? --> from what I infer from your service events the new tasks are coming up after the call to stop old task has occurred.\
But since you had a timeout value the task was taking time to stop meanwhile a new task was also getting started.\
11:49:35 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Please correct me if anything wrong here,\
\
1) SIGTERM occurs\
2) task waits for 2 minutes as stoptimeout given\
3) new task added and starts to register\
4) old task starts to deregister after timeout\
5) task stopped\
11:49:52 AM Amitha: yes\
11:49:56 AM Amitha: you are correct\
11:50:32 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: if no stoptimeout then new task will be added at last right?\
11:57:02 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: the service scheduler will receive the interruption signal and attempt to launch additional Tasks on Fargate Spot if capacity is available => seems like whenever service scheduler receives interruption signal, it will immediately tries add new task.\
00:00:46 PM Amitha: so this is the flow :\
\
1)Deregister call occured at : 2021-02-16T19:40:50.523Z\
2) new task call to add from service was at : 2021-02-16T19:41:00+0000\
2) task waits for 2 minutes as stoptimeout given as it is the timeout values.// Meanwhile the Service still tries to deregister by send the deregister calls on old task //2021-02-16T19:41:35.832Z at this time.\
3) new task added was at .//2021-02-16T19:41:20+0000	it registered at : 2021-02-16T19:42:43.066Z\
4) old task starts to deregister after timeout and stops.\
\
This is the exact workflow, so the service does things simultaneously. It will stop the task as well as start the new task but the stop task will respect its timeout and get killed.\
\
if no stoptimeout then new task will be added at last right?--> if no timeout also the new tasks will be spun up by the service and the ECS service has default timeout of 30secs for the old task.\
\
\
00:04:41 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: okay\
00:04:50 PM Amitha: I hope that helps!\
00:05:38 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: The interruption logs are logged in task status only right?\
00:05:54 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: or can I find it some where else?\
00:06:29 PM Amitha: The interruption logs are logged in task status only right? --> like I dint get you ?\
00:06:56 PM Amitha: can you tell me what are you saying if its Interruption logs\
00:07:04 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: interruption reason\
00:07:09 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: exit code \
00:07:18 PM Amitha: yes, that will be on the console itseld\
00:07:23 PM Amitha: itself\
00:07:45 PM Amitha: during the task stopped \
00:08:40 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: so I can see interruption reason only in task status tab and that too available for 3 hours right?\
00:09:21 PM Amitha: yes\
00:09:29 PM Amitha: a maximum of 3hours\
00:10:15 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: okay thanks\
00:10:20 PM Amitha: your welcome\
00:10:47 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: can you please send the spot task replacement flow in email?\
00:10:57 PM Amitha: sure,\
00:10:59 PM Amitha: I will\
00:11:04 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Thank you\
00:11:07 PM Amitha: send it my response\
00:11:34 PM Amitha: is there anything else I can help you with for today ?\
00:11:45 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Nothing\
00:11:50 PM Amitha: cool\
00:11:59 PM Amitha: have a good day.\
00:12:01 PM Amitha: bye\
00:12:04 PM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Bye\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Feb 17 2021\cb1 \
\cb3 04:54:44 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hello Team,\
\
I am running 3 fargate spot containers in one of the ECS service. I can see that tasks were deregistered from from target group and new tasks were registered again in the Events section. But I am unable to find the proper reason like "Spot interruption SIGTERM" in the logs. Could you please help me on this?\
Region: \
Cluster Name: \
Service Name: \
Task Definition Name: fargate_spot_with_autoscaling:3\
Task ID: \
Instance Id: \
\
\
Attachments\cb1 \uc0\u8232 {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/downloadAttachment?attachmentId=AAMA-EFRSURBSGlqUVc1b0VFKzNyWDZzL1ZpSWNXNDQwcXNVelZBQlpYaTdVdU82Slc5WElRRmQ4Z01nOGZLQ2lORTdIVnU4aFZqT0FBQUFmakI4QmdrcWhraUc5dzBCQndhZ2J6QnRBZ0VBTUdnR0NTcUdTSWIzRFFFSEFUQWVCZ2xnaGtnQlpRTUVBUzR3RVFRTWMyWW0zdXhwaERCUGFKdEFBZ0VRZ0R1YkwzMlZMbUpoc1lNUGNualFKNVFJaXRWR0NPUHBxSHZBU043QWtrTVplemNYVTZ0bmE4WllCUXFhaGJ6NnZQRVk4aWtEakowT2dLVktjdz09DswSnwIJjJ7tdjcdz57nuuJSvNLI6fP9Wd6cb00z_T7CjOtVOIgg7AbAnAzsNhvbKSWo67EFvf-Wt51jgnzWXbjR_sIBFL1YCrIm-tH5sh9ByaGypaBfWxZvNBElr32v28ZclrAs91V-zwqRxPIJjGQ4zQLE6u_BQlBBNZaRyQsByir5gvGUPbQkxzxd7NQx2zwlGElQnDboau91Hv5x6wfTJvP82tg3WLB4pGimTXSq0dRnKG89-IpwrxSNFzssz2KRiiC3dXqyUf0DHLodaLzeOb0bB8Re7uMXB2kZZBxN-Vyjs_Pvn7-oZe_K_xSCFdVTQQNb--hgjHWz8f-F6FzH_5g="}}{\fldrslt \cf4 \cb3 \strokec4 Fargate_spot.PNG}}\
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: Lambda function not able to get Cluster details\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hi Saroja,\
\
Yes, only the newly created services, tasks, and newly registered container instances after opting in will receive the new format ARN. ARNS of the existing components will NOT be changed as the ARNs can't be changed once they are assigned. \
\
Excerpt from an AWS documentation[1]:\
\
"Only resources launched after opting in receive the new ARN and resource ID format. All existing resources are not affected. In order for Amazon ECS services and tasks to transition to the new ARN and resource ID formats, the service or task must be re-created. To transition a container instance to the new ARN and resource ID format, the container instance must be drained and a new container instance registered to the cluster."\
\
Let me know if you have more queries.\
\
Links:\
[1]: {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonECS/latest/userguide/ecs-account-settings.html#ecs-resource-ids"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonECS/latest/userguide/ecs-account-settings.html#ecs-resource-ids }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Shiva Krishna B.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8008768181&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8008768181&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Owner (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Feb 24 2021\cb1 \
\cb3 11:31:35 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Shiva,\
\
One more qq -  service, container instance and a task ARNs created before the transition will remain in old format or old resource ARNs will automatically  change to new format?\
\
Thank you\
Saroja\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Feb 23 2021\cb1 \
\cb3 13:28:30 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hi Saroja,\
\
This is Shiva from AWS Premium Support.\
\
Yes, you are right. The ARN of the cluster will not change. The change would be only for a service, container instance and a task.\
\
Let me know if you have more queries.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Shiva Krishna B.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8008768181&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8008768181&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Call: Validate Image Builder secuirty features and parameterize during runtime\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Good day Pravin, \
\
Alan here from AWS Premium Support and I had the pleasure of chatting to you earlier, and assisting you with your case.\
\
Thank you for reaching out to AWS Premium Support with your question about replacing your ansible runbook with native ImageBuilder components. You also want to know if you can pass a parameter to a pipeline at the time of execution. \
\
On our call we able to replace some of the parts of the ansible playbook with the following components:\
  - The "python" installation :- Component Name "python-3-linux" \
      URL  - {\field{\*\fldinst{HYPERLINK "https://af-south-1.console.aws.amazon.com/imagebuilder/home?region=af-south-1#/components/arn:aws:imagebuilder:af-south-1:aws:component/python-3-linux/1.0.1/1"}}{\fldrslt \cf4 \strokec4 https://af-south-1.console.aws.amazon.com/imagebuilder/home?region=af-south-1#/components/arn:aws:imagebuilder:af-south-1:aws:component/python-3-linux/1.0.1/1 }})\
    This component did not do all the tasks done in playbook. It did not install the "pip" package.\
  - The "cis" & "security" playbook :- Component Name "stig-build-linux-high"\
      URL - {\field{\*\fldinst{HYPERLINK "https://af-south-1.console.aws.amazon.com/imagebuilder/home?region=af-south-1#/components/arn:aws:imagebuilder:af-south-1:aws:component/stig-build-linux-high/2.5.0/1"}}{\fldrslt \cf4 \strokec4 https://af-south-1.console.aws.amazon.com/imagebuilder/home?region=af-south-1#/components/arn:aws:imagebuilder:af-south-1:aws:component/stig-build-linux-high/2.5.0/1 }}\
  - The "update" playbook :- Component Name "update-linux-kernel-mainline"\
      URL - {\field{\*\fldinst{HYPERLINK "https://af-south-1.console.aws.amazon.com/imagebuilder/home?region=af-south-1#/components/arn:aws:imagebuilder:af-south-1:aws:component/update-linux-kernel-mainline/1.0.0/1"}}{\fldrslt \cf4 \strokec4 https://af-south-1.console.aws.amazon.com/imagebuilder/home?region=af-south-1#/components/arn:aws:imagebuilder:af-south-1:aws:component/update-linux-kernel-mainline/1.0.0/1 }}\
  - The "debug" playbook was informational, so there is not replacement\
\
Some of the "security" playbooks were not able to be replaced with components as the tasks were very specific to the use-case.\
\
Regards the second question about passing parameters to an ImageBuilder pipeline. I was not able to find any method of doing this with current features available on AWS ImageBuilder. I will be raising a new feature request to have this feature included into the service in the future. As with all feature requests I am not able to provide a ETA as these request are queued with the software development team. You will have to keep an eye on the "What's New with AWS?" web pages for announcement.  \
\
I hope I managed on the call and with the above, to answer your questions and provide you with some insights into the cause and solution.\
\
If you have any further questions, concerns or you need any additional information regarding this case, please feel free to reach out to us at your earliest convenience.\
\
Thank you for your time and patience on our call.\
\
Have a great day further and all the best with your deployments.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Alan L.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8061758141&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8061758141&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Mar 03 2021\cb1 \
\cb3 04:14:54 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi,\
\
We are trying to parameterize the custom components values during runtime. Currently values are hardcoded and we only use run pipeline to run it, however if we wish to change values within component during runtime, will it be possible or any workaround for it?\
\
Thanks,\
Pravin\
Email - {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/pravinks@optum.com"}}{\fldrslt \cf4 \strokec4 pravinks@optum.com }}\
Mobile - 91-9944344850 \
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Mar 03 2021\cb1 \
\cb3 03:24:51 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi,\
Below are the features we are running through ansible.\
Thanks,\
Pravin\
\
Attachments\cb1 \uc0\u8232 {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/downloadAttachment?attachmentId=AAMA-EFRSURBSGlqUVc1b0VFKzNyWDZzL1ZpSWNXNDQwcXNVelZBQlpYaTdVdU82Slc5WElRR0tPQnlhV3pIR2dBN3RSSm5WLy9zWkFBQUFmakI4QmdrcWhraUc5dzBCQndhZ2J6QnRBZ0VBTUdnR0NTcUdTSWIzRFFFSEFUQWVCZ2xnaGtnQlpRTUVBUzR3RVFRTTRNL3Fib28wMHFLL1ZybWhBZ0VRZ0R2SmNuRlVZM0k0M2R0TGN3TndWbTRjbUt3SlhwVld2ajl0VUFPcGtUZHh3QzlIOGVDMS9wKyswSTZudU13MEhCeW55dlRPejAwMXN2Z0gvZz09dr_LNU3TLtbofkw6cgvhbnf5xPufCYQTr6JlYbknIOX3xW_hexfocdcFlAO-PebuNMu5VJmSJXw74J5fkTsSo0rqXFPwPhcv6DMhMBqiThwlkgV95LZRKL-26KohxLnFLbT5nWU1aHwKeVuNzsGmIXuopzThQfXQv7KstWmXI94iZCGf0wDlxwV18soz32Y3u94wd92mmzft8DFEkwqk1j5i_8QsO7vQLACnCBZusTGQpsmjCiAs2ZuXU0CoukesujnjuGqtwqegOWUC58vea9YUv33ESQoQt9pi9lZPq3WT39kivnq5DBQ-bZI5EU7E"}}{\fldrslt \cf4 \cb3 \strokec4 ansible.zip}}\
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\'97\
\
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\b\fs28 \cf6 \cb3 \outl0\strokewidth0 Chat: not able to connect the server through session manager\

\f1\b0\fs33\fsmilli16800 \cf2 \cb1 \outl0\strokewidth0 \strokec2 \
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb3 Hello Surendar,\
\
This is Aamir from EC2 Linux team. It was a pleasure assisting you on a chat and a screen sharing session today. Below is the consolidated summary of our conversation.\
\
You reached us as you were not able to connect to the instance i-0d12532ddd713de5c via Session Manager. You were getting the below error when you were selecting this instance in Session Manager: \
\
The version of SSM Agent on the instance supports Session Manager, but the instance is not configured for use with AWS Systems Manager. Verify that the IAM instance profile attached to the instance includes the required permissions. Learn more.\
\
As you had no access to the instances via SSH because of the company policy, we had to troubleshoot the issue via Run commands. As the Instance was online in SSM, we used RUN command to troubleshoot the issue. Firstly, I asked you to change the NACLs and Security group of the instance so that connectivity is fine. Later, I requested you to get SSM agent logs from the path /var/log/amazon/ssm/amazon-ssm-agent.log so that we can see what is the status of logs. However, when we fetched the logs, they did not tell much. Below is the output of the RUN command which we executed for logs:\
\
"output": "\uc0\u9679  amazon-ssm-agent.service - amazon-ssm-agent\\n Loaded: loaded (/etc/systemd/system/amazon-ssm-agent.service; enabled; vendor preset: enabled)\\n Active: active (running) since Fri 2021-03-12 11:32:31 UTC; 37ms ago\\n Main PID: 3384 (amazon-ssm-agen)\\n CGroup: /system.slice/amazon-ssm-agent.service\\n 
\f3 \'a9\'c0
\f1 \uc0\u9472 3366 /usr/bin/ssm-document-worker 9e1e7a0a-89aa-4591-8085-b0f162b7e435 i-0d12532ddd713de5c\\n 
\f3 \'a9\'c0
\f1 \uc0\u9472 3371 sh -c /var/lib/amazon/ssm/i-0d12532ddd713de5c/document/orchestration/9e1e7a0a-89aa-4591-8085-b0f162b7e435/awsrunShellScript/0.awsrunShellScript/_script.sh\\n \u9492 \u9472 3384 /usr/bin/amazon-ssm-agent\\n\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal systemd[1]: Started amazon-ssm-agent.\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal systemd[1]: Starting amazon-ssm-agent...\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: Error occurred fetching the seelog config file path: open /etc/amazon/ssm/seelog.xml: no such file or directory\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal sudo[3385]: root : TTY=unknown ; PWD=/usr/bin ; USER=root ; COMMAND=/bin/systemctl status amazon-ssm-agent\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: Initializing new seelog logger\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: New Seelog Logger Creation Complete\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: 2021-03-12 11:32:31 INFO [amazon-ssm-agent] amazon-ssm-agent - v3.0.655.0\\n"\
"standardOutput": "\uc0\u9679  amazon-ssm-agent.service - amazon-ssm-agent\\n Loaded: loaded (/etc/systemd/system/amazon-ssm-agent.service; enabled; vendor preset: enabled)\\n Active: active (running) since Fri 2021-03-12 11:32:31 UTC; 37ms ago\\n Main PID: 3384 (amazon-ssm-agen)\\n CGroup: /system.slice/amazon-ssm-agent.service\\n 
\f3 \'a9\'c0
\f1 \uc0\u9472 3366 /usr/bin/ssm-document-worker 9e1e7a0a-89aa-4591-8085-b0f162b7e435 i-0d12532ddd713de5c\\n 
\f3 \'a9\'c0
\f1 \uc0\u9472 3371 sh -c /var/lib/amazon/ssm/i-0d12532ddd713de5c/document/orchestration/9e1e7a0a-89aa-4591-8085-b0f162b7e435/awsrunShellScript/0.awsrunShellScript/_script.sh\\n \u9492 \u9472 3384 /usr/bin/amazon-ssm-agent\\n\\nMar 12 11:32:31 ip-192-168-5\
\
\
Later we tried to see if you could reach to all the below SSM endpoints on port 443. This check was made to ensure that the connectivity is fine with these endpoints. The commands which were executed were as below:\
\
telnet ssm.us-east-1.amazonaws.com 443\
telnet ec2messages.us-east-1.amazonaws.com 443\
telnet ssmmessages.us-east-1.amazonaws.com 443\
\
The first two commands were getting executed successfully, however, the last command was getting failed. As your instance was using VPC endpoints, we had to ensure that there are two SSM endpoints created i.e. \
\
com.amazonaws.eu-west-1.ssm\
com.amazonaws.eu-west-1.ssmmessages\
\
At first I only saw one endpoint and that was com.amazonaws.eu-west-1.ssm. Hence, I requested to create the second endpoint as well. After that, we tested the above telnet commands, however, the last command was not executing successfully. When I checked the security group associated with the endpoint com.amazonaws.eu-west-1.ssmmessages, it had a different Security Group associated with it i.e. sg-0a5b3ca6b2044d295 which did not have any rules. Hence, I requested to change the Security Group and select the same Security Group which was associated with com.amazonaws.eu-west-1.ssm endpoint. When you did that, the connectivity was successful with the endpoint:\
\
Trying 192.168.55.39...\
Connected to ssmmessages.us-east-1.amazonaws.com.\
\
However, even after this, you were not able to connect via Session Manager. The Session Manager was still showing the same error. Hence, I asked you to do a reboot of the instance. When the instance was running again after a stop/start, you were then able to access the instance via Session Manager successfully.\
\
With this, we ended our chat on the note that I can close the case as there was nothing pending from our side. Hence, I\'92ll be marking the case as resolved. However, in case you have any other concerns, please feel free to reach us via Premium Support and we\'92ll be happy to assist you further.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Aamir D.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8098321891&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8098321891&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 12 2021\cb1 \
\cb3 05:20:50 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 11:24:21 AM Aamir: Hello, my name is Aamir.  I'm here to help you today.\
11:24:29 AM Aamir: Can I have your name please ?\
11:24:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Surendar\
11:25:02 AM Aamir: Hey Surendar, nice to meet you.\
11:25:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am trying to connect my AmzonLinux2 EC2 server through session manager\
11:25:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have attached the SSM full access and restarted the SSM agent services and restarted the Server as well\
11:25:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but still i am not able to access\
11:26:00 AM Aamir: Oh I see.\
11:26:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: server is in private zone\
11:26:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: there is no outbound internet connection \
11:26:47 AM Aamir: Ok, so the instance is in Private Subnet.\
11:26:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes \
11:27:02 AM Aamir: I can see a VPC endpoint created for SSM as well, right /\
11:27:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
11:27:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: for RUN COMMAND option\
11:27:38 AM Aamir: Any other instance in the same subnet which is able to connect to SSM ?\
11:27:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no\
11:27:55 AM Aamir: I can see the instance is online in SSM.\
11:28:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes but not able connect through session manager\
11:28:38 AM Aamir: Ok got it. So the instance is online. but not able to connect via session manager.\
11:28:42 AM Aamir: Any errors ?\
11:29:21 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: The version of SSM Agent on the instance supports Session Manager, but the instance is not configured for use with AWS Systems Manager. Verify that the IAM instance profile attached to the instance includes the required permissions. Learn more\
11:29:34 AM Aamir: Ok\
11:29:45 AM Aamir: Thanks for providing this to me.\
11:29:49 AM Aamir: Please hold on.\
11:29:59 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok\
11:31:09 AM Aamir: It is running Amazon Linux 2, right ?\
11:31:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
11:32:07 AM Aamir: Thanks for the confirmation.\
11:33:22 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i can see the status of the ssm agent service \
11:33:25 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Mar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: Error occurred fetching the seelog config file path: open /etc/amazon/ssm/seelog.xml: no such file or directory\
11:33:32 AM Aamir: Can you log into the instance via SSH and check the logs at /var/log/amazon/ssm/amazon-ssm-agent.log \
11:33:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but service is up and running \
11:33:53 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no i cannot  login into the server through ssh\
11:34:05 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: that is why i need to connect Session manager\
11:34:15 AM Aamir: How do you see the status of the ssm agent ?\
11:34:47 AM Aamir: via RUN command ?\
11:35:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
11:36:18 AM Aamir: Hmm, I can see that.\
11:36:52 AM Aamir: Similarly can you "cat" the above log file and see the contents ?\
11:37:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: code": 0,\
\
"name": "aws:runShellScript",\
\
"output": "\uc0\u9679  amazon-ssm-agent.service - amazon-ssm-agent\\n Loaded: loaded (/etc/systemd/system/amazon-ssm-agent.service; enabled; vendor preset: enabled)\\n Active: active (running) since Fri 2021-03-12 11:32:31 UTC; 37ms ago\\n Main PID: 3384 (amazon-ssm-agen)\\n CGroup: /system.slice/amazon-ssm-agent.service\\n 
\f3 \'a9\'c0
\f1 \uc0\u9472 3366 /usr/bin/ssm-document-worker 9e1e7a0a-89aa-4591-8085-b0f162b7e435 i-0d12532ddd713de5c\\n 
\f3 \'a9\'c0
\f1 \uc0\u9472 3371 sh -c /var/lib/amazon/ssm/i-0d12532ddd713de5c/document/orchestration/9e1e7a0a-89aa-4591-8085-b0f162b7e435/awsrunShellScript/0.awsrunShellScript/_script.sh\\n \u9492 \u9472 3384 /usr/bin/amazon-ssm-agent\\n\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal systemd[1]: Started amazon-ssm-agent.\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal systemd[1]: Starting amazon-ssm-agent...\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: Error occurred fetching the seelog config file path: open /etc/amazon/ssm/seelog.xml: no such file or directory\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal sudo[3385]: root : TTY=unknown ; PWD=/usr/bin ; USER=root ; COMMAND=/bin/systemctl status amazon-ssm-agent\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: Initializing new seelog logger\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: New Seelog Logger Creation Complete\\nMar 12 11:32:31 ip-192-168-57-159.ec2.internal amazon-ssm-agent[3384]: 2021-03-12 11:32:31 INFO [amazon-ssm-agent] amazon-ssm-agent - v3.0.655.0\\n",\
\
"startDateTime": "2021-03-12T11:32:24.534Z",\
\
"endDateTime": "2021-03-12T11:32:31.676Z",\
\
"outputS3BucketName": "",\
\
"outputS3KeyPrefix": "",\
\
"stepName": "",\
\
"standardOutput": "\uc0\u9679  amazon-ssm-agent.service - amazon-ssm-agent\\n Loaded: loaded (/etc/systemd/system/amazon-ssm-agent.service; enabled; vendor preset: enabled)\\n Active: active (running) since Fri 2021-03-12 11:32:31 UTC; 37ms ago\\n Main PID: 3384 (amazon-ssm-agen)\\n CGroup: /system.slice/amazon-ssm-agent.service\\n 
\f3 \'a9\'c0
\f1 \uc0\u9472 3366 /usr/bin/ssm-document-worker 9e1e7a0a-89aa-4591-8085-b0f162b7e435 i-0d12532ddd713de5c\\n 
\f3 \'a9\'c0
\f1 \uc0\u9472 3371 sh -c /var/lib/amazon/ssm/i-0d12532ddd713de5c/document/orchestration/9e1e7a0a-89aa-4591-8085-b0f162b7e435/awsrunShellScript/0.awsrunShellScript/_script.sh\\n \u9492 \u9472 3384 /usr/bin/amazon-ssm-agent\\n\\nMar 12 11:32:31 ip-192-168-5\
11:37:23 AM Aamir: Let me copy\
11:41:47 AM Aamir: Ok, so the logs are not complete. Can you copy the log file to somewhere else such as S3 bucket so that we can analyse the logs of the agent. But for that the Instance profile should have access to S3 buckets.\
11:42:43 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i cannot provide IAM access \
11:42:47 AM Aamir: Ok\
11:42:51 AM Aamir: no worrie\
11:42:53 AM Aamir: worries*\
11:42:55 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i dont  have previl\
11:43:05 AM Aamir: yes, I can understand\
11:43:55 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: what permission should i provide if i would use vpc endpoints \
11:44:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: for Session manager connectivity\
11:44:33 AM Aamir: The instance is connected to SSM and that is all.\
11:44:40 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: however i have provided the SSM full access to the instance \
11:45:52 AM Aamir: I'm liasing with an SME. Please hold on.\
11:46:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok\
11:47:21 AM Aamir: in the ACLs, can you allow 443 ?\
11:47:39 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment\
11:47:39 AM Aamir: I see 443 is allowed for only one subnet 192.168.0.0/16	\
11:49:02 AM Aamir: Just correct the NACLs. Allow all ports in Ingress and Egress for the moment.\
11:49:39 AM Aamir: Security Group as well.\
11:49:56 AM Aamir: Lets see what happens after that.\
11:51:25 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is done\
11:51:37 AM Aamir: Can you access now ?\
11:51:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i m not able to connect\
11:51:39 AM Aamir: Ok\
11:52:19 AM Aamir: In NACLs, can you remove all the rules and add only one rule for the moment which allows ALL in egress and Ingress\
11:52:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok\
11:54:31 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no\
11:54:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: not able to connect\
11:54:41 AM Aamir: Oh\
11:56:20 AM Aamir: Ok hold on. I'm seeing if the prerequisites are met for session manager\
11:56:30 AM Aamir: {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-prerequisites.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-prerequisites.html }}\
00:10:12 PM Aamir: Hey can you execute a RUN command with below commands to test connectivity:\
\
telnet ssm.us-east-1.amazonaws.com 443\
telnet ec2messages.us-east-1.amazonaws.com 443\
telnet ssmmessages.us-east-1.amazonaws.com 443\
00:12:58 PM Aamir: And I guess you have changed the route table for the instance now. I can see s3 endpoint in route table  \
00:13:47 PM Aamir: Are we connected Surendar ?\
00:14:09 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
00:14:10 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
00:14:26 PM Aamir: You have changed the route table ?\
00:14:35 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
00:14:58 PM Aamir: Are you able to use RUN command now ?\
00:15:18 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i ill check\
00:15:25 PM Aamir: Thanks\
00:15:55 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes run command working \
00:16:08 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: actually i havent changed anything\
00:16:12 PM Aamir: It failed\
00:16:24 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: create new endpoint but that is already there\
00:16:28 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so i deleted it again\
00:16:39 PM Aamir: Telnet is not installed\
00:17:11 PM Aamir: install the telnet with yum first:\
\
yum install telnet -y\
00:17:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure\
00:18:01 PM Aamir: meanwhile I'll test the same in my lab.\
00:22:00 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Trying 192.168.63.122...\
\
Connected to ec2messages.us-east-1.amazonaws.com.\
\
Escape character is '^]'.\
00:22:11 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Trying 192.168.53.43...\
\
Connected to ssm.us-east-1.amazonaws.com.\
\
Escape character is '^]'.\
\
\
00:22:54 PM Aamir: The last command ?\
00:23:55 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment\
00:25:00 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: other one failed to connect\
00:25:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: request time out\
00:25:22 PM Aamir: what is the command ID ?\
00:26:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: 965d5eed-a323-49b0-ab7d-59a14aa10d53\
00:26:42 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i re initiated again\
00:26:44 PM Aamir: Hmm. It is in progress.\
00:26:51 PM Aamir: It will timeout i guess\
00:26:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
00:27:56 PM Aamir: What was the last command Id for ssmmessages ?\
00:28:21 PM Aamir: Got it. It has failed\
00:28:32 PM Aamir: It is resolving it to a public endpoint.\
00:28:42 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ohh\
00:28:47 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: what should be done now\
00:31:46 PM Aamir: I see ssmmessages endpoint being deleted\
00:31:54 PM Aamir: Can you create it?\
00:32:09 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: that one was create newly\
00:32:21 PM Aamir: I guess it is deleted.\
00:32:34 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: let me check\
00:32:36 PM Aamir: Can you create a new one\
00:33:41 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: service name pls\
00:34:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: us-east-1\
00:34:05 PM Aamir: type ssm and find. It will list two interface endpoints\
00:34:06 PM Aamir: Yes\
00:34:45 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: pending\
00:34:48 PM Aamir: Ok\
00:34:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: when it will become available\
00:35:13 PM Aamir: you should have two endpoints. It will become avail in a minute or so.\
00:35:43 PM Aamir: Ok, I see it is available.\
00:36:12 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it ??\
00:36:17 PM Aamir: Yes\
00:36:39 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok\
00:36:42 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: let me try telnet\
00:36:52 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: give me the command again please\
00:37:00 PM Aamir: telnet ssm.us-east-1.amazonaws.com 443\
telnet ec2messages.us-east-1.amazonaws.com 443\
telnet ssmmessages.us-east-1.amazonaws.com 443\
00:37:38 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am not able to connect Session Manger\
00:37:55 PM Aamir: Execute the RUN commands please.\
00:39:38 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Trying 192.168.53.43...\
\
Connected to ssm.us-east-1.amazonaws.com.\
00:39:42 PM Aamir: Cool\
00:39:50 PM Aamir: Next two\
00:40:07 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Trying 192.168.63.122...\
\
Connected to ec2messages.us-east-1.amazonaws.com.\
00:40:11 PM Aamir: Ok\
00:42:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is still running\
00:42:35 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: means no hope\
00:42:40 PM Aamir: Hmm\
00:43:10 PM Aamir: can you change the security group of this endpoint and use the same security group which is associated with the instance ?\
00:44:26 PM Aamir: The current security group sg-0a5b3ca6b2044d295\
does not have any rules\
00:44:41 PM Aamir: This is associated with the ssmmessages vpc endpoint.\
00:45:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Trying 192.168.55.39...\
\
Connected to ssmmessages.us-east-1.amazonaws.com.\
00:45:24 PM Aamir: Great.\
00:45:27 PM Aamir: It is connected now\
00:45:52 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no\
00:46:02 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am not able to connect the server through session manager\
00:46:10 PM Aamir: Ok, can I call you ?\
00:46:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes pls\
00:46:19 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: 8608888285\
00:46:23 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: +91\
00:46:24 PM Aamir: +91 ?\
00:46:26 PM Aamir: Thanks\
00:46:32 PM Aamir: I'll give you a call.\
00:46:57 PM Aamir: Calling\
00:50:44 PM Aamir: {\field{\*\fldinst{HYPERLINK "https://chime.aws/5189623827"}}{\fldrslt \cf4 \strokec4 https://chime.aws/5189623827 }}\
00:58:23 PM Aamir: Bye Surendar.\
00:58:29 PM Aamir: Enjoy the rest of your evening.\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 12 2021\cb1 \
\cb3 05:20:33 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 not able to connect the server through session manager\
Instance ID :i-0d12532ddd713de5c\
\
\'97\'97\'97\'97\'97\'97\'97\

\f0\b \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 Chat: cannot update the configuration file in container
\f1\b0\fs33\fsmilli16800 \cb1 \
\
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb3 01:16:23 PM Rasika: Hello, my name is Rasika.  I'm here to help you today.\
01:16:44 PM Rasika: May I know your name?\
01:18:11 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Surendar\
01:19:02 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have ECS environment , there are three containers running inside the fargate.\
01:19:23 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: all the containers running in autoscaling group\
01:19:50 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: these three containers are for the purpose the proxy farm\
01:20:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so if i want to update some configuration files inside the container, how do i can do it.\
01:20:38 PM Rasika: Okay\
01:21:18 PM Rasika: I can see in mail your talking about this cluster/egresspoc-egress\
01:21:30 PM Rasika: Which has presently one service running\
01:21:40 PM Rasika: egresspoc-egress-ecs-service\
01:22:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
01:22:42 PM Rasika: So first you have to create a new task defination version\
01:22:50 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok \
01:22:56 PM Rasika: egresspoc-egress-task:1\
01:23:03 PM Rasika: Presntly you have this one\
01:23:05 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have a call \
01:23:27 PM Rasika: Okay\
01:23:50 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: +91-8608888285\
01:24:20 PM Rasika: Before that , please let me explain you here if required I will call for sure\
01:24:35 PM Rasika: Do you have latest version of task defination?\
01:24:37 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok done\
01:24:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no i will prepare\
01:25:21 PM Rasika: Please do the modification to your task defination\
01:25:31 PM Rasika: I will share the doc with you\
01:25:53 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am currently doing this all in terraform\
01:26:06 PM Rasika: {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonECS/latest/developerguide/update-task-definition.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonECS/latest/developerguide/update-task-definition.html }}\
01:26:32 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: that is why i need experts advice for better understanding of ECS componenets\
01:27:01 PM Rasika: What you would like to achieve with ECS?\
01:27:24 PM Rasika: I can advice you, please post your questions here\
01:27:49 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i want to prepare the terraform module for ECS service.\
01:27:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: use case is squid proxy farm\
01:28:38 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so i am trying to provision and update the configuration  squid proxy farm in ECS\
01:28:52 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: am I clear ...\
01:29:26 PM Rasika: Okay\
01:29:56 PM Rasika: I am checking on this, give me few minutes\
01:30:21 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok done\
01:33:12 PM Rasika: Are you looking for an example how to do this?\
01:33:29 PM Rasika: To achieve this via terraform\
01:33:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
01:33:37 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
01:34:10 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: to write a terraform code i need your advice and if sample is avaialable please share\
01:34:18 PM Rasika: I found an example here --> {\field{\*\fldinst{HYPERLINK "https://github.com/cloudreach/squid-utm"}}{\fldrslt \cf4 \strokec4 https://github.com/cloudreach/squid-utm }}\
01:34:49 PM Rasika: we do not support 3rd party apps and will not be able to debug your terrform \
01:35:15 PM Rasika: You can always reach out to terraform support for building the terraform code\
01:35:30 PM Rasika: we can only provide support on ECS side.\
01:35:59 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok\
01:36:23 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need some guidance to create task definition \
01:36:32 PM Rasika: Yes tell me\
01:36:42 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: just two min, can we have a call .\
01:37:40 PM Rasika: okay calling you\
01:37:45 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you\
01:42:29 PM Rasika: Please me few minutes, I m trying to call you\
01:45:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no problem\
01:46:28 PM Rasika: {\field{\*\fldinst{HYPERLINK "https://chime.aws/1031710354"}}{\fldrslt \cf4 \strokec4 https://chime.aws/1031710354 }}\
01:46:32 PM Rasika: Please join\
01:51:11 PM Rasika: Hi Surendar\
01:51:20 PM Rasika: Are you joining the call?\
01:55:59 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sorry joining in\
01:56:50 PM Rasika: okay\
02:36:34 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you \
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 12 2021\cb1 \
\cb3 07:06:52 GMT-0600 (Central Standard Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 i am using task definition to update the container 's service configuration file, so i need to update the configuration file in container.\
Region: us-east-1\
Cluster Name: egresspoc-egress\
Service Name: egresspoc-egress-ecs-service\
Task Definition Name: egresspoc-egress-task\
Task ID: \
Load Balancer Target Group Name: \
Instance Id: \cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: Need guidelines for permission\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello,\
\
Thank you very much for taking the time to chat with AWS Support today. Please kindly accept our apology for not being able to respond to your previous chat requests.\
\
You were seeking some clarification on the following IAM permissions:\
\
                "dbqms:CreateFavoriteQuery",\
                "dbqms:DescribeFavoriteQueries",\
                "dbqms:UpdateFavoriteQuery",\
                "dbqms:DeleteFavoriteQueries",\
                "dbqms:GetQueryString",\
                "dbqms:CreateQueryHistory",\
                "dbqms:UpdateQueryHistory",\
                "dbqms:DeleteQueryHistory",\
                "dbqms:DescribeQueryHistory",\
                "rds-data:BatchExecuteStatement",\
                "rds-data:BeginTransaction",\
                "rds-data:CommitTransaction",\
                "rds-data:ExecuteStatement",\
                "rds-data:RollbackTransaction"\
\
As described in the following AWS documentation, the Database Query Metadata Service (dbqms) is an internal-only service. It provides your recent and saved queries for the Query editor on the AWS Management Console for multiple AWS services, including Amazon QLDB. \
\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/qldb/latest/developerguide/dbqms-api.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/qldb/latest/developerguide/dbqms-api.html }}\
\
As described in the following AWS documentation, with the query editor for Aurora Serverless, you can run SQL queries in the RDS console. This id done with the Data Service API (rds-data), as described in the following AWS documentation. It should be noted that the query editor is only available for the following Aurora Serverless DB clusters: Aurora with MySQL version 5.6 compatibility, Aurora with MySQL version 5.7 compatibility, and Aurora with PostgreSQL version 10.7 compatibility\
\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/query-editor.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/query-editor.html }}\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/rdsdataservice/latest/APIReference/API_Operations.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/rdsdataservice/latest/APIReference/API_Operations.html }}\
\
I hope that you will find this information useful. Please do not hesitate to contact AWS Support when you need any further assistance. \
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Qingye J.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8199159611&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8199159611&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Apr 09 2021\cb1 \
\cb3 00:25:39 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 05:51:54 AM John J: Hello, my name is John J.  I'm here to help you today.\
05:52:55 AM John J: I see that you are seeking some guidance on some IAM permissions. May I know what your questions or doubts are?\
05:56:05 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need to provide permission \
05:56:24 AM John J: Yes...\
05:56:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: to user to get details in Cloudwatch \
05:56:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i mean only read access \
05:57:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and i need to provide permission to view IAM roles and permission only (Read access)\
05:57:25 AM John J: Do you mean, the user only need to have read access to CloudWatch? \
05:57:29 AM John J: Not QLDB?\
05:57:49 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: "dbqms:CreateFavoriteQuery",\
				"dbqms:DescribeFavoriteQueries",\
				"dbqms:UpdateFavoriteQuery",\
				"dbqms:GetQueryString",\
				"dbqms:CreateQueryHistory",\
				"dbqms:DescribeQueryHistory",\
				"dbqms:UpdateQueryHistory",\
				"rds-data:ExecuteSql",\
				"rds-data:ExecuteStatement",\
				"rds-data:BatchExecuteStatement",\
				"rds-data:BeginTransaction",\
				"rds-data:CommitTransaction",\
				"rds-data:RollbackTransaction",\
05:58:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need some clarification on above permission\
05:58:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: to provide to user\
05:58:52 AM John J: dbqms:CreateFavoriteQuery allows the user to save a new favorite query in the QLDB console. \
05:59:02 AM John J: If you are not using the QLDB service, you don't need it.\
05:59:57 AM John J: All of the API calls starting with dbqms is for the QLDB console.\
06:00:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok \
06:00:15 AM John J: And RDS console.\
06:00:33 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need to provide dbqms  and rds-data permission to some user\
06:00:44 AM John J: If your user is not performing queries via teh RDS console, they don't need it.\
06:01:08 AM John J: If your user needs to run queries against QLDB or RDS via the AWS web console, then you need them.\
06:01:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: actually user is developer they dont prefer the console\
06:01:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: they used to connect the RDS through cli\
06:01:51 AM John J: I see. Do you mean things like the mysql command line?\
06:01:58 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
06:02:12 AM John J: How about QLDB? We do not have a command line tool for QLDB yet.\
06:02:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: my actual goal - i want to provide least permission to developer who is working with RDS \
06:02:36 AM John J: RDS only? Not QLDB?\
06:03:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: RDS only\
06:03:41 AM John J: Good.\
06:04:43 AM John J: In this case, you should NOT give your user any IAM permissions. But rather, you give them the hostname, username, password, database name, so that they can access the database via either the mysql command, or other SQL clients.\
06:04:50 AM John J: For example, SQL Workbench.\
06:05:31 AM John J: So, the API calls you mentioned are not needed.\
06:05:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: what is the purpose of dbqms and rds-data\
06:06:33 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: why are they asking to provide dbqms and rds-data permission \
06:06:40 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can you guess\
06:07:07 AM John J: If they are given these permissions, they can run queries in the AWS web console.\
06:07:15 AM John J: Not via the mysql command line.\
06:07:20 AM John J: This is obvious very convenient.\
06:07:50 AM John J: We are making our web console easier and easier to use. We can see a lot of customers like it.\
06:08:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if they are having these permission, they dont need to have RDS username and password ???\
06:08:54 AM John J: If they have these permission, they can run queries in the AWS console without username and password.\
06:09:53 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok ok .. this is the reason ...\
06:10:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i dont want to share the user name and password\
06:10:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so better I can provide these permission to run the query\
06:10:44 AM John J: If you don't want to give them the username and password, then you can give them the above-mentioned permission, so that they can test queries in the AWS console.\
06:11:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please tell me, if they are running query from console, which username and password to authenticate the DB\
06:12:14 AM John J: AWS has a SecretManager service, and it stores the username and password.\
06:12:44 AM John J: In this case, the user is using the username and password stored in SecretManager, without being able to see the username and password.\
06:14:18 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: should i create secret manager or it will automatically created \
06:15:44 AM John J: Let me check into that. You are using Aurora for MySQL?\
06:17:51 AM John J: When you use the Query Editor for the first time, you will need to provide the username and password, then we will store them in Secret Manager.\
06:18:16 AM John J: This is described in the following AWS documentation, with screen captures to illustrate the process.\
06:18:17 AM John J: {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/query-editor.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/query-editor.html }}\
06:19:01 AM John J: This is mentioned in step 5 in the documentation.\
06:21:12 AM John J: I think your developers asked for those permissions based on this AWS documentation.\
06:22:28 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment\
06:22:41 AM John J: No worries. Please take your time.\
06:23:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so , i should tell user name and password to developer \
06:24:09 AM John J: This is needed the first time. \
06:24:23 AM John J: You can enter that for the first time, if you do not want to tell them.\
06:24:54 AM John J: However, think about the fact that your developers are writing code to access the database, and the code needs the username and password.\
06:25:24 AM John J: So, in a development environment, it is not common that the developers do not know the username and password.\
06:26:31 AM John J: The AWS console is a good place for testing SQL statements, but by the end of the data, your developers will need the username and password so that the code can connect to the database.\
06:27:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we dont need to share the username and password , we can share the SDK of secret manager to authenticate the code to RDS\
\
06:27:19 AM John J: I see.\
06:27:40 AM John J: In this case, the code connects to secret manager first.\
06:28:19 AM John J: However, you should also know that when the code connects to secret manager the code can print out the username and password in clear text. \
06:28:33 AM John J: It is the same as giving the username and password to your developer.\
06:28:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok \
06:28:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no problem\
06:29:11 AM John J: Well, not exactly the same, but when the code has access to secret manager the code can get the username and password.\
06:29:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i saw the document, "Resource": "*" \
06:29:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it very mandatory to "Resource": "*"\
06:32:59 AM John J: Let me double check.\
06:33:45 AM John J: You can limit the resource to specific Aurora clusters.\
06:34:22 AM John J: For example, one IAM user can access Aurora cluster A, while another IAM user can access Aurora cluster B.\
06:34:36 AM John J: {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazonrdsdataapi.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazonrdsdataapi.html }}\
06:34:59 AM John J: This is described in the "Resource types defined by Amazon RDS Data API" part in the documentation.\
06:35:27 AM John J: So you can replace * with the ARN of the Aurora cluster.\
06:37:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if i would replace the specific resource ARN, will that be okay???\
06:37:52 AM John J: Yes you can replace the * in the example with the ARN of a specific Aurora cluster.\
06:38:46 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: what is dbqms:UpdateQueryHistory",  ??\
06:38:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: dbqms:UpdateQueryHistory", will change any history \
06:39:11 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: details ??\
06:39:33 AM John J: So, in the query editor, you can see the history of the queries you run.\
06:39:42 AM John J: When you run a new query, it updates the query history.\
06:40:10 AM John J: These API calls are described in this documentation\
06:40:11 AM John J: {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/qldb/latest/developerguide/dbqms-api.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/qldb/latest/developerguide/dbqms-api.html }}\
06:40:50 AM John J: If you want them to use the Query Editor in the AWS console, then all these are needed for the Query Editor to work.\
06:41:05 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok thank you\
06:41:27 AM John J: Is there anything else that we can assist you today?\
06:41:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no thank you\
06:41:45 AM John J: Thank you so much for your patience.\
06:42:09 AM John J: I know that you have requested assistance quite a few times today but we we not able to have a conversations like this.\
06:42:29 AM John J: Please kindly accept our apology for the inconvenience caused by these delays or technical issues.\
06:42:40 AM John J: I am glad that we sorted things out this time.\
06:43:36 AM John J: You can close this chat window and I will send you a summary of our chat shortly.\
06:43:40 AM John J: Have a great day!\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor/surendar.s@optum.com (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Apr 09 2021\cb1 \
\cb3 00:25:30 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 need to know the permission\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Thu Apr 08 2021\cb1 \
\cb3 09:48:24 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hello,\
\
  Looks like you might be away from your desk. When you're back please feel free to chat back in. If there are any additional questions please feel free to let us know too.\
\
P.S I know you said no articles but just incase this helps here is the docs for permissions any useful information I could find that might help. \
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/qldb/latest/developerguide/security_iam_service-with-iam.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/qldb/latest/developerguide/security_iam_service-with-iam.html }}\
examples; {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/qldb/latest/developerguide/security_iam_id-based-policy-examples.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/qldb/latest/developerguide/security_iam_id-based-policy-examples.html }}\
workshop: {\field{\*\fldinst{HYPERLINK "https://qldb-immersionday.workshop.aws/en/"}}{\fldrslt \cf4 \strokec4 https://qldb-immersionday.workshop.aws/en/ }}\
other database services that work with IAM: {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-services-that-work-with-iam.html#database_svcs"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-services-that-work-with-iam.html#database_svcs }}\
\
Have a good rest of the day!\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
James P.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8199159611&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8199159611&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\

\f0\b \

\fs28 \cb3 How the bucket/Objects will be impacted by enabling Block public access (bucket settings)\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello again Surendar,\
\
Thanks for your time on chat, I have summarised our conversation below for your reference please check :\
\
1. If any buckets created through other AWS services (ex: cloudtrail or AWS Config), by default, bucket policy will allow public access (READ WRITE LIST ) or access to particular services.\
\
> None of the AWS service provides the pubic access on the S3 bucket, when they prompt to create a new bucket in S3, they will ask for your acknowledgment to add the statement in the bucket policy to allow that service to perform specific actions on the bucket or will prompt you to add the bucket policy manually allowing that service on the bucket.\
\
By default, when the create-bucket API is called, no bucket policy is added and block public access is turned on. Which means, there can be no public access on the bucket. If you want to allow the public access on the bucket, it is required that you turn off the block public access and use either bucket policy or bucket/object ACL to allow public actions.\
\
2. If we trun On the BPA, what is diffrence between denying public access in bucket policy and ACL and BPA.\
\
> Block Public Access is the prevention method and denying through bucket policy is action done to handle the cause. By default, there is an implicit deny on the S3 bucket, which do not allow any access unless specified.\
\
The public permissions can be given either via bucket policy, bucket ACL or object ACL.\
\
The end result of using the BPA or bucket policy to deny public action remains same. BPA is used when you want to prevent any IAM user/role to apply any ACL or bucket policy allowing public actions on the bucket. And if there is any public access given on the bucket by ACL or policy, you may use the bucket policy to restrict that access, you may use either of these method to restrict public access.\
\
3. If we would be enable BPA, how we can provide access to others (public users).\
\
Directly, this is not possible. Once the BPA is turned on there can be no public access given on the bucket. However, as discussed on the chat, if you are serving the website over S3, you may use CloudFront service to access the S3 bucket privately.\
\
The CloudFront will sit between S3 and client, using the OAI feature of CloudFront for S3 REST API endpoint, it will use an IAM user to access the S3 bucket. Doing this, there will be no need to allow public read on the bucket, as cloudfront will use the allowed IAM user on the bucket policy to perform GET object operation on the bucket.\
\
The OAI feature works with s3 REST API endpoint and not the static website endpoint, refer [1] to know the differences.\
\
If you do not want any S3 bucket in your account to have public access, you may turn on Block Public Access on account level which is different than providing on the bucket level. This can be done from the S3 console, left menu "Block Public Access" and turning all the four options as TRUE.\
\
Below are the documentations which can help you setup OAI in CloudFront to serve your S3 website :\
\
> {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html }}\
> {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-serve-static-website/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-serve-static-website/ }}\
> {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-access-to-amazon-s3/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-access-to-amazon-s3/ }}\
\
I hope I was able to answer your queries and the information provided was useful to you.\
\
If you have any other queries for us please do let us know.\
\
Stay safe and have a great day ahead.\
\
>> Documentation\
[1] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteEndpoints.html#WebsiteRestEndpointDiff"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteEndpoints.html#WebsiteRestEndpointDiff }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Mahin S.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8193256611&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8193256611&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Apr 07 2021\cb1 \
\cb3 00:41:52 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 05:43:23 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi\
05:43:26 AM Mahin: Hello, my name is Mahin.  I'm here to help you today.\
05:43:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar\
05:44:00 AM Mahin: Hey Surendar, I hope you are well.\
05:44:06 AM Mahin: Let me go through your case\
05:44:29 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need clarification on s3 buckets policies which are created through other aws services \
05:45:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i mean, if cloud trail creating S3 buckets, bucket policies will provide any public permission\
05:46:22 AM Mahin: Okay, how is the CloudTrail creating the S3 bucket?\
05:47:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am creating cloud trail , while doing it asks me to create a new s3 buckets or choose existing one\
05:47:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: when i select option to create s3 bucket, it will create S3 bucket\
05:48:25 AM Mahin: Okay when you choose to create a new S3 bucket, it will not allow public access. It will allow the CloudTrail service to push the objects (logs) to the bucket with the help of bucket policy.\
05:48:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok done.\
05:48:53 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: same way for other services as well ??\
05:49:27 AM Mahin: By default, there is no public access given when calling create-bucket API call, unless you/service specifies it.\
05:49:49 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: unless me !!!!! is fine\
05:49:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but service ???\
05:50:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i want to confirm, if any aws services creating S3 buckets, that bucket should not be public access..\
05:51:10 AM Mahin: Services also wont create a bucket with public access, mostly, S3 is used to store the logs of other services and when we select a creation of new bucket it allows that service to access s3. There is no need for public access here.\
05:51:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok , can you please confirm that\
05:51:54 AM Mahin: Is your use case is to not have any bucket with public access in your account?\
05:52:22 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: S3 buckets created through services wont create bucket policy which will not allow public access ?\
05:52:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
05:53:01 AM Mahin: If thats the case, you can turn on Block Public Access settings on account level.\
05:53:34 AM Mahin: From the S3 console, you can navigate to Block Public Access on the left menu and turn it on.\
05:54:02 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: what is difference between denying the public access in bucket policy and turn on Block Public Access setting\
05:56:03 AM Mahin: The end result is the same, i,e restrict pubic access. The BPA setting does not allows ACL or Bucket policy to provide any public access and bucket policy restricts the public access on the bucket.\
05:56:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ojay\
05:56:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay\
05:57:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: If I turn on BPA, how could I host static website\
05:57:49 AM Mahin: You will not be able to host a website in that case, as it requires public read.\
05:58:02 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay.\
05:58:12 AM Mahin: You might want to connect your static website with cloudfront\
05:58:20 AM Mahin: which can access bucket privately \
05:58:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
05:58:39 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I want to \
05:58:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how we can do that.\
06:01:46 AM Mahin: CloudFront is an proxy server, mostly used for caching but it also allows additional feature one of which is accessing S3 hosted website privately using your custom domain name.\
There is a feature called OAI in cloudfront service which can use an IAM user to access S3, so no need to provide public GET on the bucket.\
\
Here is the document : {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html }}\
06:02:25 AM Mahin: Step by step with vid : {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-access-to-amazon-s3/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-access-to-amazon-s3/ }}\
06:03:27 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: If you use an Amazon S3 bucket configured as a website endpoint, you must set it up with CloudFront as a custom origin. You can\'92t use the origin access identity feature described in this topic. However, you can restrict access to content on a custom origin by setting up custom headers and configuring your origin to require them. For more information, see Restricting access to files on custom origins.\
06:03:51 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Note saying, we cant use OAI when we configure static website\
06:04:21 AM Mahin: Yeah instead you can use S3 REST API endpoint, which can be used to access S3 objects.\
06:06:05 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can you please explain \
06:06:55 AM Mahin: Sure, check out this document : {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteEndpoints.html#WebsiteRestEndpointDiff"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteEndpoints.html#WebsiteRestEndpointDiff }}\
06:07:44 AM Mahin: These are two different type of endpoints which can be used to access S3, they have their differences and based on your use case you may choose any of them to serve your site.\
06:11:43 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Thank you, please update the case with your comments\
06:13:25 AM Mahin: Most welcome, sure will do that.\
06:14:41 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: 1. If any buckets created through other AWS services (ex: cloudtrail or AWS Config), by default, bucket policy will allow public access (READ WRITE LIST ) or access to particular services.\
06:16:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: 2. If we trun On the BPA, what is diffrence between denying public access in bucket policy and ACL and BPA\
06:17:11 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: 3. If we would be enable BPA, how we can provide access to others (public users).\
06:17:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Please update immediately on this , thank you very much.\
06:18:03 AM Mahin: Okay, I will send an email with these details on the case.\
06:18:15 AM Mahin: Anything else?\
06:19:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you\
06:21:10 AM Mahin: most welcome, have a good day. \
06:21:11 AM Mahin: BBye\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor/surendar.s@optum.com (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Apr 07 2021\cb1 \
\cb3 00:41:36 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 need clarification on managed services created buckets policies \
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Apr 07 2021\cb1 \
\cb3 00:13:47 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hi Saroja,\
\
Greetings for the day!!\
\
Thanks for contacting AWS Premium Support. My name is Anant from S3 team and I will be assisting you with this case\
\
You reached out today as you need to understand the impact of setting "Block Public Access" over S3 buckets and objects present inside the bucket.\
Please correct my understanding if I am missing anything.\
\
I would like to inform you that when "Block Public Access" setting is turned OFF, anyone will be able to access to the objects present in the S3 bucket from the global internet without any authentication. This will increase the security risk if your bucket contains any sensitive data stored in it.\
\
When you turn ON the "Block Public Access" setting, S3 will ensure that objects never have public access and only the authorized users will be able to access the objects present in the bucket. S3 will validate the IAM credentials for the users and the IAM permissions attached to them and if the IAM policy allows them to access the object S3 will permit the request else the users will receive an Access Denied error. If there is an existing block public access setting that prohibits the requested access, Amazon S3 rejects the request.\
\
Additionally, If an object is written to an AWS Account or S3 bucket with S3 Block Public Access enabled, and that object specifies any type of public permissions via ACL or policy, those public permissions are blocked. Hence if you have "Block Public Access" enabled for the bucket your object cannot be accessed publicly.\
\
If you want to share some objects to the users without making it publicly accessible you can use a Pre signed URL. When you create a presigned URL for your object, you must provide your security credentials, specify a bucket name, an object key, specify the HTTP method (GET to download the object) and expiration date and time. \
The presigned URLs are valid only for the specified duration. Anyone who receives the presigned URL can then access the object. \
\
For more information on sharing objects via Presigned URL, please refer the following documents:\
\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonS3/latest/dev/ShareObjectPreSignedURL.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonS3/latest/dev/ShareObjectPreSignedURL.html }}\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/cli/latest/reference/s3/presign.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/cli/latest/reference/s3/presign.html }}\
\
I would like to inform you that AWS never recommend its customer to enable public access to their S3 buckets unless you explicitly require anyone on the internet to be able to read or write to your S3 bucket. With Amazon S3 block public access, account administrators and bucket owners can easily set up centralized controls to limit public access to their Amazon S3 resources that are enforced regardless of how the resources are created.\
\
Amazon S3 Block Public Access provides four settings. These settings are independent and can be used in any combination. Each setting can be applied to an access point, a bucket, or an entire AWS account. If the block public access settings for the access point, bucket, or account differ, then Amazon S3 applies the most restrictive combination of the access point, bucket, and account settings.\
\
Please refer to the Document[1] which list the steps to block public access for your S3 bucket.\
Please refer to Document[2] more more details about the public access.\
Please refer to the Document[3] which list all the best practices related to the security of your S3 bucket.\
\
I hope the information shared above is helpful. However, should you face any issues or looking for additional assistance, please feel free to reach out to me and I'll be happy to assist you. \
\
Soliciting your cooperation.\
     \
Thank you, hope you have a great day \
\
Reference:\
\
1) {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonS3/latest/user-guide/block-public-access-bucket.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonS3/latest/user-guide/block-public-access-bucket.html }}\
2) {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html }}\
3) {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonS3/latest/dev/security-best-practices.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonS3/latest/dev/security-best-practices.html }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Anant J.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8193256611&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8193256611&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\
\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Metrics not populating for EC2\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello,\
\
We haven't heard back from you regarding case 8173337751 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home?#/case/?caseId=8173337751&displayId=8173337751&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home?#/case/?caseId=8173337751&displayId=8173337751&language=en }}\
\
Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.\
\
Best Regards,\
\
Amazon Web Services\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Thu Apr 01 2021\cb1 \
\cb3 09:31:18 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hello Ramkumar,\
\
Thank you for contacting AWS Support.\
My name is Joel Djomou, Cloud Support Engineer from the Networking profile and I will be assisting you with this case.\
\
From the case note, I understand that you noticed that the Health status metrics is not populating in the cloudwatch alarms for Instance ID : i-0394c7b51a73ca7e8\
and you would like help us fix this issue? Please correct if I misunderstood you.\
\
while using our internal AWS to check this issue, I can see that this  i-0394c7b51a73ca7e8 was terminated 14 days  ago (2 weeks as of today April1, 2021).\
This instance was only up for 2 days then terminated.\
\
You can use CloudTrail to find out what user stopped/terminated this instance on 2021-03-17T15:10:56.000Z\
\
also, checking the alarms in you account, I did not see any alarm under the name "StatusCheckFailed"\
\
Hope this information is helpful to you. If so, please feel free to resolve this case on your end. If not, you can always reply back if you need further assistance.\
\
Have a wonderful day ahead.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Joel D.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8173337751&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8173337751&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Contributor/rajendrra@optum.com (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Thu Apr 01 2021\cb1 \
\cb3 03:19:58 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi All,\
\
We noticed that the Health status metrics is not populating in the cloudwatch alarms.\
\
Alram Name : StatusCheckFailed\
Insatcne ID : i-0394c7b51a73ca7e8\
Instance Name : dev-dts\
\
Kindly help us fix this issue.\
\
Regards,\
Ramkumar\
\pard\pardeftab720\partightenfactor0
\cf2 \cb1 \
\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: AWS Glue support for Spark Jobs\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello,\
\
We haven't heard back from you regarding case 8169836661 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home?#/case/?caseId=8169836661&displayId=8169836661&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home?#/case/?caseId=8169836661&displayId=8169836661&language=en }}\
\
Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.\
\
Best Regards,\
\
Amazon Web Services\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Apr 19 2021\cb1 \
\cb3 09:05:29 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 \sub Excellent\nosupersub \
\pard\pardeftab720\sa280\partightenfactor0
\cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hi Arun,\
\
Thank you for getting back to me. I understand that you want to know when would be better to use AWS Glue and when AWS EMR.\
\
Please note that these 2 services are similar in a way that they both provide an environment for performing ETL jobs(Extract-Transform-Load). Yet, there are a few differences and the use cases vary across the services - as you will see later "You can replace Glue with EMR but not the other way round".\
\
As you mentioned, Glue is a serverless approach where you do not worry too much about the underlying resources which are provisioned, managed and terminated for your. Yet, there are limited types of resources that you can choose from - currently, we only have 3 worker types.\
\
On the other hand, with EMR you have the freedom to install different applications and managed your instances, which adds to the complexity of managing the EMR cluster but provides more functionality to the environment.\
\
So answering your question, if you are solely using Spark for your use-case you can choose either of these services, with Glue having the additional functionality of Crawlers and auto-generated scripts that can help you implementing your logic. Yet, if you want to perform more complex actions on the data including other applications,  you might have to use EMR.\
\
That being said, I managed to find a short article from a third-party provider[1] that makes a good comparison between the 2 services.\
\
Please let me know if you require any further assistance regarding the case or if you have any other follow-up questions on the topic.\
\
Have a great day ahead!\
\
\
[1] AWS Glue vs EMR: {\field{\*\fldinst{HYPERLINK "https://medium.com/swlh/aws-glue-vs-emr-433b53872b30"}}{\fldrslt \cf4 \strokec4 https://medium.com/swlh/aws-glue-vs-emr-433b53872b30 }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Boyko R.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8169836661&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8169836661&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Owner/arunkumar@optum.com (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Apr 16 2021\cb1 \
\cb3 11:26:33 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Boyko,\
\
Thanks for your help in clarifying my queries and it was very helpful.  In addition to that, i have a query as below.\
\
1. Based on my research, I understood that we can run the Spark jobs in both AWS EMR and AWS Glue. But, would like to know the guidance on type of jobs suitable for AWS EMR and AWS Glue. I know the benefit of using Glue is mainly it is serverless and can startup very quickly. \
\
2. It would be great if you can let me know the difference between AWS EMR and AWS Glue. When to use AWS EMR and When to use AWS Glue.\
\
Please guide me on this.\
\
\
Regards,\
Arun Kumar R\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Thu Apr 15 2021\cb1 \
\cb3 11:11:04 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hello,\
\
We haven't heard back from you regarding case 8169836661 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home?#/case/?caseId=8169836661&displayId=8169836661&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home?#/case/?caseId=8169836661&displayId=8169836661&language=en }}\
\
Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.\
\
Best Regards,\
\
Amazon Web Services\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: SSM manager output to S3 buckets\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hi Surendar Samuthirakani,\
\
Greetings for the day!\
\
Thanks for your time over the chat today and it was a pleasure to having conversation with you.\
\
To summarize the conversation, you contacted us regarding the SSM document S3 output related queries, and I had replicated this scenario in my lab and shared the findings.\
\
# Initially, I tried specifying the new S3 bucket name for creation and got the error message "InvalidOutputFolder". Then, I had to choose an existing S3 bucket to capture the run command output.\
\
# In the cloudtrail logs, I did not find any event for this output capture.\
\
So, you need to choose an existing S3 bucket to capture the output. For S3 bucket creation, please create a custom document and use the same. In that scenario, you should be able to get the API "CreateBucket" call in the cloudtrail.\
\
With reference to the public docs, the command output seems to be directly routed from instance to S3 bucket if you have S3 VPC endpoint for instance then this traffic goes through the same.\
\
[+] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/systems-manager/latest/userguide/rc-console.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/systems-manager/latest/userguide/rc-console.html }}\
\
Based on your confirmation, I am resolving this case for now but please feel free to contact us if you need any assistance. We will be glad to assist you. Thank you.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Velmurugan R.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8164402481&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8164402481&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 30 2021\cb1 \
\cb3 01:31:06 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 06:31:44 AM Velmurugan: Hello, my name is Velmurugan.  I'm here to help you today.\
06:32:01 AM Velmurugan: May I have your name please?\
06:32:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi velmurugan, i am surendar samuthirakani\
06:32:28 AM Velmurugan: Hi Surendar Samuthirakani, how are you doing today?\
06:32:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need sample cloud trail event when system manager creates S3 bucket for the Run Command output\
06:33:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need sample CreateBucket event when system manager creates S3 bucket \
06:33:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i want to verify the system manger using vpc endpoint to create S3 bucket\
06:33:51 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can you please help me ...\
06:34:29 AM Velmurugan: thanks for your information, I see my colleague has already started working on this case. Shall I transfer this chat session?\
06:34:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we will work together\
06:34:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no need to transfer the case\
06:35:30 AM Velmurugan: sure, please allow me to check further\
06:36:01 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok\
06:36:22 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please provide me the sample event and clarify on the doubt as well\
06:37:21 AM Velmurugan: I am trying to capture this cloud trail event in my lab setup, I will let you know the findings\
07:02:21 AM Velmurugan: Based on the testing, here is my observations -\
\
- I need to choose or enter existing S3 bucket to capture the Run Command output. It's not allowing to provide a new s3 bucket name (for creation).\
- When I choose the existing s3 bucket the command output is captured but I don't see any API call in the cloudtrail for the same.\
\
07:02:38 AM Velmurugan: could you please explain your use case so that I can investigate further\
07:14:26 AM Velmurugan: are you there?\
07:14:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes i m here\
07:14:48 AM Velmurugan: ok, could you please explain your use case\
07:15:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please create a new S3 bucket \
07:15:16 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: dont choose existing one\
07:15:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: then we will get event\
07:17:07 AM Velmurugan: In run command, it's not allowing to provide a new s3 bucket name (for creation).\
07:17:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: are you sure\
07:17:46 AM Velmurugan: yes\
07:18:09 AM Velmurugan: when I specify new name for s3 bucket (for creation) it throws an error invalid output folder\
07:18:28 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is there any way that S3 buckets create through system manager\
07:19:12 AM Velmurugan: let me check system manager documents\
07:26:43 AM Velmurugan: I don't find any predefined document for S3 bucket creation and I would suggest you to use create a custom document for this use case\
07:27:01 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok done \
07:27:03 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you\
07:27:10 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we can close this case\
07:28:26 AM Velmurugan: thanks for your confirmation\
07:28:57 AM Velmurugan: thank you for contacting AWS premium support and have a good day ahead\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 30 2021\cb1 \
\cb3 01:29:28 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Need sample cloud trail event when system manger creating the S3 buckets \
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 30 2021\cb1 \
\cb3 01:10:26 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 06:11:55 AM Rohan: Hello, my name is Rohan.  I'm here to help you today.\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 30 2021\cb1 \
\cb3 01:10:15 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 i have small query, when we create the S3 buckets for run command output. communication over the internet or it will use the internal channel to create the bucket.\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\
\

\f0\b\fs28 \cb3 Chat: Is other service creating S3 buckets using VPC endpoint\

\f1\b0\fs33\fsmilli16800 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb3 Hello,\
\
I hope this mail finds you in great health.\
\
This is again Mohd Yousuf Chopan from AWS Premium Support. I noticed the chat got disconnect while I was checking.  It looks like there was some network issue.\
\
Please know that I am checking on your ask and would get back to you with an update at the earliest.\
\
Meanwhile let us know of any further concerns/questions. We would be happy to assist.\
\
Have a wonderful day ahead!\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Mohd Yousuf C.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8164294041&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8164294041&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 30 2021\cb1 \
\cb3 00:43:54 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 05:49:23 AM Mohammad: Hello, my name is Mohammad.  I'm here to help you today.\
05:50:26 AM Mohammad: Are you there?\
05:50:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi\
05:50:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am here\
05:50:55 AM Mohammad: ok..\
05:51:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i want to know, how S3 buckets are created when we configure other services\
05:51:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i mean, when creating the cloud trail it will create the S3 bucket\
05:51:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how it will create \
05:51:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: , on the backend\
05:51:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: through VPC endpoint ???\
05:53:38 AM Mohammad: Please know that the communication would be within AWS Network only.. \
05:54:07 AM Mohammad: It would not leave AWS Network..\
05:54:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok \
05:54:29 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it using VPC endpoint ?\
05:54:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because i can see cloud trail event showing VPC endpoint ID \
05:55:40 AM Mohammad: Could you please share the logs and let me know the ID ?\
05:57:27 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: \{\
    "eventVersion": "1.08",\
    "userIdentity": \{\
        "type": "AssumedRole",\
        "principalId": {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/%22AROASNAO7RA3LQ6VGADQD:surendar.s@optum.com"}}{\fldrslt \cf4 \strokec4 "AROASNAO7RA3LQ6VGADQD:surendar.s@optum.com }}",\
        "arn": "arn:aws:sts::165387667510:assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com",\
        "accountId": "165387667510",\
        "accessKeyId": "ASIASNAO7RA3BMIJM4TU",\
        "sessionContext": \{\
            "sessionIssuer": \{\
                "type": "Role",\
                "principalId": "AROASNAO7RA3LQ6VGADQD",\
                "arn": "arn:aws:iam::165387667510:role/AWS_165387667510_Contributor",\
                "accountId": "165387667510",\
                "userName": "AWS_165387667510_Contributor"\
            \},\
            "webIdFederationData": \{\},\
            "attributes": \{\
                "mfaAuthenticated": "false",\
                "creationDate": "2021-03-30T03:24:25Z"\
            \}\
        \}\
    \},\
    "eventTime": "2021-03-30T04:17:49Z",\
    "eventSource": "s3.amazonaws.com",\
    "eventName": "CreateBucket",\
    "awsRegion": "us-east-1",\
    "sourceIPAddress": "198.203.175.175",\
    "userAgent": "[AWSCloudTrail, aws-internal/3 aws-sdk-java/1.11.980 Linux/4.9.230-0.1.ac.224.84.332.metal1.x86_64 OpenJDK_64-Bit_Server_VM/25.282-b08 java/1.8.0_282 vendor/Oracle_Corporation cfg/retry-mode/legacy]",\
    "requestParameters": \{\
        "bucketName": "s3autoremediatetesting",\
        "Host": "s3-external-1.amazonaws.com"\
    \},\
    "responseElements": null,\
    "additionalEventData": \{\
        "SignatureVersion": "SigV4",\
        "CipherSuite": "ECDHE-RSA-AES128-GCM-SHA256",\
        "bytesTransferredIn": 0,\
        "AuthenticationMethod": "AuthHeader",\
        "x-amz-id-2": "6MryXXR2i2i880SIvfAOHNM+3mFal/tc0a+f7sQEbgd7lt+p9m5VdIupyhx5OjOThs8Msrhjzsw=",\
        "bytesTransferredOut": 0\
    \},\
    "requestID": "7ZYJYNS9PYW12TF7",\
    "eventID": "b3bcc954-c857-4725-8d86-17fde4714387",\
    "readOnly": false,\
    "eventType": "AwsApiCall",\
    "managementEvent": true,\
    "eventCategory": "Management",\
    "recipientAccountId": "165387667510",\
    "vpcEndpointId": "vpce-00dc1369"\
\}\
05:59:32 AM Mohammad:  Thank you \
05:59:35 AM Mohammad: Give me a minute\
06:02:40 AM Mohammad: Yes.. it uses VPC Endpoint only..\
06:02:46 AM Mohammad: I tested in house as well\
06:02:57 AM Mohammad: "vpcEndpointId": "vpce-d3d82dba"\
06:03:29 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: same way other service also creating the buckets\
06:03:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: like AWS config\
06:03:56 AM Mohammad: Yes, it would all internal \
06:04:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can you please help me with any sample \
06:04:31 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: from AWS config and one more service to confirm it\
06:07:11 AM Mohammad: I do not have exertise in AWS Config. However let me see if I can create a bucket in it & see Ctrail\
06:07:21 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok \
06:07:22 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: done \
06:07:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 30 2021\cb1 \
\cb3 00:43:12 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Is other service creating S3 buckets using VPC endpoint ?\
Bucket Name: \
Request ID(s): \
Extended Request ID(s): \
Tool (and Version) Used?: \cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: how to create match patter\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hi Surendat,\
\
Thank you for taking time on the chat with me today.\
\
I understand that you need to match the CreateBucket API calls made from within the account by other AWS Services.\
\
On the chat, we have managed to use the following event pattern. The event pattern allows to filter for all the Cloudtrail events with a vpc endpoint Id specified.\
\
\{\
  "detail-type": [\
    "AWS API Call via CloudTrail"\
  ],\
  "detail": \{\
    "eventSource": [\
      "s3.amazonaws.com"\
    ],\
    "eventName": [\
      "CreateBucket"\
    ],\
    "vpcEndpointId": [\
      \{\
        "prefix": "vpc"\
      \}\
    ]\
  \}\
\} \
\
\
Further to this, you need you find a way to schedule the event rule target (Lambda function) in order to resend the email notification from the Lambda function to you on the next day. I have explained that, Eventbridge will not be able to re-invoke the Lambda function using a past event, therefore I have advised that you set the schedule from within the Lambda code. \
\
You have asked for time to modify the Lambda function code in order to satisfy the use case. \
\
Please let me know if you have any further questions or concerns, I am happy to assist in any way.\
\
Enjoy the rest of your day! \
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Zizipho B.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8163993261&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8163993261&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 30 2021\cb1 \
\cb3 06:13:21 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \
\cb3 Please let us know if we helped resolve your issue: \
\
If YES, click here:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/feedback?eventId=8163993261&language=en&questionnaireId=Support-HMD-Yes"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/feedback?eventId=8163993261&language=en&questionnaireId=Support-HMD-Yes }}\
\
If NO, click here:\
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/feedback?eventId=8163993261&language=en&questionnaireId=Support-HMD-No"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/feedback?eventId=8163993261&language=en&questionnaireId=Support-HMD-No }}\
\
\
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 30 2021\cb1 \
\cb3 02:58:21 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 08:01:20 AM Zizipho: Hello, my name is Zizipho.  I'm here to help you today.\
08:02:59 AM Zizipho: May I have your name\
08:03:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendat\
08:03:18 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: surendar\
08:03:33 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i was work with Mr.Aditya\
08:03:48 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: about the event pattern\
08:04:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i want to filter the event with the VPCendpointID field and invoke the lambda\
08:04:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: \{\
  "detail": \{\
    "eventSource": [\
      "s3.amazonaws.com"\
    ],\
    "eventName": [\
      "CreateBucket"\
    ],\
    "userAgent": [\
      "aws-internal"\
    ]\
  \},\
  "detail-type": [\
    "AWS API Call via CloudTrail"\
  ]\
\}\
08:04:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: above code is sample \
08:05:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: will you help me to create event filter to invoke the lambda\
08:06:40 AM Zizipho: Okay, I have to do an investigation for you and check how we can be able to filter an event using a VPCendpoint ID.\
08:07:11 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok\
08:07:28 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we can have chime session also\
08:07:34 AM Zizipho: Is it a different event pattern than the one you worked on with Aditya?\
08:07:58 AM Zizipho: Do you have an event created already?\
08:08:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
08:08:27 AM Zizipho: Please give me the event name\
08:08:58 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: CreateBucket\
08:09:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: \{\
    "eventVersion": "1.08",\
    "userIdentity": \{\
        "type": "AssumedRole",\
        "principalId": {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/%22AROASNAO7RA3LQ6VGADQD:surendar.s@optum.com"}}{\fldrslt \cf4 \strokec4 "AROASNAO7RA3LQ6VGADQD:surendar.s@optum.com }}",\
        "arn": "arn:aws:sts::165387667510:assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com",\
        "accountId": "165387667510",\
        "accessKeyId": "ASIASNAO7RA3BMIJM4TU",\
        "sessionContext": \{\
            "sessionIssuer": \{\
                "type": "Role",\
                "principalId": "AROASNAO7RA3LQ6VGADQD",\
                "arn": "arn:aws:iam::165387667510:role/AWS_165387667510_Contributor",\
                "accountId": "165387667510",\
                "userName": "AWS_165387667510_Contributor"\
            \},\
            "webIdFederationData": \{\},\
            "attributes": \{\
                "mfaAuthenticated": "false",\
                "creationDate": "2021-03-30T03:24:25Z"\
            \}\
        \}\
    \},\
    "eventTime": "2021-03-30T04:17:49Z",\
    "eventSource": "s3.amazonaws.com",\
    "eventName": "CreateBucket",\
    "awsRegion": "us-east-1",\
    "sourceIPAddress": "198.203.175.175",\
    "userAgent": "[AWSCloudTrail, aws-internal/3 aws-sdk-java/1.11.980 Linux/4.9.230-0.1.ac.224.84.332.metal1.x86_64 OpenJDK_64-Bit_Server_VM/25.282-b08 java/1.8.0_282 vendor/Oracle_Corporation cfg/retry-mode/legacy]",\
    "requestParameters": \{\
        "bucketName": "s3autoremediatetesting",\
        "Host": "s3-external-1.amazonaws.com"\
    \},\
    "responseElements": null,\
    "additionalEventData": \{\
        "SignatureVersion": "SigV4",\
        "CipherSuite": "ECDHE-RSA-AES128-GCM-SHA256",\
        "bytesTransferredIn": 0,\
        "AuthenticationMethod": "AuthHeader",\
        "x-amz-id-2": "6MryXXR2i2i880SIvfAOHNM+3mFal/tc0a+f7sQEbgd7lt+p9m5VdIupyhx5OjOThs8Msrhjzsw=",\
        "bytesTransferredOut": 0\
    \},\
    "requestID": "7ZYJYNS9PYW12TF7",\
    "eventID": "b3bcc954-c857-4725-8d86-17fde4714387",\
    "readOnly": false,\
    "eventType": "AwsApiCall",\
    "managementEvent": true,\
    "eventCategory": "Management",\
    "recipientAccountId": "165387667510",\
    "vpcEndpointId": "vpce-00dc1369"\
\}\
08:10:26 AM Zizipho: Thank you for sharing the Contrail event, please provide me with the event rule name if you have created one in Eventbridge.\
08:11:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: custodian-s3-sse-encrypt-s3tstremd\
08:15:00 AM Zizipho: Cool thanks, I can see that this is the current event pattern on used for the event rule:\
\
\{\
    "detail": \{\
        "eventSource": [\
            "s3.amazonaws.com"\
        ],\
        "eventName": [\
            "CreateBucket"\
        ],\
        "userAgent": [\
            "aws-internal"\
        ]\
    \},\
    "detail-type": [\
        "AWS API Call via CloudTrail"\
    ]\
\}\
\
So ther only part missing is to filter the API call using the VPCendpoint ID, correct?\
08:15:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
08:16:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: instead of user agent i need to filter with the vpcendpointid\
08:17:38 AM Zizipho: Okay cool, please give me a moment, I am trying to find an evnet pattern that will work by replicating th use case on my environment\
08:17:58 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok\
08:18:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have a small call\
08:18:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can you please share chime link\
08:18:53 AM Zizipho: Okay I can share a Chime meeting link, what would you like us to discuss while I'm generating the link?\
08:19:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
08:21:50 AM Zizipho: {\field{\*\fldinst{HYPERLINK "https://chime.aws/8059074822"}}{\fldrslt \cf4 \strokec4 https://chime.aws/8059074822 }}\
Meeting ID: 8059 07 4822\
U.S. Toll: +1 206-462-5569\
Meeting PIN: 8059 07 4822\
U.S. Toll-free: +1 855-552-4463\
International: {\field{\*\fldinst{HYPERLINK "https://chime.aws/dialinnumbers/"}}{\fldrslt \cf4 \strokec4 https://chime.aws/dialinnumbers/ }}\
\
08:22:34 AM Zizipho: Please use the meeting details above to join the meeting\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\
\

\f0\b\fs28 \cb3 Chat: CreateBucket is not logged, when I was creating the through cloudtrail\cb1 \
\cb3 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hi Surendar,\
\
Fatima here, I was chatting with you. \
\
Just wanted to send you a follow up email regarding our conversation.\
\
You opened a chat as you were unable to see a CloudTrail event for your CreateBucket API. To confirm, CloudTrail events can take up to 15 mins to show in your Event history. \
\
Once you saw the event, we spoke about various field such as userAgent, eventSource and invokedBy.\
\
userAgent: The agent through which the request was made, such as the AWS Management Console, an AWS service, the AWS SDKs or the AWS CLI. AWS internal in this field means the task was performed by AWS.\
\
eventSource: This is the service that the request was made to. This name is typically a short form of the service name without spaces plus .amazonaws.com. For example: AWS CloudFormation is cloudformation.amazonaws.com.\
\
For more information on the above two fields, visit: {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-record-contents.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-record-contents.html }}\
\
invokedBy:  This is the name of the AWS service that made the request, such as Amazon EC2 Auto Scaling or AWS Elastic Beanstalk.\
-->{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-user-identity.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-user-identity.html }}\
\
I am also linking you the sample event provided in our document: \
--->{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference.html }}\
\
I hope this information helps your query. As discussed, I will mark this case as resolved.\
\
Have a nice day!\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Fatima Zahra S.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8162071091&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8162071091&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 29 2021\cb1 \
\cb3 12:48:32 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 05:54:39 PM Fatima Zahra: Hello, my name is Fatima Zahra.  I'm here to help you today.\
05:54:45 PM Fatima Zahra: May I know your name please?\
05:55:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi \
05:55:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: my name is surendar\
05:55:39 PM Fatima Zahra: Hi Surendar, how are you?\
05:55:47 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have create cloudtrail \
05:55:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am good , how are you\
05:56:04 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you for asking\
05:56:09 PM Fatima Zahra: I am good! Thank you \
05:56:15 PM Fatima Zahra: Okay \
05:56:46 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have created the cloud trail , during the creation i have given the name of S3 bucket where the logs will store\
05:57:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: bucket is created now successfully, able to see the logs as well\
05:57:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but i am not able to find CreateBucket cloud trail event for this action\
05:57:52 PM Fatima Zahra: okay \
05:58:11 PM Fatima Zahra: Can I have the trail ARN?\
05:58:57 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have deleted it\
05:59:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok i will create it\
05:59:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime link to have screen share\
05:59:21 PM Fatima Zahra: Sure! \
06:00:16 PM Fatima Zahra: {\field{\*\fldinst{HYPERLINK "https://chime.aws/7087355804"}}{\fldrslt \cf4 \strokec4 https://chime.aws/7087355804 }}\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 29 2021\cb1 \
\cb3 12:48:23 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 when i was creating the cloudtrail, it is asking to store the logs in S3 bucket. we have clicked Ok, Bucket is created. but i am not able to see the CreateBucket cloud trail event for this activity  in cloud trail console.\
EventName (AWS API action): \
EventId: \
Trail ARN: \
\pard\pardeftab720\partightenfactor0
\cf2 \cb1 \
\'97\'97\'97\

\f0\b \

\fs28 \cb3 Call: Implementing credential source\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Greetings again Pravin!\
\
This is Rudolph from AWS! It was a great pleasure working with you, and thanks for contacting us! Kindly see some information about your case below.\
\
You initiated a call because your end-users are using a python script to AssumeRoleWithSAML that updates your AWS CLI credentials file, that is then used for running Jenkins jobs. They are however running into an issue where the session expires during jobs that are taking longer than an hour. You wanted to know how to implement "Sourcing credentials with an external process" [1]. Please correct me if I am wrong Pravin.\
\
[1] Sourcing credentials with an external process  - {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sourcing-external.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sourcing-external.html }}\
\
During the call you walked me through your setup and we discussed that the easiest way to solve the issue would be by specifying the DurationSeconds [2] parameter when logging in with the Python script, as long as the Maximum Session Duration for the Role is set to allow the timeframe as specified in the parameter. There is however a Lambda Function that is reverting any change made to the Maximum Session Duration back to 1 Hour if changed. The team responsible for this Lambda Function will therefore please have to whitelist that Role to allow a longer duration if possible.\
\
[2] AssumeRoleWithSAML - Request Parameters - {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html#API_AssumeRoleWithSAML_RequestParameters"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html#API_AssumeRoleWithSAML_RequestParameters }}\
\
I have otherwise also looked into [1] above, and it appears that you can indeed specify the path to your Python script, as it appears that AssumeRoleWithSAML does output the "Expiration" field; which has to be present to indicate temporary credentials "and are refreshed automatically by rerunning the credential_process command before they expire."\
\
This however means that the command that is being run, will once again require your end-users to enter their login details, which is likely not ideal, and might result in the Jenkins jobs failing regardless. It does however appear (if your script allows) that it is possible to specify Username and Password parameters in the "awsprocesscreds" [3] script from AWS Labs in the Confg file. Please see below the link :\
\
[3] AWS Process Creds {\field{\*\fldinst{HYPERLINK "https://github.com/awslabs/awsprocesscreds"}}{\fldrslt \cf4 \strokec4 https://github.com/awslabs/awsprocesscreds }}\
\
credential_process = awsprocesscreds-saml -e '{\field{\*\fldinst{HYPERLINK "https://corp.example.com/adfs/ls/IdpInitiatedSignOn.aspx?loginToRp=urn:amazon:webservices"}}{\fldrslt \cf4 \strokec4 https://corp.example.com/adfs/ls/IdpInitiatedSignOn.aspx?loginToRp=urn:amazon:webservices }}' -u Monty -p adfs -a arn:aws:iam::123456789012:role/ADFS-Dev\
\
I however do not think that this is feasible, as you have multiple users, and hardcoding their Usernames and Passwords into a config file would probably pose a bigger risk than extending the Maximum Session Duration. You could consider this, and test to see if the job still gets interrupted, but I imagine that this would not be a feasible solution.\
\
I truly hope that the above proves useful, and thanks again for contacting us! Please do not hesitate to come back with any questions, or to open another unrelated case with us!\
\
Have a great coming week Pravin!\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Rudolph W.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8157674751&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8157674751&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 29 2021\cb1 \
\cb3 05:57:08 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Team,\
\
I have tried extending the session duration of the role and noticed, still the AWS CLI is able to connect to cloud account. hence I think we can proceed with credential process.\
\
Thanks,\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Sun Mar 28 2021\cb1 \
\cb3 09:41:21 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hello Pravin\
\
It was a pleasure chatting to you regarding your IAM query.\
\
As disucssed you looking for way to extend your session duration for your Jenkin Jobs as the session expire within 1 hour.\
\
I reviewed your authentication flow as we reviewed your AssumeRoleWithSAML federating into your Jenkin application which in turn you using a Python script to generate session credential with one of your selected roles.\
\
The issue with this is specific to the CLI is you will not be able to extend the duration for session due to Role chaining. [1]\
\
*** Role chaining occurs when you use a role to assume a second role through the AWS CLI or API. For example, assume that User1 has permission to assume RoleA and RoleB. Additionally, RoleA has permission to assume RoleB. You can assume RoleA by using User1's long-term user credentials in the AssumeRole API operation. This operation returns RoleA short-term credentials. To engage in role chaining, you can use RoleA's short-term credentials to assume RoleB. [2]\
\
So to confirm role chaining please go ahead set the Maximum duration to a few hours and run your Jenkin session for >1 hour if you session still expire means role chaining is not permitting the session.\
\
Alternative you can either create IAM user credentials for long-term credentials which I know is not deal or have your script retry connection creating a new session after a hour. \
\
\
Please let me know after your tests if you still need further assistance.\
\
I hope to hear from you soon!\
\
References:\
- [1] {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/iam-role-chaining-limit/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/iam-role-chaining-limit/ }}\
- [2]  {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Marlin M.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8157674751&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8157674751&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: EMR : application provisioning failed issue\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hi Declan,\
\
Thanks for your detailed response and your support. It was very useful. Much Appreciated.\
\
\
Regards,\
Arun Kumar R\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 26 2021\cb1 \
\cb3 09:42:46 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 \sub Excellent\nosupersub \
\pard\pardeftab720\sa280\partightenfactor0
\cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hi Arun,\
\
Greetings from AWS!\
\
Thanks for going on the chat earlier. I hope you found it helpful in understanding why cluster j-15Z6FB6H83TKO failed with: \
\
=======\
On the master instance (i-08be21c5749c45249), application provisioning failed\
=======\
\
Great news you were able fix the original issue. \
\
I understand that you now have questions on your Lambda.KMSAccessDeniedException. Please correct me if I have misunderstood.\
\
Before I begin I would suggest moving forward to contact the Lambda support team on issues relating to AWS Lambda as they will have further expertise on this.\
\
Saying that I have some experience and as a result I have investigated this issue. I see Lambda functions use KMS keys to encrypt and decrypt environment variables, which are sensitive user data. lambda:Invoke returns 502 KMSAccessDeniedException when the function's execution role does not have permission to use the configured KMS key. Instead of configuring the function to use their own key, most customers select the automatically-created, default Lambda key. They can't delete this key, and our documentation says the execution role does not need any special statements to use the key -- it should "just automatically work". \
\
Usually, this error implies the function's execution role is re-created. When you create a function, change its execution role, or change its KMS key Lambda adds a grant to the key. This grant allows a principal (which corresponds to the execution role) to use the key. If you delete an execution role and create a new one with the same name, the role ARN doesn't change, but the underlying principal does. \
\
After re-creating, the role ARN is the same, but the principal ID changes due to which we see this error.\
\
Workaround\
==============\
Switch the execution role to a different value, and back using update-function-configuration :[2] CLI Command (or API Call).\
\
aws lambda update-function-configuration --function-name <LAMBDA_FUNCTION_NAME> --role <temporary role value/ARN>\
\
aws lambda update-function-configuration --function-name <LAMBDA_FUNCTION_NAME> --role <original role value/ARN>\
\
\
Recommendation\
==============\
The function execution Role should be kept intact to avoid this kind of situation, once the IAM role is created you can update the IAM role CLI commands :[3] (or equivalent API calls)\
\
I hope this helps you to solve the  Lambda issue. Please let us know if any further assistance is needed; we will be happy to help. I also request you to kindly rate my correspondence, it only takes a few seconds and it really helps us to fine-tune our responses to suit customer's need better.\
\
Have a great day Arun!\
\
References\
[1] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_identifiers.html#identifiers-unique-ids"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_identifiers.html#identifiers-unique-ids }}\
[2] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/cli/latest/reference/lambda/update-function-configuration.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/cli/latest/reference/lambda/update-function-configuration.html }}\
[3] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/IAM/latest/UserGuide/roles-managingrole-editing-cli.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/IAM/latest/UserGuide/roles-managingrole-editing-cli.html }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Declan L.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8152067001&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8152067001&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Owner (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 26 2021\cb1 \
\cb3 08:54:21 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Declan,\
\
I just found where the issue is. I have to pass the correct VPC CIDR to the EMR Cluster. I have changed the VPC's CIDR but didn't modified it in the EMR and that's why this error and i fixed and it looked good now.\
\
Thanks a lot for your help.\
\
But i would like to let you know about another issue which is not consistent.\
\
Error\
\
Lambda.KMSAccessDeniedException\
Cause\
\
Lambda was unable to decrypt the environment variables because KMS access was denied. Please check the function's KMS key settings. KMS Exception: UnrecognizedClientExceptionKMS Message: The security token included in the request is invalid. (Service: AWSLambda; Status Code: 502; Error Code: KMSAccessDeniedException; Request ID: c3501ccf-88c8-4cbf-a4a6-b5db0ef0a6d8; Proxy: null)\
\
But When i re-run the step function, it is getting fixed. Do you know why is that occuring inconsistently?\
\
\
Regards,\
Arun \
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 26 2021\cb1 \
\cb3 05:19:43 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 10:31:04 AM Declan: Hello, my name is Declan.  I'm here to help you today.\
10:31:16 AM Declan: How are you Arun?\
10:31:29 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Hi Declan\
10:31:38 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Im good. How are you?\
10:31:55 AM Declan: All good thanks for asking :)\
10:32:14 AM Declan: I understand you have application issues for cluster j-15Z6FB6H83TKO. Please correct me if I have misunderstood.\
10:32:41 AM Declan: Have you the step id and application id please?\
10:32:48 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Yes. this is one example but i face the same issue many times in different clusters.\
10:33:07 AM Declan: Ok I will check the example step id\
10:33:20 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: arn:aws:states:us-east-1:165387667510:execution:nonprod_on-demand-emr-test_on_demand_emr:6a30c519-acd5-fcb0-4d0f-ac72bbd4429f\
10:33:21 AM Declan: Can I confirm the step id please?\
10:34:30 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: arn:aws:states:us-east-1:165387667510:execution:nonprod_on-demand-emr-test_on_demand_emr:6a30c519-acd5-fcb0-4d0f-ac72bbd4429f - this is the step id\
10:34:39 AM Declan: Thanks\
10:35:23 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Also, i have triggered again which is running ID:j-126P8KDBPVSN6\
10:36:14 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: it is running for more than an hour but still master is bootstrapping and core in provisioning state.\
10:37:26 AM Declan: ok \
10:39:25 AM Declan: Can I ask are you using any custom bootstrap?\
10:39:54 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Yes. im using custom boostrap for enable EC2 v2 metadata options.\
10:40:19 AM Declan: I see this error in istance controller:\
10:40:20 AM Declan: lba:1 provision: FAILED, provisionFailureReason: DEPLOYMENT_ERROR\
10:40:41 AM Declan: this is an intermittent error but trying see why it caused the issue\
10:41:13 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: this is the bootstrap script\
10:41:17 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: #!/bin/bash\
instance_id=$(curl {\field{\*\fldinst{HYPERLINK "http://169.254.169.254/latest/meta-data/instance-id"}}{\fldrslt \cf4 \strokec4 http://169.254.169.254/latest/meta-data/instance-id }} )\
aws ec2 modify-instance-metadata-options --instance-id $\{instance_id\} --http-endpoint enabled --http-token required\
10:42:28 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Also, i found this message in bootstrap log\
10:42:31 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: 2021-03-26 07:59:32,001 INFO i-08be21c5749c45249: new instance started\
2021-03-26 07:59:40,381 INFO i-08be21c5749c45249: bootstrap action 1 completed\
2021-03-26 07:59:40,383 ERROR i-08be21c5749c45249: failed to start. bootstrap action 2 failed with non-zero exit code.\
10:43:34 AM Declan: so I see the cluster failed j-15Z6FB6H83TKO (EMR On Demand Test) has terminated with errors at  with a reason of BOOTSTRAP_FAILURE.\
10:44:14 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok. but this was working well before.\
10:44:35 AM Declan: just seeing what issue could be with bootstrap\
10:44:42 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure\
10:45:19 AM Declan: It does not say much just 2021-03-26 07:59:40,381 INFO i-08be21c5749c45249: bootstrap action 1 completed\
2021-03-26 07:59:40,383 ERROR i-08be21c5749c45249: failed to start. bootstrap action 2 failed with non-zero exit code.\
10:45:27 AM Declan: trying see if can get more insight\
10:46:50 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure. let me also check from my side\
10:52:11 AM Declan: I found in the puppet logs:\
10:52:20 AM Declan: 2021-03-26 09:01:18 +0000 /Stage[main]/Tez::Client/Exec[Copy Tez tarball to HDFS]/returns (notice): moveFromLocal: File /apps/tez/tez.tar.gz._COPYING_ could only be replicated to 0 nodes instead of minReplication (=1).  There are 0 datanode(s) running and no node(s) are excluded in this operation.\
2021-03-26 09:01:18 +0000 Puppet (err): 'hdfs dfs -moveFromLocal tez.tar.gz hdfs:///apps/tez/tez.tar.gz' returned 1 instead of one of [0]\
2021-03-26 09:01:18 +0000 /Stage[main]/Tez::Client/Exec[Copy Tez tarball to HDFS]/returns (err): change from 'notrun' to ['0'] failed: 'hdfs dfs -moveFromLocal tez.tar.gz hdfs:///apps/tez/tez.tar.gz' returned 1 instead of one of [0]\
2021-03-26 09:01:18 +0000 /Stage[main]/Tez::Client/Exec[Copy Tez tarball to HDFS] (info): Evaluated in 3569.03 seconds\
10:52:45 AM Declan: The error shows that it is having difficulty to communicate with the datanodes \
10:53:17 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok.. \
10:53:30 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Do you mean any firewall related issue?\
10:56:07 AM Declan: Ye it strange issue\
10:56:40 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: because the same setup worked before couple of days.\
10:58:16 AM Declan: Does you Bootstrap change anything on the emr nodes\
10:58:48 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: #!/bin/bash\
instance_id=$(curl {\field{\*\fldinst{HYPERLINK "http://169.254.169.254/latest/meta-data/instance-id"}}{\fldrslt \cf4 \strokec4 http://169.254.169.254/latest/meta-data/instance-id }} )\
aws ec2 modify-instance-metadata-options --instance-id $\{instance_id\} --http-endpoint enabled --http-token required\
10:59:20 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: yes. it enables metadata v2.\
10:59:43 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: The above 2 lines are the bootstrap script has\
11:00:01 AM Declan: I believe issue is happening due to a change the Bootstrap is making on EMR node\
11:00:24 AM Declan: Just to test would you be able launch exact same cluster without that bootstrap \
11:00:42 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure. i can do it.\
11:00:50 AM Declan: Thanks\
11:01:12 AM Declan: Also would you have an old cluster id where script worked \
11:01:18 AM Declan: just so can compare\
11:01:23 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure let me get that for you\
11:01:54 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ID:j-3C1T62UJUDE60\
11:01:54 AM Declan: Thanks Arun\
11:07:16 AM Declan: strange it worked fine on that cluster\
11:07:31 AM Declan: you think any config changes were changed on the network\
11:07:39 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: I just retriggered the step by commenting modify-instance-metadata-options \
11:08:47 AM Declan: ok\
11:09:22 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: i don't think so.\
11:09:30 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: j-27QIAHFCCNDFN - new EMR Cluster\
11:10:43 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: do you see any changes done from EMR side which may cause this issue?\
11:11:07 AM Declan: So I see in instance controller for cluster j-15Z6FB6H83TKO\
11:11:14 AM Declan: 2021-03-26 09:00:50,086 INFO Poller: I/O exception (java.net.ConnectException) caught when processing request: Connection refused (Connection refused)\
2021-03-26 09:00:50,086 INFO Poller: Retrying request\
2021-03-26 09:00:50,086 WARN Poller: Delay for 2 seconds before retry attempt 3/5 on {\field{\*\fldinst{HYPERLINK "http://10.10.1.229:8088/ws/v1/cluster/nodes"}}{\fldrslt \cf4 \strokec4 http://10.10.1.229:8088/ws/v1/cluster/nodes }}\
java.net.ConnectException: Connection refused (Connection refused)\
11:12:34 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok..\
11:13:42 AM Declan: lets see if new cluster fails without the bootstrap\
11:13:49 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok sure.\
11:18:04 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Master:Bootstrapping 1 units\
Core:Provisioning 1 units\
11:19:11 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: This is what happened in the previous run as well. master will be in the Boostrapping state for around 30 to 40 mins and then it through that error\
11:21:47 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: i think the issue is still there\
11:22:08 AM Declan: ok I have seen similar errors for DNS resolvable issue but I think I will need to raise a ticket with the service team on this as you said nothing changed from it working to it not\
11:22:44 AM Declan: I know the cause of failure but not sure what is causing this as of now\
11:23:13 AM Declan: Normally I would say failure is happening due to a change that script is making on EMR node\
11:23:18 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure. I will also try to run the same setup in different AWS account to validate\
11:23:23 AM Declan: but as it worked previously something else is up\
11:24:18 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Yes. little strange for me as well. It was blocker for me as it was supposed to release this week.\
11:24:24 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: but got stuck in this issue.\
11:28:26 AM Declan: Ye I get you\
11:28:57 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: So, do you want me to keep this setup available so that service team can take a look at it?\
11:29:24 AM Declan: Would you mind if I took this offline to deep dive see if any networking issue etc. If you can let me know via email if the cluster without bootstrap works\
11:29:40 AM Declan: too it would be appreciated\
11:30:04 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure. i will do that. I will also try it in a different account and let you know if that is working.\
11:30:26 AM Declan: Thanks \
11:30:36 AM Declan: Pleasure chatting with you and have a great day\
11:30:39 AM Declan: Bye for now\
11:31:04 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Thanks a lot for your timely help. Much Appreciated.\
11:31:10 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Will catch up later. Bye.\
11:32:25 AM Declan: Thanks Arun\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\

\f0\b \
\pard\pardeftab720\sl440\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8147463881&language=en"}}{\fldrslt 
\fs28 \cf4 \cb3 \ul \ulc4 \strokec4 Chat: How to check who created the buckets}}
\fs28 \cf4 \cb3 \ul \ulc4 \strokec4 \
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 \ulnone \strokec2 Hello Surendar,\
\
Thanks for your time on call and chat. It was a pleasure assisting you. Below is the summary of our conversation :\
\
You contacted us regarding a query where you wish to filter out all the bucket that were created directly by an AWS service automatically (without any consent). Regarding this I informed you that S3 is integrated with various AWS services but they wont create a bucket automatically unless you perform an action or allow the service to create a bucket. \
\
Usually when choosing S3 with any other AWS service, it will prompt you to either select an existing bucket or create a new bucket. Only when you choose to create a new bucket, then the service goes ahead and creates the bucket. To find out who created a S3 bucket. you can search for the "CreateBucket" API call in Cloudtrail and it will provide you all the details (user, time etc). Unfortunately , at this moment, we dont have a direct mechanism that helps in identifying and isolating API calls that were made from a service console to create a bucket. You can however check the user agent field that can sometimes be helpful and gives an indication which service console the API call would have been made as shown below but these fields keep on updating and cannot be used as reliable method to be ascertain that the API call was made from a AWS service console other than S3.\
\
userAgent":"[AWS Console Firehose, aws-internal/3], [AWS Console Config, aws-internal/3]\
\
Please try and perform some test in your sandbox environment before applying the same logic in production. \
\
I hope this information was helpful. Please feel free to write back to us incase if you have any further queries or concerns.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Divyanshu L.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8147463881&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8147463881&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Thu Mar 25 2021\cb1 \
\cb3 03:29:05 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 08:30:18 AM Divyanshu: Hello, my name is Divyanshu.  I'm here to help you today.\
08:30:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar\
08:30:59 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I just want to know, is there any service creating S3 buckets automaticaly\
08:31:35 AM Divyanshu: Hey Surendar, I can see that my colleague Lerato was already assisting you on this case, Shall I transfer this case back to him ?\
08:31:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i mean, if we creating or configuring the any aws service, S3 buckets creates automaticaly\
08:31:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no problem we can discuss\
08:32:29 AM Divyanshu: So shall I transfer ?\
08:32:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no problem we can discuss\
08:32:47 AM Divyanshu: okay\
08:33:41 AM Divyanshu: So you wish to know if there are any AWS services which creates S3 bucket automatically ?\
08:34:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
08:35:24 AM Divyanshu: There are multiple services which are integrated with S3 and can create the S3 bucket on your behalf automatically once you request for if, however I dont have the exhaustive list of all the service which can create S3 bucket\
08:35:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: you have any such experience \
08:35:57 AM Divyanshu: If you wish to see how a bucket has been created and all the details about if, you can check the Cloudtrail logs\
08:36:35 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because i want to create some policy to filter the S3 buckets which are created by the service \
08:37:39 AM Divyanshu: Can we get on a call to discuss this in detail\
08:37:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure sure \
08:37:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: share chime please\
08:38:03 AM Divyanshu: give me a moment\
08:38:28 AM Divyanshu: Meeting Link: {\field{\*\fldinst{HYPERLINK "https://chime.aws/aws-support-divyanshu"}}{\fldrslt \cf4 \strokec4 https://chime.aws/aws-support-divyanshu }}\
Meeting ID: aws-support-divyanshu\
U.S. Toll: +1 206-462-5569\
Meeting PIN: 2278 21 8040\
U.S. Toll-free: +1 855-552-4463\
International: {\field{\*\fldinst{HYPERLINK "https://chime.aws/dialinnumbers/"}}{\fldrslt \cf4 \strokec4 https://chime.aws/dialinnumbers/ }}\
\
09:12:57 AM Divyanshu: Thanks a lot for your time Surendar :D \
09:13:05 AM Divyanshu: Have a great day ahead :)\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Thu Mar 25 2021\cb1 \
\cb3 03:28:55 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 chat was closed\
\pard\pardeftab720\sl440\partightenfactor0
\cf2 \cb1 \
\'97\'97\'97\

\f0\b \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb3 Chat: cannot create folder in bucket after apply policy\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello Surendar,\
\
Due to no response, I will be forced to release the chat since I am not allowed to stay in an idle chat. I can see that you have modified the bucket policy as suggested in the document below, please run the test again and let us know if you need further assistance:\
\
   {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/enable-access-logs.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/enable-access-logs.html }}\
\
Please do not hesitate to contact us again should to you require assistance. Thank you for contacting AWS Premium Support, please enjoy the rest of the day.\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Bonguthando N.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8139718171&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8139718171&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 23 2021\cb1 \
\cb3 08:58:56 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 02:00:07 PM Bonguthando N: Hello, my name is Bonguthando N.  I'm here to help you today.\
02:00:17 PM Bonguthando N: May I please know your name\
02:01:00 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Surendar S\
02:01:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: hi i am running terraform script to create folder in bucket \
02:01:37 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am getting permission denied error \
02:01:39 PM Bonguthando N: Nice to meet you Surendar, how are you doing today?\
02:01:53 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am good , thank you for asking\
02:01:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how are you\
02:02:41 PM Bonguthando N: I am good thanks, I can see that you are getting an access denied\
02:03:08 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes yes\
02:03:09 PM Bonguthando N: May I please confirm if the terraform is making an HTTPS request?\
02:03:12 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how to fix it\
02:03:34 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: actualy , terraform script is enabling the access log in load balancer\
02:04:24 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: consequently it is trying to create folder to store the logs in bucket\
02:04:57 PM Bonguthando N: May you please share the role or user being used and the bucket name with me\
02:05:19 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure\
02:05:36 PM Bonguthando N: Thanks\
02:05:44 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: egress-proxy-nlb-logging-bucket\
\
02:05:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: username - surendar\
02:06:33 PM Bonguthando N: Okay, please give me a moment\
02:06:38 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok done\
02:07:44 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: arn:aws:iam::165387667510:role/AWS_165387667510_Contributor\
02:07:48 PM Bonguthando N: Is the user in this account?\
02:08:28 PM Bonguthando N: Oh okay, I can see the role\
02:11:55 PM Bonguthando N: Looks like you need edit the bucket policy and allow the ELB logs\
02:12:00 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no \
02:12:05 PM Bonguthando N: Please give me a sec\
02:12:18 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i will not able to change the policy\
02:12:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we need some other workaround for this\
02:13:27 PM Bonguthando N: In oerder to allow ELB logs to S3 you need to attach a policy like the one below:\
\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/enable-access-logs.html#attach-bucket-policy"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/enable-access-logs.html#attach-bucket-policy }}\
02:14:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok one moment\
02:14:30 PM Bonguthando N: No problem\
02:16:00 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: account id is my account ID\
02:16:11 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: or which is available in document\
02:17:03 PM Bonguthando N: Account ID of the account that is holding the elb\
02:17:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: 127311923021\
02:18:02 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: for us-east-1 ??\
02:20:30 PM Bonguthando N: Yesm youe ELB is in us-east-1?\
02:20:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes \
02:21:27 PM Bonguthando N: Okay, thats correct then\
02:22:10 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: \{\
	"Version": "2012-10-17",\
	"Statement": [\
		\{\
			"Effect": "Allow",\
			"Principal": \{\
				"AWS": "arn:aws:iam::127311923021:root"\
			\},\
			"Action": "s3:PutObject",\
			"Resource": "arn:aws:s3:::egress-proxy-nlb-logging-bucket/*"\
		\},\
		\{\
			"Effect": "Allow",\
			"Principal": \{\
				"Service": "delivery.logs.amazonaws.com"\
			\},\
			"Action": "s3:PutObject",\
			"Resource": "arn:aws:s3:::egress-proxy-nlb-logging-bucket/*",\
			"Condition": \{\
				"StringEquals": \{\
					"s3:x-amz-acl": "bucket-owner-full-control"\
				\}\
			\}\
		\},\
		\{\
			"Effect": "Allow",\
			"Principal": \{\
				"Service": "delivery.logs.amazonaws.com"\
			\},\
			"Action": "s3:GetBucketAcl",\
			"Resource": "arn:aws:s3:::egress-proxy-nlb-logging-bucket"\
		\}\
	]\
\}\
02:22:16 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is that policy is correct\
02:22:20 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ??\
02:24:45 PM Bonguthando N: \},\
      "Action": "s3:PutObject",\
      "Resource": "arn:aws:s3:::bucket-name/prefix/AWSLogs/your-aws-account-id/*"\
    \},\
    \{\
      "Effect": "Allow",\
      "Principal": \{\
        "Service": "delivery.logs.amazonaws.com"\
      \},\
      "Action": "s3:PutObject",\
      "Resource": "arn:aws:s3:::bucket-name/prefix/AWSLogs/your-aws-account-id/*",\
      "Condition": \{\
        "StringEquals": \{\
          "s3:x-amz-acl": "bucket-owner-full-control"\
\
\
I dont see this: /AWSLogs/your-aws-account-id/*"\
\
You need to replace the variables in red, and make sure that eveyrthing from the doc is there\
02:26:36 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: that is for just folder structure right ???\
02:27:57 PM Bonguthando N: You can skip the prefix or folder, but you need to have this: AWSLogs/your-aws-account-id/*" and put your account ID\
02:29:38 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok let me check\
02:30:26 PM Bonguthando N: Okay\
02:31:49 PM Bonguthando N: You can copy the bucket pplicy as it is, and then replace the variables in red\
02:36:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes i am doing it\
02:36:42 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i working on the terraform code to apply the policy\
02:37:10 PM Bonguthando N: Can you do it on using the S3 console?\
02:45:10 PM Bonguthando N: Hello, are you still there?\
02:46:26 PM Bonguthando N: I can see that you have modified the bucket policy\
02:54:13 PM Bonguthando N: Due to no response, I will be forced to release the chat as I am not allowed to sty in an idle chat, please do not hesitate to contact us again should to you require assistance. Thank you for contacting AWS Premium Support, please enjoy the rest of the day.\
\
\
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 23 2021\cb1 \
\cb3 08:58:43 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Error ::\
Error: failure configuring LB attributes: ValidationError: Access Denied for bucket: egress-proxy-nlb-logging-bucket. Please check S3bucket permission\
	status code: 400, request id: 04b6f379-5a38-4242-9cf6-85bfd6289f87\
\
\
Policy ::\
\
\{\
    "Version": "2012-10-17",\
    "Statement": [\
        \{\
            "Sid": "DenyInsecureCommunications",\
            "Effect": "Deny",\
            "Principal": "*",\
            "Action": "s3:*",\
            "Resource": "arn:aws:s3:::egress-proxy-nlb-logging-bucket/*",\
            "Condition": \{\
                "Bool": \{\
                    "aws:SecureTransport": "false"\
                \}\
            \}\
        \}\
    ]\
\}\
Bucket Name: \
Request ID(s): \
Extended Request ID(s): \cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\
\'97\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: Image builder pipeline failure for windows\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello,\
 \
Thank you for reaching out to AWS Premium Support. My name is Michal from the Windows team, and I will assist you with your case. I hope you're keeping safe there.\
 \
I understand that you are contacting us today, as one of your Image Builder pipeline is unable to complete due to the below error.\
"failureMessage": "another TOE process with ID 2158a32a-8b21-11eb-9a2c-128875c8db01 has reserved this instance for reboot. Cannot proceed",\
    "logUrl": "C:\\\\imagebuilder\\\\TaskOrchestratorAndExecutor\\\\TOE_2021-03-22_15-22-41_UTC-0_71e32ae1-8b22-11eb-8fb5-128875c8db01"\
Please feel free to correct me if I have misunderstood or omit something.\
 \
Above error appeared in Failed automation execution with ID of 760a9810-25a6-4144-93b2-354aec8d7675. That execution is running ImageBuilderBuildImageDocument automation document against instance with ID: i-05192458635f5ca5b.\
 \
I have a closer look into the instance with ID: i-05192458635f5ca5b and can confirm that other SSM automations were executed against that machine as well:\
9ab6283b-2832-4388-ac3a-067582ffb9f6 - with AWS-ConfigureAWSPackage that successfully installed AmazonCloudWatchAgent - 2021-03-22 15:10:04 UTC\
883b3847-77b4-4a89-ae64-b7b53e28d544 - with AmazonCloudWatch-ManageAgent that failed to configure your Cloud Watch Agent with failure that CloudWatch Agent not installed. - 2021-03-22 15:10:04\
 \
That is suggesting issues with the installation of the CloudWatch agent. That installation did not complete correctly and could require a restart of the machine [1, 2]. Can you please perform that reboot and confirm if your Image Builder pipeline completing the process successfully?\
 \
I hope that you find the above information helpful. In case you feel I missed out to address something more to your concern, or if I can otherwise provide any additional assistance concerning this matter, please do let me know so that I can assist you further.\
 \
Thank you, and have a nice day ahead.\
====================================\
References:\
[1] Installing and Running the CloudWatch Agent on Your Servers\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/install-CloudWatch-Agent-commandline-fleet.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/install-CloudWatch-Agent-commandline-fleet.html }}\
[2]  Installing the CloudWatch Agent on EC2 Instances Using Your Agent Configuration\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/install-CloudWatch-Agent-on-EC2-Instance-fleet.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/install-CloudWatch-Agent-on-EC2-Instance-fleet.html }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Michal M.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8135727221&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8135727221&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 22 2021\cb1 \
\cb3 10:45:21 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Trying to connect with mobile.\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 22 2021\cb1 \
\cb3 10:42:09 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Image builder pipeline failure for windows due to instance got reservered with another TOE process,\
\
"failureMessage": "another TOE process with ID 2158a32a-8b21-11eb-9a2c-128875c8db01 has reserved this instance for reboot. Cannot proceed",\
    "logUrl": "C:\\\\imagebuilder\\\\TaskOrchestratorAndExecutor\\\\TOE_2021-03-22_15-22-41_UTC-0_71e32ae1-8b22-11eb-8fb5-128875c8db01"\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\
\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: alram action return null\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello Surendar,\
\
Greetings from AWS, Christian here.\
\
Today we had a chat/call over a situation where after you deploy your ECS Service through Terraform, the alarms for step scaling are not being triggered with the warning 'No step adjustment found for metric value'.\
\
There are a couple of considerations that we have to take into place here.\
\
1. Your task is using less than 1% of CPU for the past 12 hours. There will be no scale out with that value.\
2. The scale in metric will be triggered when the CPU >= 5, but you are using less than 1%, again, this will not be triggered.\
\
As from our shared responsibility model, we can't update your Terraform .tf files but there is a good module here[6] maintained by AWS itself that can be used for that purpose.\
\
Now, to fix this in the Management Console, although Amazon ECS Service Auto Scaling supports using Application Auto Scaling step scaling policies, we recommend using target tracking scaling policies instead[4].\
\
To configure basic Service Auto Scaling parameters[3]:\
\
1. On the service page. Choose Update to update your service.\
2. On the Update service page, choose Next step until you get to Step 3: Set Auto Scaling (optional).\
3. For Service Auto Scaling, choose Configure Service Auto Scaling to adjust your service\'92s desired count.\
4. For Minimum number of tasks, enter 1 for the lower limit of the number of tasks for Service Auto Scaling to use.\
5. For Desired number of tasks, leave this value at 1.\
6. For Maximum number of tasks, enter 2 for the upper limit of the number of tasks for Service Auto Scaling to use.\
7. For IAM role for Service Auto Scaling, choose the ecsAutoscaleRole. If this role does not exist, choose Create new role to have the console create it for you.\
\
To configure a target tracking scaling policy for your service:\
\
1. Choose Add scaling policy to configure your scaling policy.\
2. On the Add policy page, update the following fields:\
\
    - For Scaling policy type, choose Target tracking.\
    - For Policy name, enter TargetTrackingPolicy.\
    - For ECS service metric, choose ECSServiceAverageCPUUtilization.\
    - For Target value, enter 75.\
    - For Scale-out cooldown period, enter 60 seconds.\
    - For Scale-in cooldown period, enter 60 seconds.\
    - Choose Save.\
\
3. Choose Next step.\
4. Review all of your choices and then choose Update Service.\
5. When your service status is finished updating, choose View Service.\
\
Because your task never goes beyond 1% of CPU utilization, you will see few occurrences of scaling out, try to add load to your tasks in order to cross 75% to see the scaling activity.\
\
I hope the above helped, but if you have additional queries regarding it, please let us know. We will be happy to assist you till everything is working properly.\
\
References:\
==================\
[1] Service Auto Scaling - {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-auto-scaling.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-auto-scaling.html }}\
[2] Target Tracking Scaling Policies  - Considerations - {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-autoscaling-targettracking.html#targettracking-considerations"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-autoscaling-targettracking.html#targettracking-considerations }}\
[3] Target Tracking Scaling Policies  - Step 2: Configure Service Auto Scaling  - {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-autoscaling-targettracking.html#tt-configure-autoscaling"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-autoscaling-targettracking.html#tt-configure-autoscaling }}\
[4] Step Scaling Policies - {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-autoscaling-stepscaling.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-autoscaling-stepscaling.html }}\
[5] {\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/blogs/compute/automatic-scaling-with-amazon-ecs/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/blogs/compute/automatic-scaling-with-amazon-ecs/ }}\
[6] {\field{\*\fldinst{HYPERLINK "https://registry.terraform.io/modules/terraform-aws-modules/ecs/aws/latest"}}{\fldrslt \cf4 \strokec4 https://registry.terraform.io/modules/terraform-aws-modules/ecs/aws/latest }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Christian C.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8126161891&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8126161891&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 19 2021\cb1 \
\cb3 04:57:38 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 10:09:03 AM Christian Chostak: Hello, my name is Christian Chostak.  I'm here to help you today.\
10:09:15 AM Christian Chostak: May I know your name?\
10:09:48 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: surendar\
10:09:59 AM Christian Chostak: how are you Surendar?\
10:10:10 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am good\
10:10:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you\
10:10:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how are you\
10:10:22 AM Christian Chostak: I'm great, thank you for asking\
10:10:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am facing issue in ECS autoscaling\
10:11:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: metric is in alarm state, but action failed\
10:11:33 AM Christian Chostak: ok, let me take a look at the resources you mentioned in the email, one moment\
10:11:55 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Summary\
Failed to execute action arn:aws:autoscaling:us-east-1:165387667510:scalingPolicy:afbcdd8f-121e-4a27-8bc6-c0190cd745b3:resource/ecs/service/egress-proxy-egress-proxy/egress-proxy-egress-proxy:policyName/egress-proxy-egress-autoscaling_scale_down. Received error: ""\
Data\
\{\
  "alarmName": "egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low",\
  "alarmType": "MetricAlarm",\
  "timestamp": "2021-03-19T08:45:56.835Z",\
  "historyItemType": "Action",\
  "historySummary": "Failed to execute AutoScaling action: No step adjustment found for metric value [0.40579378794063814] and breach delta -4.594206212059362",\
  "historyData": \{\
    "actionState": "Failed",\
    "stateUpdateTimestamp": 1616143556732,\
    "notificationResource": "arn:aws:autoscaling:us-east-1:165387667510:scalingPolicy:afbcdd8f-121e-4a27-8bc6-c0190cd745b3:resource/ecs/service/egress-proxy-egress-proxy/egress-proxy-egress-proxy:policyName/egress-proxy-egress-autoscaling_scale_down",\
    "publishedMessage": null,\
    "error": null\
  \}\
\}\
10:12:11 AM Christian Chostak: this is the error part, correct?\
10:12:43 AM Christian Chostak: do you have the name of the ecs cluster at hand?\
10:12:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
10:13:03 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Service : egress-proxy-egress-proxy\
10:13:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: cluster : egress-proxy-egress-proxy\
10:13:20 AM Christian Chostak: ok, thank you\
10:14:11 AM Christian Chostak: ok, this service you mentioned 'egress-proxy-egress-proxy'\
10:14:16 AM Christian Chostak: its running on Fargate, correct?\
10:14:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
10:14:21 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
10:15:07 AM Christian Chostak: how did you configured scaling for Fargate?\
10:15:20 AM Christian Chostak: which document you followed\
10:15:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am actually provisioning the infrastructure using terraform script\
10:16:01 AM Christian Chostak: ok, do you have the .tf file?\
10:16:08 AM Christian Chostak: or the module you downloaded\
10:16:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes i do have wit me\
10:16:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have .tf file\
10:16:23 AM Christian Chostak: can you submit through the case email?\
10:16:43 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i can show it on the screen share\
10:16:52 AM Christian Chostak: ok, let me create a room\
10:16:53 AM Christian Chostak: one moment\
10:16:59 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok \
10:17:15 AM Christian Chostak: Meeting Link: {\field{\*\fldinst{HYPERLINK "https://chime.aws/6179813274"}}{\fldrslt \cf4 \strokec4 https://chime.aws/6179813274 }}\
Meeting ID: 6179 81 3274\
U.S. Toll: +1 206-462-5569\
Meeting PIN: 6179 81 3274\
U.S. Toll-free: +1 855-552-4463\
International: {\field{\*\fldinst{HYPERLINK "https://chime.aws/dialinnumbers/"}}{\fldrslt \cf4 \strokec4 https://chime.aws/dialinnumbers/ }}\
\
10:17:43 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joinin in\
10:19:41 AM Christian Chostak: ok\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 19 2021\cb1 \
\cb3 04:57:28 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 connection was closed when trying connect chat\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 19 2021\cb1 \
\cb3 04:51:19 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 CloudWatch\
Alarms\
egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low\
Alarms (34)\
\
Search\
Hide Auto Scaling alarms\
\
1\
\
egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low\
\
Metric alarm\
In alarm\
servicenow test alert\
\
Metric alarm\
In alarm\
Appstream2-WyattTest-default-scale-in-Alarm\
\
Metric alarm\
In alarm\
\
egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low\
\
Actions\
Graph\
View in metrics\
In alarm\
CPUUtilization\
CPUUtilization <= 5 for 1 datapoints within 5 minutes\
\
0.056\
2.53\
5\
12:30\
12:45\
13:00\
13:15\
13:30\
13:45\
14:00\
14:15\
14:30\
14:45\
15:00\
15:15\
03-19 12:29\
3.9\
CPUUtilization\
Percent\
Details\
Name\
egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low\
Type\
Metric alarm\
Description\
Scale in if average Squid traffic < 10 CPUUtilization for 300 seconds\
State\
In alarm\
Threshold\
CPUUtilization <= 5 for 1 datapoints within 5 minutes\
Last change\
2021-03-19 08:45:56\
Namespace\
AWS/ECS\
Metric name\
CPUUtilization\
ServiceName\
egress-proxy-egress-proxy\
ClusterName\
egress-proxy-egress-proxy\
Statistic\
Average\
Period\
5 minutes\
Datapoints to alarm\
1 out of 1\
Missing data treatment\
Treat missing data as missing\
Percentiles with low samples\
evaluate\
ARN\
arn:aws:cloudwatch:us-east-1:165387667510:alarm:egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low\
Actions\
Type\
Description\
Config\
Auto Scaling	When in alarm, use policy egress-proxy-egress-autoscaling_scale_down (Remove 1 task)	\
-\
\
History (8)\
Search\
\
1\
2\
3\
\
Date\
Type\
Description\
2021-03-19 08:45:56	Action	Failed to execute action arn:aws:autoscaling:us-east-1:165387667510:scalingPolicy:afbcdd8f-121e-4a27-8bc6-c0190cd745b3:resource/ecs/service/egress-proxy-egress-proxy/egress-proxy-egress-proxy:policyName/egress-proxy-egress-autoscaling_scale_down. Received error: ""\
2021-03-19 08:45:56	State update	Alarm updated from Insufficient data to In alarm\
2021-03-19 08:43:46	Configuration update	Alarm "egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low" created\
2021-03-19 06:42:16	Configuration update	Alarm "egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low" deleted\
2021-03-19 05:44:44	Action	Failed to execute action arn:aws:autoscaling:us-east-1:165387667510:scalingPolicy:7444de91-65db-4f8c-b971-fabff23459bd:resource/ecs/service/egress-proxy-egress-proxy/egress-proxy-egress-ecs-poc-service:policyName/egress-proxy-egress-autoscaling_scale_down. Received error: ""\
2021-03-19 05:44:44	State update	Alarm updated from Insufficient data to In alarm\
2021-03-19 05:43:09	Configuration update	Alarm "egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low" created\
2021-03-18 18:07:30	Configuration update	Alarm "egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low" deleted\
Parent alarms\
Search alarms\
\
1\
\
Name\
ARN\
No alarms\
This alarm has no parent alarms\
\
History data\
State change in alarm at 2021-03-19 08:45:56\
\
Summary\
Failed to execute action arn:aws:autoscaling:us-east-1:165387667510:scalingPolicy:afbcdd8f-121e-4a27-8bc6-c0190cd745b3:resource/ecs/service/egress-proxy-egress-proxy/egress-proxy-egress-proxy:policyName/egress-proxy-egress-autoscaling_scale_down. Received error: ""\
Data\
\{\
  "alarmName": "egress-proxy-egress-cloudwatch-alarm-cpu-utilization-low",\
  "alarmType": "MetricAlarm",\
  "timestamp": "2021-03-19T08:45:56.835Z",\
  "historyItemType": "Action",\
  "historySummary": "Failed to execute AutoScaling action: No step adjustment found for metric value [0.40579378794063814] and breach delta -4.594206212059362",\
  "historyData": \{\
    "actionState": "Failed",\
    "stateUpdateTimestamp": 1616143556732,\
    "notificationResource": "arn:aws:autoscaling:us-east-1:165387667510:scalingPolicy:afbcdd8f-121e-4a27-8bc6-c0190cd745b3:resource/ecs/service/egress-proxy-egress-proxy/egress-proxy-egress-proxy:policyName/egress-proxy-egress-autoscaling_scale_down",\
    "publishedMessage": null,\
    "error": null\
  \}\
\}\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97
\f0\b \

\fs28 \cb3 Chat: cannot put object after enabling server side encryption policy\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 03:53:14 PM Chinmay: Hello, my name is Chinmay.  I'm here to assist you today.\
03:53:35 PM Chinmay: Hello Surendar, how are you doing today?\
03:54:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi\
03:54:43 PM Chinmay: As per the case details, I understand that you cannot upload objects to the bucket after putting the server side encryption policy\
03:55:31 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
03:55:47 PM Chinmay: The bucket "egressdemo-workflow" is deleted for now\
03:55:51 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
03:56:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but i just initiated the terraform script to create the bucket and put object in same bucket\
03:56:39 PM Chinmay: okay, can we do a chime call with screenshare to discuss further?\
03:56:49 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes sure\
03:57:12 PM Chinmay: Please join:\
03:57:13 PM Chinmay: Meeting Link: {\field{\*\fldinst{HYPERLINK "https://chime.aws/1248867570"}}{\fldrslt \cf4 \strokec4 https://chime.aws/1248867570 }}\
Meeting ID: 1248 86 7570\
U.S. Toll: +1 206-462-5569\
Meeting PIN: 1248 86 7570\
U.S. Toll-free: +1 855-552-4463\
International: {\field{\*\fldinst{HYPERLINK "https://chime.aws/dialinnumbers/"}}{\fldrslt \cf4 \strokec4 https://chime.aws/dialinnumbers/ }}\
\
03:57:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joining in\
04:44:29 PM Chinmay: closing the chat now\
\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Mar 17 2021\cb1 \
\cb3 10:50:41 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 i am creating the s3 bucket with the sever side encryption policy using terraform script after that terraform script trying to put one object into the s3 bucket. but it is getting failed.\
\
sample policy for your reference.\
\
\{\
	"Version": "2012-10-17",\
	"Id": "PutObjectPolicy",\
	"Statement": [\
		\{\
			"Sid": "DenyIncorrectEncryptionHeader",\
			"Effect": "Deny",\
			"Principal": "*",\
			"Action": "s3:PutObject",\
			"Resource": "arn:aws:s3:::egressdemo-workflow/*",\
			"Condition": \{\
				"StringNotEquals": \{\
					"s3:x-amz-server-side-encryption": "AES256"\
				\}\
			\}\
		\},\
		\{\
			"Sid": "DenyUnencryptedObjectUploads",\
			"Effect": "Deny",\
			"Principal": "*",\
			"Action": "s3:PutObject",\
			"Resource": "arn:aws:s3:::egressdemo-workflow/*",\
			"Condition": \{\
				"Null": \{\
					"s3:x-amz-server-side-encryption": "true"\
				\}\
			\}\
		\},\
		\{\
			"Sid": "ForceSSLOnlyAccess",\
			"Effect": "Deny",\
			"Principal": "*",\
			"Action": "s3:*",\
			"Resource": "arn:aws:s3:::egressdemo-workflow/*",\
			"Condition": \{\
				"Bool": \{\
					"aws:SecureTransport": "false"\
				\}\
			\}\
		\}\
	]\
\}\
Bucket Name: \
Request ID(s): \
Extended Request ID(s): \cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: Image builder pipeline failure for windows\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello,\
 \
Thank you for reaching out to AWS Premium Support. My name is Michal from the Windows team, and I will assist you with your case. I hope you're keeping safe there.\
 \
I understand that you are contacting us today, as one of your Image Builder pipeline is unable to complete due to the below error.\
"failureMessage": "another TOE process with ID 2158a32a-8b21-11eb-9a2c-128875c8db01 has reserved this instance for reboot. Cannot proceed",\
    "logUrl": "C:\\\\imagebuilder\\\\TaskOrchestratorAndExecutor\\\\TOE_2021-03-22_15-22-41_UTC-0_71e32ae1-8b22-11eb-8fb5-128875c8db01"\
Please feel free to correct me if I have misunderstood or omit something.\
 \
Above error appeared in Failed automation execution with ID of 760a9810-25a6-4144-93b2-354aec8d7675. That execution is running ImageBuilderBuildImageDocument automation document against instance with ID: i-05192458635f5ca5b.\
 \
I have a closer look into the instance with ID: i-05192458635f5ca5b and can confirm that other SSM automations were executed against that machine as well:\
9ab6283b-2832-4388-ac3a-067582ffb9f6 - with AWS-ConfigureAWSPackage that successfully installed AmazonCloudWatchAgent - 2021-03-22 15:10:04 UTC\
883b3847-77b4-4a89-ae64-b7b53e28d544 - with AmazonCloudWatch-ManageAgent that failed to configure your Cloud Watch Agent with failure that CloudWatch Agent not installed. - 2021-03-22 15:10:04\
 \
That is suggesting issues with the installation of the CloudWatch agent. That installation did not complete correctly and could require a restart of the machine [1, 2]. Can you please perform that reboot and confirm if your Image Builder pipeline completing the process successfully?\
 \
I hope that you find the above information helpful. In case you feel I missed out to address something more to your concern, or if I can otherwise provide any additional assistance concerning this matter, please do let me know so that I can assist you further.\
 \
Thank you, and have a nice day ahead.\
====================================\
References:\
[1] Installing and Running the CloudWatch Agent on Your Servers\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/install-CloudWatch-Agent-commandline-fleet.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/install-CloudWatch-Agent-commandline-fleet.html }}\
[2]  Installing the CloudWatch Agent on EC2 Instances Using Your Agent Configuration\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/install-CloudWatch-Agent-on-EC2-Instance-fleet.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/install-CloudWatch-Agent-on-EC2-Instance-fleet.html }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Michal M.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8135727221&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8135727221&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 22 2021\cb1 \
\cb3 10:45:21 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Trying to connect with mobile.\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 22 2021\cb1 \
\cb3 10:42:09 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Image builder pipeline failure for windows due to instance got reservered with another TOE process,\
\
"failureMessage": "another TOE process with ID 2158a32a-8b21-11eb-9a2c-128875c8db01 has reserved this instance for reboot. Cannot proceed",\
    "logUrl": "C:\\\\imagebuilder\\\\TaskOrchestratorAndExecutor\\\\TOE_2021-03-22_15-22-41_UTC-0_71e32ae1-8b22-11eb-8fb5-128875c8db01"\
\pard\pardeftab720\partightenfactor0
\cf2 \cb1 \
\'97\'97\'97\

\f0\b \

\fs28 \cb3 Chat: Setup Excel in AppStream\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello Navaneethan,\
\
Thank you very much for your time today on our chat.  In summary, you had some questions about running Microsoft Excel in an AWS AppStream 2.0 fleet and initiated a chat to help get answers from Premier Support.\
\
I started out by confirming that licensing for Office is going to be the main point here.  Licensing for AppStream does require some special considerations, due to the fact that streaming instances will be replaced daily or more often depending on your configuration. An active session will connect to an available streaming instance, once the session is ended and the disconnect time out is reached, the streaming instance is terminated and will be replaced with a new one as needed based on your scaling policies. Users will not share a streaming instance, session to instance is a 1 to 1 mapping (very much like WorkSpaces).\
\
Keeping this information in mind, we do have other customers who have successfully deployed Office on AppStream. You will need to ensure that it is configured for shared activation as shown following the below URL :\
\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://docs.microsoft.com/en-us/DeployOffice/overview-of-shared-computer-activation-for-office-365-proplus"}}{\fldrslt \cf4 \strokec4 https://docs.microsoft.com/en-us/DeployOffice/overview-of-shared-computer-activation-for-office-365-proplus }}\
\
This next URL shows you how to adjust registry key components prior to creating the Image Builder that you can update to your fleet:\
\
{\field{\*\fldinst{HYPERLINK "https://blogs.technet.microsoft.com/educloud/2015/03/20/how-to-setup-shared-computer-activation-step-by-step-for-your-education-environment/"}}{\fldrslt \cf4 \strokec4 https://blogs.technet.microsoft.com/educloud/2015/03/20/how-to-setup-shared-computer-activation-step-by-step-for-your-education-environment/ }}\
\
  Note: AppStream instance requires internet access to contact the Office Licensing Service on the Internet to obtain or renew a licensing token.\
\
The link below also provides some more information on Office365 running VDI:\
\
{\field{\*\fldinst{HYPERLINK "https://www.microland.com/insights/blogs/deploying-office-365-how-it-is-different-for-vdi"}}{\fldrslt \cf4 \strokec4 https://www.microland.com/insights/blogs/deploying-office-365-how-it-is-different-for-vdi }}\
\
If you do have more specific questions regarding office365 licensing, Microsoft is going to be the best point of contact, as the same product can be licensed in multiple ways, and you will need to know what is or is not supported by your license model.\
\
Once your licensing model is decided on and a plan is purchased, you can then use the following documentation link in order to launch your Image Builder to install o365 on and then create an image and fleet for use:\
\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/appstream2/latest/developerguide/getting-started.html"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/appstream2/latest/developerguide/getting-started.html }}\
\
Please feel free to let me know if you have any additional questions or concerns and myself or the next available engineer will be more than happy to assist!\
\
Please let us know if we helped resolve your issue: \
\
 If YES, click here: \
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/feedback?eventId=8117981811&language=en&questionnaireId=Support-HMD-Yes"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/feedback?eventId=8117981811&language=en&questionnaireId=Support-HMD-Yes }}\
\
 If NO, click here: \
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/feedback?eventId=8117981811&language=en&questionnaireId=Support-HMD-No"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/feedback?eventId=8117981811&language=en&questionnaireId=Support-HMD-No }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Cory L.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8117981811&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8117981811&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Mar 17 2021\cb1 \
\cb3 09:04:08 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 02:29:03 PM Cory L.: Hello, my name is Cory L..  I'm here to help you today.  Can I have your name please?\
02:29:21 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Hi. I'm Navaneethan.\
02:29:33 PM Cory L.: Hi Navaneethan, I am reviewing the case now.\
02:29:40 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Sure. Thanks!\
02:29:45 PM Cory L.: I see you had some questions about configuring Microsoft Excel for Appstream\
02:30:13 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: That's right\
02:32:44 PM Cory L.: Ok just a few moments while I review this and then we can continue.\
02:32:53 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Sure. No problem.\
02:37:56 PM Cory L.: Ok so I did want to start off by letting you know that currently it only looks like office365 apps are compatible with AppStream from a licensing perspective.  We always recommend our customers to check with their Microsoft Licensing provider and or support to confirm the licensing requirements for non-o365 installations.\
02:39:05 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Oh alright! But, wouldn't Excel be a part of Office365 app?\
02:39:18 PM Cory L.: Yes that is correct.\
02:40:22 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Sorry but what are the apps that come under office365?\
02:40:41 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Because I see that Excel seems to be a part of it. Not sure if I'm wrong\
02:40:54 PM Cory L.: I know the 4 core are Word, Access, Excel and Outlook.  I have not checked in a while so that may have changed,.\
02:41:09 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Got it\
02:42:36 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: So, to confirm Excel can be configured through AppStream. But, for the license we would need to reach out to Microsoft?\
02:42:47 PM Cory L.: That is correct.\
02:42:57 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Great\
02:43:29 PM Cory L.: Specifically there is a "shared activation" that needs to be configured for it to  be activated properly in AppStream.\
02:43:30 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: So, once we get the license from Microsoft are there a list of steps available to set that up through Appstream?\
02:43:41 PM Cory L.: {\field{\*\fldinst{HYPERLINK "https://docs.microsoft.com/en-us/DeployOffice/overview-of-shared-computer-activation-for-office-365-proplus"}}{\fldrslt \cf4 \strokec4 https://docs.microsoft.com/en-us/DeployOffice/overview-of-shared-computer-activation-for-office-365-proplus }}\
02:43:56 PM Cory L.: I will include any links and documentation as well in an email summary of the case.\
02:44:32 PM Cory L.: Once you have your o365 plan all set, you can then just use the normal AWS user guide to setup your first Image Builder.\
02:45:12 PM Cory L.: Is Excel a hard requirement?\
02:45:24 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Unfortunately yes\
02:45:39 PM Cory L.: You may have a simpler solution using a open source spreadsheet app\
\
02:45:44 PM Cory L.: ah yeah I understand.\
02:46:04 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: There are some custom macros that are written in Excel..\
02:46:08 PM Cory L.: gotcha\
02:48:20 PM Cory L.: So essentially, you would need to purchase your o365 plan.  Then configure the Image Builder and make the needed changes so that each fleet instance created from that image can activate o365.  Then each AppStream instance in the fleet would use internet access to contact the Office Licensing Service on the Internet to obtain or renew a licensing token whenever it is launched.\
\
02:49:20 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Sure yeah then the first step would be to get the license for O365 from my end.\
02:49:22 PM Cory L.: I have a couple of more reference links, I can put them in this chat or just include them in an email summary for you.\
02:49:25 PM Cory L.: Correct.\
02:49:47 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Yeah probably it would be better if you can put the references in the email\
02:50:05 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: one additional question on Appstream\
02:50:15 PM Cory L.: Sure thing, one is a 3rd party blog post going over differences for o365 and how it is different for VDI deployments (appstream2.0)\
02:50:41 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Can we host a custom application and configure it through Appstream?\
02:50:55 PM Cory L.: and the others will be walkthroughs for setting up appstream once you get the licensing and installation directions from Microsoft.\
02:51:00 PM Cory L.: You certainly can.\
02:51:09 PM Cory L.: Pretty much any app works in AppStream.\
02:51:18 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Great\
02:52:03 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: So, we have to build our Image with the application configured in it and then use it through Appstream?\
02:52:38 PM Cory L.: Yep you setup the image builder first - get the apps installed and use it to test how the app will work in appstream.\
02:53:35 PM Cory L.: then, you tell the image builder to make a new image, it shuts down and goes through that processess.  Once done, you can then use that image to configure the fleet.\
02:54:18 PM Cory L.: Then a 'stack' gets created, this holds the sign-on options and a few other settings, and the fleet gets assigned to that stack.  Then you're done.\
02:54:49 PM Cory L.: Image > Fleet > Stack  in that order.\
02:55:51 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Great thanks for the explanation\
02:56:15 PM Cory L.: If you would like to play around with AppStream in the meantime and test other apps to get a feel for it.  We have a "Try it now" feature for appstream which will walk you through setting up a sample app and seeing how the Solution works.\
02:57:07 PM Cory L.: I'll include a link as well in my summary for that in case you wanted to test it with a free app like Notepad or an internet browser first just to see how AppStream works and functions.\
02:57:35 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Yeah I was trying out the free sample apps that was present in there.\
02:57:58 PM Cory L.: oh awesome, then you probably already got a feel for how it goes then.\
02:58:08 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Yup that's right\
02:58:46 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: But, that link in Summary would definitely help as well.\
02:58:56 PM Cory L.: Most definitely.\
02:59:09 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Will probably go over them and reach out out if I have additional questions n it.\
02:59:18 PM Cory L.: Ok so I will get together links and documentation on things we discussed on the chat\
02:59:27 PM Cory L.: Perfect, I was about to ask if there was anything else I could help with.\
02:59:54 PM Cory L.: If not then feel free to close the chat window when ready.  Have a great rest of your day and I will get this summary of our chat over shortly.\
03:00:00 PM Cory L.: Thank you!\
03:00:14 PM assumed-role/AWS_165387667510_Owner/ngunasek@optum.com: Sure thank you so much!\
\
\
\cb1 \
\cb3 AWS_165387667510_Owner (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Wed Mar 17 2021\cb1 \
\cb3 09:03:56 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi,\
\
We are trying to see if we could setup MS Excel through AppStream. Can you please guide us through the steps for it and if there is any license cost for the same?\
\
Thanks!\
Resources affected (if any): \
AWS Region in which you faced the issue: \cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\

\f0\b \
\pard\pardeftab720\sl440\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8117933431&language=en"}}{\fldrslt 
\fs28 \cf4 \cb3 \ul \ulc4 \strokec4 Stream MS Excel through AppStream}}
\fs28 \cf4 \cb3 \ul \ulc4 \strokec4 \
\
No comments\
\'97\'97\
\pard\pardeftab720\sl440\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb1 \ulnone \strokec2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb3 Chat: application autoscaling\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hi,\
\
Thank you for contacting AWS support. My name is Abraham and I will be supporting you on this case.\
\
I understand that you want to set up autoscaling for your ECS service.\
\
I shared a blog article [1] which guides you in setting up autoscaling for ECS, but you could not find the Auto Scaling option on your ECs console. We tried performing a screenshare via Chime but this was not successful (screensharing took a long time to load and then terminated by itself).\
\
You indicated that you were going to call in later again should you require assistance via a screenshare. I am transferring this case to the ECS team to assist you with setting up autoscaling for your ECS clusters as they are more familiar with the ECS console.\
\
Should you have any additional questions, thoughts, concerns or queries please don't hesitate to ask. \
\
[1] {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/blogs/compute/automatic-scaling-with-amazon-ecs/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/blogs/compute/automatic-scaling-with-amazon-ecs/ }}\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Abraham d.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8111849721&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8111849721&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_P0001489@optum.com\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 15 2021\cb1 \
\cb3 23:52:56 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 04:55:08 AM Abraham: Hello, my name is Abraham.  I'm here to help you today.\
04:57:59 AM Abraham: Hello\
04:59:16 AM Abraham: I see you are trying to set up autoscaling for your ECs service.\
05:00:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes\
05:00:49 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i want to setup autoscaling for ECS fargate service\
05:01:35 AM Abraham: Have you seen this blog article which provides guidance on how to set this up? {\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/blogs/compute/automatic-scaling-with-amazon-ecs/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/blogs/compute/automatic-scaling-with-amazon-ecs/ }}\
05:02:39 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: let me check\
05:02:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment pls\
05:05:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i coundnt see autocaling option in console\
05:05:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am searching option in ECS service screen\
05:06:56 AM Abraham: Can we do a screenshare so that I can also look?\
05:07:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure\
05:07:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please share chime link \
05:07:32 AM Abraham: \
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://chime.aws/4695772512"}}{\fldrslt \cf4 \strokec4 https://chime.aws/4695772512 }}\
05:08:10 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joining in\
\
\
\pard\pardeftab720\sl480\partightenfactor0
\cf2 \cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 15 2021\cb1 \
\cb3 23:52:45 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 I am trying to create application autoscaling for ECS service\
Auto Scaling Group Name: \cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\
\'97\'97\

\f0\b \

\fs28 \cb3 Chat: Getting started with Redshift Aqua\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Hello Saroja, \
\
Thank you for writing back and sharing your concerns with us. \
\
I apologize for the inconvenience caused because of this. Please find the answers to your concerns below. \
\
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\
\
- In this case, am I not supposed to be communicated about the status by AWS?\
\
As per the link provided ({\field{\*\fldinst{HYPERLINK "https://pages.awscloud.com/AQUA_Preview.html"}}{\fldrslt \cf4 \strokec4 https://pages.awscloud.com/AQUA_Preview.html }}), to evaluate AQUA, you need to run on Amazon Redshift RA3 nodes in US East (N. Virginia), US West (Oregon), and US East (Ohio) regions and apply to participate in the AQUA preview by filling out the form. Due to the absence of an RA3 instance, the email with further instructions could not be sent. \
\
-May I now how much costs to launch a new RA3 cluster?\
 \
You can use the below mentioned link to use the pricing calculator and get details on RA3 node type pricing. \
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/redshift/pricing/#Pricing_calculator"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/redshift/pricing/#Pricing_calculator }}\
\
-What is planned date for AQUA live?\
I reached out to the AQUA team and have been informed that AQUA will be live in a couple of upcoming weeks. To set the right expectations, I cannot provide an exact date for the release. \
\
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\
\
Please let me know if you have any further questions and I will be glad to answer them all. Have a great day!\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Aefaaz Ali Mansoor A S.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8109098901&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8109098901&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Owner (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 29 2021\cb1 \
\cb3 12:52:49 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi  Aefaaz,\
\
In this case I am I not suppose to be communicated about the status by AWS?\
May I now how much costs to launch a new RA3 cluster?\
What is planed date for AQUA live?\
\
Thank you\
Saroja\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Fri Mar 26 2021\cb1 \
\cb3 16:29:33 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Hello Saroja, \
\
Thank you for writing back. I hope you are doing well. \
\
I understand that you signed up for AQUA as guided but have not heard back from AWS after signing up. You want to know the reason behind this and the expected timeline for a response. \
\
I went ahead and contacted the AQUA team for this issue and have the following update for you. \
\
There's only one DC2 cluster in the account provided and AQUA only works with RA3 16XL and 4XL nodes. Also, AQUA is currently in preview mode, therefore, it should never be used in production. To access AQUA, you need to launch a new RA3 cluster. Please confirm with us if you are okay with launching the recommended cluster as it can incur additional charges. Once we receive your confirmation, we will go ahead and enable AQUA access for you.   \
\
Please let me know if it works for you or if you have any other questions and I will be happy to help. Have a great day!\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Aefaaz Ali Mansoor A S.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8109098901&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8109098901&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97\'97\

\f0\b \

\fs28 \cb3 RDS Event Notification Issue\
\
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0\fs33\fsmilli16800 \cf2 Dear Ramkumar ,\
\
Thank you for your time . We had a productive screenshare session , where we did below steps .\
\
=> We have created a new SNS Topic with standard subscription and choose email as subscription type and confirmed the subscription status .\
=> Then we create event subscription in RDS dashboard and opted for previous SNS topic .\
=> Then we restarted database "dts-mysql-01" and "dts" and observed email as event notification .\
\
As discussed we can follow below docs for creating the subscription[1] and filter out the required events as per our need[2] .\
\
Reference :\
\
[1] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_Events.html#USER_Events.Subscribing"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_Events.html#USER_Events.Subscribing }}\
[2] {\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_Events.html#USER_Events.Messages"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_Events.html#USER_Events.Messages }}\
\
I hope above is helpful to you in event subscription . Please feel free to reach out to me if you need any further clarification or information. I will be glad to help you to the best of my abilities  !\
\
Thank you for the kind understanding.  Be safe & have a great day ahead !\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Bhabagrahi B.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8108151581&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8108151581&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\cb3 Amazon Web Services\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Tue Mar 23 2021\cb1 \
\cb3 00:14:27 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28 \cf2 \cb5 Was this response helpful? Click here to rate:\cb1 \

\fs48 \
\
\
\
\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\sl480\partightenfactor0

\f0\b\fs33\fsmilli16800 \cf2 \cb3 Translate\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\f1\b0 \cf2 \cb3 \
Dear Ramkumar,\
\
Thank you for confirming your schedule .\
I will schedule below meeting starting 11:30 AM IST . Lets meet and check on the issue .\
\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://chime.aws/5026740576"}}{\fldrslt \cf4 \strokec4 https://chime.aws/5026740576 }} \
\
Please feel free to reach out to me if you need any further clarification or information. I will be glad to help you to the best of my abilities  !\
\
Thank you for the kind understanding.  Be safe & have a great day ahead !\
\
We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.\
\
Best regards,\
Bhabagrahi B.\
Amazon Web Services\
\
===============================================================\
\
To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: {\field{\*\fldinst{HYPERLINK "https://console.aws.amazon.com/support/home#/case/?displayId=8108151581&language=en"}}{\fldrslt \cf4 \strokec4 https://console.aws.amazon.com/support/home#/case/?displayId=8108151581&language=en }}\
\
Note, this e-mail was sent from an address that cannot accept incoming e-mails.\
To respond to this case, please follow the link above to respond from your AWS Support Center.\
\
===============================================================\
\
AWS Support:\
\pard\pardeftab720\sl480\partightenfactor0
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/premiumsupport/knowledge-center/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/premiumsupport/knowledge-center/ }}\
\
AWS Documentation:\
{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/"}}{\fldrslt \cf4 \strokec4 https://docs.aws.amazon.com/ }}\
\
AWS Cost Management:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/aws-cost-management/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/aws-cost-management/ }}\
\
AWS Training:\
{\field{\*\fldinst{HYPERLINK "http://aws.amazon.com/training/"}}{\fldrslt \cf4 \strokec4 http://aws.amazon.com/training/ }}\
\
AWS Managed Services:\
{\field{\*\fldinst{HYPERLINK "https://aws.amazon.com/managed-services/"}}{\fldrslt \cf4 \strokec4 https://aws.amazon.com/managed-services/ }}\
\
\cb1 \
\cb3 AWS_165387667510_Contributor (Role)\cb1 \
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf2 \
\pard\pardeftab720\partightenfactor0

\fs28\fsmilli14400 \cf2 \cb3 Mon Mar 22 2021\cb1 \
\cb3 23:58:28 GMT-0500 (Central Daylight Time)\cb1 \
\pard\pardeftab720\sl480\partightenfactor0

\fs33\fsmilli16800 \cf2 \cb3 Hi Bal,\
\
Our calendar is blocked from 2 PM IST till the end of the day. Could you please reschdule the same to 11 AM or 11:30 AM IST. \
\
Regards,\
Ramkumar\cb1 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\'97\'97-\
\
\
}

=====================================================

Hello Surendar,

Thank you for confirming your availability on Monday March 28th, 2022 from 9am-10am (ET time zone).

I understand you will share your screen on Monday, but please,  before the meeting , can you share the cluster id and indicate the period when the issue was experienced  so that I may take a look at the cluster?

Can you also provide a phone number through which I can call you?

Should you have any questions or concerns, please let me know. I am happy to assist.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Ridick T.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9812128711&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Mar 25 2022
13:52:52 GMT+0530 (India Standard Time)
Hi, 

we are okay with 9am-10am (ET time zone), we will share the screen and show you the EMR cluster.


Amazon Web Services


Fri Mar 25 2022
13:10:41 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Surendar,

Thank you for your time on the chat. I can see the chat dropped.

Can you confirm if Monday  8am-9am or 9am-10am (ET time zone) (That will be 2pm-3pm or 3pm-4pm UTC+2 timezone ) will be convenient for you?

Can you also confirm the EMR cluster id on which the issue was experienced as well as the time frame when the issue occurred?

Should you have any questions or concerns, please let me know. I am happy to assist

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Ridick T.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9812128711&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Mar 25 2022
12:35:20 GMT+0530 (India Standard Time)
07:06:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
07:06:15 AM Ridick: Hello, my name is Ridick.  I'm here to help you today.
07:06:27 AM Ridick: Please what is your name?
07:06:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
07:07:01 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am looking for a help in EMR managed scaling
07:07:08 AM Ridick: Hey Surendar, how are you today
07:07:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: as per our testing in managed scaling in EMR, It is provisioning the max number of instances and there is no response
07:07:55 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am good thanks for asking, how are you 
07:08:20 AM Ridick: You are welcome. I am doing great. Thanks for asking as well.
07:08:55 AM Ridick: I see you need guidance with managed scaling.
07:09:44 AM Ridick: I can also see that you mentioned that you want to schedule a meeting to discuss that in the ticket
07:09:58 AM Ridick: When would you like the meeting to take place
07:11:14 AM Ridick: You mentioned that the job was provisioning the max number of instances
07:11:30 AM Ridick: When did this occur?
07:11:43 AM Ridick: Can you confirm the EMR cluster id?
07:13:01 AM Ridick: Hey Surender are you there?
07:16:59 AM Ridick: Hey Surender
07:17:03 AM Ridick: Are you there
07:19:54 AM Ridick: Hey Surender, if you need me to call later, we can agree on a time for the call
07:23:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
07:24:04 AM Ridick: hello
07:24:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: One moment
07:24:40 AM Ridick: ok
07:24:43 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: anytime tomorrow (except 10.30am-11am ET) or Monday (except 10am-11am) would work
07:25:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please mention your time so that i will arrange my application team also on the call 
07:25:19 AM Ridick: Monday will be great for me because I am off shift during the weekends
07:26:20 AM Ridick: Let me check what 10am ET timezone will be in my location (UTC+2)
07:27:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please tell me your time in ET
07:28:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: bcoz application teams are working on ET zone



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Mar 25 2022
12:35:10 GMT+0530 (India Standard Time)
Hi connecting to schedule the meeting

==================================================

Hello,

Anubhav here to assist you with your case. Thank you for your patience while I was working with the internal team regarding your issue. 

I have heard back from the team and they have mentioned that they have verified all findings for instances mentioned by you have now been closed. 

Please kindly check at your end and let us know if you sill see them in the console and share a screenshot with us for the same. 

Looking forward to hearing from you soon.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Anubhav M.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9792461381&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Wed Mar 23 2022
12:51:36 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

Anubhav here to assist you with your case. 

No issues , I have updated the case status to Pending Amazon Action again. 

Also the internal team is actually working on a fix to be deployed soon which should clear the findings of deleted instances . I will make sure to update and check with you once I hear back from the internal team. 

Thank you for your continued patience and understanding on this. 

Keep being AWSome :)

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Anubhav M.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9792461381&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Mar 23 2022
12:48:36 GMT+0530 (India Standard Time)
unknowingly closed this case, please change the status to pending amazon actioin


Amazon Web Services


Wed Mar 23 2022
12:47:44 GMT+0530 (India Standard Time)

Translate
Please let us know if we helped resolve your issue: 

If YES, click here:
https://console.aws.amazon.com/support/feedback?eventId=9792461381&language=en&questionnaireId=Support-HMD-Yes 

If NO, click here:
https://console.aws.amazon.com/support/feedback?eventId=9792461381&language=en&questionnaireId=Support-HMD-No 



Amazon Web Services


Sat Mar 19 2022
07:51:20 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello ,

Greetings from AWS Premium Support. My name is Anubhav and I will be assisting you with your case today. 

You contacted us because instances that have been terminated are showing in the Inspector findings.

I have reached out to our internal team on your behalf and made a request to investigate this. Once the service team is done with the investigation, I will reach back to you.

Please note that I do not have ETA for this. I will keep a very close eye on the ticket and will let you as soon as I have updates from our internal team. Until then,I am going to change the status of this case to "Pending Amazon Action.

In the meantime, please feel free to reach out with any other queries or concerns. I will be more than happy to assist you.

Have a good day!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Anubhav M.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9792461381&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 

==============================================================================

Hello,

We haven't heard back from you regarding case 9784919871 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9784919871&displayId=9784919871&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Thu Mar 17 2022
17:55:53 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Surendar,

It's Napoleone from AWS Premium Support. Hope you are having a great day so far.

First and foremost, thank you for your kindness and collaboration over our chat. It was very appreciated.

With the following, I am going to summarize what we discussed while we were connected. You reached out since you were having issues in getting parameters correctly. Indeed, you have a Lambda function that is being triggered by the following Step Function: "arn:aws:states:us-east-1:165387667510:stateMachine:nonprod_on-demand-surendar_on_demand_emr". The Lambda is returning different parameters in order to create an EMR cluster. However, they are not integers as expected, but they are returned as string. For this reason, the executions are failing, and EMR cluster is never created.

I dove deeper into your issue, and collaborated with a colleague of mine. However, the way the Step Function is defined is correct, hence no issues here:
"ComputeLimits": {
                        "UnitType": "InstanceFleetUnits",
                        "MinimumCapacityUnits.$": "$.minimumcapacityunits",
                        "MaximumCapacityUnits.$": "$.maximumcapacityunits",
                        "MaximumOnDemandCapacityUnits.$": "$.maximumondemandcapacityunits",
                        "MaximumCoreCapacityUnits.$": "$.maximumcorecapacityunits"
                    }

As a matter of fact, we both noticed that the parameters returned by the Lambda function are already strings. I replicated this in my own environment, and I have the following Lambda function that is triggered by a Step Function of mine:
import json

def lambda_handler(event, context):
    
    value1 = "1"
    value2 = "2"
    value3 = "3"
    return {
        "value1": int(value1),
        "value2": int(value2),
        "value3": int(value3)
    }

However, the three variables are properly converted to integer, as you can see in the attachment. Therefore, may I ask you to kindly ensure you are returning the parameters as integers correctly in the Lambda function?

Please dont hesitate to let me know if you have any more questions or concerns and I will be happy to assist you.

I wish you a great day ahead!

To see the file named 'Screenshot 2022-03-17 at 11.38.06.png' included with this correspondence, please use the case link given below the signature.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Napoleone C.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9784919871&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Attachments
Screenshot 2022-03-17 at 11.38.06.png

AWS_P0001489@optum.com


Thu Mar 17 2022
15:46:54 GMT+0530 (India Standard Time)
10:19:39 AM Napoleone C.: Hello, my name is Napoleone. I'm here to help you today. May I know whom I am chatting with please?
10:26:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
10:29:46 AM Napoleone C.: based on the case correspondence, I understand you want to get integers in response, but the variables are strings. Please feel free to correct me if I have misunderstood
10:30:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
10:30:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: variables substitute as string not an integer
10:30:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if you are okay i can share the screen it will be easier for us to fix the issue
10:32:59 AM Napoleone C.: kindly allow me some time to check something quick. path variables will always send as a string, but let me see if there is a workaround. hold on please
10:40:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: any luck
10:40:51 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please call me if chat disconnected +91-8608888285
10:41:28 AM Napoleone C.: no worries, I am just replicating the same scenario on my environment
10:41:46 AM Napoleone C.: may I only ask you an example of the input you are passing?
10:42:25 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have screen share
10:42:38 AM Napoleone C.: sure
10:42:41 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: you can do the testing my environment 
10:43:35 AM Napoleone C.: Click to join the meeting: https://chime.aws/9405358088 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Mar 17 2022
15:46:51 GMT+0530 (India Standard Time)
connecting agin


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Mar 17 2022
15:44:56 GMT+0530 (India Standard Time)
how to use substitute  number in definition

the below block should be substituted in integer but getting string while running the step function

          "ComputeLimits": {
            "UnitType": "InstanceFleetUnits",
            "MinimumCapacityUnits.$": "$.minimumcapacityunits",
            "MaximumCapacityUnits.$": "$.maximumcapacityunits",
            "MaximumOnDemandCapacityUnits.$": "$.maximumondemandcapacityunits",
            "MaximumCoreCapacityUnits.$": "$.maximumcorecapacityunits"
          }
State Machine ARN: 

========================================================================================

Please let us know if we helped resolve your issue: 

If YES, click here:
https://console.aws.amazon.com/support/feedback?eventId=9769265631&language=en&questionnaireId=Support-HMD-Yes 

If NO, click here:
https://console.aws.amazon.com/support/feedback?eventId=9769265631&language=en&questionnaireId=Support-HMD-No 



Amazon Web Services


Tue Mar 22 2022
11:15:13 GMT+0530 (India Standard Time)

Translate

Hello,

We haven't heard back from you regarding case 9769265631 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9769265631&displayId=9769265631&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Tue Mar 15 2022
10:24:38 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Dear customer, thank you for contacting AWS premium support. This is Mahadi and I am here to assist you today.

I understand you wanted to move from Zeppelin to an AWS Managed service. Here is my inputs and use-cases.

For use-cases similar to Zeppelin,  EMR Notebook which is AWS manages is great option[1-2]. For example if you are running interactive job development then EMR notebook is great choice. In addition EMR studio is also great choice for multiple users since EMR studio provides features like authenticating users with AWS Identity and Access Management (IAM). Here is documentation of key EMR studio features[3]. Also note that EMR Studio is an integrated development environment (IDE) that makes it easy for data scientists and data engineers to develop, visualize, and debug data engineering and data science applications written in R, Python, Scala, and PySpark. So EMR studio is just wrapper around Juypter Notebook, so it is wrapper around EMR Notebook with extra key features[3-4].

For ETL use-cases, then Glue with SageMaker would be better option[5]. I won't be able to give you more details regarding Glue and SageMaker since I am EMR engineer so I would recommend you to open tickets to the Glue/SageMaker teams and they will be able to give you more details for the best use-cases for these services. 

In addition, you can also use EMR with Zeppelin when creating the EMR cluster[6-7]

I hope this information is helpful to you, please let me know if you have questions.

Ref Link --
[1] https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-managed-notebooks.html 
[2] https://www.youtube.com/watch?v=fC4Y7KNwRzs 
[3] https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-studio.html 
[4] https://www.youtube.com/watch?v=rZ3zeJ6WKPY 
[5] https://docs.aws.amazon.com/glue/latest/dg/dev-endpoint-tutorial-sage.html 
[6] https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-zeppelin.html 
[7] https://confusedcoders.com/data-engineering/how-to-create-emr-cluster-with-apache-spark-and-apache-zeppelin 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Mahadi O.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9769265631&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Owner/arunkumar@optum.com (Role)


Mon Mar 14 2022
21:03:38 GMT+0530 (India Standard Time)
Hi Team,

We have been using Zeppelin for running our on-demand Sparks jobs(On-prem) on top of our EMR Cluster. We wanted to move this to an AWS Managed service. 

Based on the quick research, we found AWS EMR Notebook maybe a good alternative. But, also it looks we can use Sagemaker Notebook with Glue Dev endpoint. Also, based on the recommendation from some blog, it seems AWS EMR Studio is better than EMR Notebook. Also, the final option would be running Zeppelin on EC2 if no other options are good.

Now, I wanted some inputs from your team on the differences between these solutions. Which would work better for different use-cases?


Regards,
Arun
EMR Cluster-id: 

============================================================================================

Dear Customer,

Thank you for reaching out to AWS Premium Support. It was nice interacting with you on chat/call today. Please find the summary of the discussion as below: 
 
I understand that you reached out to us as you are concerned about how to apply scale policy to EMR cluster using step function. Please correct me if I have missed or misunderstood something.

Please checkout the sample format on the attached file (sample.json). As per the sample file it will try to launch an EMR cluster with 1 master node, 1 core node as well as 1 TASK node and it will add an auto scaling on the TASK instance group where it's requesting a minimum of 1 instance and maximum of 5 instances. I am triggering the scale out on YARNAvailablememory. Please note that I am currently not attaching any scale in rule in the cluster. One can follow similar procedure to add a scale in. I trust you will find the attached file useful. 

Please check out this AWS documentation on using EMR managed scaling and automatic-scaling in Amazon EMR [1][2]. You can also check the benefits of managed scaling in this AWS big data blog [3]. Please refer third party article [4] to understand how to Launch an EMR managed scaling cluster with Step Functions. 

We also discussed about EMR managed scaling, autoscaling, various parameters which plays major role in scaling and how to configure it. 

As discussed, Im marking this case as Resolved.  Feel free to open a new case in case of any other issue for better case management.  

I hope the above information helps. Please feel free to get back to us in case of any further queries and concerns and I shall be glad to assist you further.

Stay safe and have a nice day!

References:
=========
[1] https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-managed-scaling.html 
[2] https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-automatic-scaling.html 
[3] https://aws.amazon.com/blogs/big-data/introducing-amazon-emr-managed-scaling-automatically-resize-clusters-to-lower-cost/ 
[4] https://medium.com/@amit.kumarbasu/launch-an-emr-managed-scaling-cluster-with-step-functions-bc544babc80f 
[5] https://aws.amazon.com/blogs/aws/new-using-step-functions-to-orchestrate-amazon-emr-workloads/ 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9768689781&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9768689781&language=en&questionnaireId=Support-HMD-No 

To see the file named 'sample.json' included with this correspondence, please use the case link given below the signature.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Asif S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9768689781&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Attachments
sample.json

AWS_P0001489@optum.com


Tue Mar 15 2022
10:28:01 GMT+0530 (India Standard Time)
04:59:25 AM Asif Sayyad: Hello, my name is Asif Sayyad.  I'm here to help you today.
04:59:52 AM Asif Sayyad: May I know your name ?
05:01:22 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
05:01:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am trying to enable scaling policy using step function
05:02:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so i am creating the EMR cluster setup first 
05:02:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and then i am trying to enable the scaling poliyc
05:02:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so is it possible to enable custom policy on EMR cluster
05:03:14 AM Asif Sayyad: Please allow me a moment I'm checking on this
05:08:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime call on this to discuss
05:09:04 AM Asif Sayyad: sure
05:09:08 AM Asif Sayyad: let me share chime link
05:09:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks to you 
05:09:42 AM Asif Sayyad: Meeting Link: https://chime.aws/7111287637 
Meeting ID: 7111 28 7637
U.S. Toll: +1 206-462-5569
Meeting PIN: 7111 28 7637
U.S. Toll-free: +1 855-552-4463
International: https://chime.aws/dialinnumbers/ 

05:10:06 AM Asif Sayyad: Please join



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Mar 15 2022
10:27:55 GMT+0530 (India Standard Time)
connecting


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Mar 15 2022
10:24:45 GMT+0530 (India Standard Time)
connecting now 


Amazon Web Services


Mon Mar 14 2022
22:08:33 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello, this is Chris from AWS Premium Support. I joined a chat this morning to assist you with a possible issue or question, but I disconnected after waiting approximately 15 minutes as I did not receive a reply.

I have reviewed your case and I see your issue/question was relating to scaling policies. Without knowing more details, I can only help by providing documentation regarding EMR managed scaling policies [1], and custom auto-scaling policies [2] which are linked below.


If you can clarify the details of your query, I would be happy to assist further.

[1] https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-managed-scaling.html 
[2] https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-automatic-scaling.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Chris D.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9768689781&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 

===============================================================================

Please let us know if we helped resolve your issue: 

If YES, click here:
https://console.aws.amazon.com/support/feedback?eventId=9757433681&language=en&questionnaireId=Support-HMD-Yes 

If NO, click here:
https://console.aws.amazon.com/support/feedback?eventId=9757433681&language=en&questionnaireId=Support-HMD-No 



Amazon Web Services


Sat Mar 12 2022
05:51:55 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

Thank you for contacting AWS Premium Support. My name is Prakin and I will be assisting you with this case.

I understood from the case that you would like to know what is default web server in elastic beanstalk. 

Can you please help me understand which default web server are you referring to here?

Elastic beanstalk provides platforms for programming languages (Go, Java, Node.js, PHP, Python, Ruby), application servers (Tomcat, Passenger, Puma), and Docker containers for your application deployment. To know more, please visit: https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts.platforms.html 

Since a chat was initiated on the case, if you would like to connect to an engineer please feel free to initiate a chat back with us and you will be provided assistance on your queries.

Please let me know if you have any questions and I will be happy to assist. 

Have a great day and Stay Safe.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Prakin R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9757433681&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Mar 11 2022
19:05:32 GMT+0530 (India Standard Time)
03:12:08 PM Prakin R: Hello, my name is Prakin R.  I'm here to help you today.
03:12:14 PM Prakin R: May I know your name please?
03:14:04 PM Prakin R: Hello are you there? 
03:22:49 PM Prakin R: I am disconnecting the chat due to inactivity. Please re-initiate a chat back with us to get assistance. 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Mar 11 2022
19:05:28 GMT+0530 (India Standard Time)
connection lost connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Mar 11 2022
19:04:12 GMT+0530 (India Standard Time)
what is default web server in elastic beanstalk
Application Name: 
Environment Name or Environment ID: 
Have You Attached Logs?: 

==============================================================================

Please let us know if we helped resolve your issue: 

If YES, click here:
https://console.aws.amazon.com/support/feedback?eventId=9732580371&language=en&questionnaireId=Support-HMD-Yes 

If NO, click here:
https://console.aws.amazon.com/support/feedback?eventId=9732580371&language=en&questionnaireId=Support-HMD-No 



Amazon Web Services


Thu Mar 17 2022
09:22:09 GMT+0530 (India Standard Time)

Translate

Hello,

We haven't heard back from you regarding case 9732580371 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9732580371&displayId=9732580371&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Thu Mar 10 2022
09:07:13 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello

Greetings!

Thank you for immense patience while the internal team was looking at the issue.

As per the internal team, the reason you are getting this error is because you have set  [encrypted: false] in the container recipe even though the custom AMI ami-077be682d8f131d6b is in encrypted state.

Please allow me to mention that you cant create an unencrypted volume from an encrypted snapshot. That is the the reason for failure and the is conveyed by the error message Cannot create unencrypted device /dev/xvda from encrypted snapshot for the Docker one.


  instanceConfiguration: {
            image: ami-077be682d8f131d6b,
            blockDeviceMappings: [
                {
                    deviceName: /dev/xvda,
                    ebs: {
                        encrypted: false,
                        deleteOnTermination: true,
                        iops: null,
                        kmsKeyId: null,
                        snapshotId: snap-063b73eebf3ecebdf,
                        volumeSize: 8,
                        volumeType: gp2
                    },
                    virtualName: null,
                    noDevice: null
                }
         

However, in the In the AMI recipe,  a KMS key is specified in the storage options. That is why it is not failing there.

         

  parentImage: ami-077be682d8f131d6b,
        blockDeviceMappings: [
            {
                deviceName: /dev/xvda,
                ebs: {
                    encrypted: true,
                    deleteOnTermination: true,
                    iops: 1500,
                    kmsKeyId: arn:aws:kms:us-east-1:165387667510:key/fe8be482-6484-4f20-b01b-346e84993182,
                    snapshotId: null,
                    volumeSize: 30,
                    volumeType: io1
                },
                virtualName: null,
                noDevice: null
            }
        ],
         

Therefore, I would request you to retry the container recipe with the encryption enabled and see if it works.

I hope I was able to assist you today.  If you have any further queries/concerns, please do reach out. I will be more than happy to address them.

Take care and Be safe! 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Soumya G.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9732580371&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Tue Mar 08 2022
16:12:23 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

Greetings.

Thank you for your time on chat session and for the continued patience while the internal team was looking at your query.

Please allow me to address your queries one by one for clarity. I am clubbing the related queries together:


1. EC2 Imager builder pipeline currently dont let me to update the Metadata Version as V2, during EC2 getting created during pipeline run.
2. Also, unable to increase Meta data hoplimit value as 2 during the intermittent EC2 creation during pipeline run.


As mentioned on the chat, the internal team has confirmed that currently there is no direct way to do update the Metadata Version 2 and Hoplimit value in the Image Builder console and a feature request for has already in place.  While I would not be able to guarantee this features availability, it is something they can review to determine its feasibility thereafter, determine implementation.

I would not be able to provide an ETA on when the feature will be added however, you can monitor the AWS Features blog for all updates on AWS:

	[+] https://aws.amazon.com/new/  

As a workaround, the internal team suggested to accomplish your use-case by setting the InstanceMetadataOptions object in the Infrastructure Configuration as below

	--instance-metadata-options
	httpTokens=required,httpPutResponseHopLimit=<give a hop limit>

For more details, you can refer the below document:

	[+]  https://docs.aws.amazon.com/imagebuilder/latest/APIReference/API_CreateInfrastructureConfiguration.html#imagebuilder-CreateInfrastructureConfiguration-request-instanceMetadataOptions 
	[+] https://docs.aws.amazon.com/cli/latest/reference/imagebuilder/create-infrastructure-configuration.html 


3. Encrypted AMI when passed to Image builder pipeline of type docker, it fails with error stating as Cannot create unencrypted device /dev/xvda from encrypted snapshot. However, when passing the same AMI to image builder of type AMI it works fine. 


Regarding this issue, I have already reached out to the internal team. I will get back to you as soon as I hear from them. I will do my best to make sure this gets the attention it needs, though please note that it may take some time before we have the first response from this team, till then I will keep this case locked to myself.

Alternatively, if you have any additional questions or concerns, please do not hesitate to write back to us. I will be happy to assist you with the queries. 

Thank you for your understanding. Your patience is highly appreciated.
(Flipping the case to "Pending Amazon Action" till then)

Take Care and Stay Safe!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Soumya G.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9732580371&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Tue Mar 08 2022
12:53:50 GMT+0530 (India Standard Time)
Hi Soumya,

I am quickly summarizing the issues we face and looking for any workaround to get things work,

1. EC2 Imager builder pipeline currently don't let me to update the Metadata Version as V2, during EC2 getting created during pipeline run.
2. Also, unable to increase Meta data hoplimit value as 2 during the intermittent EC2 creation during pipeline run.
3. Encrypted AMI when passed to Image builder pipeline of type docker, it fails with error stating as "Cannot create unencrypted device /dev/xvda from encrypted snapshot". However, when passing the same AMI to image builder of type AMI it works fine. 

Looking for some workaround or get the feature updated so that we can push the pipeline to end users.

Thanks,
Pravin

==============================================================================

Hi Pandian,

At this time I currently have no new updates, the team is aware of the issue and is continuing to investigate the root cause. We have tried a few different things but the same error remains with the same error code.

I will reach out to them to see if they can give me any insight though on any progress and update you with the feedback I am provided. 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Manuel A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9706121831&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Owner/pandian.ganesan@optum.com (Role)


Thu Mar 24 2022
18:34:40 GMT+0530 (India Standard Time)
Hi Manual,

Any Update on this?


AWS_165387667510_Owner/pandian.ganesan@optum.com (Role)


Tue Mar 15 2022
07:12:48 GMT+0530 (India Standard Time)
Thanks for the update


Amazon Web Services


Tue Mar 15 2022
02:15:16 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hi,

Just wanted to keep you updated. My internal team found a slight error in the CloudFormation stack for the /index.html. However, even after fixing this, the issue remains. We continue to investigate this and please note I will update you with any other findings.

Thank you

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Manuel A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9706121831&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Thu Mar 10 2022
02:27:59 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hi, 

Thank you for the logs, I have continued to work on this with my internal team and will reach back out with any further information request or any updates provided to me.

Thank you for your patience. 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Manuel A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9706121831&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 

=======================================================================

Hi Surendar,

Greetings!

It was nice talking to you. We discussed about the issue faced in state machine to terminate the Ec2 instance. Below are the changes that we discussed.

1. In TerminateInstances state, add below statement to get the instance Id

 "InstanceIds.$": "States.Array($.instance_result.Instances[0].InstanceId)"

2. If there is an error in any of the states add "ResultPath":null which will discard the output and forward the input passed to the state to terminate the instance.

Please find the relevant documentation for reference below.

https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-intrinsic-functions.html 
https://docs.aws.amazon.com/step-functions/latest/dg/input-output-resultpath.html#input-output-resultpath-null 

As discussed, I am resolving the case.

Thanks and have a nice day ahead!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Preeti S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9701850581&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Mon Feb 28 2022
10:41:40 GMT+0530 (India Standard Time)
Create Image input - 

{
  "ImageId": "ami-07e7c21fcdf74e90a",
  "InstanceType": "t2.micro",
  "SubnetId": "subnet-0fca27af1beec4836",
  "instance_result": {
    "Groups": [],
    "Instances": [
      {
        "AmiLaunchIndex": 0,
        "Architecture": "x86_64",
        "BlockDeviceMappings": [],
        "CapacityReservationSpecification": {
          "CapacityReservationPreference": "open"
        },
        "ClientToken": "7389f2c4-6739-4373-89db-00d18a7c50cc",
        "CpuOptions": {
          "CoreCount": 1,
          "ThreadsPerCore": 1
        },
        "EbsOptimized": false,
        "EnaSupport": true,
        "EnclaveOptions": {
          "Enabled": false
        },
        "Hypervisor": "xen",
        "ImageId": "ami-07e7c21fcdf74e90a",
        "InstanceId": "i-00eb40eee1a80d8c9",
        "InstanceType": "t2.micro",
        "LaunchTime": "2022-02-28T05:01:20Z",
        "MetadataOptions": {
          "HttpEndpoint": "enabled",
          "HttpProtocolIpv6": "disabled",
          "HttpPutResponseHopLimit": 1,
          "HttpTokens": "optional",
          "InstanceMetadataTags": "disabled",
          "State": "pending"
        },
        "Monitoring": {
          "State": "disabled"
        },
        "NetworkInterfaces": [
          {
            "Attachment": {
              "AttachTime": "2022-02-28T05:01:20Z",
              "AttachmentId": "eni-attach-0fe150bdd6eefb19e",
              "DeleteOnTermination": true,
              "DeviceIndex": 0,
              "NetworkCardIndex": 0,
              "Status": "attaching"
            },
            "Description": "",
            "Groups": [
              {
                "GroupId": "sg-0bf77c69ef36d72c4",
                "GroupName": "default"
              }
            ],
            "InterfaceType": "interface",
            "Ipv6Addresses": [],
            "MacAddress": "0a:1f:35:7f:36:05",
            "NetworkInterfaceId": "eni-0674936f6841a2ef6",
            "OwnerId": "165387667510",
            "PrivateDnsName": "ip-172-31-30-252.ec2.internal",
            "PrivateIpAddress": "172.31.30.252",
            "PrivateIpAddresses": [
              {
                "Primary": true,
                "PrivateDnsName": "ip-172-31-30-252.ec2.internal",
                "PrivateIpAddress": "172.31.30.252"
              }
            ],
            "SourceDestCheck": true,
            "Status": "in-use",
            "SubnetId": "subnet-0fca27af1beec4836",
            "VpcId": "vpc-0137cfaac4f49f8fd"
          }
        ],
        "Placement": {
          "AvailabilityZone": "us-east-1d",
          "GroupName": "",
          "Tenancy": "default"
        },
        "PrivateDnsName": "ip-172-31-30-252.ec2.internal",
        "PrivateDnsNameOptions": {
          "EnableResourceNameDnsAAAARecord": false,
          "EnableResourceNameDnsARecord": false,
          "HostnameType": "ip-name"
        },
        "PrivateIpAddress": "172.31.30.252",
        "ProductCodes": [],
        "PublicDnsName": "",
        "RootDeviceName": "/dev/xvda",
        "RootDeviceType": "ebs",
        "SecurityGroups": [
          {
            "GroupId": "sg-0bf77c69ef36d72c4",
            "GroupName": "default"
          }
        ],
        "SourceDestCheck": true,
        "State": {
          "Code": 0,
          "Name": "pending"
        },
        "StateReason": {
          "Code": "pending",
          "Message": "pending"
        },
        "StateTransitionReason": "",
        "SubnetId": "subnet-0fca27af1beec4836",
        "VirtualizationType": "hvm",
        "VpcId": "vpc-0137cfaac4f49f8fd"
      }
    ],
    "OwnerId": "165387667510",
    "RequesterId": "432015868146",
    "ReservationId": "r-0511f38d025d0a0fa"
  },
  "AssociateIamInstanceProfile": {
    "IamInstanceProfileAssociation": {
      "AssociationId": "iip-assoc-0861742fb42e76b2b",
      "IamInstanceProfile": {
        "Arn": "arn:aws:iam::165387667510:instance-profile/surendar_test_instance_profile",
        "Id": "AIPASNAO7RA3GEA5BIOYX"
      },
      "InstanceId": "i-00eb40eee1a80d8c9",
      "State": "associating"
    }
  },
  "finding_results": {
    "ExecutedVersion": "$LATEST",
    "Payload": {
      "InstanceId": "i-00eb40eee1a80d8c9",
      "Findings": []
    },
    "SdkHttpMetadata": {
      "AllHttpHeaders": {
        "X-Amz-Executed-Version": [
          "$LATEST"
        ],
        "x-amzn-Remapped-Content-Length": [
          "0"
        ],
        "Connection": [
          "keep-alive"
        ],
        "x-amzn-RequestId": [
          "80460136-e355-4158-9dd1-2affe89202d6"
        ],
        "Content-Length": [
          "53"
        ],
        "Date": [
          "Mon, 28 Feb 2022 05:02:21 GMT"
        ],
        "X-Amzn-Trace-Id": [
          "root=1-621c575d-3ada96216e5a83014d64e871;sampled=0"
        ],
        "Content-Type": [
          "application/json"
        ]
      },
      "HttpHeaders": {
        "Connection": "keep-alive",
        "Content-Length": "53",
        "Content-Type": "application/json",
        "Date": "Mon, 28 Feb 2022 05:02:21 GMT",
        "X-Amz-Executed-Version": "$LATEST",
        "x-amzn-Remapped-Content-Length": "0",
        "x-amzn-RequestId": "80460136-e355-4158-9dd1-2affe89202d6",
        "X-Amzn-Trace-Id": "root=1-621c575d-3ada96216e5a83014d64e871;sampled=0"
      },
      "HttpStatusCode": 200
    },
    "SdkResponseMetadata": {
      "RequestId": "80460136-e355-4158-9dd1-2affe89202d6"
    },
    "StatusCode": 200
  },
  "remediation_results": {}
}


AWS_P0001489@optum.com


Mon Feb 28 2022
10:22:53 GMT+0530 (India Standard Time)
04:54:27 AM Preeti: Hello, my name is Preeti.  I'm here to help you today.
04:54:51 AM Preeti: may I please know your name?
04:55:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar. 
04:55:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am trying to delete the terminate instances 
04:56:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but it is not getting the instance ID from preious state output
04:56:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: *previous
04:56:24 AM Preeti: Hi Surendar, how are you today? I understand that you are using Step Functions to delete EC2 instance
04:56:34 AM Preeti: oh ok. May I know the state machine arn?
04:57:57 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: arn:aws:states:us-east-1:165387667510:execution:surendar_test_inspector_remediation
04:58:12 AM Preeti: ok thanks. Let me look at state machine definition
04:58:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes i am fine , Hope you are good too !!!!!!!
04:58:21 AM Preeti: give me few minutes please
04:58:27 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure
05:02:24 AM Preeti: could we get into a call to discuss the issue? I would like to see the execution which failed. 
05:03:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
05:03:16 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can you provide me the chime link to join the meeting
05:03:56 AM Preeti: sure
05:04:14 AM Preeti: Click to join the meeting: https://chime.aws/6955286207 
Meeting ID: 6955 28 6207
A headset is recommended or you may use your computers microphone and speakers.

05:05:54 AM Preeti: joining?
05:06:03 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joining in



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Mon Feb 28 2022
10:22:48 GMT+0530 (India Standard Time)
connection lost. connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Mon Feb 28 2022
10:21:55 GMT+0530 (India Standard Time)
cannot terminate the instances
State Machine ARN: 

========================================================================

Hello Surendar, 

Thank you for your time today on our Chat/Chime Session; it was a pleasure working with you.  You reached out to us today regarding issues with your Step function failing when trying to run the "AssociateIamInstanceProfile" action, with the operation failing with the below 
-------------------------------------------------------------------------------------------------------
errorCode: Client.UnauthorizedOperation
errorMessage: You are not authorized to perform this operation. Encoded authorization failure message: K9NqgTD9zVhzkS5sHKss_Xd0kOzDCJ0UfuphfV4K_lF5_VOH4IlCrakYYq3WbcqxXiDQ5V_RJXfBmUinFozNrxlr2bRmB24j5zBF10hxNpbSlFjOGyMc7_rlfYH-L1bgMMdBltjEptejoeFIKq2mCovrMoHcOC74n4MsuxzM2MYDjumH7D5inQkMDU_fA2OO8kSumWhR8AvnfUhAjkQiIhsyV6y9G4lrVyHkf9uqyPoGdUJ_cJLkic6wnaSXTA_2CiGULVKwemOlsTP8pLrrTXIEB7NsUQ16BudV197fJc2mseOT5KoTIFKKFyGl6ys2GA9QDdD_W5rA_3w1g-oV8hrUtrJVZxQj2iBF5IOA-SLZ3iUnhUOWO43YKyyvoWgevJTJGjMlAgMFEEC41Amp9iNm_XXCnRQ-JORInYHJAbpWeyhZcJY3wwxA684hsE5ekSFfBMkEiSTQguaYC-6-_KhNouwXw6OgD4E3Uur2ZNCA7y9fvCOBBq9UlaCYscXlUxHn0F-jdPmXtatcNLMWz_GaM0-A6vVpT2d5LyjDbKo7dL7KWCifhXn2eggmiwxcfuePqJL7j7NKN0zJ8gZCjMp1JAyl
-------------------------------------------------------------------------------------------------------

We first began by following instructions in documentation [1] to decode the associated encoded error message above. This revealed the below:
-------------------------------------------------------------------------------------------------------
"context": {
    "principal": {
      "id": "AROASNAO7RA3MEJ2UU35N:uDWhQONWlxsOwWUWHHjOWqrMjqJIIrqF",
      "arn": "arn:aws:sts::165387667510:assumed-role/surendar_test_stepfunction_role/uDWhQONWlxsOwWUWHHjOWqrMjqJIIrqF"
    },
    "action": "iam:PassRole",
    "resource": "arn:aws:iam::165387667510:role/AmazonSSMRoleForInstancesQuickSetup",
-------------------------------------------------------------------------------------------------------

Understanding that we need to modify the IAM policy in the IAM role "arn:aws:iam::165387667510:role/surendar_test_stepfunction_role" so it has the required permission noted in the decoded messasge above, we proceeded to make the necessary modifications to the role's IAM policy.  

Upon making the required changes to the IAM policy, you proceeded to run your step function again. This time were confirmed the FX was able to successfully run the "AssociateIamInstanceProfile" operation against EC2 instance "i-0627b1d8e3992e264". 

Glad we could work together in getting this issue resolved! Per your request, I will proceed to close out the Ticket. Please feel free to reach out again if you have any questions or concerns.

Thank you & have a great day!

REFERENCE LINKS
[1] Decoding Encoded Error Messages in AWS CLI: https://aws.amazon.com/premiumsupport/knowledge-center/aws-backup-encoded-authorization-failure/ 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9687430811&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9687430811&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Ayo A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9687430811&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Feb 24 2022
21:46:06 GMT+0530 (India Standard Time)
02:56:28 PM Ayo: Hello!
02:56:39 PM Ayo: Apoligies for the delay 
02:56:42 PM Customer: HI My name is surendar
02:56:56 PM Ayo: Hi Surendar!
02:57:21 PM Customer: I wanted to provide the least permission to associate and disassociate the instance profile to a role
02:57:32 PM Customer: so can you please least permissions 
02:57:48 PM Ayo: Understood. 
02:58:38 PM Ayo: So please correct me if I am mistaken, but you want the Instance role to only be able to associated & disassociate? 
03:00:15 PM Ayo: You there, Surendar?
03:01:09 PM Ayo: hello...?
03:01:32 PM Customer: Hi I am gere
03:01:37 PM Customer: here
03:01:52 PM Ayo: Great so can you please confirm the above
03:02:15 PM Customer: I have stepfunction , from stepfunction i wanted to associate and disassociate the instanceprofile
03:03:09 PM Ayo: can we please get on chime call to review this properly & understand your use-case?
03:03:26 PM Customer: sure 
03:03:35 PM Customer: can we hve chime call in next 15 Mins
03:04:11 PM Ayo: So 9:15 AM CST?
03:04:35 PM Customer: yes
03:04:45 PM Ayo: Understood. 
03:04:46 PM Customer: meanwhile can you please provide the least permission 
03:05:10 PM Ayo: That is why I have requested the chime meeting 
03:05:26 PM Ayo: I need to understand what you are trying to achieve 
03:05:28 PM Customer: and i am trying to decode the encoded error message it is showing syntax error
03:05:39 PM Customer: aws sts decode-authorization-message --encoded-message -a5dsrlF6M9fJhbZIEOMRtHh-POWz7Iw3AWniaabSBlOVA4JRU5jQc9Zw6tiKr1HFkSkIQNo6uU2SCDHQObc3JceFOHJU-TeoO9hD
cn13i38yagZgDl9I_hWCuXmGfRuthLLjIOszDDX-_RMfigupyqBa9zExEg3h_f5CNs2XlLtYvkwaO1m_OxjIw9uYtwjRfwDPe533ciZTNvJDBuafIzvK1wDvS6lXjLpKBPeUZ7eKmaBVGUW-VkMGwAQoBM5xbBN6YBPdHeb5l05IwypMjwcq91VUm0Kem0OP-IDRYMVPRcIAeHkK9ek
kleB0p95WxCHoIWEK6MFlXLRP9FmHMZxaqSLJH-4w7I7KN2WZZqXP0hljqJlrmdvobCGFbBnsAXCMT1Sod-PDfO0ribYzXl0bMkqYWk478to5ZXo8pZrOoBi8bGUYX0Sno1T9iRF69FTaAYy2nJtryg7MmzWJy2v5jIC1BZMkBWWParebLE42dnu3i18-CDP4s6O-CTkbefSAITaNM5
s3iL7wU9M90Oy-EcckoviJlEB748Yk0nhgmcLNOiOGjeQSl4lrImd0bvKCu60mamnIKr2KPQsZlVb3w
Note: AWS CLI version 2, the latest major version of the AWS CLI, is now stable and recommended for general use. For more information, see the AWS CLI version 2 installation instructions at: https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html 

usage: aws [options] <command> <subcommand> [<subcommand> ...] [parameters]
To see help text, you can r
03:05:41 PM Ayo: Oh one moment. 
03:06:05 PM Ayo: Please see this link: https://aws.amazon.com/premiumsupport/knowledge-center/aws-backup-encoded-authorization-failure/ 
03:06:21 PM Customer: i refer that only 
03:06:26 PM Customer: but i am getting error
03:06:33 PM Customer: is there any reason
03:06:56 PM Customer: can you please run the below command
03:06:56 PM Customer: aws sts decode-authorization-message --encoded-message -a5dsrlF6M9fJhbZIEOMRtHh-POWz7Iw3AWniaabSBlOVA4JRU5jQc9Zw6tiKr1HFkSkIQNo6uU2SCDHQObc3JceFOHJU-TeoO9hDcn13i38yagZgDl9I_hWCuXmGfRuthLLjIOszDDX-_RMfigupyqBa9zExEg3h_f5CNs2XlLtYvkwaO1m_OxjIw9uYtwjRfwDPe533ciZTNvJDBuafIzvK1wDvS6lXjLpKBPeUZ7eKmaBVGUW-VkMGwAQoBM5xbBN6YBPdHeb5l05IwypMjwcq91VUm0Kem0OP-IDRYMVPRcIAeHkK9ekkleB0p95WxCHoIWEK6MFlXLRP9FmHMZxaqSLJH-4w7I7KN2WZZqXP0hljqJlrmdvobCGFbBnsAXCMT1Sod-PDfO0ribYzXl0bMkqYWk478to5ZXo8pZrOoBi8bGUYX0Sno1T9iRF69FTaAYy2nJtryg7MmzWJy2v5jIC1BZMkBWWParebLE42dnu3i18-CDP4s6O-CTkbefSAITaNM5s3iL7wU9M90Oy-EcckoviJlEB748Yk0nhgmcLNOiOGjeQSl4lrImd0bvKCu60mamnIKr2KPQsZlVb3w --query DecodedMessage --output text | jq '.'
03:07:01 PM Ayo: What operation are you performinf thats giving the error?
03:07:39 PM Customer: while i am trying to associate the instanceprofile from stepfunction i am getting the error
03:07:54 PM Ayo: ohh is see!
03:08:09 PM Customer: to analayse the error message i m running the decode command, that too giving me error
03:08:16 PM Ayo: Which IAM user is performing this action please?
03:08:40 PM Ayo: And what error do you get when you run decode cmd 
03:08:42 PM Customer: can you please run the decode command and tell me what is the issue
03:08:53 PM Ayo: WHta is the re
03:08:59 PM Customer: Note: AWS CLI version 2, the latest major version of the AWS CLI, is now stable and recommended for general use. For more information, see the AWS CLI version 2 installation instructions at: https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html 

usage: aws [options] <command> <subcommand> [<subcommand> ...] [parameters]
To see help text, you can run:

  aws help
  aws <command> help
  aws <command> <subcommand> help
aws: error: argument --encoded-message: expected one argument
03:09:11 PM Ayo: what is the Request ID of the error?
03:10:16 PM Customer: {
    "eventVersion": "1.08",
    "userIdentity": {
        "type": "AssumedRole",
        "principalId": "AROASNAO7RA3MEJ2UU35N:uPrSIeguKYTZtIstoATyYXpFEZGcGeOK",
        "arn": "arn:aws:sts::165387667510:assumed-role/surendar_test_stepfunction_role/uPrSIeguKYTZtIstoATyYXpFEZGcGeOK",
        "accountId": "165387667510",
        "sessionContext": {
            "sessionIssuer": {
                "type": "Role",
                "principalId": "AROASNAO7RA3MEJ2UU35N",
                "arn": "arn:aws:iam::165387667510:role/surendar_test_stepfunction_role",
                "accountId": "165387667510",
                "userName": "surendar_test_stepfunction_role"
            },
            "webIdFederationData": {},
            "attributes": {
                "creationDate": "2022-02-24T13:13:41Z",
                "mfaAuthenticated": "false"
            }
        },
        "invokedBy": "states.amazonaws.com"
    },
    "eventTime": "2022-02-24T13:13:46Z",
    "eventSource": "ec2.amazonaws.com",
    "eventName": "A
03:10:54 PM Customer:  "requestID": "d2e385c1-5c31-403e-81d6-8fedae437be6",
    "eventID": "7d8ed94d-1b2e-4c14-8ad3-ac62be1a4682",
03:11:38 PM Customer: this request ID is generated when i trying to associate the instance profile from stepfunction
03:12:44 PM Customer: can we connect on chime now
03:12:57 PM Ayo: Yes
03:13:03 PM Ayo: I sent the chime meeting link



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Feb 24 2022
21:31:31 GMT+0530 (India Standard Time)
{
    "DecodedMessage": "{\"allowed\":false,\"explicitDeny\":false,\"matchedStatements\":{\"items\":[]},\"failures\":{\"items\":[]},\"context\":{\"principal\":{\"id\":\"AROASNAO7RA3MEJ2UU35N:BQFpVmZbQOhjBIvlrkIDQiaRiXPMoNol\",\"arn\":\"arn:aws:sts::165387667510:assumed-role/surendar_test_stepfunction_role/BQFpVmZbQOhjBIvlrkIDQiaRiXPMoNol\"},\"action\":\"iam:PassRole\",\"resource\":\"arn:aws:iam::165387667510:role/AmazonSSMRoleForInstancesQuickSetup\",\"conditions\":{\"items\":[{\"key\":\"aws:Region\",\"values\":{\"items\":[{\"value\":\"us-east-1\"}]}},{\"key\":\"aws:Service\",\"values\":{\"items\":[{\"value\":\"ec2\"}]}},{\"key\":\"aws:Resource\",\"values\":{\"items\":[{\"value\":\"role/AmazonSSMRoleForInstancesQuickSetup\"}]}},{\"key\":\"iam:RoleName\",\"values\":{\"items\":[{\"value\":\"AmazonSSMRoleForInstancesQuickSetup\"}]}},{\"key\":\"aws:Type\",\"values\":{\"items\":[{\"value\":\"role\"}]}},{\"key\":\"aws:Account\",\"values\":{\"items\":[{\"value\":\"165387667510\"}]}},{\"key\":\"aws:ARN\",\"values\":{\"items\":[{\"value\":\"arn:aws:iam::165387667510:role/AmazonSSMRoleForInstancesQuickSetup\"}]}}]}}}"
}



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Feb 24 2022
21:19:05 GMT+0530 (India Standard Time)
{
    "DecodedMessage": "{\"allowed\":false,\"explicitDeny\":false,\"matchedStatements\":{\"items\":[]},\"failures\":{\"items\":[]},\"context\":{\"principal\":{\"id\":\"AROASNAO7RA3MEJ2UU35N:BQFpVmZbQOhjBIvlrkIDQiaRiXPMoNol\",\"arn\":\"arn:aws:sts::165387667510:assumed-role/surendar_test_stepfunction_role/BQFpVmZbQOhjBIvlrkIDQiaRiXPMoNol\"},\"action\":\"iam:PassRole\",\"resource\":\"arn:aws:iam::165387667510:role/AmazonSSMRoleForInstancesQuickSetup\",\"conditions\":{\"items\":[{\"key\":\"aws:Region\",\"values\":{\"items\":[{\"value\":\"us-east-1\"}]}},{\"key\":\"aws:Service\",\"values\":{\"items\":[{\"value\":\"ec2\"}]}},{\"key\":\"aws:Resource\",\"values\":{\"items\":[{\"value\":\"role/AmazonSSMRoleForInstancesQuickSetup\"}]}},{\"key\":\"iam:RoleName\",\"values\":{\"items\":[{\"value\":\"AmazonSSMRoleForInstancesQuickSetup\"}]}},{\"key\":\"aws:Type\",\"values\":{\"items\":[{\"value\":\"role\"}]}},{\"key\":\"aws:Account\",\"values\":{\"items\":[{\"value\":\"165387667510\"}]}},{\"key\":\"aws:ARN\",\"values\":{\"items\":[{\"value\":\"arn:aws:iam::165387667510:role/AmazonSSMRoleForInstancesQuickSetup\"}]}}]}}}"
}


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Feb 24 2022
20:59:23 GMT+0530 (India Standard Time)
{
	"DecodedMessage": "{\"allowed\":false,\"explicitDeny\":false,\"matchedStatements\":{\"items\":[]},\"failures\":{\"items\":[]},\"context\":{\"principal\":{\"id\":\"AROASNAO7RA3MEJ2UU35N:uDWhQONWlxsOwWUWHHjOWqrMjqJIIrqF\",\"arn\":\"arn:aws:sts::165387667510:assumed-role/surendar_test_stepfunction_role/uDWhQONWlxsOwWUWHHjOWqrMjqJIIrqF\"},\"action\":\"iam:PassRole\",\"resource\":\"arn:aws:iam::165387667510:role/AmazonSSMRoleForInstancesQuickSetup\",\"conditions\":{\"items\":[{\"key\":\"aws:Region\",\"values\":{\"items\":[{\"value\":\"us-east-1\"}]}},{\"key\":\"aws:Service\",\"values\":{\"items\":[{\"value\":\"ec2\"}]}},{\"key\":\"aws:Resource\",\"values\":{\"items\":[{\"value\":\"role/AmazonSSMRoleForInstancesQuickSetup\"}]}},{\"key\":\"iam:RoleName\",\"values\":{\"items\":[{\"value\":\"AmazonSSMRoleForInstancesQuickSetup\"}]}},{\"key\":\"aws:Type\",\"values\":{\"items\":[{\"value\":\"role\"}]}},{\"key\":\"aws:Account\",\"values\":{\"items\":[{\"value\":\"165387667510\"}]}},{\"key\":\"aws:ARN\",\"values\":{\"items\":[{\"value\":\"arn:aws:iam::165387667510:role/AmazonSSMRoleForInstancesQuickSetup\"}]}}]}}}"
}

=============================================

Hi Surendar,

Kanyisile here with AWS Premium Support.

I see you have already created case with IAM with case ID 9687430811 kindly ask them about the decode error they will be able to assist further.

It was a pleasure meeting you and have a great day further. 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Kanyisile N.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9687307491&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Thu Feb 24 2022
20:19:42 GMT+0530 (India Standard Time)

Translate
This case has been resolved. Please contact us again if you need further assistance.


AWS_P0001489@optum.com


Thu Feb 24 2022
19:26:07 GMT+0530 (India Standard Time)
02:09:24 PM Kanyisile: Hello, my name is Kanyisile.  I'm here to help you today.
02:09:31 PM Kanyisile: May I please have your name.
02:09:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
02:10:35 PM Kanyisile: Hi Surendar, its a pleasure to meet you, and how are you today?
02:10:45 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am fine...
02:10:50 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how are you 
02:11:38 PM Kanyisile: I am good thank you for asking. I understand you would like to know least permissions for an IAM EC2 profile
02:11:52 PM Kanyisile: This depends you what you would like the profile to do. 
02:11:53 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can you please tell me the least permission to associate the and disassociate the instance profile
02:12:12 PM Kanyisile: one moment please. 
02:14:24 PM Kanyisile: can you kindly give me some background on what permissions you would like to give, is this for SSM for example or another service that needs the permissions for an instance profile?
02:17:39 PM Kanyisile: for instance the following link has information on all the permissions you can grant, and depending you your business requirements you can set the permissions as needed: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html 
02:19:34 PM Kanyisile: For example, the following IAM policy grants users permission to launch instances with an IAM role, or to attach or replace an IAM role for an existing instance using the AWS CLI.: {
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
         "ec2:RunInstances",
         "ec2:AssociateIamInstanceProfile",
         "ec2:ReplaceIamInstanceProfileAssociation"
      ],
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "arn:aws:iam::123456789012:role/DevTeam*"
    }
  ]
}              
02:19:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime session on this 
02:20:04 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if it is possible
02:21:01 PM Kanyisile: not even a problem I can create a call for us, however there is a dedicated IAM team that you can reach out to but lets first chat about it via chime. Please allow me a moment while I create a meeting for us. 
02:21:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
02:22:17 PM Kanyisile: creating it now one moment please.
02:25:38 PM Kanyisile: https://chime.aws/7252689200    kindly join '
  



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Feb 24 2022
19:25:54 GMT+0530 (India Standard Time)
what is the least IAM permission for a user, would be able to associate and de associate the instance profile

===================================

Please let us know if we helped resolve your issue: 

If YES, click here:
https://console.aws.amazon.com/support/feedback?eventId=9686509631&language=en&questionnaireId=Support-HMD-Yes 

If NO, click here:
https://console.aws.amazon.com/support/feedback?eventId=9686509631&language=en&questionnaireId=Support-HMD-No 



Amazon Web Services


Wed Mar 09 2022
08:40:00 GMT+0530 (India Standard Time)

Translate

Hello,

We haven't heard back from you regarding case 9686509631 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9686509631&displayId=9686509631&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Wed Mar 02 2022
08:04:09 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello ,

Thank you for your patience on this case. I have an update from the Service Team.

Service Team has closed the finding for the terminated instances as requested.

I would request you to please check the Inspector finding and let me know if there are any terminated instances that still shows Inspector Finding.

I hope the above information is helpful. In case of any other query or concern, please feel free to update the case and I will be glad to assist you further.

Have a good day!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Md juber A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9686509631&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Mon Feb 28 2022
16:18:05 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello ,

Hope you are doing well.

I am still waiting on a response from the service team. I have escalated the case again to help expedite feedback on it. I apologise for the delay in resolution of your issue and will update you as soon as I receive any information regarding this case.

In the meantime, please feel free to reach out with any other queries or concerns. I will be more than happy to assist you.

Thank you for your patience. Have a great day ahead!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Md juber A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9686509631&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Thu Feb 24 2022
16:11:21 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello ,

Thank you for your time in chat and chime call today. My name is Juber.

Below is a short summary of what we discussed during the call. 

You contacted us because instances that have been terminated are showing in the Inspector findings.

I have reached out to our internal team on your behalf and made a request to investigate this. Once the service team is done with the investigation, I will reach back to you.

Please note that I do not have ETA for this. I will keep a very close eye on the ticket and will let you as soon as I have updates from our internal team. Until then,I am going to change the status of this case to "Pending Amazon Action.

In the meantime, please feel free to reach out with any other queries or concerns. I will be more than happy to assist you.

Have a good day!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Md juber A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9686509631&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


=====================================

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>


Hello Arun,

Many thanks for your patience while I was investigating this with the service team.

I was updated today by the EMR Security Team.
In order to understand the ownership of the of the vulnerability fix is necessary to understand the packages that triggered the alarm in the AWS Inspector.

Generally speaking each case will be managed by the proper team that own the specific package (EMR team, or Amazon Linux Team ...).
Please also note that some of the vulnerability detected by the AWS inspector may be false alarm, since the vulnerable classes or jar may not be used by EMR.
However, each case requires proper investigation and evaluation.

As general rule AWS will provide update for this when a fix is available by releasing new EMR release and normally not as AMI update.
In particular case or condition the service team may also provide on the user request a bootstrap action script for a faster resolution.
Please note that any vulnerability associated to packages or software that depends on the custom installation should be addressed on the customer end.

Having said that, if you wish that the service team analyze this vulnerability report further, it's requested to share with us a detailed list of the vulnerability, including the information regarding the affected packages.
Please make sure to provide as much detail as possible regarding the vulnerability, including the EMR release version and the impacted resources.

I hope you find the above information clear and helpful.
Should you have any questions or concerns, please feel free to write back.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Andrea B.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9653269641&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Mon Feb 28 2022
15:11:30 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Arun,

This to let you know that I'm keep looking on this with the EMR internal team.

Your query is now being evaluated by the EMR Security team.
I'll get update you as soon I've a feedback on this.

Many thanks for your extended patience on this.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Andrea B.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9653269641&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Owner/arunkumar@optum.com (Role)


Fri Feb 25 2022
22:17:13 GMT+0530 (India Standard Time)
Hi Andrea,

Thanks. We are looking forward for the response as some of our teams are waiting on this to resolve these vulnerabilities. Please let us know as soon as you get some updated on this.


Regards,
Arun 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello

It was a pleasure chatting with your today. My name is Tshepo, I am the AWS Support Engineer handling your case today.

You reached out to AWS Premium Support on chat today because you were getting the error below when using run command to download a script to your instance. 

"ERROR: http request failed. status:403 Forbidden statuscode:403"

We connected over a chime call to investigate the permission issue that you were encountering when access the S3 bucket from the instance. During the session, we observed that the S3 buckets was encrypted but the instance profile role did not have KMS permissions to access the encryption key. 

To resolve the issue, KMS permission were added on the policy and thereafter the instance could now download the file as required. 

In addition to the above, you observed that, even though the file was downloaded, it was not executed as expected. 

The AWS-RunRemoteScript document requires that you provide the source info and the command line parameters to execute that file.[1]

Below is sample of the required parameters to be able to both download the file and also to execute it.

response = ssm_client.send_command(
         InstanceIds=[
             'i-0627141864831ee75',
             ],
         DocumentName="AWS-RunRemoteScript",
         Parameters = {
             "sourceType": ["s3"],
             "sourceInfo":["{"path":"https://s3.amazonaws.com/165387667510-glue-test-arun/CVE-2021-43527/CVE-2021-43527.sh"}" ],
             "commandLine":["CVE-2021-43527.sh"]
             },
         )

I hope you find the above useful.

As confirmed on the call, I will go ahead and mark this case resolved.
Feel free to reach out if you have any additional questions or concerns, I will be glad to assist.

References:

[1] Run shell scripts from Amazon S3 - Run a shell script from Amazon S3 (console) - https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-s3-shell.html#integration-s3-ruby-console 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9646004681&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9646004681&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Tshepo K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9646004681&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Fri Feb 18 2022
16:56:08 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello

It was a pleasure chatting with your today. My name is Tshepo, I am the AWS Support Engineer handling your case today.
 
You reached out to AWS Premium Support on chat today because you were getting the error below when using run command to download a script to your instance. 

"ERROR: http request failed. status:403 Forbidden statuscode:403"

We connected over a chime call to investigate the permission issue that you were encountering when access the S3 bucket from the instance. During the session, we observed that the S3 buckets was encrypted but the instance profile role did not have KMS permissions to access the encryption key. 

To resolve the issue, KMS permission were added on the policy and thereafter the instance could now download the file as required. 

In addition to the above, you observed that, even though the file was downloaded, it was not executed as expected. 

The AWS-RunRemoteScript document requires that you provide the source info and the command line parameters to execute that file.[1]

Below is sample of the required parameters to be able to both download the file and also to execute it.

response = ssm_client.send_command(
         InstanceIds=[
             'i-0627141864831ee75',
             ],
         DocumentName="AWS-RunRemoteScript",
         Parameters = {
             "sourceType": ["s3"],
             "sourceInfo":["{"path":"https://s3.amazonaws.com/165387667510-glue-test-arun/CVE-2021-43527/CVE-2021-43527.sh"}" ],
             "commandLine":["CVE-2021-43527.sh"]
             },
         )

I hope you find the above useful.

As confirmed on the call, I will go ahead and mark this case resolved.
Feel free to reach out if you have any additional questions or concerns, I will be glad to assist.

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9646004681&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9646004681&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Tshepo K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9646004681&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Feb 18 2022
15:23:12 GMT+0530 (India Standard Time)
09:55:03 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar
09:55:08 AM Tshepo: Hello, my name is Tshepo.  I'm here to help you today.
09:55:33 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we are trying to execute the remote script from S3 location
09:55:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but we are getting access denied error
09:55:58 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: will you be able to help me in this
09:56:18 AM Tshepo: How are you surendar
09:57:25 AM Tshepo: Sure, I can help
09:57:38 AM Tshepo: How are you running the script?
09:57:45 AM Tshepo: SSM?
09:58:22 AM Tshepo: May I have the instance ID that you are running the script against please
09:58:23 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes
09:58:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i-0627141864831ee75
09:59:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sample command ID - 9b58b3d2-f4c1-490e-9365-a56ae8fa3c59
09:59:43 AM Tshepo: Thanks
09:59:51 AM Tshepo: Just a moment while I investigate
10:00:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay thanks
10:01:45 AM Tshepo: Has the role attached to the instance given permissions to the S3 bucket?
10:01:57 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: s3 full access given
10:02:21 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and i tried aws s3 ls s3://bucketname/script_location - it is working
10:02:30 AM Tshepo: To this role 	EC2 role for SSM for Quick-Setup?
10:02:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
10:02:46 AM Tshepo: Cool
10:03:02 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: IAM Role ARN - AmazonSSMRoleForInstancesQuickSetup
10:03:21 AM Tshepo: Lets have a look over screenshare please
10:03:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure 
10:03:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please share the chime session link
10:04:04 AM Tshepo: v
10:04:08 AM Tshepo: https://chime.aws/4194081894 
10:24:17 AM Tshepo: Please reconnect



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Feb 18 2022
15:23:01 GMT+0530 (India Standard Time)
Hi connecting again to check the S3 permission issue when running remote script


Amazon Web Services


Fri Feb 18 2022
14:22:52 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Surendar,

Let me know if you are available to connect now ?
You can join me on following link : https://chime.aws/4780155343 

Please note that the meeting link will be valid for 10 mins. If you are currently busy with any high priority task, feel free to raise a live call/chat as per your availability.

I can see you were facing issues to connect over a chat due to network disconnection, i would suggest you to please test call/email options in such cases.

Looking forward to hearing back.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Rutukesh P.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9646004681&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello,

Tekena here from AWS.

I notice you already resolved the case so it looks like you figured out the solution already but I wanted to update you on my findings.

I was unable to find any specific samples for your use case but I did some tests and was able to execute a script from s3 using this Python code snippet below:

####
import boto3
ssm_client = boto3.client('ssm') 
response = ssm_client.send_command(
             InstanceIds=[
                "i-06594b370fxxxxxxxx"
                     ],
             DocumentName="AWS-RunRemoteScript",
             Parameters={
                "sourceType": ["S3"],
                "sourceInfo": ["{\"path\":\"https://s3.eu-west-1.amazonaws.com/mybucket/hostname.ps1\"}" ],
                "commandLine": ['hostname.ps1']
                },
            ),
output = ssm_client.list_command_invocations(
      InstanceId='i-06594b370xxxxxxxx',
    )
print(output)

Please let me know if you have any questions and feel free to resolve the case if this is no longer needed.

Thanks for your patience and have a lovely day. 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9640525151&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9640525151&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Tekena O.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9640525151&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Thu Feb 17 2022
11:56:55 GMT+0530 (India Standard Time)

Translate
This case has been resolved. Please contact us again if you need further assistance.


AWS_P0001489@optum.com


Wed Feb 16 2022
18:19:44 GMT+0530 (India Standard Time)
00:50:02 PM Lance: Hello, my name is Lance.  I'm here to help you today.
00:50:06 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar
00:50:51 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am trying to run ssm command from python, but i am getting parameters doesnot support in remote shell script
00:51:16 PM Lance: A pleasure to meet you Surendar, I hope you are well. please allow me a few moments to review case history and notes
00:51:31 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
00:52:28 PM Lance: Okay I review my colleague was researching on a sample script to provide you
00:52:35 PM Lance: let me follow up with him
00:53:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay thanks
00:55:39 PM Lance: okay I will be passing chat back to Tekena, please allow a few moments
00:58:07 PM Lance: okay it seems he is having technical difficulty accepting chat
00:58:17 PM Lance: however he has tested this and had success
00:58:34 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: oh is it 
00:58:39 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can i have that sample code
00:58:42 PM Lance: import boto3
ssm_client = boto3.client('ssm') 
response = ssm_client.send_command(
             InstanceIds=[
                "i-06594b370f1bfb2f5"
                     ],
             DocumentName="AWS-RunPowerShellScript",
             Parameters={
                'commands':[
                     'hostname'
                       ]
                   },
            ),
output = ssm_client.list_command_invocations(
      InstanceId='i-06594b370f1bfb2f5',
    )
print(output)
00:59:13 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is working for me also 
00:59:20 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need to run the script from S3
01:00:02 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we need to specify the source type and source info and all
01:00:16 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: that is where i am blocked
01:02:11 PM Lance: okay, I may suggest that when Tekena becomes available he can reply to you on the case? 
01:02:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: will you help me in this
01:02:32 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if possible
01:03:20 PM Lance: okay, from specifying the source and source info, this is in python correct?
01:03:33 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: right
01:03:46 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i want to fetch the script from S3 bucket and run command 
01:04:08 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: there is an option but it is showing error, so probably it is syntax error
01:04:13 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so that i need your help
01:05:10 PM Lance: okay, for python code we unfortunately do not debug code and are not python developers, as Tekena has mentioned, I can refer to documentation on boto however I cannot provide much insight into correcting syntax errors as thats not in our support scope
01:05:57 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i understand but if you provide sample code that would be helpful 
01:09:21 PM Lance: We do not have any sample code as for this, only as provided by my colleague, for s3 boto reference you may review here: https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html#service-resource  



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Feb 16 2022
18:19:37 GMT+0530 (India Standard Time)
connection lost and connecting again

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello Surendar,

Thank you for your time on chat and chime meeting earlier today. It was nice talking to you. I am sharing a brief summary of what we conversed.

During our discussion, you mentioned that although you had built, associated layer to use boto3 version 1.21.0, Lambda function was still picking up the older version of 1.18.0 and wanted help on the same. When I looked at the Lambda layer export which you were using, I noticed that the layer was not maintaining the file hierarchy that was expected by Lambda: https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html#configuration-layers-upload  and also detailed how the layer needs to be built. I shared a sample latest version of boto3 with you which you tested out and it seemed to work successfully. Further, I also corrected the layer structure in your layer zip, tested it to work and shared it back with you. I also mentioned to provide adequate permissions to Lambda in its execution role when you had got the access denied exception in your code.

As discussed earlier, I am closing this case, please feel free to open a new case in future if there are any other queries and we shall be happy to assist.

Hope you have a good day ahead!

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9638922401&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9638922401&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Kirtana R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9638922401&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Wed Feb 16 2022
12:09:35 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Surendar,

This is Kirtana here. As we were connected via chat, the chat was disconnected from your end due to some network issue. In order to continue our discussion, could you please join the chime meeting below?

Personalized ID: 3997762988
Meeting ID: 3997 76 2988
Hosting Region: Singapore
URL Link: https://chime.aws/3997762988 
US dial-in: +1 206-462-5569
US toll-free dial-in: +1 855-552-4463
International dial-in numbers: https://chime.aws/dialinnumbers/ 

Looking forward to connecting with you.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Kirtana R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9638922401&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Feb 16 2022
11:58:25 GMT+0530 (India Standard Time)
06:30:01 AM Kirtana: Hello, my name is Kirtana.  I'm here to help you today.
06:30:30 AM Kirtana: Can I have your name please ?
06:31:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: my name is surendar
06:31:41 AM Kirtana: Hello Surendar, hope you are doing good. 
06:31:46 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: function arn : arn:aws:lambda:us-east-1:165387667510:function:surendar_test_inspecor_findings
06:31:59 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hey i am good thanks.. i hope you are good too
06:32:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: layer arn
06:32:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: arn:aws:lambda:us-east-1:165387667510:layer:boto3_cutom_layer:2

06:32:48 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am trying to use latest boto3 version in aws lambda function , so i have created the new aws lambda layer and attached with function 
06:33:07 AM Kirtana: I am doing good as well, thanks.. 

ok, so, I understand that latest version of boto3 is not working at your end and you have attached the oto3_cutom_layer:2  to your Lambda but still latest version is not being picked up ?
06:33:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but still it is not updated one, i am getting inspector2 service not available error 
06:33:22 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes 
06:33:25 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: you are correct
06:33:35 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if you want we can chime call 
06:33:50 AM Kirtana: can you please try to print "boto3.__version__" and let me know the result ?
06:34:22 AM Kirtana: sure.. please give me few minutes, I am checking few things at my end.. will create meeting in few minutes and share



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Feb 16 2022
11:58:17 GMT+0530 (India Standard Time)
boto3 latest version is not working
Function ARN: 
Error message: 
CloudWatch logs: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hi Surendar,

This is Zhenbang from AWS Premium Support. I hope you are having a great day. We had a chat today regarding the question you have regarding Boto3 in Lambda. It was very nice chatting with you!

During our chat, we have found that the service you want to use, inspector2 [1], is a new feature and it is not available in the Boto3 Lambda has in its runtimes [2]. Boto3 team releases new versions every few days, whereas the Lambda team takes more time to review a given version before launching it globally. In the interim, customers need to create their own Boto3 library to work around this.

The easiest way to do is create a Lambda layer. A layer is a piece of additional libraries specific to a runtime that will be loaded when the function is started. It can also share among many functions. Note that, for Python, you may want to create layer for each individual runtime, e.g. Python 3.7, 3.8, 3.9 etc., instead of having one for all.

You can follow the instruction here [3] to create a layer. Basically, you need to have an EC2 instance running Amazon Linux 2 and install the desired Python version. Then, you need to have a directory of this project (here called boto3Py37) and inside it, have another directory called python and install the latest Boto3 to it:

    $ mkdir -p boto3Py37/python
    $ cd boto3Py37
    $ pip3 install boto3 -t python/

Then, after examine the directory and make sure it has the latest Boto3, you can then run the following command to create a zip file:

    $ zip -r boto3Py37.zip .

In the zip file, it has to have the python/ directory in the root directory. Every libraries should be inside the python/ directory.

Then, you can upload it as a layer and make sure you select the correct runtime for it. Next, adding it to your Lambda function. The loaded Boto3 library should has higher priority than the stock one. You can inspect the Boto3 version in Python like this:

    print(boto3.__version__)

I hope the information I provided is helpful. As discussed, I will mark this support case as resolved. However, please feel free to reach out to us again if you have further questions about this topic. Stay healthy and have a nice day!





[1] https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/inspector2.html 
[2] https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html 
[3] https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9632874141&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9632874141&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Zhenbang X.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9632874141&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Feb 15 2022
18:14:29 GMT+0530 (India Standard Time)
Error Message as per our chat -

[ERROR] UnknownServiceError: Unknown service: 'inspector2'. Valid service names are: accessanalyzer, account, acm, acm-pca, alexaforbusiness, amp, amplify, amplifybackend, apigateway, apigatewaymanagementapi, apigatewayv2, appconfig, appflow, appintegrations, application-autoscaling, application-insights, applicationcostprofiler, appmesh, apprunner, appstream, appsync, athena, auditmanager, autoscaling, autoscaling-plans, backup, batch, braket, budgets, ce, chime, chime-sdk-identity, chime-sdk-messaging, cloud9, cloudcontrol, clouddirectory, cloudformation, cloudfront, cloudhsm, cloudhsmv2, cloudsearch, cloudsearchdomain, cloudtrail, cloudwatch, codeartifact, codebuild, codecommit, codedeploy, codeguru-reviewer, codeguruprofiler, codepipeline, codestar, codestar-connections, codestar-notifications, cognito-identity, cognito-idp, cognito-sync, comprehend, comprehendmedical, compute-optimizer, config, connect, connect-contact-lens, connectparticipant, cur, customer-profiles, databrew, dataexchange, datapipeline, datasync, dax, detective, devicefarm, devops-guru, directconnect, discovery, dlm, dms, docdb, ds, dynamodb, dynamodbstreams, ebs, ec2, ec2-instance-connect, ecr, ecr-public, ecs, efs, eks, elastic-inference, elasticache, elasticbeanstalk, elastictranscoder, elb, elbv2, emr, emr-containers, es, events, finspace, finspace-data, firehose, fis, fms, forecast, forecastquery, frauddetector, fsx, gamelift, glacier, globalaccelerator, glue, greengrass, greengrassv2, groundstation, guardduty, health, healthlake, honeycode, iam, identitystore, imagebuilder, importexport, inspector, iot, iot-data, iot-jobs-data, iot1click-devices, iot1click-projects, iotanalytics, iotdeviceadvisor, iotevents, iotevents-data, iotfleethub, iotsecuretunneling, iotsitewise, iotthingsgraph, iotwireless, ivs, kafka, kafkaconnect, kendra, kinesis, kinesis-video-archived-media, kinesis-video-media, kinesis-video-signaling, kinesisanalytics, kinesisanalyticsv2, kinesisvideo, kms, lakeformation, lambda, lex-models, lex-runtime, lexv2-models, lexv2-runtime, license-manager, lightsail, location, logs, lookoutequipment, lookoutmetrics, lookoutvision, machinelearning, macie, macie2, managedblockchain, marketplace-catalog, marketplace-entitlement, marketplacecommerceanalytics, mediaconnect, mediaconvert, medialive, mediapackage, mediapackage-vod, mediastore, mediastore-data, mediatailor, memorydb, meteringmarketplace, mgh, mgn, migrationhub-config, mobile, mq, mturk, mwaa, neptune, network-firewall, networkmanager, nimble, opensearch, opsworks, opsworkscm, organizations, outposts, personalize, personalize-events, personalize-runtime, pi, pinpoint, pinpoint-email, pinpoint-sms-voice, polly, pricing, proton, qldb, qldb-session, quicksight, ram, rds, rds-data, redshift, redshift-data, rekognition, resource-groups, resourcegroupstaggingapi, robomaker, route53, route53-recovery-cluster, route53-recovery-control-config, route53-recovery-readiness, route53domains, route53resolver, s3, s3control, s3outposts, sagemaker, sagemaker-a2i-runtime, sagemaker-edge, sagemaker-featurestore-runtime, sagemaker-runtime, savingsplans, schemas, sdb, secretsmanager, securityhub, serverlessrepo, service-quotas, servicecatalog, servicecatalog-appregistry, servicediscovery, ses, sesv2, shield, signer, sms, sms-voice, snow-device-management, snowball, sns, sqs, ssm, ssm-contacts, ssm-incidents, sso, sso-admin, sso-oidc, stepfunctions, storagegateway, sts, support, swf, synthetics, textract, timestream-query, timestream-write, transcribe, transfer, translate, voice-id, waf, waf-regional, wafv2, wellarchitected, wisdom, workdocs, worklink, workmail, workmailmessageflow, workspaces, xray
Traceback (most recent call last):
  File "/var/lang/lib/python3.7/imp.py", line 234, in load_module
    return load_source(name, filename, file)
  File "/var/lang/lib/python3.7/imp.py", line 171, in load_source
    module = _load(spec)
  File "<frozen importlib._bootstrap>", line 696, in _load
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/var/task/lambda_function.py", line 4, in <module>
    inspector = boto3.client("inspector2")
  File "/var/runtime/boto3/__init__.py", line 93, in client
    return _get_default_session().client(*args, **kwargs)
  File "/var/runtime/boto3/session.py", line 263, in client
    aws_session_token=aws_session_token, config=config)
  File "/var/runtime/botocore/session.py", line 851, in create_client
    client_config=config, api_version=api_version)
  File "/var/runtime/botocore/client.py", line 81, in create_client
    service_model = self._load_service_model(service_name, api_version)
  File "/var/runtime/botocore/client.py", line 123, in _load_service_model
    api_version=api_version)
  File "/var/runtime/botocore/loaders.py", line 132, in _wrapper
    data = func(self, *args, **kwargs)
  File "/var/runtime/botocore/loaders.py", line 379, in load_service_model
    known_service_names=', '.join(sorted(known_services)))



AWS_P0001489@optum.com


Tue Feb 15 2022
18:05:31 GMT+0530 (India Standard Time)
00:37:35 PM Zhenbang X: Hello, my name is Zhenbang X.  I'm here to help you today. Can I have your name, please?
00:37:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar
00:38:09 PM Zhenbang X: Hi Surendar, how are you today?
00:38:13 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am trying to run boto3 inspector2 code in lambda
00:38:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hey I am good !!!!! thanks for asking
00:38:32 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how are you 
00:38:48 PM Zhenbang X: Not bad myself. Thanks for asking :)
00:39:03 PM Zhenbang X: Can you let me know which Lambda function this is? ARN or function name and region
00:39:45 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: arn:aws:lambda:us-east-1:165387667510:function:surendar-test
00:39:51 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: us-east-1
00:40:11 PM Zhenbang X: Thanks. Checking
00:42:20 PM Zhenbang X: What is the error message you see in your execution?
00:44:48 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have paste the error message on the case description
00:45:18 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: there are is no service name like inspector2 
00:46:10 PM Zhenbang X: Do you mean this: https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/inspector2.html 
00:46:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
00:47:47 PM Zhenbang X: It might be that the boto3 your particular runtime isn't new enough to have that service in. Let me take a look of the Python3.7 runtime
00:49:35 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: even python 3.9 also having same issue when we running the code in lambda
00:52:02 PM Zhenbang X: I just checked the version of Boto3 used in Lambda is 1.18.55. It is released in Oct 2021, so it may not have the service there: https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html 
00:52:45 PM Zhenbang X: What you can do is you can create a custom layer of the latest Boto3 and attach to your function. The layer needs to be version-specific, i.e. you need to create the layer corresponding to Python 3.7, 3.8, 3.9 etc.
00:53:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how to do that
00:53:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we chime call on this
00:55:08 PM Zhenbang X: Basically, you need to have an EC2 running Amazon Linux 2, and install the Python version you want for your Lambda function, and then pip install boto3 into a folder. Zip that folder and upload to Lambda layer and include the layer in your function.
00:56:15 PM Zhenbang X: A more comprehensive explanation can be found here: https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html 

This one is a bit more complicated because it also includes steps if your function is using ARM instead of x86. My explanation above is the minimal model of what you need
00:57:20 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: hmmm
00:57:55 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: why AWS not updated the boto3 version in python runtime 
00:58:01 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but document saying it is updated 
00:58:15 PM Zhenbang X: Which document?
00:58:23 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Name	Identifier	AWS SDK for Python	Operating system	Architectures
Python 3.9

python3.9

boto3-1.18.55 botocore-1.21.55

Amazon Linux 2

x86_64, arm64
00:58:36 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html 
00:59:25 PM Zhenbang X: No, it's not updated, it's 1.18.55 like I mentioned
00:59:48 PM Zhenbang X: The latest is 1.21.0
01:00:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: when i checking the https://github.com/boto/boto3/blob/develop/CHANGELOG.rst#12016  link
01:00:38 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is available from 1.21
01:00:47 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
01:01:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sorry it is available from 1.20.6
01:01:55 PM Zhenbang X: Boto3 and Lambda are not the same team. Boto3 make new releases every few days. Lambda needs to review the updates from Boto3 and making changes every several months. They are not in sync. For the latest features, customer has to use their own Boto3 instead of the one comes with the official runtime.
01:02:12 PM Zhenbang X: So that's what you need to do.
01:02:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay i will check how i can do it
01:02:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks for your support
01:03:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we can close this case
01:04:42 PM Zhenbang X: Sure thing. My high-level conclusion of what you need to do should be able to guide you. It's essentially "download the latest Boto3 to a folder called 'python' and zip everything and upload to Lambda Layer". Do make sure you installed the right version of Python though, they may not compatible cross versions.
01:05:07 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: right
01:05:09 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
01:05:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: all good
01:05:31 PM Zhenbang X: No problem. Please feel free to let us know if you have problems creating it. Have a nice day ahead Surendar!
01:06:38 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks you too



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Feb 15 2022
18:05:18 GMT+0530 (India Standard Time)
connection lost connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Feb 15 2022
17:54:48 GMT+0530 (India Standard Time)
how to run inspector2 boto3 in lambda. 

Issue is python latest version doesnt have boto3 module 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello Surendar,

Damini here from AWS Premium Support. It was nice speaking to you on call. I'm here to summarize the discussion we had over the call.

You had contacted us today as you were experiencing below error while executing EC2 "RunInstances" API action using Step Functions although you have passed the "ImageId" value in the Step Input.

    {
     "error": "Ec2.Ec2Exception",
    "cause": "Invalid id: \"$.input.ImageId\" (expecting \"ami-...\") (Service: Ec2, Status Code: 400, Request ID: dddf9c23-cd5c-423b-8c47-4dbf29fea4c2, Extended Request ID: null)"
    }

As mentioned on call, in order to specify that a parameter use a path to reference a JSON node in the input, end the parameter name with .$ [1]. After modifying the "Parameters" in the State definition as follows, the issue was resolved.

                    "ImageId.$": "$.input.ImageId",
                    "InstanceType.$": "$.input.InstanceType",
                    "SubnetId.$": "$.input.SubnetId"

However, we observed that the EC2 instance launched from the AMI terminated immediately with State Transition Reason as "Client.InternalError: Client error on launch". As described in the documentation [2], this error occurs when IAM Role/User used to launch the instance does not have the required permissions to access the AWS KMS keys used to decrypt and encrypt volumes. 

Upon checking the AMI, we observed that the EBS snapshot was encrypted using KMS. Therefore, I would request you to update the KMS Key policy to allow below permissions [3] for the Step Function Execution Role and see if the issue is resolved.

       "kms:Encrypt",
       "kms:Decrypt",
       "kms:ReEncrypt*",
       "kms:GenerateDataKey*",
       "kms:DescribeKey"

I hope the information provided was helpful. Please don't hesitate to reach out to me should you have any further queries and I will be happy to assist.

Wishing you a great day ahead!

References:
=========
[1] https://docs.aws.amazon.com/step-functions/latest/dg/connect-parameters.html#connect-parameters-path 
[2] https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/troubleshooting-launch.html#troubleshooting-launch-internal-solution 
[3] https://docs.aws.amazon.com/autoscaling/ec2/userguide/key-policy-requirements-EBS-encryption.html#configuring-key-policies 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Damini Nixcy Mol A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9631893281&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Feb 15 2022
11:55:18 GMT+0530 (India Standard Time)
06:36:33 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
06:36:34 AM Damini Nixcy Mol Antony: Hello, my name is Damini Nixcy Mol Antony.  I'm here to help you today.
06:36:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
06:36:45 AM Damini Nixcy Mol Antony: Hello Surendar
06:36:51 AM Damini Nixcy Mol Antony: Hope you are doing well
06:37:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yeah thanks, how are you !!!!
06:37:10 AM Damini Nixcy Mol Antony: I am good. Thank You!
06:37:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am getting error - {
  "error": "Ec2.Ec2Exception",
  "cause": "Invalid id: \"$.input.ImageId\" (expecting \"ami-...\") (Service: Ec2, Status Code: 400, Request ID: dddf9c23-cd5c-423b-8c47-4dbf29fea4c2, Extended Request ID: null)"
}
06:37:27 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: my definition - {
  "Comment": "inspector autoremdiation",
  "StartAt": "RunInstances",
  "States": {
    "RunInstances": {
      "Type": "Task",
      "Parameters": {
        "MaxCount": 1,
        "MinCount": 1,
        "ImageId": "$.input.ImageId",
        "InstanceType": "$.input.InstanceType",
        "SubnetId": "$.input.SubnetId"
      },
      "Resource": "arn:aws:states:::aws-sdk:ec2:runInstances",
      "ResultPath": "$.instance_result",
      "End": true
    }
  }
}
06:37:39 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: my input - {
  "input": {
     "ImageId": "ami-001b9e3176648ea36",
  	"SubnetId": "subnet-0fca27af1beec4836",
  	"InstanceType": "t2.micro"
  }
06:37:44 AM Damini Nixcy Mol Antony: $.input.ImageId -- What is the value passed?
06:37:59 AM Damini Nixcy Mol Antony: Can you ping me the StateMachine ARN?
06:40:58 AM Damini Nixcy Mol Antony: Hello, Are we connected?
06:42:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
06:42:21 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: arn:aws:states:us-east-1:165387667510:execution:inspector-surendar-machine:0a54d634-7409-48b6-52c9-59378687c954
06:42:26 AM Damini Nixcy Mol Antony: Can we get on a chime call?
06:42:35 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: "ImageId": "ami-001b9e3176648ea36",
06:42:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure
06:42:41 AM Damini Nixcy Mol Antony: Click to join the meeting: https://chime.aws/9940675385 
Meeting ID: 9940 67 5385

06:55:09 AM Damini Nixcy Mol Antony: https://docs.aws.amazon.com/step-functions/latest/dg/connect-parameters.html#connect-parameters-path 
07:06:13 AM Damini Nixcy Mol Antony: 

    kms:CreateGrant

    kms:Decrypt

    kms:DescribeKey

    kms:GenerateDataKeyWithoutPlainText

    kms:ReEncrypt

07:07:33 AM Damini Nixcy Mol Antony: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/troubleshooting-launch.html#troubleshooting-launch-internal-cause 
07:07:44 AM Damini Nixcy Mol Antony: A snapshot specified in the block device mapping for the AMI is encrypted and you do not have permissions to access the KMS key for decryption or you do not have access to the KMS key to encrypt the restored volumes.
07:16:03 AM Damini Nixcy Mol Antony: EC2 Image Builder 	arn:aws:states:::aws-sdk:imagebuilder:[apiAction]



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Feb 15 2022
11:55:05 GMT+0530 (India Standard Time)
cannot create the EC2 instance using custom input
State Machine ARN: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello Surendar,

This is Michael here from AWS Premium Support with a summary of our earlier session.

Thank you for your time and efforts during our chime and screen share meeting. You had reached out to us to confirm why you were seeing a large list of EC2 instance IDs when programmatically querying your Inspector finding reports via the CLI. 

During the investigation, we were able to establish that these instance IDs belonged to closed findings from previous EC2 instances that was launched in the account.

Next, you queried how you can specify that only the current active findings should be included in your programmatic query.

By using the "create-findings-report" API via the CLI [1], you can request a report from Inspector programmatically. When using this API, you're able to specify a filter in the request parameters which narrows down  the report's scope to your active findings.

At this point in the call, all your questions was answered and you're happy for us to close this case. Please do feel free to reach out to us again should you have any further questions or concerns.

Wishing you an AWSome week ahead!

=========
Resources:
=========

[1] create-findings-report - https://docs.aws.amazon.com/cli/latest/reference/inspector2/create-findings-report.html 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9598832941&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9598832941&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Michael v.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9598832941&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Feb 10 2022
14:00:33 GMT+0530 (India Standard Time)
08:34:58 AM Michael: Hello, my name is Michael.  I'm here to help you today. May I know your name please?
08:37:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
08:38:01 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
08:38:16 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have run the api calls and getting some big results,
08:38:30 AM Michael: Thanks Surendar, could you please give me a moment to review the case history? 
08:38:35 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it contains lot of instance IDs , those are not in my account
08:39:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure , if it is okay we can have chime session
08:42:56 AM Michael: Thanks for your patience, just to confirm you have been able to successfully execute the API and you're getting a lot of results from listing the findings via API. 

At this point, you're seeing instance ID's that are not in your account and would like to investigate this, correct? 
08:43:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes 
08:43:39 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if i can share the screen, we can isolate the issue easily
08:43:52 AM Michael: Okay, please give me a moment to set the meeting up 
08:43:57 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
08:45:23 AM Michael: https://chime.aws/7792477784 
Meeting ID: 7792 47 7784
U.S. Toll: +1 206-462-5569
Meeting PIN: 7792 47 7784
U.S. Toll-free: +1 855-552-4463
International: https://chime.aws/dialinnumbers/ 

09:26:30 AM Michael: Thank you for your time on the meeting, I'll be sure to send a summary and then cllose the case as discussed. Have a great day :) 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Feb 10 2022
14:00:27 GMT+0530 (India Standard Time)
chat got disconnected, connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Feb 10 2022
13:56:44 GMT+0530 (India Standard Time)
when i run the command I can see there are lot of conflict with cli result and console 


Amazon Web Services


Thu Feb 10 2022
13:15:19 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Surendar, 

Thank you so much for contacting AWS Premium Support today. This is Man Man who was assisting you on the live contact, it was a pleasure chatting with you earlier. 

I see that you attempted to re-initiate a chat session but the chat was not initiated. I apologize for the inconvenience if there was a connection issue. If a re-initiate of chat still fail, please kindly share a contact number with country code, a timeframe and time zone, and we will attempt to reach out to you instead. 

I'm sending this email as a brief summary of previous chat session. 

The chat is about you want to use Step Functions to list inspector findings. During the chat, we discussed:

- We confirmed that Step Function currently does not have SDK integration with inspector2 service. I checked internally and had raised a feature request to have Step Functions SDK integration to support Inspector2 service. Since the request will be handled by the service team, I apologize that Premium Support does not have visibility on their timeline and not able to provide an ETA at this time. New feature implementation will be published on the AWS Blog [1] and AWS New [2], I do recommend to follow them for any updates. You are also more than welcome to open a support case to request a status update, and we will gladly provide any information to the best we can. 

[1] https://aws.amazon.com/blogs/ 
[2] https://aws.amazon.com/new/ 

- The inspector classic assessment is already checking only EC22 instances, so the instance type would always be EC22 instances. On the other hand, Inspector2 service will scan both EC2 instance ECR images. 

-  For Inspector Classic CLI/ boto3 SDK, the ListFindings API support using the Filter option to filter the findings [3]. For example, the following are some sample CLI commands:

// This will filter findings with specific instance-id
aws inspector list-findings --filter agentIds=i-00xxxxxxxxxx

// This will filter findings with specific ENI-id
aws inspector list-findings --filter 'attributes={key=ENI,value=eni-0xxxxxxx}'

[3] https://docs.aws.amazon.com/inspector/v1/APIReference/API_ListFindings.html 

- I did some further testing on Step Functions and was able to get the following state definition working with the above Filter option. For example, this state machine will output the findings of the instance-id:

```
{
    "Comment": "InspectorClassicListFindings",
    "StartAt": "ListFindings",
    "States": {
        "ListFindings": {
            "Type": "Task",
            "End": true,
            "Parameters": {
                     "Filter": {"AgentIds":["i-00xxxxxxxxxx"]}
            },
            "Resource": "arn:aws:states:::aws-sdk:inspector:listFindings"
        }
    }
}
```

- Given Step Functions currently has no native support on Inspector2 service, a workaround would be to use Step Function to invoke a Lambda function [4], and then have the Lambda function code to call Inspector2 ListFindings API  instead. The Inspector2 ListFindings API also has a filterCriteria option to filter findings [5]. 

[4] https://docs.aws.amazon.com/step-functions/latest/dg/tutorial-creating-lambda-state-machine.html 
[5] https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/inspector2.html#Inspector2.Client.list_findings 

I apologize again for the impact due to the lack of feature support at this time. Please let me know if you have any questions or concerns, and I will do my best to assist.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Man Man C.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9598832941&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello Surendar,

It was a pleasure chatting with you.

This is a brief summary of our discussion. You had reached out to us as you were facing an issue while making AWS Inspectors ListFindings API[1] call, using Step Functions. The error message suggested that the field severities is not supported by Step Functions. On replicating the issue, I could see that ListFindings has a filter parameter, that has severities as an attribute and on trying the following snippet, I was able to successfully create a state machine :




"Parameters": {
        "Filter" : {
          "Severities": [
          "High"
        ]}
      }



Note :- Please note that Parameter names should be in Pascal case.

Further, we went on a call and were able to successfully create a state machine and run an execution. We also discussed about Optimised integrations[2] in Step Functions and SDK integrations[3]. 

I hope I could help. As discussed I will be resolving this case for now. However, feel free to get back to us in case of any other queries or concerns and we will be happy to assist.

Have a nice day !

References:
[1] https://docs.aws.amazon.com/inspector/v1/APIReference/API_ListFindings.html 
[2] Optimized integrations for Step Functions - https://docs.aws.amazon.com/step-functions/latest/dg/connect-supported-services.html 
[3] https://docs.aws.amazon.com/step-functions/latest/dg/supported-services-awssdk.html 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9598661011&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9598661011&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Nirupam S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9598661011&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Feb 09 2022
12:44:07 GMT+0530 (India Standard Time)
07:15:11 AM Nirupam: Hello, my name is Nirupam.  I'm here to help you today.
07:15:18 AM Nirupam: May I know your name please?
07:15:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: HI My name is surendar
07:15:56 AM Nirupam: Hi Surendar, hope you are doing well. Please give me a minute to go through your case notes
07:16:27 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com:  I am trying to list the aws inspector findings in step function and initiate the lambda as per the result 
07:16:46 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: error is - There are Amazon States Language errors in your state machine definition. Fix the errors to continue.
The field "severities" is not supported by Step Functions
07:17:32 AM Nirupam: Okay, the API call is listfindings ?
07:18:38 AM Nirupam: I am checking the ListFindings API syntax, just give me few minutes 
07:19:16 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes 
07:19:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: {
    "Comment": "inspector autoremdiation",
    "StartAt": "ListFindings",
    "States": {
      "ListFindings": {
        "Type": "Task",
        "End": true,
        "Parameters": {
            "severities": [
              "High"
            ]
        },
        "Resource": "arn:aws:states:::aws-sdk:inspector:listFindings"
      }
    }
  }
07:22:38 AM Nirupam: Thanks for sharing this, I am trying to quickly replicate the issue
07:23:26 AM Nirupam: Although Parameter namess should be Pascal case, but give me few minutes to replicate
07:23:30 AM Nirupam: names*
07:25:48 AM Nirupam: Okay, so I believe its an API syntax issue
07:26:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
07:26:23 AM Nirupam: ListFindings has a "filter" parameter, that has severities as an attribute
07:26:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have a call to quickly check on this
07:26:26 AM Nirupam: I tried this
07:26:30 AM Nirupam: "Parameters": {
        "Filter" : {
          "Severities": [
          "High"
        ]}
      }
07:26:32 AM Nirupam: and it worked
07:26:49 AM Nirupam: can you try this snippet in the definition of your state machine?
07:27:08 AM Nirupam: If it doesn't work, do let me know, and we can quickly hop on a call
07:27:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
07:27:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but i do have other doubts as well 
07:27:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: with step function
07:27:48 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so it is possible to jump on call
07:27:57 AM Nirupam: sure, could you please share your number?
07:28:01 AM Nirupam: with country code
07:28:11 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: chime is fine for me 
07:28:18 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i can share the screen 
07:28:18 AM Nirupam: alright, give me a minute
07:28:26 AM Nirupam: I will share a meeting link
07:29:09 AM Nirupam: https://chime.aws/2472226895 
07:30:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
07:31:18 AM Nirupam: no problem! 
07:36:59 AM Nirupam: https://docs.aws.amazon.com/step-functions/latest/dg/supported-services-awssdk.html 
07:37:14 AM Nirupam: https://docs.aws.amazon.com/step-functions/latest/dg/connect-supported-services.html 
07:47:53 AM Nirupam: I will send a brief summary of our discussion via an email in some time. Thank you for your time, have a nice day !



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Feb 09 2022
12:43:59 GMT+0530 (India Standard Time)
connection lost so connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Feb 09 2022
12:43:40 GMT+0530 (India Standard Time)
connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Feb 09 2022
12:37:06 GMT+0530 (India Standard Time)
how to add aws inspector in step function .

we tried to get the aws inspector findings using step function and remediate with lambda function but we are not able to add listfindings in stepfunction
State Machine ARN: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello there,

Thank you for contacting AWS Premium Support. This is Venkat with a follow up. It was a pleasure chatting with you. 

During the chat you mentioned that you would like to integrate AWS Inspector and Security Hub.

While on chat I confirmed that you can enable integration of AWS Inspector with SecurityHub. You can enable integration through SecurityHub Integration console (it should be automatically enabled) [1] [2].

For automatic remediation of AWS Inspector, right now we dont have any automated actions available unfortunately. The AWS Inspector remediations has Information on how to remediate a finding like a comment section and there are no SSM documents for automatic remediations of AWS Inspector. [3]

For remediating SecurityHub findings, we have a solution in place which you can use to see if that works for your use case. AWS Security Hub Automated Response and Remediation includes the playbook remediations for the security standards defined as part of the Center for Internet Security (CIS) AWS Foundations Benchmark v1.2.0 and AWS Foundational Security Best Practices (AFSBP) v.1.0.0, and Payment Card Industry Data Security Standard (PCI-DSS) v3.2.1. [4]

The solution deploys Lambdas, SSM Automation Documents, Step functions etc. to autoremediate and send SNS notifications from Administrator account to member accounts. [5] To be honest I have never really deployed it myself and also, we cannot entirely support this from our end because it is a solution and not a service feature which makes this a bit out of scope of AWS Premium Support. That being said, I do have experience with troubleshooting this SHARR issues and I will be happy to help in every way I can. 

I hope this helped. Please let me know if you have any further questions and I will be happy to assist.

Have a lovely day :)

References:
 
[1] Integration with AWS Security Hub - https://docs.aws.amazon.com/inspector/v1/userguide/securityhub-integration.html 

[2] Integration with AWS Security Hub - Enabling and configuring the integration - https://docs.aws.amazon.com/inspector/latest/user/securityhub-integration.html#integrations-security-hub-enabling-configuring 

[3] Remediation - https://docs.aws.amazon.com/inspector/v2/APIReference/API_Remediation.html 

[4] Automatically address security threats with predefined response and remediation actions in AWS Security Hub - https://docs.aws.amazon.com/solutions/latest/aws-security-hub-automated-response-and-remediation/welcome.html 

[5] https://aws.amazon.com/blogs/security/how-to-remediate-amazon-inspector-security-findings-automatically/ 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Venkatakrishnan G.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9587819481&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Mon Feb 07 2022
18:46:30 GMT+0530 (India Standard Time)
01:44:11 PM Venkatakrishnan: Hello, my name is Venkatakrishnan.  I'm here to help you today.
01:45:24 PM Venkatakrishnan: May I know your name please? 
01:48:06 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
01:48:14 PM Venkatakrishnan: Hey Surendar. How are you?
01:48:24 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi I am fine, thanks
01:48:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how are you 
01:48:52 PM Venkatakrishnan: I am good thanks for asking :) Sorry to keep you waiting. I see you would like to import findings to SecurityHub dashboard from Inspector. 
01:49:08 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: also i want to remediate automatically
01:49:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how i can find remediation steps for security findings
01:50:01 PM Venkatakrishnan: Right. We are talking about Inspector V2 or classic? 
01:50:15 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: inspector V2
01:51:19 PM Venkatakrishnan: Cool. Integration is really quick. you go to Security Hub integrations, look for inspector and hit enable
01:51:26 PM Venkatakrishnan: [] Integration with AWS Security Hub - https://docs.aws.amazon.com/inspector/v1/userguide/securityhub-integration.html 

[] Integration with AWS Security Hub - Enabling and configuring the integration - https://docs.aws.amazon.com/inspector/latest/user/securityhub-integration.html#integrations-security-hub-enabling-configuring 


01:51:44 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is already integrated 
01:51:49 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: in my account
01:52:05 PM Venkatakrishnan: Cool. The remediation part. thats more complex to answer. Please give me a moment
01:52:15 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we need help in auto remediation and where remediation documented in aws documentation
01:52:41 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: quick question: is there any way that we can remediate the security findings using security hub
01:53:25 PM Venkatakrishnan: The reason being, Inspector V2 is relatively new and the remediation recommendations would be there. but you would have to create a custom remediation steps for automatic remediation.
01:54:07 PM Venkatakrishnan: For securityHub, we have a solution called SHARR. SecurityHub automatic Remediation Response. You can look into that and see if its feasible for you to set it up. 
01:54:19 PM Venkatakrishnan: please give me a moment. let me find those docs for you
01:54:43 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
01:54:44 PM Venkatakrishnan: https://aws.amazon.com/blogs/security/how-to-deploy-the-aws-solution-for-security-hub-automated-response-and-remediation/ 

[] Automated deployment - Stacks - https://docs.aws.amazon.com/solutions/latest/aws-security-hub-automated-response-and-remediation/deployment.html 

01:55:08 PM Venkatakrishnan: Thats for SecHub auto remediation. Its a solution by AWS using SSM, Step functions etc. 
01:56:00 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
01:56:16 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have a call quickly discuss on this
01:57:11 PM Venkatakrishnan: I dont think we have automatic remediations for Inspector findings. Are you looking to deploy a centralized architecture? like one central account with many member accounts? 
01:57:33 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is possible ??
01:58:31 PM Venkatakrishnan: yes ofcourse
01:59:06 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay can we discuss briefly on the call 
02:00:29 PM Venkatakrishnan: if you look at the blog I sent you for SHARR, that is the one you deploy the SecHub admin account. Sure we can. now I have never really deployed it myself and to be honest, we cannot entirely support this from our end because its a solution and not a service feature. That being said, I do have experience with troubleshooting this SHARR issues so I will be happy to help in anyway I can
02:01:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: SHAAR need primary account , (if my account joined in organization)
02:01:51 PM Venkatakrishnan: Yeah in that case, its your SecHub admin account. Delegated admin account for your SecurityHub or the centralized account
02:02:15 PM Venkatakrishnan: thats where you deploy this and setup the roles for SHARR to do its thing
02:02:36 PM Venkatakrishnan: You can see the solution overview. 
02:03:21 PM Venkatakrishnan: Basically member account send findings to admin account -> you trigger SHARR through CloudWatch -> Lambda from SHARR assumes the role in the member account and makes API calls for you. Finally SHARR notifies you through SNS
02:04:47 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how this will remediate the findings
02:04:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: where the remediation steps are stored
02:06:23 PM Venkatakrishnan: The solution uses SSM automation documents to deploy automation actions. you can make these docs customized as well
02:07:31 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment
02:08:51 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: that complete documentation is all about SHARR
02:09:33 PM Venkatakrishnan: Yes the remediation of Inspector I dont think currently is possible. I need to verify that from end offline but right now I think there are any automations for Inspector findings
02:10:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay please check and let me know, how we can remediate the inspector findings
02:11:49 PM Venkatakrishnan: Sure I will. I will have to take this offline. I did a quick check on SSM documents present I dont see anything relevant to the inspector findings specifically. but ll see if there anything we can use offline if that is okay with you. 
02:12:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
02:12:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we will connect tomorrow again 
02:12:45 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: meantime i will look into the documentation 
02:12:49 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you
02:12:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: good day to you
02:13:02 PM Venkatakrishnan: Sure. Have a lovely day :) 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Mon Feb 07 2022
18:46:12 GMT+0530 (India Standard Time)
how to integrate AWS inspector and security Hub and autoremediate the findings
Integration type: AWS service Integrations
Finding ID / ARN: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello,

We haven't heard back from you regarding case 9573050761 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9573050761&displayId=9573050761&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Fri Feb 04 2022
15:17:11 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hi there, 

Nataizya here from AWS. 

A chat session was opened with the need to find out how to run a web based application in AWS Batch and scale the appication in response to load.

We got on a screenshare and discussed multiple features of Batch. I shared the link in [1] regarding the Scheduling Policy that can be used to control how jobs are scheduled. I would recommend reading through the blog post as it gives good examples of how to make use of the scheduling policy feature. 

We then had a chat about the job queue and how Compute Environments would be selected for scheduling if there is more than one Compute Environment associated to the job queue. In [2] it mentions the following about the ComputeEnvironmentOrder:

    - The order in which compute environments are tried for job placement within a queue. Compute environments are tried in ascending order. For example, if two compute environments are associated with a job queue, the compute environment with a lower order integer value is tried for job placement first.

It was then mentioned that it would be best to have a web application running in ECS rather than Batch because Batch will not restart the job should the web application fail. 

In ECS, it was mentioned that to run a web application, the following would be needed:

    - an ECS cluster
    - a task definition
    - an ECS service
    - a load balancer that should be created prior to creating the ECS service and can be added to the ECS service when creating the ECS service. This can be used as a single point of entry for the web application. Please refer to [3] on steps on how to add a load balancer to an ECS service. 
    - Servie autoscaling. This is also configured when creating the ECS service. I have incldued the steps in [4] for more information on this. 

Lastly, I would recommend starting with the getting started guide of ECS [5] to get a better understanding of how it works and what is needed to run tasks in ECS. 

I trust that the above will be useful. Feel free to reach out should there be anything that I can assist with. I will be more than happy to. 

# References 
[1] - https://aws.amazon.com/blogs/hpc/introducing-fair-share-scheduling-for-aws-batch/ 
[2] ComputeEnvironmentOrder - https://docs.aws.amazon.com/batch/latest/APIReference/API_ComputeEnvironmentOrder.html 
[3] - Creating an Application Load Balancer - https://docs.aws.amazon.com/AmazonECS/latest/userguide/create-application-load-balancer.html 
[4] Step 5: Configuring your service to use Service Auto Scaling - https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-configure-auto-scaling.html 
[5] Getting started with Amazon ECS - https://docs.aws.amazon.com/AmazonECS/latest/developerguide/getting-started.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Nataizya S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9573050761&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Feb 04 2022
14:30:42 GMT+0530 (India Standard Time)
09:01:45 AM Nataizya S: Hello, my name is Nataizya S.  I'm here to help you today.
09:01:49 AM Nataizya S: May I ask who I am speaking to?
09:04:15 AM Nataizya S: Hello?
09:05:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
09:05:29 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Sorry for the late response
09:05:33 AM Nataizya S: No worries
09:05:43 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I have few queries in AWS batch
09:06:09 AM Nataizya S: sure
09:06:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how to run persistent web application on aws batch and application should be scaled as per the request metrics 
09:06:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: also if there is any issue with the application containers should be terminated and new one should be provisioned
09:07:07 AM Nataizya S: AWS Batch isnt the right service for this use case. you would be better with something like AWS ECS
09:07:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes 
09:07:16 AM Nataizya S: It can do all of that
09:07:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but I want to do it on AWS batch
09:07:42 AM Nataizya S: It cant be done in Batch. Batch isnt designed for long running web applications
09:08:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: long running is basically depends on the container CMD argument right
09:08:37 AM Nataizya S: well yes.. 
09:09:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have call to discuss on this
09:09:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime meeting 
09:09:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if possible
09:09:14 AM Nataizya S: sure.. One moment
09:09:20 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks a lot
09:09:48 AM Nataizya S: https://chime.aws/4893387576 
09:10:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joining in
09:10:13 AM Nataizya S: Sure
09:16:56 AM Nataizya S: https://aws.amazon.com/blogs/hpc/introducing-fair-share-scheduling-for-aws-batch/ 
09:37:32 AM Nataizya S: Have a good day



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Feb 04 2022
14:30:38 GMT+0530 (India Standard Time)
connection got disconnected

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Dear AWS Customer,

Thank you for contacting AWS Premium Support. My name is Karan and I will be assisting you today.
I am writing a summary email as our chat got disconnected earlier today.

From the case notes, I see that you have a couple of questions pertaining to AWS Batch unmanaged compute environment. You want to know how to create an unmanaged compute environment in AWS Batch. Also, you want to know the drawbacks if any in an unmanaged compute environment. Please correct me if my understanding about your issue is incomplete.

Question 1 - How to create unmanaged compute environment ?

Answer -

To create an unmanaged compute environment using EC2 resources, please kindly follow the link in the references [1] that has detailed steps guiding you through AWS console to create and test the same.
Please kindly note that your unmanaged compute environment doesn't have any compute resources on creation until you launch them manually. This is different than the managed compute environment.

Question 2 - What are the drawbacks of an unmanaged compute environment ?

In an unmanaged compute environment [2], you manage your own compute resources. You must verify that the AMI you use for your compute resources meets the Amazon ECS container instance AMI specification.
After you created your unmanaged compute environment, you can then use the DescribeComputeEnvironments API operation to view the compute environment details.

However, In a managed compute environment, AWS Batch helps you to manage the capacity and instance types of the compute resources within the environment. This is based on the compute resource specification that you define when you create the compute environment. You can choose either to use EC2 On-Demand Instances and EC2 Spot Instances. Or, you can alternatively use Fargate and Fargate Spot capacity in your managed compute environment. You can optionally set a maximum price so that Spot Instances only launch when the Spot Instance price is under a specified percentage of the On-Demand price.

As such there are no drawbacks to launch an unmanaged compute environment unless you do not want to add/manage your own compute recources like EC2 instances by yourself manually and want the AWS Batch to do this job for you. If this is the scenario, only then you can opt for the managed compute environment where AWS Batch helps you manage these resources.

To know more about managed and unmanaged compute environments in AWS Batch, please refer to [2].

Please let me know if you have any further questions and I will be happy to assist you.

A gentle note that my work shift is from Monday to Friday 8:00AM till 5:00PM CST. In case of any urgent issues or live troubleshooting, please initiate a call or chat from the AWS Support console and the next available AWS Support engineer will be able to assist you immediately. 

Have a great day ahead !

=======REFERENCES========

[1] TITLE - Creating a compute environment - To create an unmanaged compute environment using EC2 resources. 
	LINK - https://docs.aws.amazon.com/batch/latest/userguide/create-compute-environment.html#create-compute-environment-unmanaged-ec2 

[2] TITLE - Compute environment - Unmanaged compute environments. 
	LINK - https://docs.aws.amazon.com/batch/latest/userguide/compute_environments.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Karan T.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9532354771&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Jan 25 2022
20:02:58 GMT+0530 (India Standard Time)
02:47:37 PM Karan T: Hello, my name is Karan T.  I'm here to help you today.
02:47:42 PM Karan T: May I know your name ?



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Jan 25 2022
20:02:54 GMT+0530 (India Standard Time)
connecting again

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello Saroja, 

I hope you are doing well. 

I will go ahead and resolve this issue. Please re-open or initiate a new one if you still having facing any issues.

I appreciate your feedback and have a great weekend! 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9511586001&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9511586001&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Victor K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9511586001&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Fri Jan 28 2022
04:53:23 GMT+0530 (India Standard Time)

Translate

Hello,

We haven't heard back from you regarding case 9511586001 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9511586001&displayId=9511586001&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Fri Jan 21 2022
04:32:48 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Saroja, 

Thank you for contacting AWS Premium Support. I am Victor and it was a pleasure assisting you on this case. 

As per our chat/call you wanted to check the options on accessing resources in different account from a central place.

One of the option can be AWS Single Sign On (AWS SSO). Check [1] for more information and if you need more guidance in SSO you may open a ticket with the SSO Team. 

A Second option is to assume a Role in the cross account from the main account. 
Document [2] shows all the steps to achieve the assumeRole. (in CLI and console). 

In the call we went through both. The ClI, you used the command: 
aws sts assume-role --role-arn "role" --role-session-name "session"

Once done, you add the below with the values returned in the above command.

set AWS_ACCESS_KEY_ID=""
set AWS_SECRET_ACCESS_KEY=""
set AWS_SESSION_TOKEN=""

Running "aws sts get-caller-identity" You may check with role is in command.

A third option that we discussed is named profiles.  This is done with users and not roles. 
Please  Check [3] for more information. 

So basically You would create a user in the other account. You would need to Check the below and to save the information needed: 

Access key - Programmatic access
Enables an access key ID and secret access key for the AWS API, CLI, SDK, and other development tools.

Once you have the above information, in the aws cli , you would go to the .aws/credentials file and add the below using the access key created with the user.: 

[userX]
aws_access_key_id=ACCESSKEYID
aws_secret_access_key=SECRETACCESSKEY

Once you have the above you can run the commands and add       --profile userX  at the end to have the query ran by that profile. 

Also you can change to the profile by running the below command: 

export AWS_PROFILE=ProfileCreated

And you can revert back by 

unset AWS_PROFILE 
or you can use: export AWS_PROFILE=default" if you save a default one as well.


I hope the above information is helpful. I appreciate your feedback.
Please update me if you have any follow up questions or concerns. 

Have a great rest of your day!

References
============
[1] https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html 
[2] https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Victor K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9511586001&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Jan 20 2022
19:53:22 GMT+0530 (India Standard Time)
02:25:34 PM Victor Khoury: Hello, my name is Victor.  I'm here to assist you today. May I know your name please?
02:26:06 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Hi Victor, my name is Saroja
02:26:30 PM Victor Khoury: Hello Saroja. How are you? 
02:26:42 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Doing good, how r u?
02:27:15 PM Victor Khoury: I am doing fine as well. Thank you. 
Please just a moment to go through the case's details.
02:29:10 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: ok
02:30:15 PM Victor Khoury: I understand that you want to check how to access multiple accounts by logging in to only one account. Is that correct ?
02:30:49 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: yes
02:32:10 PM Victor Khoury: One way to do it, is to use the AWS Single Sign On service. https://aws.amazon.com/single-sign-on/ 
02:32:55 PM Victor Khoury: You will be able to manage multiple AWS accounts from one place. 
02:33:34 PM Victor Khoury: Another way to access accounts: You can do cross account Assume Roles. 
https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html 

02:34:18 PM Victor Khoury: That way you can jump from one account to another
02:34:42 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: all my accounts are under one organization but I need to login to one account from the org and should bee able to access some accounts 
02:36:57 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: can we have a call?
02:37:16 PM Victor Khoury: Sure. Chime call is fine? 
02:37:20 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: yes
02:38:40 PM Victor Khoury: 
https://chime.aws/7745033930 
02:58:02 PM Victor Khoury: aws sts get-caller-identity
03:15:55 PM Victor Khoury: export AWS_ACCESS_KEY_ID=RoleAccessKeyID
export AWS_SECRET_ACCESS_KEY=RoleSecretKey
export AWS_SESSION_TOKEN=RoleSessionToken
03:34:21 PM Victor Khoury: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-cli.html 
03:35:39 PM Victor Khoury: less .aws/config
03:44:34 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: https://cloudcustodian.io/docs/tools/c7n-org.html 
03:46:26 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: https://docs.aws.amazon.com/cli/latest/reference/cloudcontrol/index.html 
03:53:35 PM Victor Khoury: unset AWS_ACCESS_KEY_ID
unset AWS_SECRET_ACCESS_KEY
unset AWS_SESSION_TOKEN


AWS_165387667510_Owner/sarojani.macharla@optum.com (Role)


Thu Jan 20 2022
19:53:16 GMT+0530 (India Standard Time)
Hi,

I am looking to access resources from different/multiple accounts by logging in to only one account programatically.
Example scenario is - we have a policy in place that  "every S3 bucket should configured with secure data transport policy", so I want to see all the buckets in bunch of accounts which are violating this policy.

I am looking for a better approach to do this.

Thank you
Saroja
Error: 
IAM user or role ARN experiencing the issue: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello,

We haven't heard back from you regarding case 9505700751 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9505700751&displayId=9505700751&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Mon Feb 07 2022
08:56:38 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

Please join:  
https://chime.aws/1561924711 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Priyanka K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9505700751&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Mon Feb 07 2022
08:43:28 GMT+0530 (India Standard Time)
Hi Team,

I was trying to implement the solution and still facing the issue. Not sure of the issue and help in resolving the issue.

Thanks,
Pravin
91-9944344850


Amazon Web Services


Mon Feb 07 2022
01:37:25 GMT+0530 (India Standard Time)

Translate
Please let us know if we helped resolve your issue: 

If YES, click here:
https://console.aws.amazon.com/support/feedback?eventId=9505700751&language=en&questionnaireId=Support-HMD-Yes 

If NO, click here:
https://console.aws.amazon.com/support/feedback?eventId=9505700751&language=en&questionnaireId=Support-HMD-No 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hi Pravin,

This is Josh again from AWS Support. It was a pleasure working with you earlier! Im happy we were able to explain and resolve the strange behavior with EC2 Image Builder pipeline ImageBuilderPipelineLinuxMSTR. I am going to quickly summarize our conversation below for your records. 

You have a third party security service that monitors your AWS accounts to alert you to security concerns. This tool has been alerting you that there are unencrypted EBS volumes being created in this account, but not terminated, and your suspicion is the image builder pipeline. We confirmed this behavior over screenshare. Your image recipe stated that there should be one encrypted io1 EBS volume attached to this instance as /dev/xvda, but the source AMI used in the recipe is configured to create 3 EBS volumes, two of which are unencrypted. 

Essentially, what happened is your pipeline would run, the /dev/xvda EBS volume would be created correctly per the recipe settings, but because of the AMI in use two other EBS volumes were being created (xvdb and xvdc), and they were set to NOT delete on termination. This is what was causing the Image Builder test instances to create extra EBS volumes and not delete them, leading to the alerts you received. We resolved this issue by creating a new version of the recipe, and this time specifying storage volume configuration for all three volumes included in the AMI (we were sure to enable them to delete on termination). After modifying the recipe, we ran the pipeline, and confirmed the EBS volumes were now being encrypted as expected, and being deleted when no longer needed. This should clear up the emails your organization was receiving. 

Im happy you found my input helpful! As discussed, I will be closing this support case now. Please feel free to reach out if you have any further questions regarding this issue! 


References:
[1] https://docs.aws.amazon.com/imagebuilder/latest/userguide/troubleshooting.html#troubleshooting-pipelines 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Josh T.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9480795851&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Jan 13 2022
21:55:33 GMT+0530 (India Standard Time)
04:35:58 PM Josh T.: Hello, my name is Josh.  I'm here to help you today.
04:36:07 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi Josh,
04:36:43 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I had created a ec2 image builder pipeline and notice when EC2 instance is launching I see additional volumes getting created unencrypted
04:37:35 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Need to understand if it can be eliminated. Please do let me know if we can have chime call to share my screen and explain
04:38:42 PM Josh T.: Hi! I'll be happy to join a call if needed, but I need to review some information first. Can you please confirm the name of the pipeline? docker-1?
04:39:05 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: no not that.
04:39:15 PM Josh T.: Which pipeline?
04:39:16 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: ImageBuilderPipelineLinuxMSTR
04:39:21 PM Josh T.: Ok got it, thank you 
04:39:32 PM Josh T.: One moment please
04:45:38 PM Josh T.: When troubleshooting Image Builder pipelines, you can find more information about the failure from the SSM console. Image Builder uses SSM to orchestrate build actions, so each image build has a "Systems Manager Execution ID" associated with it https://docs.aws.amazon.com/imagebuilder/latest/userguide/troubleshooting.html#troubleshooting-pipelines 
04:46:04 PM Josh T.: I am investigating your account's failed SSM automations and will be returning info shortly. You can also view this information direction from the SSM console 
04:46:27 PM Josh T.: Under the "Automation" section 
04:46:32 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: one moment.. 
04:46:39 PM Josh T.: Sure. I am gathering info as well
04:47:12 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: before that I wanted to understand why I see there are additional volumes than root volume getting spin when EC2 instance is getting created
04:47:23 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: and snapshots are taken without encryption
04:49:44 PM Josh T.: In the recipe for this image, I only see one storage volume. It is configured to use 1 encrypted io1 volume. You are seeing more volumes than this? I think it may be a good idea to run the pipeline again. It seems this pipeline has not been executed for a while 
04:50:07 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes the pipeline is start now
04:50:20 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I see in snapshots there are multiple taken
04:50:24 PM Josh T.: Ok great. The SSM Execution log will give us much more detail 
04:50:47 PM Josh T.: Ok, I'll be monitoring this most recent pipeline execution 
04:55:23 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: i hope you would have seen i had encrypted the one root volume. however, I see multiple volumes been backed up which are unencrypted too
04:57:09 PM Josh T.: Hmm ok. I definitely see the 100GB encrypted io1 volume, but I see no other reasons so far (in this pipeline) why extra volumes would be added, or snapshots be created. Especially unencrypted. The most recent execution of the pipeline should give us an SSM Execution ID to review for more info 
04:57:29 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: ok sure
04:57:44 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Execution ID: 50e1a27e-c375-4016-8796-40b4d2efbf50
04:57:52 PM Josh T.: Awesome! Checking now 
04:58:10 PM Josh T.: I see it's building!
04:58:15 PM Josh T.: Now we wait for the steps to complete
04:58:33 PM Josh T.: If it hangs at any point, the SSM execution ID should provide more info 
05:00:10 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I see in ec2 instance which got created now.. there is root device and block device
05:00:32 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: why comes the block device to the ec2 instance which was spin by ec2 image builder
05:01:31 PM Josh T.: When you run an image builder pipeline, the service spins up EC2 instances on your behalf. I'm assuming this is the EC2 instance you noticed? This instance will be terminated once the build is complete
05:01:34 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: additional two volumes in block device
05:01:54 PM Josh T.: Can you share the EC2 instance ID please
05:02:13 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: i-00723fa562451c9bc
05:02:20 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes instance get terminated
05:02:46 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: however some additional volumes it is creating is not deleting on termination as it is set as false
05:02:55 PM Josh T.: Oh!
05:03:05 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: and snapshots of those volumes are taken without encryption and cause violation
05:03:35 PM Josh T.: Ok interesting. I'm going to review your pipeline configuration again. One moment please
05:05:55 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: if it is fine we can have chime to share my screen and test it
05:06:04 PM Josh T.: Sure I will set that up now 
05:07:06 PM Josh T.: Please join here: 
https://chime.aws/2612695921 
05:31:38 PM Josh T.: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html 



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Thu Jan 13 2022
21:55:17 GMT+0530 (India Standard Time)
Hi team,

EC2 instance volumes unencrypted and causing violation when Image builder is spinning the instance.

Thanks,
Pravin

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello Pravin.

Hope you are fine today,

It was my pleasure speaking with you regarding your query about adding tags to the baked output AMI. This email is a summary for our conversation.

I understood that you would like to add a tag to the final out AMI with the name of the source AMI which is used in the pipeline, since the pipeline is dynamically changed with each run.

I have suggested to use the "Output AMI tags - optional" under the [Distribution Settings] to achieve that.

You were able to test that, and the AMI output was now showing the new tags.

I have suggested to use the SSM Automation also to achieve the same outcome, since the Automation is also providing more granular actions and flexible ways to achieve your use case.

Please find the following links for more information regarding the SSM Automation service:

[+] https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-automation.html 

[+] https://docs.aws.amazon.com/systems-manager/latest/userguide/automation-actions.html 

I trust these information will help you, and as agreed I will be marking the case as closed for now, However please feel free to reach us in case if you needed any further help or details.

Thanks and I wish you a great day.

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9475453581&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9475453581&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Ahmed Y.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9475453581&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Wed Jan 12 2022
18:32:52 GMT+0530 (India Standard Time)
Hi Team,

Need help in including Image builder to include the dynamic output tags


>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Dear surendar,

Warm greetings from AWS premium support.

Lavanya again! Thank you for your time on chat today! It was a pleasure talking with you and I appreciate the opportunity to assist you with this case today.

Please find below a quick summary of our conversation:

From the case description, I understand that you faced issue with the WAF reporting metric suggesting your WebACL rules has not showing any blocked requests on the WAF dashboard. Further, you were not able to view the graph in the cloudwatch console too.

I would like to inform you that recently, we experienced issues with AWS WAF real-time metrics for customers using WAFv2 APIs with Amazon CloudFront. During this period, real-time metrics were submitted to CloudWatch using WebACL ARN instead of WebACL name, so customers may not have seen WAF metrics in their CloudWatch graphs. Consequently, CloudWatch alarms that customers may have on this metric might not have worked correctly. 

Please note, our internal team working on this and we cannot provide any ETA for this.Having said that, there was no impact to WAF mitigation or CloudFront servers inspecting and responding to customer requests during this time. There was also no impact to WAF full logs.

I apologize for the inconvenience due to this issue. Please feel free to write back to me if you have any further query or concerns regarding this. I will be happy to assist you. 

Please Remember we are here for you.

Stay safe and Have a lovely day!

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9470141651&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9470141651&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
lavanya n.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9470141651&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Jan 11 2022
15:54:05 GMT+0530 (India Standard Time)
we are facing issue with metrics in AWS WAFV2 dashboard . 


Attachments
all_metics.JPG
blocked_metrics.JPG

AWS_P0001489@optum.com


Tue Jan 11 2022
15:36:49 GMT+0530 (India Standard Time)
10:07:14 AM Lavanya: Hello, my name is Lavanya.  I'm here to help you today.
10:07:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi Lavanya, My name is surendar
10:08:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I have query on AWS WAF monitoring dashboard
10:08:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is showing allowed request logs but it is not showing blocked requests
10:08:24 AM Lavanya: Hi surendar, nice to meet you!
10:08:39 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: when i select "all metric" in dashboard
10:08:44 AM Lavanya: ok
10:08:51 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: what could be the reason 
10:11:54 AM Lavanya: yes it may happens when there are no requests blocked by the waf.
10:12:02 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is blocked
10:12:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime session 
10:12:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i can show 
10:12:13 AM Lavanya: sure
10:12:44 AM Lavanya: Click to join the meeting: https://chime.aws/3018153644 
Meeting ID: 3018 15 3644
10:12:47 AM Lavanya: please join
10:24:51 AM Lavanya: Bye surendar!
10:25:21 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
10:25:28 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Please send an email now
10:25:35 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am waiting for it
10:25:38 AM Lavanya: sure!
10:26:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Thanks a lot... have a good day
10:26:05 AM Lavanya: bye for now.



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Jan 11 2022
15:36:41 GMT+0530 (India Standard Time)
connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)
Hi Surendar,

Thank you for your time over the call. I appreciate you being patient and responsive throughout.

We discussed that you wanted to deploy a WAF in front of your Load Balancer and your CloudFront distribution. I mentioned that a WAF is a a layer 7 firewall offering of AWS, an entity that helps protect your web applications or APIs against common web exploits. The internal architecture for the same is managed by AWS and you simply need to associate your WAF with a resource that needs protection.

Your architecture will be as follows: 

Clients ~~~> WAF ~~~> ALB ~~~> Backend targets

There is no additional software to deploy, DNS configuration, SSL/TLS certificate to manage, or need for a reverse proxy setup. We also discussed that, since a WAF is a regional service, we need to create a different Web ACL to be used with your Application Load Balancer and your CloudFront distribution.

As discussed, I will be closing this case. In case you still face any concerns, please feel free to raise another support case and we will be available to assist you with the same.

Have a great day!

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9464660331&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9464660331&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Yashovardhan C.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9464660331&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Mon Jan 10 2022
13:04:06 GMT+0530 (India Standard Time)
07:39:16 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar
07:39:29 AM Yashovardhan Chaturvedi: Hello, my name is Yash Chaturvedi.  I'm here to help you today.
07:39:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I have one query about the workflow of Webacl
07:39:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: If I would add the load balancer in webacl protected resouces
07:40:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how it is blocking or allowing the request as per my conditions
07:40:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because i have pointed my URL (abc.om ) to the load balancer hostname.
07:40:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how the traffic flow is happening
07:41:33 AM Yashovardhan Chaturvedi: So you want to know how the traffic flow will happen in your case and how the WAF will allow or block a request correct?
07:42:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: right
07:42:39 AM Yashovardhan Chaturvedi: Okay let me tell you
07:42:52 AM Yashovardhan Chaturvedi: So the traffic flow/architecture will be as follows:
07:43:52 AM Yashovardhan Chaturvedi: Website (abc.com) ---> WAF ---> Application Load Balancer ---> backend targets
07:44:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but my traffic is how does it know the webacl is placed in between application load balancer
07:44:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because i have pointed the  URL to the hostname directly from my domain provider
07:45:10 AM Yashovardhan Chaturvedi: We will add some rules inside the WAF, as per your use case and the type of requests that you want to be blocked. Then the WAF will inspect all the requests coming for your ALB and block it if it matches the rules that we had set
07:45:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime call
07:45:41 AM Yashovardhan Chaturvedi: Sure, let me generate a link for you
07:45:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: THANKS 
07:46:45 AM Yashovardhan Chaturvedi: Please join using this link: https://chime.aws/6850350739 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Mon Jan 10 2022
13:03:54 GMT+0530 (India Standard Time)
blocking request using WAF


>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Dear Customer,

Good day to you.

Thank you for contacting AWS premium support. I am Mayank from RDS team and I will be assisting you on this case.

==========
Description
===========

From the case notes I understand that, you want to restore backup on existing database. Please correct if the understanding is wrong.

=========
Analysis
=========

Regretfully, I would like to inform you that currently there is no such option to restore database from DB snapshot to an existing DB instance.  Please refer, https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_RestoreFromSnapshot.html 

Please note, Amazon RDS creates a storage volume snapshot of your DB instance, backing up the entire DB instance and not just individual databases. You can create a new DB instance by restoring from a DB snapshot. You provide the name of the DB snapshot to restore from, and then provide a name for the new DB instance that is created from the restore.

========
Solution
========

Moving further, I understand that below mentioned points might be you requirement for which you are trying to restore and existing DB instance from a DB snapshot. Please let me know your requirement, if below mentioned points doesn't meet to your requirement. I will be happy to assist you.

1. After creating new instance your endpoint name (DB Identifier) is getting changed:
2. Requirement to import some specific tables 

1. After creating new instance your endpoint name (DB Identifier) is getting changed : I understand that there might be possibility that your current DB is integrated/configured with different applications and you are using the Endpoint name (DB identifier) for accessing due to which you don't want to change your current DB instance name.

If this is the case then I would like to suggest you to rename your current DB instance and restore the new DB instance from a DB snapshot with the old DB identifier (old Db name). By following this approach your current integrated endpoint name (DB identifier) will not get changed.

2. Requirement to import database to an existing instance : I would like to inform you if you have requirement to import database to an existing instance then you can create a new DB instance from the DB snapshot and then you can take an export of the database from new created DB instance and then import it to the existing one using MySQL dump utility.

--> For restoring a DB instance from a DB snapshot

		To restore a DB instance from a DB snapshot

		1. Sign in to the AWS Management Console and open the Amazon RDS console at https://console.aws.amazon.com/rds/ 
		2. In the navigation pane, choose Snapshots.
		3. Choose the DB snapshot that you want to restore from.
		4. For Actions, choose Restore snapshot.
		5. On the Restore snapshot page, for DB instance identifier, enter the name for your restored DB instance.
		6. Choose Restore DB instance

Take mysqldump of new RDS instance and restore this dump to old RDS instance: 

mysqldump: https://dev.mysql.com/doc/mysql-backup-excerpt/5.7/en/mysqldump-sql-format.html  
Restore: https://dev.mysql.com/doc/mysql-backup-excerpt/5.7/en/reloading-sql-format-dumps.html 

Note: 
1. It is highly recommended to test above suggestion in test environment before applying the same to production. 
2. It is highly recommended to perform this activity in non business hours.


I sincerely hope that the above information I have provided has been helpful to you. If you have any further questions on the above, or if you'd like me to clarify anything I've shared, please don't hesitate to reach back out to me and I will be happy to assist further as best I can. 

Thank you, please always be in good health and have a blessed day ahead.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Mayank S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9454296821&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Jan 07 2022
15:05:36 GMT+0530 (India Standard Time)
connection lost


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Jan 07 2022
15:02:49 GMT+0530 (India Standard Time)
How to restore backup on existing database

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hello,

Warm Greetings from AWS Premium Support. This is Jay from the CloudWatch team and I will be assisting you with the case today.

From your case notes, I was able to understand that you have derived custom metrics by creation metric filters on log groups and would like to add "InstanceId" as dimension to these metrics. Please feel free to correct me if I have misunderstood anything here.

+To begin I would like inform you that you can create dimensions for metric filter if filter pattern provided is in JSON log events or space-delimited log events only [1][2]. Unfortunately, we cannot add custom dimensions(e.g. InstanceId) while configuring the filters at the moment.

+Having said that I would like to inform you that we already have an existing feature request to support custom dimensions with metric filters. I will perform my due diligence in ensuring that your case is used as supporting evidence to escalate this feature. Unfortunately I wont be able to provide you with an ETA on when this feature might be released as I have no visibility over that process. However, all of our new announcements and releases will be posted on https://aws.amazon.com/blogs/aws/  and http://aws.amazon.com/new .

Workaround:
============
+As a possible workaround, you can look to create separate log group for each EC2 Instance and then add the "InstanceId" value as prefix to log group name. For e.g. i-ab372239292373_messages_logs

+I can see that you have already tried to implement this workaround by naming your log groups and metric starting with "InstanceId" prefix as show below:

-------------------
i-04b761fe3a6c9e800_/dev/syslog/secure  - i-04b761fe3a6c9e800-/dev/syslog/secure-count (Metric name)
i-04b761fe3a6c9e800_/dev/syslog/messages - i-04b761fe3a6c9e800-/dev/syslog/messages-count) (Metric name)
-------------------


I hope this information was of value to you. In case you have any queries or concerns, please feel free to let me know and I would be happy to assist you further.

We wish you a great day ahead.

Have great rest of your day!

References:
============
[1] https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html#logs-metric-filters-dimensions 

[2] Example: Extract fields from an Apache log and assign dimensions  - https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/ExtractBytesExample.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Jay J.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9383976601&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/ngunasek@optum.com (Role)


Wed Dec 22 2021
13:55:38 GMT+0530 (India Standard Time)
We've created Log metric for analysing EC2 instance logs and pushing the logs from EC2 through Cloudwatch Agent. But, since the same log will be available in multiple instance we would need to have a dimension available for the Metric using the Instance ID to distinguish it.
Namespace: CWAgent
Metric Name: /dev/syslog/messages-count

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>.

Tue Jan 11 2022
15:33:51 GMT+0530 (India Standard Time)
Not showing blocked requests in monitoring

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

Hi,

Thanks for contacting AWS Support, my name is Andrew.

I understand that you wanted to confirm what order Components run in because you wanted to have updateOS run last.

Please note that Test Components run after Build Components. However, Test Components are not able to make any changes to the final Image produced by EC2 Image Builder; this may not apply to your situation, but I wanted to clarify this because it may be something you would like to consider.

Regarding the order in which EC2 Image Builder Components run, the Components run in the order specified (top to bottom), this is the case when you define them in the web-console GUI, and when you define them using JSON through the AWS CLI.

So, if you had the following Components defined:

-Build Component 1
-Build Component two
-Build Component 3
-Test Component one
-Test Component 2

They would run in the order they appear (top to bottom).


If you had:

-Test Component one
-Test Component 2
-Build Component 1
-Build Component two
-Build Component 3

The three Build Components would run first (top to bottom), then the two Test Components would run (top to bottom).


Please don't hesitate to write back if you have any additional questions.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Andrew T.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9363654871&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Dec 17 2021
19:27:44 GMT+0530 (India Standard Time)
I am trying to connect but it took more time and not connecting to support team. 

kindly provide the clarification on the below query

what is the order of executing the component in image builder pipeline. 

we wanted to run the updateOS module at last step, how to do this ?


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Dec 17 2021
18:32:49 GMT+0530 (India Standard Time)
i do have multiple component is recipe, in that which component will run first. what order image pipeline will execute the component and inbuilt modules

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

64. 
Hello Surendar,

My name is Hrishikesh. 
Thank you for your time on call. It was pleasure working with you. 
Please treat this email as a summary of the conversation we had.

Issue:
Wanted to blacklist ip addresses in WAF and test some rules

Solution:
While on call we added you own ip address in ip set and set rule action to block. 
you also set custom message and error code 420 and tested same in developer tools

I hope you find the information above useful. Should you have any additional questions, thoughts, concerns or queries please don't hesitate to ask. I will be happy to assist!
Have a great Day!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Hrishikesh Diwakar L.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9362767531&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Dec 17 2021
13:55:39 GMT+0530 (India Standard Time)
08:30:36 AM Hrishikesh Diwakar: Hello, my name is Hrishikesh .  I'm here to help you today.
08:30:56 AM Hrishikesh Diwakar: may I know your name please?
08:33:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
08:33:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i wanted to know how to blacklist the IP address in WAF
08:34:22 AM Hrishikesh Diwakar: Hello Surendar , how are you?
08:34:49 AM Hrishikesh Diwakar: to blacklist ip address in WAF..create an ip set..add in a rule ..rule action keep block
08:35:10 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have session on how to do it
08:35:36 AM Hrishikesh Diwakar: ok ,screenshare?
08:35:41 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
08:36:25 AM Hrishikesh Diwakar: https://screenshare.aws/?ak=9dda4449a137a5459156505e09eab258 
08:38:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it possible to connect in chime
08:39:09 AM Hrishikesh Diwakar: ok
08:39:34 AM Hrishikesh Diwakar: https://chime.aws/7681574669 
Meeting ID: 7681 57 4669
U.S. Toll: +1 206-462-5569
Meeting PIN: 7681 57 4669
U.S. Toll-free: +1 855-552-4463
International: https://chime.aws/dialinnumbers/ 

08:40:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joinin in



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Dec 17 2021
13:55:10 GMT+0530 (India Standard Time)
couldnt connect


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Dec 17 2021
13:54:56 GMT+0530 (India Standard Time)
could not connect


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Dec 17 2021
13:12:09 GMT+0530 (India Standard Time)
how to add multiple bad IPs in list

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
65.
Chat: User data not running successfully on recently created EC2of type t3.small

Hello Saroja,

Thank you for contacting AWS today. I am sending this email as a quick summary of the case we have worked on together today.

Basically the issue was related to the UserData that you were attempting to execute on your instances, same source AMI, same instance type, same infrastructure, same AWS region, etc. 

However at the end of the day you received an error related to the JVM version that Tomcat was getting, as it was not the one you expected even after installing that properly from the User Data as below:

#!/bin/bash
yum -y update --security
yum -y update kernel
yum install ruby -y
yum install httpd -y
yum install java-1.8.0-openjdk-src.x86_64 -y
yum install tomcat -y

Therefore, after various attempts from my end and your end, the solution was related to the installation of java, it happened to work by executing the following command: (no src)

yum install java-1.8.0-openjdk.x86_64 -y


We came to the conclusion that it could be that since SRC is usually related to source installation, there might have be a recent change at the repositories which is not working anymore with Tomcat. Furthermore, by installing Java as non SRC this could be the most suitable option as it would only contain the binaries needed for Tomcat to work properly with your applications.


As agreed, I am resolving this case.

Thank You

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9359340081&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9359340081&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Oscar R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9359340081&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Dec 16 2021
22:35:27 GMT+0530 (India Standard Time)
05:06:36 PM Pukar: Hello, my name is Pukar.  I'm here to help you today.
05:06:45 PM Pukar: May I have your name as I review the case please/ 
05:06:47 PM Pukar: ? 
05:08:04 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Hi, my name is Saroja
05:08:20 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Oscar R was assisting me
05:08:22 PM Pukar: Hello Saroja, seems like you were working with engineer Oscar,
05:08:33 PM Pukar: Let me try and transfer it back to him.
05:08:35 PM Pukar: Just a moment please.
05:08:50 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: so I lost the connection with chat  when I was working witth him
05:09:02 PM Pukar: Understood. 
05:09:20 PM Pukar: Let me try and transfer. Just a moment please.
05:09:25 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: ok
05:10:27 PM Oscar R: Hello Saroja
05:10:31 PM Oscar R: We are back
05:10:33 PM Oscar R: sorry for that
05:10:42 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: np :)
05:11:01 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: can you send me the chime link please?
05:11:48 PM Oscar R: We can try sure but I won't be really able to see your screen if the resources belong to another account
05:11:54 PM Oscar R: if you agree on that I can share it
05:12:33 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: alll the accounts fall under same org
05:12:46 PM Oscar R: That's a fact
05:12:51 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: ok
05:13:08 PM Oscar R: however, as per security policies unless you have signed off a crossaccount support
05:13:30 PM Oscar R: you need to open a case from the Account of the resources you need to
05:13:46 PM Oscar R: Anyway, I've been trying to replicate this issue
05:14:31 PM Oscar R: and I could successfully do it. 
05:14:39 PM Oscar R: basically what I have performed is:
#!/bin/bash
yum -y update --security
yum -y update kernel
yum install ruby -y
yum install httpd -y
yum install java-1.8.0-openjdk-src.x86_64 -y
yum install tomcat -y

output : { all : '| tee -a /var/log/cloud-init-output.log' }
05:14:43 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: working server: Server version: Apache Tomcat/7.0.76
Server built:   Jun 22 2020 23:34:41 UTC
Server number:  7.0.76.0
OS Name:        Linux
OS Version:     4.14.225-169.362.amzn2.x86_64
Architecture:   amd64
JVM Version:    1.8.0_312-b07
JVM Vendor:     Red Hat, Inc.
05:15:46 PM Oscar R: After executing the user data I see that openjdk was installed:
# rpm -qa |grep openjdk
java-1.8.0-openjdk-headless-1.8.0.312.b07-1.amzn2.0.1.x86_64
java-1.8.0-openjdk-src-1.8.0.312.b07-1.amzn2.0.1.x86_64
05:16:14 PM Oscar R: But I still don't get what could mean:
- keytool error: java.lang.Exception: The -keyalg option must be specified."
05:16:23 PM Oscar R: I don't see it in my logs
05:17:58 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: keytool -noprompt -keystore .keystore.jks -genkey -alias ${svc_user}_client -storepass "${truststore_password}"  -keypass "${truststore_password}"  \
    -dname "CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, S=Unknown, C=US"

05:18:28 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: can you run above after installss
05:19:02 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: can you check java version after the install commands?
05:19:21 PM Oscar R: Oh ok so the error is related to that command
05:19:22 PM Oscar R: interesting
05:19:43 PM Oscar R: I'm sorry but I'm not familiar with that. Thank you for providing it. 
05:19:54 PM Oscar R: can you please provide a few more details
05:20:00 PM Oscar R: about what that command does?
05:21:07 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: can we talk...I will not share any other account details...
05:21:35 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: it will be easy I feel
05:21:51 PM Oscar R: Sure no worries
05:21:57 PM Oscar R: let me give you the link
05:22:11 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: ok
05:23:43 PM Oscar R: https://chime.aws/1664492212 



AWS_165387667510_Owner/sarojani.macharla@optum.com (Role)


Thu Dec 16 2021
22:35:22 GMT+0530 (India Standard Time)
lost chat connection 


AWS_P0001489@optum.com


Thu Dec 16 2021
21:25:53 GMT+0530 (India Standard Time)
04:07:36 PM Oscar R: Hello, my name is Oscar R.  I'm here to help you today.
04:07:38 PM Oscar R: GetComponent, exceeded maximum number of attempts, 3
04:07:52 PM Oscar R: Can I have your name while I review the case please?
04:08:27 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Hi Oscar, my name is Saroja
04:08:55 PM Oscar R: Thank You Saroja!
How are you today? :)
Please bear with me, I need a couple of minutes to check your information.
04:09:29 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: sure
04:13:38 PM Oscar R: Thank you, sorry for the delay. 
I see you recently migrated applications then you recreated Ec2 instances and they are now giving some errors while running the same user data correct?
04:13:52 PM Oscar R: can you please provide me the Instance ID of one of these new instances?
04:13:53 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: yes
04:17:40 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: The instance is on another account, I don't have permission on that account so creating ticket in this account
04:18:21 PM Oscar R: Oh I see, sure that'd be necessary in order to be able to see the resources on that other account. 
04:18:49 PM Oscar R: please let me know the new case ID, I can actually work on that over this same chat.
04:19:03 PM Oscar R: So you don't have to open a new one, if you want.
04:19:24 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: you want to me to create new case?
04:20:13 PM Oscar R: Yes, this case was created on AWS account 165387667510
04:20:23 PM Oscar R: so if the instances belong to another acount
04:20:26 PM Oscar R: *account
04:20:36 PM Oscar R: you need to create another case on that specific account. 
04:21:26 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: I dpn't have permissions on that account
04:22:02 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: if you can send me the chime link , i can show you the issue if you want
04:22:30 PM Oscar R: Since the resources belong to another account that is not possible for me to do as per our privacy policies. 
04:22:34 PM Oscar R: but you can share with me
04:22:38 PM Oscar R: at least some data
04:22:39 PM Oscar R: such as 
04:22:47 PM Oscar R: what is the OS version you are using
04:22:54 PM Oscar R: and you can even share with me via email
04:23:00 PM Oscar R: the user data you are using
04:23:33 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Linux
04:23:35 PM Oscar R: and the EC2 instance type
04:23:48 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: t3.small
04:24:25 PM Oscar R: is it Amazon Linux 2?
04:27:00 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: yes
04:28:45 PM Oscar R: Ok, So I am trying to look up in my documentation about the error you are receiving
04:29:10 PM Oscar R: but it would be helpful if you could share with me the user data. 
04:29:38 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: I just now checked yum update -y
yum -y update --security
yum -y update kernel
yum install ruby -y
yum install httpd -y
yum install java-1.8.0-openjdk-src.x86_64 -y
yum install tomcat -y
04:31:02 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: with above installations I see working instance has openjdk version "1.8.0_312" and latest one has openjdk version "17.0.1" 2021-10-19 LTS and latest instance has 
04:34:55 PM Oscar R: ok, thanks for that. it seems that you. are attempting to install the specific version:
yum install java-1.8.0-openjdk-src.x86_64 -y
Is the working instance based on the same Amazon Linux 2 version?
04:34:59 PM Oscar R: or same AMI
04:35:00 PM Oscar R: ?
04:35:33 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: yes
04:35:52 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: let me double check
04:36:02 PM Oscar R: sure
04:37:09 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: yes, both has same AMI
04:38:43 PM Oscar R: ok, please let me try to take a look at this.
04:38:48 PM Oscar R: please bear with me
04:39:05 PM Oscar R: it might take me  some minutes but I'll keep you updated. 
04:39:47 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: no problem
04:59:07 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Can you create chime link?



AWS_165387667510_Owner/sarojani.macharla@optum.com (Role)


Thu Dec 16 2021
21:25:50 GMT+0530 (India Standard Time)
Delont'e has left the conversation.

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

66. Chat: Need Remediation for findings

Hello,

We haven't heard back from you regarding case 9354023611 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9354023611&displayId=9354023611&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 168 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Wed Dec 15 2021
19:18:43 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Surendar,

It was a pleasure working with you today.

You reached out to us today because inspector had revealed CVE-2021-3640, CVE-2021-4002 - kernel, CVE-2021-3772 vulnerabilities in your EC2 instance i-0c0dd3e4be4a6de7d located in the us-east-1 region and wanted to remediate it. As i could not find the vulnerability listed in the same region found here [1] I looked up Amazon Linux Security Center [2] for the same vulnerabilities and found the remediation. 

To remediate all three vulnerabilities you simply have to run:

sudo yum update kernel

This will update your kernel version and should patch the listed vulnerabilities.

I hope this information serve useful, please feel free to reach back out if you have any more questions and I will be more than happy to assist you.

Have a great rest of the day!


References:

1. Common vulnerabilities and exposures - https://docs.aws.amazon.com/inspector/latest/userguide/inspector_cves.html 

2. https://alas.aws.amazon.com/AL2/ALAS-2021-1727.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Nagendra Prasad P.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9354023611&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Dec 15 2021
18:23:37 GMT+0530 (India Standard Time)
01:15:59 PM Nagendra: Hello, my name is Nagendra.  I'm here to help you today.
01:16:35 PM Nagendra: May I know your name please?
01:17:08 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: hi
01:17:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: my name is surendar
01:17:35 PM Nagendra: How are you doing today surendar
01:19:46 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am fine thanks
01:20:10 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can you please let me know the remediation for inspector finding mentioned in the case
01:21:54 PM Nagendra: I took at look at the instance, seems like it is in the us-east-1 region.
The CVE's that inspector can detect in that region can be found in this link - https://docs.aws.amazon.com/inspector/latest/userguide/inspector_cves.html 
01:22:42 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: remediation needed 
01:24:14 PM Nagendra: While the list is massive I was able to comb through it and I did not find CVE-2021-3640.
01:24:34 PM Nagendra: Is this a finding generated by inspector classic?
01:24:56 PM Nagendra: I understand you require remediation.
01:25:14 PM Nagendra: I would need to locate the CVE first, in order to proceed with the remediation
01:25:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i m not sure
01:25:22 PM Nagendra: No worries
01:25:28 PM Nagendra: Allow me a moment please.
01:25:33 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok
01:26:00 PM Nagendra: can we get on a quick screenshare session?
01:28:09 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we do it by 7.30 PM IST
01:28:16 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: that means in next 30 Min
01:28:43 PM Nagendra: Sure.
01:28:55 PM Nagendra: initiate another chat when you are available
01:29:05 PM Nagendra: And we can pick it up from there.
01:30:20 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay done
01:30:32 PM Nagendra: See you then :)
01:31:06 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
01:31:17 PM Nagendra: You're welcome



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Dec 15 2021
18:23:28 GMT+0530 (India Standard Time)
connecting again

>>>>>>>>>>>>>>>>>>>>>>>>>

67. Hi Team,

Below is the summary of the call we had.

1. Impacted or not?
>>> as described in [1]. The issue discussed in CVE-2021-44228 is relevant to Apache log4j- core versions between 2.0 and 2.14.1 when processing inputs from untrusted sources. EMR clusters launched with EMR 5 releases up to 5.34 and EMR 6 releases up to EMR 6.5 include open source frameworks such as Apache Hive, Flink, HUDI, Presto, and Trino, which use these versions of Apache Log4j. However, many customers use the open source frameworks installed on their EMR clusters to process and log inputs from untrusted sources. Therefore, AWS recommends that you apply the "EMR Bootstrap Action Solution for Log4j CVE-2021-44228".

2. EMR EC2 inspector?
>>> EC2 Inspector will show the CVE-2021-44228 vulnerability but if you are not processing inputs from untrusted sources ( non-https/ssl) then you are not affected. You can apply the BA to fix the reported vulnerability by inspector.

3. BA actions?
>>> you will need to terminate and create you clusters (transient/persistence) in order to apply for the provided BAs. For some major versions, the BAs are only available in the latest minor versions. You can use the default S3 bucket location or download the BA script to a local S3 bucket and use it (them) on cluster start-up.

4. ETA on permanent solution for new minor major versions?
>>> there's no ETA set by the Service Team at this moment but I can assure you that the team is working hard to release minor and/or major versions which include the fix on a permanent basis.

5. Custom AMI vs BA?
>>> This is purely the customer's choice we cannot make recommendations on this. Custom AMI maintained by customer whereas BAs are maintained by us. This might be the factor to decide on.

6. Which versions are affected?
Please follow the documentation [1] where you will find the list of affected versions and their application BAs scripts.

I hope you find the above summary helpful. Should you have any questions or concerns please update the case and I will be more than happy to assist.

In the meantime, keep well and stay safe.

Reference
[1] https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-log4j-vulnerability.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Senele S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9353758761&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Dec 22 2021
13:23:25 GMT+0530 (India Standard Time)
07:57:39 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi Senele
07:57:51 AM Senele Sithole: Hello, my name is Senele Sithole.  I'm here to help you today.
07:58:04 AM Senele Sithole: Can I get your name please?
07:58:17 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am Pravin.
07:58:30 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Currently we have EMR clusters running and need to clarify if the log4j s handled with newer emr versions
08:00:18 AM Senele Sithole: Hi Pravin,

We have released BA actions at this moment for most of all our versions.
08:00:57 AM Senele Sithole: https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-log4j-vulnerability.html 
08:01:23 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Is it fine to have a chime call ?? one of my team aws engineer too have few questions
08:01:49 AM Senele Sithole: yeah sure let me set it up, give me a moment.
08:02:19 AM Senele Sithole:  please join here

You have been invited to an online meeting, powered by Amazon Chime.

Click to join the meeting: https://chime.aws/3949370930 
Meeting ID: 3949 37 0930
A headset is recommended or you may use your computers microphone and speakers.

Call in using your phone:
United States Toll-Free (1): +1 855-552-4463
Meeting ID: 3949 37 0930
One-click Mobile Dial-in (United States (1)): +1 206-462-5569,,,3949370930#
United States (1): +1 206-462-5569
International: https://chime.aws/dialinnumbers/ 
Dial-in attendees must enter *7 to mute or unmute themselves.

To connect from an in-room video system, use one of the following Amazon Chime bridges:
SIP video system: 3949370930@meet.chime.in  or meet.chime.in
H.323 system: 13.248.147.139 or 76.223.18.152
If prompted enter the Meeting PIN: 3949370930#

Download Amazon Chime at https://aws.amazon.com/chime/download 
For information about creating an Amazon Chime account, see https://aws.amazon.com/chime/getting-started 

08:02:37 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: thanks
08:09:04 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am changing my network and connecting.. just a moment.
08:35:38 AM Senele Sithole: I will summarise our call on the ticket reply, cheers Pravin
08:38:19 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Thanks Senele for your support



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Wed Dec 22 2021
13:23:02 GMT+0530 (India Standard Time)
.

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

68. Chat: Need Clarification in Critical Patch Updates

Dear Ramkumar,

It was pleasure talking to you over phone call today.

As per the Oracle Doc ID 2827611.1, Oracle doesnt believe the Database products to be affected by vulnerability CVE-2021-44228.

Please find the attachment of Doc ID 2827611.1 for your reference.

Also, I referred below document which also confirms that it is not affecting RDS Oracle.

[+] https://aws.amazon.com/security/security-bulletins/AWS-2021-006/ 

As per your confirmation over phone call, I am marking this case as closed.

Please feel free to reach out to me in case of any further questions or concerns and I'll be glad to assist you.

Hope you have a great day ahead and stay safe!

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9334089941&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9334089941&language=en&questionnaireId=Support-HMD-No 

To see the file named '2827611.1.pdf' included with this correspondence, please use the case link given below the signature.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Veeramani A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9334089941&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Attachments
2827611.1.pdf

Amazon Web Services


Sat Dec 11 2021
13:42:22 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Dear Ramkumar,

It was pleasure talking to your over chime call.

Please find below the summary of our conversation:

1) We were discussing about how frequent is the patch list in AWS once Oracle releases a new patches. 

According to our AWS documentation: Amazon RDS incorporates bug fixes from Oracle by using their quarterly Database Patch Set Updates (PSUs).  

https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Appendix.Oracle.PatchComposition.html 

2) You are concerned about this patch Oracle Security Alert for CVE-2021-44228 since you have got an email from Oracle Corporation to apply this security fix.

3) It seems to be application related security fix. However, we don't want to take any chance in it. We AWS are concerned about our Customers security guidelines.

4) I have reached out to my internal team with high severity asking whether this security alert has anything to do with Oracle RDS instance, as we are concerned about this and would like to know RDS would be applying on your behalf and how to proceed on this. Please note that it might take some time to get an update from the AWS internal team on this. But please be rest assured that I'll provide you with the updates as soon as I hear back from them. Till then I will keep the case status in 'Pending Amazon Action'.

Please let me know if you have any further questions, I will be happy to help. Thanks again for your understanding! 

Stay safe and have a great day.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Veeramani A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9334089941&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Sat Dec 11 2021
10:42:35 GMT+0530 (India Standard Time)
05:16:26 AM Veeramani A: Hello, my name is Veeramani A.  I'm here to help you today.
05:16:46 AM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: HI Veeramani
Hope you are doing Good
05:17:16 AM Veeramani A: I am doing good. Thanks
05:17:21 AM Veeramani A: How are you ?
05:17:34 AM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Basically try to get some knowledge on how RDS critical security Patching works
05:17:38 AM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: I am doing Great
05:17:53 AM Veeramani A: sure. Please give me a moment
05:18:54 AM Veeramani A: From the case correspondence I understand that you want to know about the patches and updates with AWS RDS oracle as  Oracle Critical Patch Update
05:19:36 AM Veeramani A: Please correct me if I misunderstood your query.
05:19:47 AM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Yes 
05:20:15 AM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Also on how frequent is the patch list in AWS world once Oracle release an new patches
05:20:29 AM Veeramani A: According to our AWS documentation: Amazon RDS incorporates bug fixes from Oracle by using their quarterly Database Patch Set Updates (PSUs).  
05:20:35 AM Veeramani A: https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Appendix.Oracle.PatchComposition.html 
05:20:56 AM Veeramani A: The updates, before being available are thoroughly verifies so that you can be confident that your DB instance is running a version of the database software that has been tested by both Oracle and Amazon.
05:21:12 AM Veeramani A: Thus once the new update is available it will be applied in a maintenance window duration depending on the auto patching settings at the time.
05:21:39 AM Veeramani A:  you can also refer to our AWS document: https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.Maintenance.html 
05:23:15 AM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: So let's say there is a critical patch released from Oracle today so it get's reflected in AWS World after a Quarter. May I know if this is accurate
05:26:28 AM Veeramani A: security patches may not necessarily be released every quarter
05:27:17 AM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: So May I know when does it get released in AWS
05:29:36 AM Veeramani A: it depends on how AWS verifies the patch. As per our AWS Doc
05:29:38 AM Veeramani A: Maintenance items that require a resource to be offline include required operating system or database patching. Required patching is automatically scheduled only for patches that are related to security and instance reliability. Such patching occurs infrequently (typically once every few months) and seldom requires more than a fraction of your maintenance window.


05:29:50 AM Veeramani A: https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.Maintenance.html 
05:31:54 AM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Well I am still don't understand. If possible could we connect on a chime session
05:33:30 AM Veeramani A: sure
05:33:30 AM Veeramani A: Click to join the meeting: https://chime.aws/3892234527 
Meeting ID: 3892 23 4527



AWS_165387667510_Owner/rajendrra@optum.com (Role)


Sat Dec 11 2021
10:42:22 GMT+0530 (India Standard Time)
Hi All,

We could like to understand on how frequent the Oracle Critical Patches are applied on RDS once it's released by Oracle Corporation.

We could like to apply the recent security patch (Oracle Security Alert for CVE-2021-44228) across multiple AWS account.

Feel free to share us the docs, pre-requites (if any)
Regards,
Ramkumar
ARN of RDS instance: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

69. Chat: Task gets timed out with shorter time frame

Hello,

We haven't heard back from you regarding case 9331171221 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9331171221&displayId=9331171221&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 168 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Fri Dec 10 2021
18:39:36 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hi Pravin,

This is Martin again from AWS Premium Support. It was a pleasure to chat with you today.

As advised on the chat, please see a brief summary of our chat conversation below.

The issue you were facing was a timeout error from your AWS Lambda function arn:aws:lambda:us-east-1:165387667510:function:MSTR-AMI. We looked at the AWS Lambda Function and noticed that the timeout error matched the timeout value configured for this AWS Lambda Function. Once the timeout value was increased the AWS Lambda Function completed its execution successfully. Additionally, you advised that you need to complete further testing and wished for the case to remain open. Please note, this case will stay open for 10 days. After 10 days the ticket will automatically close, but, you can still reopen the case for an additional 14 days.

I hope this information is clear and helpful to you. If anything is unclear, or if you have additional questions about this. Please reach out to me and I will happily provide clarity, or, assist you as best I can. 

Wishing you and your team all the best.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Martin R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9331171221&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Dec 10 2021
18:03:15 GMT+0530 (India Standard Time)
00:40:38 PM Martin R: Hello, my name is Martin R.  I'm here to help you today.
00:41:09 PM Martin R: Can I get your name please?
00:41:11 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi Martin,
00:41:15 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am Pravin kumar
00:41:33 PM Martin R: Hi Pravin, I hope you are doing well today.
00:42:13 PM Martin R: From my understanding you are getting timeouts from an AWS Lambda function. 
00:42:26 PM Martin R: Could you please provide some additional details?
00:42:26 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: to brief you in short, I created a lambda function to invoke Image builder pipeline. However, I do three activities within the same lambda python code.
00:43:34 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: firstly, Create image builder recipe. Secondly, Update the image builder pipeline with that recipe and third boto3 request is to start running the pipeline.
00:44:49 PM Martin R: And can you confirm you are getting the timeout on the third part of the process?
00:45:06 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: create recipe works and even I notice pipeline also gets updated with the recipe, however after that I see error as "task timed out in 3 seconds" 
00:45:17 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: infact all these will happen in less than a minute.
00:45:30 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes correct 
00:46:02 PM Martin R: As you said you see an error, is this error from the AWS ]lambda logs?
00:46:19 PM Martin R: If so could you please share here the full error message?
00:46:59 PM Martin R: Additionally, are these Ec2 images you are building?
00:47:57 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes from Lambda logs.
00:49:00 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am trying to update the image builder pipeline and run it, to get the AMI output.
00:49:28 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: 2021-12-10T17:52:25.414+05:30

Copy
2021-12-10T12:22:25.411Z a2c643ab-d133-4b15-9be3-d8580a812eb0 Task timed out after 3.00 seconds

2021-12-10T12:22:25.411Z a2c643ab-d133-4b15-9be3-d8580a812eb0 Task timed out after 3.00 seconds
00:49:29 PM Martin R: OK, thanks. Can you please provide the name of this AWS Lambda Fuction.
00:49:42 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: MSTR-AMI
00:49:58 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: arn:aws:lambda:us-east-1:165387667510:function:MSTR-AMI
00:50:15 PM Martin R: Thanks, I can see from looking at your resources that the timeout value for this function is set to 3 seconds.
00:50:33 PM Martin R: Have you tried increase the timeout value for this AWS Lambda Function?
00:50:59 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Oops I haven't tested it. one second
00:51:08 PM Martin R: sure, thanks.
00:53:11 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I updated it and re-testing now.
00:53:50 PM Martin R: Thanks, I can see it is update to 243 seconds.
00:58:53 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I think that was the reason and it went fine now..
00:59:08 PM Martin R: Excellent. 
00:59:15 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Let me spend some time and do few more testing and do let you know.
00:59:22 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: but really thanks for help
00:59:25 PM Martin R: Is there anything else I can help you with today?
00:59:33 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I hope that is all for now
01:00:03 PM Martin R: Thanks, I will send you a brief summary of our conversation. Are you happy for me to resolve this case? or would you rather I keep it open?
01:01:09 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Would be better if this is open for some time so that I can complete my other testings too
01:01:48 PM Martin R: Thanks, that is no worries at all. I will of course leave the case open. I hope you have a great rest of day.
01:02:00 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Thanks again
01:02:11 PM Martin R: No worries, I will close this chat now, happy testing!



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Fri Dec 10 2021
18:02:54 GMT+0530 (India Standard Time)
Hi Team,

Task gets timed out with shorter time frame, as I am trying to update and invoke a resource alone from Lambda function.

Thanks,
Pravin
Function ARN: 
Error message: 
CloudWatch logs: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

70. Chat: how to scan for vulnerablity with aws inspector while creating AMI

Hello,

We haven't heard back from you regarding case 9325947341 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=9325947341&displayId=9325947341&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 168 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Fri Dec 10 2021
16:31:07 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Surendar,

Thank you for your time on the case.

As mentioned on the chime call, below are the findings for the use-case that you have:

We are doing the deployment using Cloudformation template wherein the template creates an Image Builder pipeline and using Ansible playbook, you can customise the configuration as per your requirement. Below is the workflow:

1. Deploy the CloudFormation templates.

2. The template creates an Image Builder pipeline

3. AWS Systems Manager completes the AMI build process.

4. Amazon EC2 starts an instance to build the AMI.

5. Systems Manager starts a test instance build after the first build is successful.

6. The AMI starts provisioning.

7. The Amazon Inspector CIS benchmark starts.

So, if you refer to the diagram mentioned in the link below, in the test phase the inspector would run to inspect the AMI and then the report would be generated by the inspector which you would see on the Inspector AWS console. You can use the Image Builder pipeline to simply update the Ansible playbooks with the settings, then run the Image Builder pipeline to build a new AMI, deploy the new AMI to an EC2 Instance, and run the Amazon Inspector report to ensure that the issue has been resolved. Finally, we can see the specific instances that have been assessed that have this issue.

https://aws.amazon.com/blogs/devops/deploying-cis-level-1-hardened-amis-with-amazon-ec2-image-builder/ 

Answering the question:

1. How to integrate the SSM patch manager with AWS Image builder 
       (To patch the AMI before it creates in image builder)

You can try the integration as explained in the below documentation i.e to selectively install or update patches on operating systems of supported AMIs, you can author an Image Builder component to install the required patches. A custom component can install patches using shell scripts (Bash or PowerShell), or it can use the UpdateOS action module to specify patches for installation or exclusion. For more information, see Action modules supported by AWSTOE component manager.

https://docs.aws.amazon.com/imagebuilder/latest/userguide/vulnerability-analysis-and-management.html 

2. How to remediate the Inspector findings while creating the AMI itself

For inspector, we need an EC2 instance as it only runs inside an EC2 to validate anything, so this will not work while creating the AMI itself.

I would like to inform you that both the scanning and remediation would need two different steps and cannot be done at once like you would have to create separate configuration for the same.

Please try out the custom settings as per the details explained above since this is a custom requirement and you would have to make changes accordingly to achieve the use case. However, feel free to discuss this via call and we can take this further.

Have a great day ahead!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Manisha S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9325947341&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Dec 10 2021
11:28:59 GMT+0530 (India Standard Time)
As per our discussion, Kindly check and let us know
1. How to integrate the SSM patch manager with AWS Image builder 
       (To patch the AMI before it creates in image builder)
2. How to remediate the Inspector findings while creating the AMI itself


AWS_P0001489@optum.com


Fri Dec 10 2021
10:57:48 GMT+0530 (India Standard Time)
05:28:16 AM Manisha S: Hello, my name is Manisha S.  I'm here to help you today.
05:29:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: HI My name is surendar
05:29:15 AM Manisha S: Hello Surendar
05:29:21 AM Manisha S: checking the case details.
05:29:53 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I wanted to know, how to scan for AMI vulnerability while it is creating itself in image builder
05:30:24 AM Manisha S: I got your query, however would need yo check on this as we are not sure if this can be done. 
05:30:28 AM Manisha S: please allow me sometime
05:30:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
05:30:42 AM Manisha S: Thanks
05:36:40 AM Manisha S: The inspector-test-component AWS managed component is pre-built for performing vulnerability with Amazon Inspector in EC2 Image Builder.
05:38:58 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but how to remediate this that is another question
05:39:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have a call to discuss about this
05:39:44 AM Manisha S: yes sure, please give me sometime
05:41:01 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
05:45:05 AM Manisha S: ok, so just wanted you to know that you would need to create a custom scripted component to use a different set of package with Amazon Inspector.
05:45:13 AM Manisha S: let me send you the chime link
05:45:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
05:46:10 AM Manisha S: https://chime.aws/8000104563 
06:01:11 AM Manisha S: https://aws.amazon.com/blogs/devops/deploying-cis-level-1-hardened-amis-with-amazon-ec2-image-builder/ 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

71. Chat: AWS CLI Command not working in userdata

Hi Arun, 

Thank you for connecting with me earlier today. I am sending this as a follow up for your record.

In our conversation we discussed that you are facing an issue that is specific to the 6.2 release of EMR.
When you run the below command via SSM "aws ec2 modify-instance-metadata-options --instance-id $ec2Id --http-endpoint enabled --http-token required", you are getting this message "You must specify a region. You can also configure your region by running "aws configure"."

SSM is what is considered a global service, which means it is unaware of the region that it is being run in. 
With the suggestion of "aws configure" you are setting up a default region and as a result of a default region you would not be asked for a region.

With ---region (e.g. us-west-1) you are not using a default but specifying exactly.
My suggestion in your case (for now) would be to use the --region as if it works you are not creating any additional problems by specifying a region and also ensuring that a global service is aware of your request.
SSM is a valuable service and we encourage engineers to use it as it.

Few things to remember and some suggestions: 
- The version can make a difference esp. considering this is a major upgrade (5.x to 6.x) and when making upgrades of this nature it is important to test as it appears you are doing before moving to a production release. 
- If possible, please try and use 6.2.1 as the x.x.1 change is usually a "patch" or fix for known issues and is usually a better version without major software upgrades.
- If you are looking to migrate and have the capacity to do a full upgrade I would always suggest the lastest release 6.5 at the moment as service teams are consistently improving software quality so if possible I'd go as high as possible.
But obviously if you have version dependencies etc. then whatever works best for you!

Please let me know if you have any follow up questions and I hope you have a good day further.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
David S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9309628501&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Mon Dec 06 2021
15:15:51 GMT+0530 (India Standard Time)
09:48:41 AM David Sobey: Hello, my name is David.  I'm here to help you today.
09:48:45 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: hi David
09:48:55 AM David Sobey: Hi Arun, how are you today?
09:48:55 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: My name is Arun
09:49:25 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: I'm good. How are you?
09:49:32 AM David Sobey: I am good thank you.  
09:49:36 AM David Sobey: I have read through the case
09:49:55 AM David Sobey: I can see that you are facing an issue that is specific to the 6.2 release of EMR.
09:50:23 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: This is not happened in this AWS account.
09:50:44 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: This is our other team part of our Org
09:50:46 AM David Sobey: Ok
09:50:57 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: But still wanted to know why this issue happens
09:51:11 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: As it is creating lot of security violations.
09:51:30 AM David Sobey: So just an FYI I cannot provide cross account support.
09:51:51 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sorry. i do not mean cross account support.
09:52:24 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: When we run the below command "aws ec2 modify-instance-metadata-options --instance-id $ec2Id --http-endpoint enabled --http-token required"
09:52:38 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: We are getting this message "You must specify a region. You can also configure your region by running "aws configure"."
09:52:46 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: What may be the reason for that message?
09:53:37 AM David Sobey: Where is this being run on a B.A?
09:53:37 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: If i run the same command with --region, it seems to be working. 
09:54:02 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: B.A ?
09:54:09 AM David Sobey: Sorry bootstrap action"
09:54:22 AM David Sobey: Or run in SSM?
09:54:37 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Actually, we tried it in bootstrap actiion.
09:54:45 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: it was not enabled.
09:54:53 AM David Sobey: Yeah ok
09:54:57 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: We then tried to run in SSM command, got the above message
09:55:04 AM David Sobey: Ok I understand
09:55:13 AM David Sobey: So SSM is what is considered a global service
09:56:16 AM David Sobey: Which means it is unaware of the region that it is being run in.  With the suggestion of "aws configure" you are setting up a default region.
With ---region (e.g. us-west-1) you are not using a default but specifying exactly.
09:57:12 AM David Sobey: My suggestion in your case (for now) would be to use the --region as if it works you are not creating any additional problems by specifying a region and also ensuring that a global service is aware of your request.
09:57:32 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok. 
09:58:08 AM David Sobey: Cool no problem.  SSM is a valuable service and we encourage engineers to use it as it.
09:58:26 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Will it because of the difference between emr label version.
09:59:17 AM David Sobey: The version can make a difference esp. considering this is a major upgrade (5.x to 6.x) but I am not part of the development team so I am not aware of the internals.
10:00:52 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Also, wanted you to confirm whether 6.2.0 supports metadata option in security configuration
10:00:53 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: https://aws.amazon.com/about-aws/whats-new/2021/03/amazon-emr-now-supports-amazon-ec2-instance-metadata-service-v2/ 
10:01:38 AM David Sobey: Checking this documentation quickly.
10:02:11 AM David Sobey: Yup I am sure that is accurate.
10:02:23 AM David Sobey: Two quick suggestions if I may?
10:02:31 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure.
10:02:34 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Please tell me
10:03:20 AM David Sobey: If possible, please try and use 6.2.1 as the x.x.1 change is usually a "patch" or fix for known issues and is usually a better version without major software upgrades.
10:03:24 AM David Sobey: 2..
10:04:16 AM David Sobey: If you are looking to migrate and have the capacity to do a full upgrade I would always suggest the lastest release 6.5 at the moment as service teams are consistently improving software quality so if possible I'd go as high as possible 
10:04:36 AM David Sobey: But obviously if you have version dependencies etc. then whatever works best for you!
10:04:45 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok. that's great. Thanks for your suggestion.
10:04:52 AM David Sobey: Sure
10:04:55 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: We will try to use the latest one.
10:05:11 AM David Sobey: Great, any other questions I can help with?
10:05:29 AM David Sobey: I will send a follow up mail which you can respond to as well as keep for record of our conversation.
10:05:41 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Thats all from. 
10:05:47 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: me
10:05:58 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Thanks for your time and valuable suggestions.
10:06:02 AM David Sobey: Great thanks Arun hope you have a good day further
10:06:07 AM David Sobey: No problem.
10:06:12 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: You too.
10:06:16 AM David Sobey: Bye :)



AWS_165387667510_Owner/arunkumar@optum.com (Role)


Mon Dec 06 2021
15:15:34 GMT+0530 (India Standard Time)
Hi Team,

In one of our AWS Account(Account Number: 526621796011), we are facing an issue whenever an EMR Cluster is provisioned. Enabling EC2 Metadata V2 is mandatory in our org and in some of our EMR Cluster, we have used bootstrap action to enable ec2 metadata with the below command.

aws ec2 modify-instance-metadata-options --instance-id $ec2Id --http-endpoint enabled --http-token required

The above command works when we use in the label emr 5.30 where it didn't worked in 6.2.0 

But when we try to run the command from SSM for the ec2 instances in 6.2.0 emr cluster, we get this error "You must specify a region. You can also configure your region by running "aws configure"."

So, if we specify --region in the command, it worked.

Though we are trying to use --region but wanted to understand what may be the issue.  Is that because any AMI related issue?


Regards,
Arun
EMR Cluster-id: 
Bootstrap Action name/id: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

72. Chat: Oracle RDS is not able to access S3

Dear Customer,

It was a pleasure to assist you today via chat. Please find a quick summary of our conversation below.

As updated in the last case summary notes, after you have removed the bucket policy from the S3 bucket with deny you are able to download the files from S3 to the RDS instance.

I hope you find the above information answered your queries and should you require any more information or assistance please let me know and I will be glad to assist.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Keshav J.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9274246691&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Mon Nov 29 2021
19:20:06 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Dear Customer,

Thank you for contacting AWS Premium Support. My name is Keshav and I will be assisting you today with this case.

From the case description I understand that you have issues with the S3 integration with the RDS instance. Please feel free to correct me if I have mistaken or missed any concerns.

Please allow me to explain that I have verified the RDS instance "dts" which is integrated with the S3 option group which is active, further I have verified the IAM role attached to the RDS instance which has required access to the s3 bucket "165387667510-ram" and I see the bucket is attached to the bucket policy with deny, can you please remove this policy or remove the deny and then test the downloads from S3 to RDS. Please refer below links for more information.

[+] Amazon S3 integration - https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/oracle-s3-integration.html 
[+] Amazon S3 integration - Prerequisites for Amazon RDS for Oracle integration with Amazon S3  - https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/oracle-s3-integration.html#oracle-s3-integration.preparing 

I hope you find the above information answered your queries and should you require any more information or assistance please let me know and I will be glad to assist.

Hope you have a great day ahead!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Keshav J.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9274246691&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Mon Nov 29 2021
19:05:36 GMT+0530 (India Standard Time)
01:49:01 PM Keshav J: Hello, my name is Keshav J.  I'm here to help you today.
01:50:28 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Hi Keshav
01:50:54 PM Keshav J: May I know your name please
01:51:01 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: This is Ram
01:52:20 PM Keshav J: Hello Ram, Hope you are doing good
01:52:40 PM Keshav J: I have sent a correspondence on the case can you verify that
01:53:28 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Let me remove the S3 deny and have it right away
01:53:41 PM Keshav J: sure
01:55:51 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: I do see that the S3 policy with Deny access is applicable only to the resources matching with particular tags value
01:57:37 PM Keshav J: ok can you remove it and test
01:58:57 PM Keshav J: or if you have other S3 bucket with out any policy of Deny
01:59:39 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: It seems to be working now but facing no disk space issue in RDS
02:01:38 PM Keshav J: ok, can you confirm whats the size of the file downloading
02:01:49 PM Keshav J: I see only 17GB is free on the RDS instance
02:03:19 PM Keshav J: https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1&redir=1#metricsV2:graph=~(metrics~(~(~'AWS*2fRDS~'FreeStorageSpace~'DBInstanceIdentifier~'dts) )~stat~'Average~period~60~start~'2021-11-29T10*3a28*3a27Z~end~'2021-11-29T11*3a28*3a27Z~region~'us-east-1)
02:03:59 PM Keshav J: please refer above link for more information
02:05:19 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Okay
02:05:45 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: I will add additional volume and re-try again, keshav
02:05:46 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Thanks
02:06:34 PM Keshav J: ok if you want to test now, u can try to download small size file just to see if the S3 feature works
02:10:06 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: Okay
02:10:07 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: sure 
02:10:19 PM Keshav J: ok
02:11:33 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: It's working and I was able to download a small file
02:11:55 PM Keshav J: Thats great, I will send a summary in the case in some time then
02:12:10 PM Keshav J: do you need any more information please let me know
02:19:34 PM Keshav J: are you there Ram?
02:19:47 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: yes
02:20:04 PM assumed-role/AWS_165387667510_Owner/rajendrra@optum.com: No additional information requried, Keshav
Thanks
02:20:41 PM Keshav J: ok fine Ram, please feel free to close the chat I will send summary in the case in some time
02:20:49 PM Keshav J: Have a nice day

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

73. Call: Clarify on the base AMI features

Hello Pravin,

Uday here again from AWS Linux team, I'm following up on this case!

Thank you so much for your patience while I checked your concern with our service team. Also, i would like to sincerely apologize for the inconvenience you might have experienced because of the delay. With that said, I'm glad to let you know that I've received a response from them - 

Unfortunately, the features(OSSEC/Shred SSH) are not provided by the Base AmazonLinux and AmazonLinux2 AMIs provided by AWS. 

However, if you are creating your own AMis using Ec2 Image Bulder and with AWS provided AmazonLinux AMIs as the parent AMIs, you need to write own custom EC2 Image Builder components to do this. None of the AWS provided Image Builder components provide these capabilities.

Please note that EC2 Image Builder also runs cleanup/sanitization scripts at the end of execution(once all the Build components) are executed as a Security Best practice. Here's the link[1] for the cleanup script. So if the customer is making any changes to the SSH setting(or anything else) that are being reverted in the cleanup script, please follow the guide[2] to override the cleanup/house-keeping/sanitization scripts.

I trust this correspondence proves useful. Should you have any other questions or need additional clarification, please feel free to get back to us and we will be happy to assist you.

Stay safe and take care!

References:
=========
[1] Security best practices for EC2 Image Builder
https://docs.aws.amazon.com/imagebuilder/latest/userguide/security-best-practices.html 

[2] Override the Linux housekeeping script
https://docs.aws.amazon.com/imagebuilder/latest/userguide/security-best-practices.html#override-linux-housekeeping-script 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Uday
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9272785681&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Mon Nov 29 2021
11:28:32 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Pravin,

Uday here from AWS Linux team, I'm here to assist you with this case!

Thank you so much for your call. 

As confirmed on the call, I shall confirm these details to you in sometime.

Until then, I am keeping the case locked to myself with its status set to 'Pending Amazon Action'.

In the meantime, if you have any further queries and/or concerns, please do let me know.

Stay safe and take care!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Uday
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9272785681&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Mon Nov 29 2021
11:16:48 GMT+0530 (India Standard Time)
Hi,

Need to clarify if the OSSED HIDS, Shred ssh is taken care within the base AMI provided by Amazon or is there any Amazon native components available to get these installed ?

Thanks,
Pravin

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

74. Pipeline failure

Hello Pravin,

Thanks for your time on call today. To recap, you reached out to us as you were seeing issue with the Image Pipeline - ImageBuilderPipelineLinuxMSTR.

We verified the failed execution and noticed that pipeline is timing out on WaitForInstanceToSpinUp step. After checking in detail, we found that instance created by pipeline was failed to launch due to Client.InternalError. While we were troubleshooting the issue, you were able to identify the KMS key used to encrypt the root volume is disabled. 

The instance was able to launch successfully after modifying the required configuration. I also verified internally and able to confirm that launch was failed due to disabled KMS key - arn:aws:kms:us-east-1:165387667510:key/0383aaed-02b1-4938-86e2-4ff9a46498e2.

As per our discussion, I checked further and this information is documented in following article:

Client.InternalError: https://aws.amazon.com/premiumsupport/knowledge-center/ec2-client-internal-error/ 

1.    Run the describe-instances API to verify the StateReason error message and error code. The following is an example of the command output if there is an encrypted volume attached to the instance and there are permissions or policy issues:

aws ec2 describe-instances --instance-ids i-xxxxxxxxxxxxxxxxx
"StateReason": {
     "Message": "Client.InternalError: Client error on launch",
     "Code": "Client.InternalError"
   },

2.    Verify the following:
-  The AWS Key Management Service (AWS KMS) key used to encrypt the volume is enabled.  <<==
-  The user trying to start the instance has the correct IAM permissions.
-  The key has the correct key policies.


Please feel free to reach out to us if you need further assistance with the Pipeline. 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Neha R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9225432951&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Mon Dec 06 2021
08:51:18 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Pravin,

Please join screen sharing session with following URL
https://screenshare.aws/?ak=ad1dd477f5b25fa18c253b9fd82e2a6a 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Neha R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9225432951&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


>>>>>>>>>>>>>>>>>>>>>>>

75. How to implement Regional DR for the RDS

Hello Team,

A very warm greeting from AWS Premium Support RDS Team. My name is Ruz and I will be the engineer assisting with your case today.

From your case description, I understand that you would like guidance on how to implement Regional DR for the RDS. 

Generally, to achieve the same you can consider having to set up (1) Automated backups (2) Manual snapshots and (3) Read replicas which are the supported DR mechanisms in RDS for either single region or can span across regions.

That said, I have included the below official documentation [+] which gives comprehensive details on the supported DR capabilities in RDS as well as detailed steps on how to configure such in RDS. Please may you kindly review the below documentation [+] for further information to this issue.

[+] https://aws.amazon.com/blogs/database/implementing-a-disaster-recovery-strategy-with-amazon-rds/ 

I hope the information was helpful. If you have additional queries or concerns, please feel free to add them to the case notes and I will be more than happy to help you.

Have an AWSome day ahead and stay safe!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Ruz G.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9216114321&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Nov 17 2021
19:17:10 GMT+0530 (India Standard Time)
How to implement Regional DR for the RDS


>>>>>>>>>>>>>>>>>>>>>>>>>>>

76. Chat: Is it necessary to stop instances before taking a snapshot of the root volume?

Hello Surendar,

Greetings of the day!

This is Radhika from AWS Premium Support. Thank you for your time on chat today. It was a pleasure assisting you. Kindly find the below summary for the same:

You reached out to us as it was mentioned in the article-[1] that it is required to stop the instance before taking snapshot of the root volume. You wanted to know if it is mandatory to stop the instance before taking the snapshot of the root volume.

As conveyed on chat, snapshots of root volume can be taken while the instance is in running state and it is not mandatory to stop the instance. It is just a recommendation by AWS to stop the instance before taking a snapshot of an EBS volume that serves as a root device to ensure the snapshot consistency. Further, I went ahead and replicated the behaviour in my lab environment and was able to successfully create a snapshot of the root volume of my running instance in my lab environment using boto3.

Further, you wanted to know if this is the same for both platforms to which I confirmed to you that you can create snapshots of your root volume of running instances for both Linux and Windows platforms. 

I hope this helps. As confirmed on chat, I will be marking this case as resolved. Please feel free to open a new case if you encounter any issue or need our assistance with anything.

Stay safe and take care!

References:

[1] https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/ec2.html#EC2.Client.create_snapshot 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Radhika K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9209241431&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

Dont miss messages from AWS Support when you need help! Update your contact information:
https://console.aws.amazon.com/billing/home#/account 

If you receive an error message when visiting the contact information page, visit:
https://aws.amazon.com/premiumsupport/knowledge-center/iam-billing-access/ 

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Nov 16 2021
12:50:15 GMT+0530 (India Standard Time)
07:20:46 AM Radhika K: Hello, my name is Radhika K.  I'm here to help you today.
07:21:23 AM Radhika K: May i have your name please while I pull up the case details
07:21:59 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
07:22:11 AM Radhika K: Hope you are doing well surendar
07:22:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes, Thanks. hope you doing great !!!!!
07:23:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: from the article i got to know that, we should stop the instance before taking snapshot(only root volumes)
07:23:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it mandatory to stop the instance to take snapshot of root volume 
07:24:03 AM Radhika K: Okay. Please allow me sometime to check this.
07:24:18 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Okay
07:25:05 AM Radhika K: Please could you confirm how you are taking the snapshot?
07:25:16 AM Radhika K: Example: using aws console or boto3
07:28:33 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: boto3
07:30:48 AM Radhika K: Okay. Please could you share the instance ID in concern.
07:31:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i-0a242c3678d99fb65
07:31:40 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: vol-081283c8151d0d9c7
07:31:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: root volume
07:32:05 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: please check both linux and windows
07:32:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Now i have shared the linux instance ID, but we will take snapshot for both platforms using boto3
07:32:46 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so please confirm for both platforms
07:34:10 AM Radhika K: Could you confirm what type of workload is on this instance?
07:35:03 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it could be anything
07:35:28 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because we will take snapshot for multiple instances 
07:35:44 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we dont know what type of workloads are running 
07:38:37 AM Radhika K: I would like to inform you that the snapshot can be taken while instance is running and it is not mandatory to stop the instance. However, that is just a recommendation by AWS.
07:39:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Thanks for your confirmation.
07:39:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: just to confirm again, it is for both linux and windows platform ??
07:40:23 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we can take snapshot of root volumes (windows | Linus )with stopping instances 
07:40:41 AM Radhika K: Yes it is same for both the platforms
07:41:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
07:41:53 AM Radhika K: You're welcome
07:42:05 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we can close the case
07:42:35 AM Radhika K: Sure. I will be sending a summary email and marking the case as resolved.
07:42:44 AM Radhika K: Thank you for your time on chat



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Nov 16 2021
12:50:05 GMT+0530 (India Standard Time)
connection was lost, connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Nov 16 2021
12:49:32 GMT+0530 (India Standard Time)
As noted in the article below, instances should be stopped before taking snapshots of root volumes.

https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/ec2.html#EC2.Client.create_snapshot 


""To create a snapshot for Amazon EBS volumes that serve as root devices, you should stop the instance before taking the snapshot."""
Instance ID(s): 
Timestamp (YYYY-MM-DD HH:MM:SS UTC): 


>>>>>>>>>>>>>>>>>.

77. Chat: Need clarification on taking backup

Hi Surendar,

This is Niall, the AWS Premium Support Engineer that spoke with you on the chat earlier, it was a pleasure speaking with you today.

As discussed, you had questions on completing activities on your AWS resources while backups were in progress and you wanted to know if it's recommended to perform these actions while the backup is in progress.

As mentioned on the chat, it's recommended that you allow the backup to complete before performing any maintenance on your resource such as patching an EC2 instance. You can however, continue to use your resources as normal while backups are in progress for normal day to day use cases, however, when it comes to preforming maintenance, it's best to let the backup complete before starting any patching or similar maintenance. 

In addition to the above, you also had questions on event notifications for AWS backup so that you could receive a notification when the backup is completed successfully, this would allow you to start maintenance work on your resources automatically. As mentioned on the chat, you can configure SNS notifications for "backup job completed" events, you can then set the endpoint for your SNS notification as a Lambda function and then configure the lambda function to complete the required tasks to start the maintenance/patching of your resources. 

For your reference, I am including the following article which walks through configuring event notifications for the AWS backup service, the steps in this article will help get you started with creating an event notification[1]. The following article also walks through creating an SNS topic[2]

As agreed on the chat, I will resolve this case for now. I hope that I was able to explain everything in a clear and concise manner. If not, please do let me know.
If you have any more queries or other concerns, please don't hesitate to include in this case.
     
Have a great day ahead and take care!

References:
[1] Configuring notifications to monitor AWS Backup jobs - https://aws.amazon.com/blogs/storage/configuring-notifications-to-monitor-aws-backup-jobs/  
[2] Creating an Amazon SNS topic - https://docs.aws.amazon.com/sns/latest/dg/sns-create-topic.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Niall C.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9186617101&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Nov 11 2021
17:39:06 GMT+0530 (India Standard Time)
00:12:44 PM Niall  : Hello, my name is Niall.  I'm here to help you today.
00:12:53 PM Niall  : May I get your name while I review the case details?
00:14:11 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar
00:15:44 PM Niall  : Hi Surendar, nice to meet you. From reviewing the case, I understand that you would like to know if you should wait for a backup to complete before stating other dependent activities. Is that correct?
00:17:11 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes 
00:18:36 PM Niall  : Thank you for confirming, can you confirm what you are referring to when you say "dependent activities" are you referring to starting another backup while one backup is already in progress for the same resource?
00:19:19 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: No , other activities like patching the server 
00:20:12 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we are going to patch via aws system manager (patch manager)
00:20:44 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so before patching, we wanted to take a backup of server (AMI backup)
00:21:56 PM Niall  : Ok, thank you for confirming, I understand. Please allow me a few moments to confirm if there will be any impact of performing an activity such as patching before the backup has completed.
00:23:04 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
00:28:15 PM Niall  : Thank you for your patience, if you are performing patching on your server, it's best to wait for the backup to complete before starting the patching. You can continue to use the resource as normal while the backup is in progress but if you are performing maintenance on the resource, it's best to let the backup complete first before starting the maintenance.
00:33:01 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay is there any way that we can get programmatic way to know backup completion 
00:33:23 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i mean, once backup completes patching activity should start automatically
00:33:42 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so is there any way that we know programmatic way 
00:36:48 PM Niall  : You can configure notifications for your AWS backup events such as "Backup Job Completed" to trigger an SNS notification. You could then configure the SNS notification to invoke a lambda function that starts your patching activity. Further information on AWS Backup notifications can be found here:
https://docs.aws.amazon.com/aws-backup/latest/devguide/sns-notifications.html 
00:37:22 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how about boto3
00:38:39 PM Niall  : You can use the AWS Boto3 Python SDK in your Lambda function to process the SNS notification and complete further actions based on your Lambda function
00:39:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it possible for you to check is there any customer was asked this query before 
00:39:44 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and let me know possiblities 
00:39:48 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it possible
00:42:47 PM Niall  : Ok, I can quickly check if similar requests have been made by customers before, however, due to the number of cases, it's not possible to review all the cases. However, as I have mentioned that you can configure Backup event notifications using SNS, you can then invoke a Lambda function from the event and based on the code in your Lambda function you can then perform some action.
00:42:56 PM Niall  : Please allow me a few moments to review similar cases.
00:43:22 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
00:49:55 PM Niall  : Thank you for your patience, I have been unable to locate similar customer requests due to the volume of cases we receive. However, the following article walks through monitoring AWS backup Jobs, the steps in this guide will get you started with configuring the notification and SNS topic, from there you can configure the SNS topic to send the notification to the Lambda function.
https://aws.amazon.com/blogs/storage/configuring-notifications-to-monitor-aws-backup-jobs/ 
00:50:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay thanks
00:50:33 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we can close the case
00:50:37 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks for the support
00:51:07 PM Niall  : You're welcome surendar, is there anything else I can help you with before ending the chat?
00:51:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: no thanks
00:51:50 PM Niall  : Ok, thank you for your time today surendar, I will end the chat now. Bye, have a nice day :) 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Nov 11 2021
17:38:58 GMT+0530 (India Standard Time)
connecting again


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Nov 11 2021
17:36:14 GMT+0530 (India Standard Time)
The scenario is: If we initiate the backup, should we wait until the backup is complete before starting other dependent activities or can they be started immediately?

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

78. Chat: SNS notification for Shield

Hi Atchaya,

Jean-Pierre here again from AWS Premium Support.

As promised, this serves as a summary of the chat we had a few moments ago.

We discussed if it was possible to set up the SNS topic notification for a protected resource via the CLI. 

At this moment, the only method to configure this mechanism is via the Console[1]. There is currently no method to configure this CLI or programmatically.

As discussed, I will proceed to mark this as resolved. 

Have a AWSome day further!

--------------
References:
--------------
[1] Configuring AWS Shield Advanced protections -  Create alarms and notifications - https://docs.aws.amazon.com/waf/latest/developerguide/manage-protection.html#add-alarm-ddos 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Jean-Pierre R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9185474551&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Nov 11 2021
12:35:26 GMT+0530 (India Standard Time)
07:05:40 AM JP Roux: Hello, my name is JP Roux.  I'm here to help you today.
07:06:10 AM JP Roux: How are you today? May I get your name?
07:06:16 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Hello Atchaya
07:07:04 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Hi JP, typo here. I'm Atchaya
07:07:18 AM JP Roux: No stress at all. :) 
07:07:22 AM JP Roux: Allow me a few moments to review the case noets.
07:07:24 AM JP Roux: notes*
07:07:32 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: sure
07:11:07 AM JP Roux: To clarify what you trying to achieve -> https://docs.aws.amazon.com/waf/latest/developerguide/manage-protection.html#add-alarm-ddos  ?
07:15:37 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Yes, I achieved this by manual configuration in console. Now, I want to automate this step (Attaching existing SNS topic to  protected service). For that, I'm referring awscli command but have a doubt whether this feature is available in cli?
07:16:37 AM JP Roux: Ah perfect, so yes indeed. This feature is currently not available from a CLI perspective. I do see that we have a feature request for this. I can proceed to add your voice to it. However, I cannot provide an ETA on when this feature will be implemented. As, Premium Support does not have visibility into the service teams roadmap.
07:17:09 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: okay
07:17:29 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Any idea about boto3 feature for this?
07:17:50 AM JP Roux: At this moment, the only method to configure this is via the Console. 
07:17:58 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: okay
07:18:16 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: Thank you so much.
07:18:35 AM JP Roux: Its a pleasure. I do apologize for the limitation around configuring this. Is there anything else I can assist you with today? 
07:19:09 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: No JP.
07:19:12 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: thank you
07:19:32 AM JP Roux: Perfect, should I proceed to mark this as resolved for you? :)
07:19:38 AM assumed-role/AWS_165387667510_Contributor/asamina1@optum.com: yes
07:19:47 AM JP Roux: I will do so. Have a splendid day further.
07:20:19 AM JP Roux: I will close off this chat now and send a summary response via case " 9185474551 ".



AWS_165387667510_Contributor/asamina1@optum.com (Role)


Thu Nov 11 2021
12:35:14 GMT+0530 (India Standard Time)
Hello Team,

I have attached the SNS topic to the Shield protected service manually. But I am unable to find the proper awscli command to attach the SNS topic with Shield protected service. Could you please help me on this?

>>>>>>>>>>>>>>>>>>>>>

79. Breaking down RDS spend in Cost Explorer (without Tags)

Good Morning!

I've received an update from our service team. They've stated they unfortunately do not support resource level data for RDS at this time, only EC2. 

I apologize for any inconvenience this may have caused.

I will be updating this case to a status of resolved as it seems no further action is needed, but please do not hesitate to reach out if you have any further questions or concerns.

Thank you and have a wonderful day!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Marc R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9177289181&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Wed Nov 10 2021
23:50:52 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:
Excellent


Translate

Good Afternoon! 

I'm following up to let you know I have your case locked to myself and am working with the service team on your RDS spend request. From my knowledge, getting that granular in Cost Explorer can be challenging, but I believe what you're seeking can be found in the the monthly billing .csv file. 

However, this is only accessible through the Payer ending in 6488 as linked accounts do not have access to these .csv files as all billing is handled by the payer. I've attached an example of what that would look like to this email and filtered column P to 'db.t3.medium'. The results appear to reference different instances, but if not please let me know. 

I will follow up with our service team just to be safe that I'm not missing anything from a cost explorer standpoint being able to view this data.

Once I receive an update from the service team I will be happy to follow back up with you!

I appreciate your patience and have a great day!

${attachment-start}
To see the file named 'DB.t3.medium - Optum.xlsb' included with this correspondence, please use the case link given below the signature.
${attachment-end}

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Marc R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9177289181&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Attachments
DB.t3.medium - Optum.xlsb

AWS_165387667510_Contributor/wyatt_andersen@optum.com (Role)


Wed Nov 10 2021
00:33:22 GMT+0530 (India Standard Time)
Hello! Is it possible to break down RDS spend by database Instance in AWS Cost Explorer (without tags)? I can isolate RDS spend, and I can split that up by Instance Type (db.t3.medium vs db.t3.large), but if I have multiple db.t3.medium instances (as an example) how would I see just one of them by itself? If I had "DB instance" as a filter that would do it, or if the "Resource" Filter worked on RDS instances not just EC2 that would be what I'm looking for.  

I think this is solvable with Tagging. Just wondering if I can get Instance level granularity in Cost Explorer without Tags.

Thanks!

>>>>>>>>>>>>>>>>>>>>>>

80. Chat: Need help in Remediation

i have executed the command successfully,
yum install ntp-4.2.8p15-3.amzn2.0.4.x86_64 -y
yum install ntpdate-4.2.8p15-3.amzn2.0.4.x86_64 -y

yum update ntp-4.2.8p15-3.amzn2.0.4.x86_64 -y
yum update ntpdate-4.2.8p15-3.amzn2.0.4.x86_64 -y

and CVE ID - CVE-2021-35942 is gone now. thanks for your support


Amazon Web Services


Wed Nov 10 2021
19:49:37 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

Hope you are well.

I can see that you have mentioned that the issue is still persisting at your end. I apologize for the inconvenience caused to you due to the same.

Can you please mention the Assessment ARN of the scan where the CVE shows up even after patching with the below command? Also, can you please add if the commands mentioned below are giving you any kind of error.

I also noticed that you tried to initiate the chat, but were not connected. I'd suggest you to try calling, if this is an urgent issue. Otherwise, you can mention your availability here, and we can set up a call for us to troubleshoot the issue together.

That said, please provide the above details, which can assist me in investigating on your issue deeply.

Have a nice day ahead.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Akshita N.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9176118021&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Nov 10 2021
12:24:46 GMT+0530 (India Standard Time)
Still the issue is persist


Amazon Web Services


Tue Nov 09 2021
21:38:31 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

Hope you are well.

Unfortunately, we could not connect on the call, as you were not available. However, I did research on your issue. Please find the below findings and suggestions for the same.

Just to quickly recap, you are looking to find a remediation for the CVE ID - CVE-2021-35942 for your Amazon Linux 2 instance.

As I investigated on this query, I found that the Amazon Linux Security Center portal for the security updates, does have the updates for this CVE, available from 2021-09-15 onwards, but these updates might not be appearing in repositories. This was a known issue at our end.

https://alas.aws.amazon.com/alas2.html 

However, this issue is fixed for now, and the packages are available in the repositories again. Please use the below commands to check if you can install them in your Amazon Linux 2 Instance - 

-------------------------------------------------------------------------------------------------------------------------

# yum list ntp-4.2.8p15-3.amzn2.0.4.x86_64
Failed to set locale, defaulting to C
Loaded plugins: extras_suggestions, langpacks, priorities, update-motd
Available Packages
ntp.x86_64                                                                                                          4.2.8p15-3.amzn2.0.4                                                                                                          amzn2-core

# yum list ntpdate-4.2.8p15-3.amzn2.0.4.x86_64
Failed to set locale, defaulting to C
Loaded plugins: extras_suggestions, langpacks, priorities, update-motd
Available Packages
ntpdate.x86_64                                                                                                        4.2.8p15-3.amzn2.0.4                                                                                                        amzn2-core

-------------------------------------------------------------------------------------------------------------------------

That said, I'd request you to please try installing these updates with the above commands again on your Instance, and please revert back on the mail, if the issue still persists.

As I'll be ending my shift now, I won't be able to have a call with you. However, we can set up the same for tomorrow, once you revert back with the suggested resolution above.

I hope the above information helps you in remediating that CVE.

Have a nice day ahead.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Akshita N.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9176118021&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 

>>>>>>>>>>>>>>>>>>>>>>>>

81. Chat: AWS-RunPatchBaselineAssociation run against the EMR instances when provisioning

07:22:39 AM Agent: Hi 
07:22:58 AM Agent: My name is Soumya and Its my pleasure to assist you with the case today.
07:23:05 AM Agent: May I know your name please ?
07:23:24 AM Customer: i have query on EMR AMI
07:23:24 AM Customer: My name is surendar
07:24:07 AM Agent: Hi Surendar 
07:24:13 AM Agent: How are you doing today ?
07:24:37 AM Customer: EMR AMI is private AMI ??? !!!!! and if I create EMR and changing something in my newly created EMR instance, will that change be always on original AMI
07:24:47 AM Customer: I am good thanks for asking
07:24:53 AM Customer: hope you are doing great
07:25:46 AM Agent: Glad to hear about, Yes I am doing great. thanks for asking though 
07:26:23 AM Agent: EMR AMI is the default AMI for all the EMR clusters 
07:27:01 AM Customer: after i have created the EMR and I changed something in EMR 
07:27:32 AM Agent: in case there is no custom AMI has been supplied during the cluster launch, EMR AMI takes preecedence else custom AMI Takes preecedence  
07:27:33 AM Customer: the changed things are persist on original AMI !!
07:27:53 AM Customer: is it okay that we can have a call 
07:28:13 AM Agent: It is not recommended to create an custom AMI from an EMR AMI or from a master node 
07:28:31 AM Agent: Sure, 
07:28:52 AM Customer: thanks can you please share the chime link to discuss about it
07:28:54 AM Agent: Meeting Link: https://chime.aws/6559176095 
Meeting ID: 6559 17 6095
U.S. Toll: +1 206-462-5569
Meeting PIN: 6559 17 6095
U.S. Toll-free: +1 855-552-4463
International: https://chime.aws/dialinnumbers/ 

07:29:02 AM Agent: Please join 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Nov 11 2021
12:11:28 GMT+0530 (India Standard Time)
the issue is still persist after installing the mentioned packages



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Nov 10 2021
17:32:09 GMT+0530 (India Standard Time)
Is EMR AMI updated recently 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Nov 10 2021
15:30:04 GMT+0530 (India Standard Time)
Need clarification on EMR AMI 

>>>>>>>>>>>>>>>>>>>>>

82. Chat: Assume role with ECS Task for S3 cross account access

Hi Navaneethan,

Thank you for reaching out to AWS Premium Support.  This is Jake.  It was my pleasure to work with you today.

You initiated a live chat with us today because you need help with troubleshooting cross-account access from ECS Fargate tasks to S3 objects.  

You are currently trying to resolve two errors.
  1. Attempts to perform STS operations fail with "The AWS Access Key Id you provided does not exist in our records."
  2. Copy operations result in Access Denied.

Regarding the first error, please look at the linked document to see if all of the permissions and IAM settings are complete.  The document is linked in the resources section, below [1].  Please note that assuming an STS role from within a Fargate task is unnecessary as the task can inherit needed permissions for both accounts using the task role and task execution role.  The task is attempting to gain credentials similar to the CLI access [2].  However, it is advised to add the necessary permissions and establish the connection using the permissions already inherited from the task [3] through the role.  

As it pertains to the second error, when we parted from the chat and Chime session you were going to attempt to allow the task role access to the S3 bucket by updating the policy with Terraform.  As you have reported, this did not allow the connection and you are still getting permissions denied responses in the logs.  

I shared a few documents with you on the Chime call. Those documents are linked in the resources section, below [4, 5, 6].

I have limited access to troubleshoot this case from the other account, so my attempts are the best effort approach for the ECS tasks.  It may help if we open another case from the ECS account, however, please share the Account number, ECS Cluster name, and ECS service name and I will see if I can look into this other account, at all, from this case.  

I look forward to your response and I hope that you found our session and the information provided to be helpful.  Should you have any additional questions, you need only to respond to this case, and I will be happy to assist. 

Stay safe, healthy, and have a great day!

=====
Resources:
[1] https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html  : IAM tutorial: Delegate access across AWS accounts using IAM roles 
[2] https://aws.amazon.com/premiumsupport/knowledge-center/iam-assume-role-cli  : AWS IAM Assume Role CLI
[3] https://aws.amazon.com/premiumsupport/knowledge-center/ecs-fargate-access-aws-services  : Access other AWS services from my Amazon ECS tasks on Fargate
[4] https://aws.amazon.com/premiumsupport/knowledge-center/s3-cross-account-access-denied  : Troubleshooting S3 cross account issues
[5] https://aws.amazon.com/premiumsupport/knowledge-center/s3-access-key-error  : Resolve "The AWS Access Key Id you provided does not exist in our records."
[6] https://aws.amazon.com/blogs/containers/aws-fargate-launches-platform-version-1-4  : AWS Fargate launches platform version 1.4.0

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Jake S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9170754341&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/ngunasek@optum.com (Role)


Mon Nov 08 2021
22:23:12 GMT+0530 (India Standard Time)
Hi Jake,

Thanks for your time today. I tried adding full permissions to the destination bucket but that still did not solve the problem.

Thanks!


AWS_P0001489@optum.com


Mon Nov 08 2021
18:56:32 GMT+0530 (India Standard Time)
03:16:27 PM Jake S.: Hello, my name is Jake S.  I'm here to help you today.
03:16:49 PM Jake S.: May I have your name while I review the case details?
03:19:12 PM Jake S.: Also, may I have the ECS Cluster name and region?
03:23:21 PM Jake S.: From what I can tell, you are trying to use credentials to manage s3 objects from an ECS Fargate task.  This may be better and more secure if we use IAM task roles instead.  Have you tried using a task role?
03:23:38 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Hello
03:23:46 PM Jake S.: Hi
03:24:24 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: We are trying to make use of ECS Task role to do the actual copy
03:24:54 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Unfortunately, I don't have the setup in this account. But, I can show you over a call if that would be helpful.
03:25:11 PM Jake S.: Sure.  May I have your name?
03:25:21 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Sorry I'm Navaneethan here.
03:25:49 PM Jake S.: Nice working with you today, Navaneethan.  What cluster and region are we working with?
03:26:21 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: I don't have the cluster in this account. But, I can show the script that I'm using within it.
03:26:34 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: This is the account I'm using as a source account to pull the S3 files from
03:27:02 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: This is the role that I have created to assume from the ECS Task - arn:aws:iam::165387667510:role/crossaccount-s3access
03:28:59 PM Jake S.: Got it.  Does Chime work for you?
03:29:40 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: sure
03:29:57 PM Jake S.: Cool.  Let's meet here: https://chime.aws/5506139481 
03:31:22 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Sure

>>>>>>>>>>>>

83. Chat: how to rescan whenever we required

Hello, 

This is Fred from AWS Support, it was my pleasure chatting with you today. I am sending you this follow-up email as a summary of our conversation.

I understand that you wanted to know if you could manually begin an AWS Inspector assessment run.

During our chat, we went over how this can be done through console[1], or automatically through a Lambda function[2]. You then inquired to if there was any way for your account to initiate this assessment run considering your account does not have permissions to do that and unfortunately there is no way for you to run them as you do not have the required permissions. 

As you have no additional queries, I am going to mark this case as resolved.

I'm glad I was able to assist you with this matter and hope this information helps. If you have any additional questions, please don't hesitate to reach out.

Have a wonderful day ahead!

REFERENCES
==========
[1] https://docs.aws.amazon.com/inspector/latest/userguide/inspector_assessments.html#assessment_runs 
[2] https://docs.aws.amazon.com/inspector/latest/userguide/inspector_assessments.html#assessment_runs-schedule 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9158487951&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9158487951&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Fred G.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9158487951&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Nov 05 2021
17:22:28 GMT+0530 (India Standard Time)
11:54:31 AM Fred: Hello, my name is Fred.  I'm here to help you today. Who do I have the pleasure of speaking with today?
11:54:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi, How to rescan findings in inspector
11:55:31 AM Fred: I understand you are looking for a method to manually rescan resources with AWS Inspector. Is that understanding correct?
11:55:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
11:55:51 AM Fred: Great, please allow me a moment while I look into this for you.
11:58:56 AM Fred: So in order to run these assessments, you need to establish an assessment run (https://docs.aws.amazon.com/inspector/latest/userguide/inspector_assessments.html#assessment_runs ). This can be done through the AWS console. If you would like to automate when these runs occur, you can set up automatic runs through lambda (https://docs.aws.amazon.com/inspector/latest/userguide/inspector_assessments.html#assessment_runs-schedule ). 
11:59:10 AM Fred: Do you have any other queries for me today?
00:00:11 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment
00:01:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is there any straight way to run the assesment
00:01:43 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and for your note, i cannot run assessment from my account it is managed by master account.
00:02:08 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so how soon finding are updated in console (after we remediated it)
00:02:44 PM Fred: If your account is not privileged to run the assessments, unfortunately there is no way for you to run them as you do not have the required permissions.
00:04:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay how soon finding gets updated after remediatipon
00:04:35 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: *remediation
00:05:00 PM Fred: It would update soon after the assessment run is complete.
00:07:20 PM Fred: Is there any other queries I can help you with today?
00:12:49 PM Fred: Hello - Are you still there?
00:16:36 PM Fred: Hello - As this chat has been inactive for over 10 minutes, I will have to terminate it. Trust I will send a follow up email reviewing what we have gone over today.



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Nov 05 2021
17:22:10 GMT+0530 (India Standard Time)
how to rescan whenever we required

>>>>>>>>>>>>>>>>>>>>>>>

84. Chat: system manager does verify the windows updated on backend

Greetings,

Thank you for contacting AWS Premium Support. My name is Peter and it was a pleasure assisting you on chat today. Please allow me to provide a recap of our conversation today.

You opened this case as you had a question surrounding the documentation [1] which states "AWS does not test patches for Windows or Linux before making them available in Patch Manager".

While on chat I explained that AWS does not notify or monitor updates, AWS runs on a shared responsibility model.[2] AWS is responsible for patching and fixing flaws within the infrastructure, but customers are responsible for patching their guest OS and applications.

We recommend that you regularly patch, update, and secure the operating system and applications on your EC2 instances. [3] 

These Windows patches are thoroughly tested prior to release by the creators at Microsoft. AWS make these patches available to patch and AWS only provides Microsoft approved and verified updates to be patched.

You can use the AWS Systems Manager console to generate patch compliance reports that are saved as a .csv file to an Amazon Simple Storage Service (Amazon S3) bucket of your choice. You can generate a single on-demand report or specify a schedule for generating the reports automatically.  This can be achieved as per the following documentation. https://docs.aws.amazon.com/systems-manager/latest/userguide/patch-compliance-reports-to-s3.html 

I trust the information provided is beneficial and helps resolve your issue. If you feel no further action is needed then please feel free to mark the case as resolved. If you have any further questions please do not hesitate to ask.

Wishing you a good and safe day ahead.

[1] https://paragon-na.amazon.com/hz/view-case?caseId=9121807171#:~:text=https%3A//www.wellarchitectedlabs.com/operational-excellence/100_labs/100_inventory_patch_management/5_patch_mgmt/ 

[2] https://aws.amazon.com/compliance/shared-responsibility-model/ 

[3] https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/update-management.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Peter W.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9121807171&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Oct 28 2021
19:02:54 GMT+0530 (India Standard Time)
01:35:51 PM Peter: Hello, my name is Peter.  I'm here to help you today.
01:36:01 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: HI
01:36:06 PM Peter: May I take your name please?
01:38:48 PM Peter: I am just reviewing your case details now
01:43:19 PM Peter: I see you have a query surrounding "AWS does not test patches for Windows or Linux before making them available in Patch Manager" as per the documentation kindly provided 
01:45:35 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
01:46:04 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it really verifying the patches or just downloaded the patches and make it available to patch 
01:49:56 PM Peter: Please allow me to relay onto you that AWS does not notify or monitor updates, AWS runs on a shared responsibility model.[1] AWS is responsible for patching and fixing flaws within the infrastructure, but customers are responsible for patching their guest OS and applications.

We recommend that you regularly patch, update, and secure the operating system and applications on your EC2 instances. [2] 

These Windows patches are thoroughly tested prior to release by the creators at Microsoft. AWS make these patches available to patch.  


[1] https://aws.amazon.com/compliance/shared-responsibility-model/ 

[2] https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/update-management.html 
01:51:39 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so it wont verify the patches am i right ?
01:52:56 PM Peter: What do you mean exactly by verify? AWS only provides Microsoft approved and verified updates to be patched
01:53:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay 
01:53:33 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i got your point
01:53:51 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how to get patching logs in s3 bucket
01:54:49 PM Peter: No problem at all I am glad I can be of assistance. It is my understanding you would like to view patching logs in S3? 
01:55:19 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes right
01:57:13 PM Peter: You can use the AWS Systems Manager console to generate patch compliance reports that are saved as a .csv file to an Amazon Simple Storage Service (Amazon S3) bucket of your choice. You can generate a single on-demand report or specify a schedule for generating the reports automatically.  This can be achieved as per the following documentation. https://docs.aws.amazon.com/systems-manager/latest/userguide/patch-compliance-reports-to-s3.html  
01:58:06 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks 
01:58:22 PM Peter: You are most welcome, glad to be of assistance 
01:59:00 PM Peter: I will send a follow up email with a summary of our conversation today via email correspondence on this case
01:59:08 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks a lot
01:59:18 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am closing the cha
01:59:20 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: chat
01:59:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: have a good day
01:59:33 PM Peter: You are most welcome. Are you happy to mark the case as resolved when I follow up?



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Oct 28 2021
19:02:09 GMT+0530 (India Standard Time)
i saw there is warning in workshop document saying "AWS does not test patches for Windows or Linux before making them available in Patch Manager"

ref- link
https://www.wellarchitectedlabs.com/operational-excellence/100_labs/100_inventory_patch_management/5_patch_mgmt/ 

>>>>>>>>>>>>>>>>>>>>

85. Chat: EFS with Lambda fail with OS error

Hi,

We have mounted the EFS to the Lambda - onprem-filemoverupdate-sftp-filemover-lambda. When we are trying to upload and download files from EFS we are facing the below error:

OSError: [Errno 116] Stale file handle

Log group - 2021/10/28/[$LATEST]2c749393aee447218ed4e1304cba14b6

We are facing the issue when sending files more than 500 MB.

We are using pysftp in the Lambda to send files from S3 to our SFTP account.

Thanks!

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

86. Chat: UI filter to monitor Step function metrics

Hello Pravin, 

This is Ruying from AWS Premium Support. It was a pleasure to assist you today. I would like to summarize what we discussed in the chat and call today. 

I understand that you would like to know if its possible to filter certain information from Step Function execution history and export it to CloudWatch Dashboard. 

As we discussed over the chat, CloudWatch Logs Insights supports all types of logs. So if you have enabled logging for Step Function state machines [1], you will be able to use CloudWatch Logs Insights to interactively search and analyze your log data further. Regarding your specific use case, if you would like to calculate the execution count on a monthly basis, since each execution will generate a log stream in the log group, you could count the number of log streams in a certain log group for the period of a month. Also, if you would like to calculate the execution failures, you could filter the log by capturing the key word ExecutionFailed in the log messages. For more information regarding Log insights, you could refer to the documentation[2][3][4]. 

Additionally, you would like to know if its possible to hard code the log group to be run inside a query. From the console, you will need to manually select the log group, however, by using AWS CLI commend start-query, you could configure all information including log group name inside a single command. For more information regarding the AWS CLI commend start-query, please refer to the documentation[5]. Further, as I am from Lambda team and I have limited knowledge on the logs insights query and functionality, if you have additional questions regarding logs insights, I would suggest reaching out to the CloudWatch team, and an CloudWatch expert will be able to assist you further. 

As per your confirmation, I will go head and close the case. Please feel free to let us know if you have any other questions in the future. We will be more than happy to assist you further. Thank you again for contacting AWS Premium Support. Hope you have a great rest of your day!  

References: 
[1] https://docs.aws.amazon.com/step-functions/latest/dg/cw-logs.html 
[2] https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/AnalyzingLogData.html 
[3] https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_QuerySyntax.html 
[4] https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_QuerySyntax-examples.html 
[5] https://docs.aws.amazon.com/cli/latest/reference/logs/start-query.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Ruying S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9116462151&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Oct 27 2021
21:49:56 GMT+0530 (India Standard Time)
04:22:00 PM Ruying: Hello, my name is Ruying.  I'm here to help you today.
04:22:11 PM Ruying: May I have your name please? 
04:22:30 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi, My name is Pravin
04:23:02 PM Ruying: Thank you Pravin! Would you mind elaborating your use case a bit more? 
04:23:17 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes sure let me copy paste the requirement.
04:23:37 PM Ruying: Sure
04:24:15 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: looking for UI filter & groupby and see the trend of execution status sliced by member, datetime, execution_time. 
04:24:47 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: And the metrics would be Monthly step fucntion Execution Count by Execution Status
Which step fails a lot?
Which step takes longer time for execution and its trend by Member
04:26:21 PM Ruying: I see. Please give me one moment
04:27:01 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: sure
04:28:20 PM Ruying: May I ask if you would like to filter these information out with CloudWatch metrics? 
04:28:40 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes correct..
04:29:27 PM Ruying: Do you want all the information in one metric or you are fine for having those information in different metrics
04:30:52 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: actually the product teams have their scattered into different services like dynamo db, step function execution history and cloud watch logs. so is it possible to filter them into single dashboard
04:35:55 PM Ruying: So step function does not have a bulid-in feature to filter execution history or export them to a dashboard. As for the functionality of CloudWatch dashboard, since I am from step functions team and I have limited knowledge regarding the CloudWatch features, I would recommend you reaching out to the CloudWatch team to see if there's any features in CloudWatch side that might serve your goal. 
04:37:05 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: however, if step function execution history will be available in cloud watch log right ??
04:37:22 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Is it possible to get the details from there and filter ?
04:39:18 PM Ruying: If you have logging enabled for a state machine, then yes, the execution history will be stored in the CloudWatch logs. Further, by mentioning the filter, are your referring to the log insights? 
04:41:19 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes the basic requriement would be to find the SF montly execution count and status, step fails..
04:41:46 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: not sure if it can be captured through logs only or any thru step function feature
04:46:30 PM Ruying: Yes, so theoretically, you could use CloudWatch Logs Insights to filter all types of logs, including Step function execution history logs. And the supported fields are @timestamp, @ingestionTime, @logStream, @message, @log. For more information regarding CloudWatch log insights, you may refer to this documentation: https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/AnalyzingLogData.html 
04:47:17 PM Ruying: So how to generate the expected analytics reports, it all depends on how you build the log insight query
04:48:50 PM Ruying: For example, for execution count, you may count the number of log streams in a log group for the period of a month, since one log stream contains the execution history of one execution. 
04:49:33 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Is it fine for a quick chime call ?
04:49:41 PM Ruying: Yes sure
04:49:47 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Thanks..
04:50:31 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: you can ping me the chime link once it is created
04:50:42 PM Ruying: Please click to join the meeting: https://chime.aws/4150789499 



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Wed Oct 27 2021
21:49:46 GMT+0530 (India Standard Time)
Hi Team,

Looking for UI filter to monitor Step function metrics. Possibility to implement this with Cloudwatch dashboard.

Thanks,
Pravin

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

87. Chat: what is the use of patch group in patchbaseline

Hello Surendar, 

Greetings for the day!

Thank you for contacting AWS Premium Support. It was a pleasure chatting with you. 

As per our conversation on chat, you wanted to confirm if you would use maintenance windows, then "patch group" tag would be mandatory or not. Please find below the recap of our conversation:

Case Summary:
----------------------

	1. While on chat session, I confirmed you that "patch group" tag would not be mandatory for maintenance window. Maintenance Windows simply helps you define a schedule for when to perform potentially disruptive actions on your instances such as patching an operating system, updating drivers, or installing software or patches.
	2. Additionally you can refer to below mentioned video tutorial for more insights in to patching and patch group.
		a. https://www.youtube.com/watch?v=_RYL90VQgtI 
		b. https://www.youtube.com/watch?v=ABtwRb9BFY4&t=1s 

Additionally, should I have failed to address any other concern related to this case or if you have any questions, please do feel free to update the case correspondence with the same and I will be more than happy to work on this further.

Awaiting response.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Pradeep k.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9104869311&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Oct 26 2021
10:57:22 GMT+0530 (India Standard Time)
05:28:57 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
05:29:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
05:29:16 AM Pradeep Kumar: Hello, my name is Pradeep Kumar.  I'm here to help you today.
05:29:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have one requirment - patch multiple system with multiple patch baseline
05:29:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so what should i use - maintenance window or configure patching
05:30:03 AM Pradeep Kumar: Hello Surendar. Hope you are doing well !
05:30:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes I am fine, thanks. Hope you are doing great !!!!!!!
05:30:58 AM Pradeep Kumar: I am fine. Thanks for asking.
05:31:27 AM Pradeep Kumar: Regarding your query, Maintenance window would be good
05:31:43 AM Pradeep Kumar: Maintenance windows would help you with schedule.
05:32:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if i would use maintenance windows, then patch group tag is not mandatory , am i right
05:32:27 AM Pradeep Kumar: let me check on that.
05:32:31 AM Pradeep Kumar: Allow me a minute
05:32:39 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure
05:32:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we connect on chime session to discuss more about this
05:35:38 AM Pradeep Kumar: Tags would not be mandatory. Please refer to https://docs.aws.amazon.com/systems-manager/latest/userguide/maintenance-windows-targetless-tasks.html 
05:36:24 AM Pradeep Kumar: https://docs.aws.amazon.com/systems-manager/latest/userguide/mw-walkthrough-console.html 

(Optional) In the Manage tags area, apply one or more tag key name/value pairs to the maintenance window.
05:38:25 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Okay let me check and come back to you
05:38:32 AM Pradeep Kumar: Sure
05:38:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Just got to go on another call now. so closing this chat.
05:38:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks 
05:38:54 AM Pradeep Kumar: no issue. Have a great day ahead



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Oct 26 2021
10:56:27 GMT+0530 (India Standard Time)
Hi how patch group is useful in maintenance window

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

88. Chat: Need help in creating dev end point Note book from CLI

Greetings Pravin,

I hope you are well.

It was a pleasure assisting you on chat, I just want to follow up on what we discussed. You had 2 issues to regarding dev endpoint and Sagemaker creation, I shall address them below.


=================Python version in Dev Endpoint=====================

To resolve this I ran the below command which sets python version 3 on the environment. [1]

aws glue create-dev-endpoint --endpoint-name "endpoint0" --role-arn "roleArnHere" --number-of-nodes "2" --glue-version "1.0" --arguments '{"GLUE_PYTHON_VERSION": "3"}' --region "eu-west-1"

===================NoteBook setup through CLI===================

As of now we don't have a simple way of setting up sagemaker notebooks with dev enpoints as glue runs internal apis to help set this up. That said, since the notebooks themselves are just sagemaker notebooks, by using the same Lifecycle configuration scripts glue creates from console we can setup the notebooks through the CLI. 

This cloudformation template [2] automates the process of creating a DevEndpoint and associates a notebook with said endpoint. If we look at the YAML file, we can see the scripts used on the LifeCycleconfigurations for onStart and OnCreate. 

Note: I created a notebook from glue console to ensure the Life Cycle configurations scripts are the same 

Step 1:
For ease of reference I have attached the script (Lifecycle.sh) which you can use as the OnCreate and OnStart script, however you would need to change the endpoint name and endpoint region under "# MAKE CHANGES HERE !!!" in the script to your own endpoint and region.

Note: OnCreate and OnStart use the same script

Step 2:
Once you have altered the script you can create the Lifecycle config with with the below command. According to [3] The shell script must be a base64-encoded string.

aws sagemaker create-notebook-instance-lifecycle-config --notebook-instance-lifecycle-config-name CLI_lifecycle_config --on-create Content=$((cat Lifecycle.sh || echo "")| base64)  --on-start Content=$((cat Lifecycle.sh || echo "")| base64)

Step 3: 
Create the Notebook instance with the below command using the LifeCycleConfig created above. Also without the tags containing your endpoint name the notebooks will not show up under glue notebooks, but you will still be able to interact with the endpoint through the notebook.

aws sagemaker create-notebook-instance --notebook-instance-name aws-glue-notebookCLI --instance-type ml.t2.medium --tags Key=aws-glue-dev-endpoint,Value=EndpointName --role-arn-here role_ARN --lifecycle-config-name CLI_lifecycle_config

Once this is done you can now access your notebook and test.


=========================================================

I trust he above information helpful and should you have any other questions or concerns, please feel free to reach out to me and I'll be happy to address them

Have a great day!

References:
[1] Adding a Development Endpoint - https://docs.aws.amazon.com/glue/latest/dg/add-dev-endpoint.html 
[2]https://github.com/aws-samples/aws-glue-samples/blob/master/utilities/sagemaker_notebook_automation/glue_sagemaker_notebook.yaml 
[3]https://docs.aws.amazon.com/cli/latest/reference/sagemaker/create-notebook-instance-lifecycle-config.html 

To see the file named 'Lifecycle.sh' included with this correspondence, please use the case link given below the signature.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Vidushen R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9103961661&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Attachments
Lifecycle.sh

AWS_P0001489@optum.com


Mon Oct 25 2021
14:27:49 GMT+0530 (India Standard Time)
08:59:50 AM Vidushen: Hello, my name is Vidushen.  I'm here to help you today.
09:00:12 AM Vidushen: may I know your name
09:00:34 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi Vidhushen,
09:00:36 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am Pravin
09:00:44 AM Vidushen: how are you today Pravin
09:01:24 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am great. Hope you are doing good as well..
09:01:52 AM Vidushen: Im doing well thanks, I understand you would like some assitance creating a dev endpoint through the cli
09:03:38 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes. I need help in creating the Sagemaker Notebook from Dev endpoint client
09:05:11 AM Vidushen: have you created the endpoint already?
09:05:22 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes created 
09:05:32 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: devendpoint-pravin
09:06:46 AM Vidushen: okay let me just check the sagemaker apis needed for this
09:07:51 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes please
09:09:01 AM Vidushen: would you mind If I take this offline to test the sagemaker apis so I can give you the exact steps/commands needed
09:10:11 AM Vidushen:  I dont see glue having a create notebook api, so it has to be sagemakers api
09:10:37 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I hope you are clear with my requirement.
09:11:11 AM Vidushen: to confirm, you need to create sagemaker notebook and connect it to your dev endpoint through the cli
09:11:22 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: 1.I am trying to create the Devendpoint and also along with it need to create sage maker notebook below that ..
09:11:26 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Yes correct !!
09:12:08 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: 2. Also, when creating the Devendpoint from CLI need option to set python version as 3. I can only set glue version as 1.0
09:12:18 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: which defaults to python version 2.
09:12:30 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Need help in both these scenarios..
09:13:26 AM Vidushen: have you tried forcing glue version 2 or 3 in the glue version argument?
09:13:56 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes tried it thru terraform and it failed
09:14:08 AM Vidushen: okay I'll look into it as well
09:14:39 AM Vidushen: I'll update you on the case with my findings
09:15:02 AM Vidushen: and if you have any other questions or concerns, please feel free to reach out to me
09:15:18 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Sure.. you can test and update me
09:15:51 AM Vidushen: Thanks have a great day.. please feel free to close the chat
09:17:17 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: thanks



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Mon Oct 25 2021
14:27:33 GMT+0530 (India Standard Time)
HI TEAM,

Need help in creating dev end point Note book from CLI. And also not sure of the option of choose the python version 3 through CLI or terraform or any other tool.

Thanks,
Pravin
9944344850
Region: 
Dev Endpoint Name: devendpoint-pravin

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

89. Hello Surendar,

Greetings for the day! I hope you are well.
Thank you for your time over Chat and screenshare session.

You have initiated a chat as you have a requirement to patch the Dev environment and perform the testing in the patched environment, after which you will install patches to the production environment.

Over the chat, I have provided the information regarding how patches are installed and you can check the same using below documentation:-
[+] https://docs.aws.amazon.com/systems-manager/latest/userguide/patch-manager-how-it-works-installation.html 

Further we have discussed over the 1 month time period during which you will be performing the testing for which I have provided you the information that KB which are superseded will not be present in the WSUS server or in the Systems manager.

Also, we discussed over the days vs date approval in custom baseline in which we came to the point that using date you can specify the date till which you have tested and install the patches.

Further, we discussed about the patch group and the tags after which you were able to create and tag patch baseline and register in the Maintenance Window. Please refer below documentation for more information:-
[+] https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-patch-working.html 

Below I have elaborated on some key concepts of Systems Manager Patch Management to provide you with further guidance, namely:
1. Patch Baseline:
A patch baseline defines which patches are approved for installation on your instances. There are default patch baselines available, however you can also create your own custom patch baseline.  You can specify approved or rejected patches one by one. You can also create auto-approval rules to specify that certain types of updates (for example, critical updates) should be automatically approved. 
[+] https://docs.aws.amazon.com/systems-manager/latest/userguide/about-patch-baselines.html 

2. Patch Groups:
You can use a patch group to associate instances with a specific patch baseline.  A patch group is created using Tags as parameter. You create a patch group by using Amazon EC2 tags. A patch group must be defined with the tag key: Patch Group. Patch groups help ensure that you are deploying the appropriate patches, based on the associated patch baseline rules, to the correct set of instances. You can create different patch groups as per the environment, for e.g. Dev, Test, Prod etc. This helps you to perform all patching on non-prod instances first and only then on the prod instances. 
[+] https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-patch-patchgroups.html 

3. Maintenance Windows:
AWS Systems Manager Maintenance Windows let you define a schedule for when to perform potentially disruptive actions on your instances such as patching an operating system, updating drivers, or installing software or patches. Maintenance Windows lets you decide a suitable time period when there is low impact on production and you can patch the instances.
[+] https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-maintenance.html 

Using Patch Baseline, Patch Groups and Maintenance Windows you can set up your patch management and it will be a completely automated process. If you use AWS-RunPatchBaseline document with your Maintenance Window, you can then review the compliance reports generated on SSM. 
Please review this blog which explains patching windows instances with step by step details:
[+] https://aws.amazon.com/blogs/mt/patching-your-windows-ec2-instances-using-aws-systems-manager-patch-manager/ 

Additionally, I have linked an SSM best practices and use-cases document below [1], which I trust you will find useful. I would also highly recommend you follow the steps outlined in the blog ("Patching your Windows EC2 instances using AWS Systems Manager Patch Manager") linked above, it provides detailed guidance on the step up process and it can also be applied to EC2 instances. 

As discussed I am marking as this case as resolved, if you have any further query please reach out to us with new case so that all your queries can be answered effectively.

Thank you and have a great day ahead!  

References:-
==========================
[1] Use cases and best practices:- https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-best-practices.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Anuj R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9103125421&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Mon Oct 25 2021
11:17:45 GMT+0530 (India Standard Time)
05:49:10 AM Anuj: Hello, my name is Anuj.  I'm here to help you today.
05:49:18 AM Anuj: May I know your name please.
05:50:22 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surenda
05:50:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: surendar
05:50:29 AM Anuj: Hi Surendar
05:50:36 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have setup the patch manager for windows 
05:51:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i want to know what updated are installed 
05:51:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and also how to apply old updates through package manager
05:51:52 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: also i just wanted to understand the patch group tag
05:52:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so it is possible to have session, so that i can show my setup
05:53:03 AM Anuj: Please allow me a moment, Generating a link.
05:54:18 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
05:54:27 AM Anuj: Can you join below URL
05:54:28 AM Anuj: URL link:
https://chime.aws/6707195763 
05:54:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joining in
07:12:47 AM Anuj: Thank you and have a nice day!



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Mon Oct 25 2021
11:15:02 GMT+0530 (India Standard Time)
how to run windows update

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

90. Call: SageMaker Notebook need to be added to Devpoint

Hello Pravin,

Thanks for your time on call today. To summarize our conversation, you reached out to Premium Support as you are looking to attach glue dev endpoint when creating notebook instance in Sagemaker console. As we saw that it is currently not possible to attach it from sagemaker notebook instance. You can attach it in Glue console using notebook featute under Glue dev endpoints. I hope you got the information needed.

As agreed I am closing this case. Should you have any other queries, feel free to open a case with Premium Support.

Have a good day ahead!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Rakesh Reddy B.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9093160401&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Fri Oct 22 2021
20:32:04 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Praveen,

You have been invited to an online meeting, powered by Amazon Chime.

Click to join the meeting: https://chime.aws/7077697029 
Meeting ID: 7077 69 7029
A headset is recommended or you may use your computers microphone and speakers.

Call in using your phone:
United States Toll-Free (1): +1 855-552-4463
Meeting ID: 7077 69 7029
One-click Mobile Dial-in (United States (1)): +1 206-462-5569,,,7077697029#
United States (1): +1 206-462-5569
International: https://chime.aws/dialinnumbers/ 
Dial-in attendees must enter *7 to mute or unmute themselves.

To connect from an in-room video system, use one of the following Amazon Chime bridges:
SIP video system: 7077697029@meet.chime.in  or meet.chime.in
H.323 system: 13.248.147.139 or 76.223.18.152
If prompted enter the Meeting PIN: 7077697029#

Download Amazon Chime at https://aws.amazon.com/chime/download 
For information about creating an Amazon Chime account, see https://aws.amazon.com/chime/getting-started 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Rakesh Reddy B.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9093160401&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Fri Oct 22 2021
20:17:50 GMT+0530 (India Standard Time)
Hi Team,

SageMaker Notebook need to be added to Devpoint. However, when creating the SageMaker Notebook it was not possible. 

I tried creating notebook from Glue Devedpoint and able to attach it.

Thanks,
Pravin
Region name  optional: 
Notebook ARN  optional: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

91. Chat: is it possible to use server shared drive in lambda

Hello Surendar, 

Thank you for contacting AWS Premium Support. It was a pleasure assisting you on the chat today. Here is a quick summary of our discussion. 

You had reached out to us with a few queries regarding temporary storage options available in AWS Lambda. You had a setup similar to below: 

=========================

S3 ==> Lambda (/tmp) ==> SFTP server 

=========================

However, the above setup was not working when the file size were greater than 512 MB. Hence you were looking for alternatives to store the file temporary. 

To assist with the issue, I did some research on my end. I informed you that AWS Lambda includes a 512-MB temporary file system for your code, this is an ephemeral scratch resource not intended for durable storage. To store files that are large in size we can use Amazon EFS for AWS Lambda in your serverless applications. Please refer to below blog post for more details regarding setting up Amazon EFS with AWS Lambda. 

https://aws.amazon.com/blogs/compute/using-amazon-efs-for-aws-lambda-in-your-serverless-applications/ 

However, you were wondering if it would be possible to directly store files of size greater than 512MB in the SFTP server without using EFS with lambda. Unfortunately since the /tmp storage size 512 mb is a hard limit it cannot be increased. Therefore, in order to have more storage at Lambda, we would require to mount and EFS with the lambda function. Please refer to [1] for more information about lambda quotas. Further, I also shared another AWS blog post that discusses choosing between AWS Lambda data storage options in web apps : 

https://aws.amazon.com/blogs/compute/choosing-between-aws-lambda-data-storage-options-in-web-apps/ 

I hope the above information is beneficial to you. With your permission I am marking the case as resolved. 

In case you feel I missed out to address something more to your concern, or if I can otherwise provide any additional assistance with regard to this matter, please do not hesitate to let me know and I will be happy to work ahead with you until everything is successfully addressed.

Have a great day ahead.  

References : 
[1] https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Suraj T.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9092020831&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Oct 22 2021
14:28:05 GMT+0530 (India Standard Time)
09:01:47 AM Suraj T: Hello my name is Suraj, and I will assist you regarding this case. May I have your name please?
09:02:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar
09:02:43 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have one issu 
09:02:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: issue
09:03:06 AM Suraj T: Hello Surendar hope you are doing well. 
09:03:10 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we are copying files from S3 to on prem sftp server using lambda function 
09:03:18 AM Suraj T: Okay
09:03:33 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes, i am doing good thanks.. hope you are doing great
09:04:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: when we copy file which below 500 MB it is working, if file size is more than 512 MB it is failing 
09:04:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because lambda's /tmp size is 512 MB only
09:04:42 AM Suraj T: right 
09:04:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so is there any way we can use efs or other shared mount points in lambda
09:04:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: for /tmp
09:05:18 AM Suraj T: Yes, you can mount an EFS to your lambda function for additional storage 
09:05:29 AM Suraj T: https://aws.amazon.com/blogs/compute/using-amazon-efs-for-aws-lambda-in-your-serverless-applications/ 
09:05:42 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we can increase /tmp size right
09:05:46 AM Suraj T: No
09:06:03 AM Suraj T: /tmp size would always be only 512 MB only 
09:06:26 AM Suraj T: But you can access your EFS and store and retrieve files from EFS 
09:06:58 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we can download files from efs and we can transfer to on prem sftp am i right
09:07:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: instead of EFS can we use on prem sftp
09:08:11 AM Suraj T: Please allow me a few moments to research on this 
09:09:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure sure
09:11:26 AM Suraj T: From what I understand your current setup is : 

S3 ==> Lambda (/tmp) ==> SFTP 

We discussed : 

S3 ==> Lambda (EFS) ==> SFTP 

You are now wondering the possibility for : 

S3 ==> Lambda ==> SFTP 

directly ? 
09:11:56 AM Suraj T: is my understanding correct ? 
09:12:21 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
09:13:03 AM Suraj T: Unfortunately that would not be possible, since the lambda would need to download the file from S3 and save it to a location 
09:13:31 AM Suraj T: If there is no EFS attached, lambda would not be able to store files of size > 512 MB (max limit for /tmp)
09:13:49 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: then EFS charges will occurs
09:14:41 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we just want temporary storage for this 
09:14:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is there any other way
09:17:03 AM Suraj T: I am checking if there are any alternative approaches for your use case 
09:17:54 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
09:19:43 AM Suraj T: I am not able to find alternate temporary storage options for lambda other than EFS and /tmp
09:19:43 AM Suraj T: https://aws.amazon.com/blogs/compute/choosing-between-aws-lambda-data-storage-options-in-web-apps/ 
09:23:40 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay thanks 
09:23:48 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we can close the chat 
09:23:59 AM Suraj T: Okay, do you have any other queries ? 
09:24:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: No 
09:24:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank you
09:24:18 AM Suraj T: Shall I mark the case as resolved on your behalf? 
09:24:21 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
09:24:27 AM Suraj T: Okay, thanks for confirming 
09:24:33 AM Suraj T: I am closing this chat session for now. I will share a short summary of our discussion via email.
09:24:39 AM Suraj T: Thank you for your time. Have a great day ahead! 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Oct 22 2021
14:27:51 GMT+0530 (India Standard Time)
is it possible to use server shared drive in lambda
Function Name/ARN: 

>>>>>>>>>>>>>>>>>>>>>>

92. Chat: SQS Client not on ec2 instance not able to talk to SQS

Hello Saroja,

Its Rick again from AWS Premium Support. Thank you for your time on the chat session earlier, it was a pleasure chatting with you.

You were reaching out regarding an issue where SQS client failed to load AWS credentials.

This error means AWS SDK for Java failed to find AWS credentials by using the default credential provider chain [1]. For AmazonSQSClientBuilder standard client you would need to explicitly specify credentials as show in [2]. Switching to defaultClient [3] resolved the issue.

Moving further, I have done some research regarding JAVA dependency after the chat. As Spring Cloud AWS Messaging module has included the AWS Java SDK for Amazon SQS module, there shouldnt be any issue using this module for SQS client. However Amazon SDK is released more frequently than Spring Cloud AWS. If you need to use newer version of AWS SDK than one configured by Spring Cloud AWS you would need to add AWS SDK BOM to dependency management section as shown in [5].

Hope the above information is of help to you. Please feel free to reach back for any other queries or concerns, I will be more than happy to help!

References:
[1] Using the Default Credential Provider Chain: https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html#credentials-default 
[2] Explicitly Specifying Credentials: https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html#credentials-explicit 
[3] public static AmazonSQS defaultClient(): https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/sqs/AmazonSQSClientBuilder.html#defaultClient-- 
[4] What's different between the SDK for Java 1.x and 2.x: https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/migration-whats-different.html 
[5] Amazon SDK dependency version management: https://cloud.spring.io/spring-cloud-aws/reference/html/#amazon-sdk-dependency-version-management 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Rick X.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9089760461&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Oct 22 2021
05:18:44 GMT+0530 (India Standard Time)
11:51:36 PM Rick: Hello, my name is Rick.  I'm here to help you today.
11:52:47 PM Rick: Hi Saroja, how are you today?
11:55:14 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Hi Rick, I am doing fine, how about you?
11:55:45 PM Rick: I'm doing good!
11:56:25 PM Rick: I see the sqs java client built on ec2 instance was unable to connect to SQS, is that correct?
11:57:48 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: yes, I was using standard() client, seems like I have to use defaultClient?
11:58:47 PM Rick: I'm not familiar with JAVA, please allow me a moment to check the SDK docs
11:59:05 PM Rick: The error means the client could not find credentials in any of the places the DefaultAWSCredentialsProviderChain looks at
11:59:19 PM Rick: SDK has a credential resolution logic to resolve the aws credentials to use when interacting with aws services
11:59:52 PM Rick: Please refer to this: https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html#credentials-default 
00:01:50 AM Rick: I have checked the sample code for JAVA SDK to connect to SQS in the following link and it was using defaultClient() : https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/examples-sqs-message-queues.html#sqs-create-queue 
00:05:41 AM Rick: According to the SDK doc, AmazonSQSClient() has been deprecated and you need to use AmazonSQSClientBuilder.defaultClient()
00:05:45 AM Rick: https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/sqs/AmazonSQSClient.html#AmazonSQSClient-- 
00:05:45 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: I tried using        AmazonSQS sqs = AmazonSQSClientBuilder..standard().withRegion("us-east-1").build();
 but I got error
00:06:59 AM Rick: It seems standard client doesnt use the Default Credential Provider Chain
00:07:19 AM Rick: Can you please try again using defaultClient()?
00:07:55 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: trying now
00:08:39 AM Rick: Thank you, I will be waiting for the result
00:13:11 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: its working fine
00:13:38 AM Rick: Awesome
00:13:43 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: One qq - can sdk version1 and 2 work together?
00:14:24 AM Rick: I think for standard() client you would need to explicitly specify credentials like the example here: https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html#credentials-explicit 
00:15:03 AM Rick: The answer should be no, but I would need to further confirm that
00:15:47 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: ok, version one willl have upgraades sttill right, this is not going to be deprecated right?
00:16:48 AM Rick: That's correct, current we dont have plans for depreaction of Java 1.x 
00:17:05 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: we are using spring provided  dependency <!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-aws-messaging  -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-aws-messaging</artifactId>
    <version>2.2.5.RELEASE</version>
</dependency>

00:17:50 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: is this the recommended approach or we better to use direct Amazon dependencies?
00:20:45 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: like <!-- https://mvnrepository.com/artifact/com.amazonaws/aws-java-sdk-sqs  -->
<dependency>
    <groupId>com.amazonaws</groupId>
    <artifactId>aws-java-sdk-sqs</artifactId>
    <version>1.12.90</version>
</dependency>

00:22:16 AM Rick: I dont think there would be much difference if you are not encouraging any issues, but I would suggest to use direct Amazon dependencies 
00:22:53 AM Rick: I will reach out to SDK team for further insights after  the chat and update you via email
00:23:35 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Sure, that would be helpful 
00:23:40 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: thank you
00:23:44 AM Rick: No worries!
00:23:53 AM Rick: Do you have any other questions for me right now?
00:24:54 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: no, I am good
00:24:56 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: thank you
00:25:09 AM Rick: No problem!
00:25:15 AM Rick: Have a good day then!
00:25:23 AM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: you too
00:25:31 AM Rick: Feel free to close the chat when you are ready
00:25:35 AM Rick: Bye!



AWS_165387667510_Owner/sarojani.macharla@optum.com (Role)


Fri Oct 22 2021
05:18:39 GMT+0530 (India Standard Time)
Hi,

Trying to create SQSClient        AmazonSQS sqs = AmazonSQSClientBuilder.standard().withRegion("us-east-1").build();
using 		<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-aws-messaging</artifactId>
			<version>2.2.5.RELEASE</version>
		</dependency>
dependency in maven project but getting  below error
"
com.amazonaws.SdkClientException: Unable to load AWS credentials from any provider in the chain: [EnvironmentVariableCredentialsProvider: Unable to load AWS credentials from environment variables (AWS_ACCESS_KEY_ID (or AWS_ACCESS_KEY) and AWS_SECRET_KEY (or AWS_SECRET_ACCESS_KEY)), SystemPropertiesCredentialsProvider: Unable to load AWS credentials from Java system properties (aws.accessKeyId and aws.secretKey), com.amazonaws.auth.profile.ProfileCredentialsProvider@7c57ac40: profile file cannot be null, "
 NOTE: Ec2 's role has fullsqs permissions

Another application which is using version2 SDK is working fine with Ec2 instance role with below code                  
 SqsClient sqsClient = SqsClient.builder()
                          .region(Region.US_EAST_1)
                          .build();


thank you
Saroja
SDK Language and Version: Java SDK1 (spring-cloud-aws-messaging 2.2.5)
Queue ARN ( if applicable ): 
Operation Name ( if applicable ): 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

93. Chat: how to update window update using patch manager

Hello Surendar,

Thank you for your time on the chat today. It was a pleasure assisting you. Please find this email as the recap of our conversation.

You reached out to us today to understand how to set up Patching activity on your EC2 instances in the us-east-1 region using SSM Patch Manager feature.

During the chat and later on chime call, I helped you with a walkthrough the SSM Patch Manager console to guide how to configure patching. We also walked through the Maintenance Window creation process as well as had a good review of how to create Patch Baselines to be used for patching the instances.

As I mentioned on the call, you will be able to find all the required information about the terms and the process how Patch Manager works in the below public documentation.

https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-patch.html 

In addition to this, I also mentioned that you can use "Patch Groups" to group your instances together using the Tag Key as "Patch Group" and associate different patchbaselines with the Patch Groups.

In order to address your query on patching your instances with a time gap of 1 or months, I would advise you to configure two different Patch Manager tasks by associating different Patch Group or Instances directly with them. You can also do a one off patching activity by targeting individual instances each time. This is because within the same Maintenance Window, there is no option to allow a time gap. You can control the number of targets receiving the patches but that would not solve your purpose.

In order to configure patching, the steps will look like below:

1. Create Patch Group (Optional) or you can patch individual instances as well.
	
	https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-patch-group-tagging.html#sysman-patch-group-tagging-ec2 

2. If using Patch Group, then add Patch Baselines to them.

	https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-patch-group-tagging.html#sysman-patch-group-patchbaseline 
	
3. Create a Maintenance Window.
	
	https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-maintenance-create-mw.html 
	
4. Navigate to the Patch Manager window and click on Configure patching.
	
	4.a) While configuring patching, select the patch group or manually select instances.
	4.b) Select the maintenance window created in step3
	4.c) Advanced setting, select the patch baseline associated with the path group
	
When we configure patching operation with steps above and select the Maintenance Window with it, the configuration automatically creates and registers a Maintenance Window task for AWS-RunPatchBaseline Run_Command document and adds the targets as well so you do not have to do these steps manually.
	
Once the Patching operation is configured, this will initiate itself on the scheduled Maintenance Window and runs the operations you have configured which could be either both Scan and Install or just scan.

I hope you find this information useful. I see that you have resolved the case, hence I will keep it in the same state. For any further assistance, please feel free to reach out to us again. Thank you for your time today.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Shilpi V.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9087142841&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Thu Oct 21 2021
17:36:13 GMT+0530 (India Standard Time)

Translate
This case has been resolved. Please contact us again if you need further assistance.


AWS_P0001489@optum.com


Thu Oct 21 2021
15:47:27 GMT+0530 (India Standard Time)
10:18:54 AM Shilpi: Hello, my name is Shilpi.  I'm here to help you today.
10:19:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
10:19:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I want to know how to update the windows EC2 server using patch manager
10:19:43 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have a quick call to understand it better...
10:20:39 AM Shilpi: Hello Surendar, I hope you are doing good. 
I understand you would like to have a call but I do not believe we need it at the minute.
I see you are looking for guidance on updating windows using PatchManager.
10:21:06 AM Shilpi: Have you configured your instances as SSM Managed already? If so, what is the region for the instances?
10:21:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: us-east-1
10:21:33 AM Shilpi: thank you, just pulling up few details at my side for your environment.
10:21:59 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure
10:27:43 AM Shilpi: Thanks Surendar, I see you only have a single windows instance at minute with SSM.
You can use PatchManager feature to patch your instances. You can as well schedule Patch Manager to run at specific time when you would like to install patches to the instances.
Patch Manager uses Patch Baselines to filter which patched to apply,. You can use the default PatchBaseline provided by AWS or you can create your custom baseline as well as per your requirements.

This documentation here has all the information on the use of Patch Manager: https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-patch.html 

Since this quite a vast topic, do you have any specific questions for me that I can help you with ?
10:29:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment
10:30:15 AM Shilpi: Sure
10:37:22 AM Shilpi: Are you there ?
10:41:21 AM Shilpi: It looks like you stepped away, I will wait a few minutes and then I will unfortunately have to terminate this chat for lack of communication.
10:41:55 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sorry
10:42:02 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: let me check the document 
10:43:24 AM Shilpi: Sure, its just that it will take you some time to give it a read.
Here is another document with walkthough but its only for applying security related patches. This will you an idea but you can of course make changes as per your requirment: https://docs.aws.amazon.com/systems-manager/latest/userguide/service-pack-patch-walkthrough.html 
10:43:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i read through the document but just wanted to know how it can suits my environment
10:44:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we can have a call
10:44:10 AM Shilpi: okay, lets get on a call.
10:44:16 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it possible
10:44:25 AM Shilpi: let me get the meeting link
10:45:57 AM Shilpi: Here you go: https://chime.aws/9304675156 
10:47:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joining in
10:47:52 AM Shilpi: ok
10:47:53 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: two min



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Oct 21 2021
15:45:13 GMT+0530 (India Standard Time)
how to update window update using patch manager


>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

94. Chat: How to update OS patches without downtime while Database is running

Hello Surendar 

Thanks for your time on chat and call today 

You reached out as you wanted to know if there is any want to update database servers without rebooting them or with any downtime. 

Please note, not all Windows updates required reboot.  Only the updates which are doing changes to system level files require a reboot as they cannot make any changes when the OS is up and there are active handles on these binaries. 

Broadly, any roll-up updates will require a restart, however some security patches do not. Additionally, even if you install these patches, they are placed in a pending state and will not restart automatically unless specified. Once you have a downtime window, you can restart these servers which is when pending updates will take effect.  You can read more about this process in Microsoft article below: 
https://docs.microsoft.com/en-us/troubleshoot/windows-server/deployment/why-prompted-restart-computer 

Additionally, you wanted to know if there is a way to ensure 0 downtime on database while you perform the update. I checked online for different scenarios in which this can be achieved and one of the ways is to put your database server in high availability group like always on group.  You can read more about the same here: 
https://docs.microsoft.com/en-us/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server?view=sql-server-ver15 

Features such as rolling upgrade can be used for SQL upgrades and includes database being shared between multiple nodes and if one of the node needs to be restarted it automatically gets transferred to a different functioning node: 
https://docs.microsoft.com/en-us/sql/database-engine/availability-groups/windows/upgrading-always-on-availability-group-replica-instances?view=sql-server-ver15 

This can be implemented in EC2 using the following link: 
https://aws.amazon.com/premiumsupport/knowledge-center/ec2-windows-sql-server-always-on-cluster/ 
https://aws.amazon.com/blogs/storage/simplify-your-microsoft-sql-server-high-availability-deployments-using-amazon-fsx-for-windows-file-server/ 

High availability can also be ensured using Amazon RDS databases and you can read more about the same here: 
https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.MultiAZ.html 

Please note, being part of windows team I have limited knowledge on databases but you can reach out to our database team for additional queries. I trust these details will help, do let me know if you have any queries or concerns 

Have a pleasant day ahead !!  

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Snehil V.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9081713621&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Oct 20 2021
16:58:46 GMT+0530 (India Standard Time)
11:30:12 AM Snehil  V.: Hello, my name is Snehil  V..  I'm here to help you today.
11:30:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: HI
11:30:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
11:30:35 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need some suggestion on OS patching
11:30:51 AM Snehil  V.: Hi Surendar
11:30:56 AM Snehil  V.: sure
11:31:03 AM Snehil  V.: quickly checking the case
11:31:11 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Instance is running with Database
11:31:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i mean database is running on Instance 
11:31:40 AM Snehil  V.: ok
11:31:55 AM Snehil  V.: and you want to install pacthes
11:31:56 AM Snehil  V.: what kind of patches are we discussing here ? 
Are these rollup updates or security updates
11:33:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: both
11:33:27 AM Snehil  V.: and you want to install those without rebooting ?
11:33:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
11:33:47 AM Snehil  V.: can we get on a call ?, to better understand this
11:33:51 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure sure
11:34:04 AM Snehil  V.: give me a minute here, creating link for you 
11:34:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
11:34:35 AM Snehil  V.: https://chime.aws/2776192666 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Oct 20 2021
16:58:06 GMT+0530 (India Standard Time)
How to update OS patches without downtime while Database is running
Instance ID(s): 
Volume ID(s): 
Timestamp (YYYY-MM-DD HH:MM:SS UTC): 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

95. Create PHD notifications

Hello,

I'm pleased to inform you that a mock PHD event has been generated as required with below details.

Event: Health operational issue
Details: This is a test AWS Health Event AWS_HEALTH_OPERATIONAL_ISSUE
Event category: Issue

+ As a result, I can see the event rule "aws-health-notifier-testing" triggered and invoked the target lambda function 'arn:aws:lambda:us-east-1:165387667510:function:modern-flounder-lambda-PHD' at 2021-10-18 04:40 UTC as seen in the below graph.

https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#metricsV2:graph=~(metrics~(~(~'AWS*2fEvents~'FailedInvocations~'RuleName~'aws-health-notifier-testing)~(~'.~'Invocations~'.~'.) )~view~'timeSeries~stacked~false~region~'us-east-1~start~'-PT1H~end~'P0D~stat~'Sum~period~60);query=~'*7bAWS*2fEvents*2cRuleName*7d*20aws-health-notifier-testing

+ I could also see the target lambda function invoked at 2021-10-18 04:40 UTC as seen in the below graph.

https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#metricsV2:graph=~(metrics~(~(~'AWS*2fLambda~'Invocations~'FunctionName~'modern-flounder-lambda-PHD)~(~'.~'Errors~'.~'.) )~view~'timeSeries~stacked~false~region~'us-east-1~stat~'Sum~period~60~start~'-PT1H~end~'P0D);query=~'*7bAWS*2fLambda*2cFunctionName*7d*20modern-flounder-lambda-PHD

+ From the above outcomes, it looks like the setup is working fine from CloudWatch perspective. Please, confirm the same on your end.

I trust the information provided to be helpful and addresses your concern. Feel free to reach out to us in case of difficulties.

Have A Good Day!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Moin N.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9067490091&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Mon Oct 18 2021
09:28:13 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Pravin,

Thank you for providing details.

I'll reach out to our internal team to have a mock PHD event created in us-east-1 region for this account. Will let you know once I have updates. Expect your patience in this regard.

Meanwhile, flipping the status of this case to 'Pending Amazon Action'. Feel free to reach out to us in case of difficulties.

Have A Good Day!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Moin N.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9067490091&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Mon Oct 18 2021
09:22:52 GMT+0530 (India Standard Time)
Hi Moin,

Below are the details,

event rule name - aws.health

I have updated this in the event rule in order to receive any PHD notifications. Also have created Lambda as a target to receive the payload and send out mails to distribution list. Currently I have created this into US-EAST-1.

Thanks,
Pravin

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

96. Chat: What dependency I need to choose to use Glue in Spring boot application

Hi Saroja,

It was a pleasure talking with you.

You have raised a chat in regards to connecting to SQS from an EC2 instance using AWS Java SDK version 1.

We are observing authorized error while trying to run the code, so we added SQS full access policy to the IAM role attached to the EC2 instance. Even then we are observing the same error as previously.

So I would recommend you to raise a new case with the SQS team as they have better knowledge regarding the issue.

Please let me know if you have any issues regarding Glue and I am happy to assist you.

Have a great day ahead.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Tarun Y.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9051271561&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Oct 22 2021
05:01:48 GMT+0530 (India Standard Time)
11:33:36 PM Tarun Y: Hi Saroja, 
11:33:49 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: Hi Tarun, getting same error
11:33:53 PM Tarun Y: So you are getting same error even with the IAM role attached.
11:34:10 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: yes
11:34:17 PM Tarun Y: Okay. Is it possible to raise an issue with the SQS team ?
11:34:41 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: I attached SQSFull permissionspolicy ti Ec2 role
11:34:51 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: sure
11:34:59 PM Tarun Y: I will keep this case open until we figure out the real issue.
11:35:54 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: So, you are asking me to reach out?
11:36:08 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: or you will be reaching to that tteam now?
11:36:37 PM Tarun Y: Yes, it is easy to raise a new case from your side with SQS as it directly goes to that teams queue.
11:36:56 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: ok
11:36:59 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: thank you
11:37:35 PM Tarun Y: Nws. Please let me know the new case id so that I will be looking into it as well.
11:38:05 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: sure
11:39:07 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: You want me post that Id in this case 
11:39:18 PM Tarun Y: Yes.
11:39:22 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: ok
11:39:37 PM assumed-role/AWS_165387667510_Owner/sarojani.macharla@optum.com: We can disconnect now right?
11:39:42 PM Tarun Y: Sure.
11:39:50 PM Tarun Y: Bye.



AWS_165387667510_Owner/sarojani.macharla@optum.com (Role)


Fri Oct 22 2021
05:01:43 GMT+0530 (India Standard Time)
Hi Tarun, 
Getting same after updating Ec2 role permissions.

Thank you
Saroja

>>>>>>>>>>>>>>>>>>>>>

97. Chat: cannot set JWKS url manually

Hello, 

Thank you for contacting AWS premium support. My name is Donald and I am happy to assist you today. 

It is my understanding that you will like to secure your distribution using OpenID connect and Secrets manager but you are getting an error on your JWT token and as a result you need assistance in figuring this out. 

In order to better understand your issue and try to replicate in my environment, I will like yo to share the following information with me. 

- The complete error message being returned or at least the cloudFront request ID for the failing request.
- A HAR capture of the failing request from your browser[1].

It also appears we might have missed your chat. Please feel free to reinitiate a live chat or call and the next available engineer will be able to assist you. 

References
========
[1] https://aws.amazon.com/premiumsupport/knowledge-center/support-case-browser-har-file 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Donald A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9043442101&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Oct 13 2021
17:18:08 GMT+0530 (India Standard Time)
i am following the document https://aws.amazon.com/blogs/networking-and-content-delivery/securing-cloudfront-distributions-using-openid-connect-and-aws-secrets-manager/ 


i got error on JWT token

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

98. Chat: Cannot create cloudfront distribution getting error

Hello,

Greetings for the day!!

Thank you for contacting AWS Premium Support. My name is Rahul and I will be assisting you with this case today.

From the case notes , I understand that you are facing the error: "resource CFDistribution with message:#/DistributionConfig: required key [Enabled] not found create: [CFDistribution]. Rollback requested by user." in CloudFormation.
You would like to know the reason and fix for this issue. Please correct me if I have misunderstood anything here.

In order to check more on this, I checked the CloudFormation stacks in your account but I was not able to locate the stack with this error. From the error , it seems like you were trying to create a cloudFrontDistribution resource, please correct me if I am mistaken here.

From the error message , I understand that under 'AWS::CloudFront::Distribution'[1] resource we have 'DistributionConfig' property and under that we have 'Enabled' property [3], it seems like this 'Enabled' property was not specified in the template. As this property is mandatory to specify so if we dont specify it ,the distribution will fail to create.

In order to confirm this , I created a CloudFront distribution resource using the template[4]. Next , I removed the property 'Enabled' from the template (AWS::CloudFront::Distribution-> DistributionConfig -> Enabled) and I also got the same error :

Properties validation failed for resource CloudFrontDistribution1 with message: #/DistributionConfig: required key [Enabled] not found

In order to fix the issue , please provide the above property in the template. Here is a short snippet for reference:
************************

CloudFrontDistribution1:
  Type: AWS::CloudFront::Distribution
  Properties:
    DistributionConfig:
      Enabled: true       <------ please specify this property
      Aliases:
      - !If [ WPDomainName, !Join [ '', [ '*.', !Ref WPDomainName ] ], !Ref 'AWS::NoValue' ]
      CacheBehaviors:
      - PathPattern: wp-includes/*
        AllowedMethods:
        - DELETE
        ......
        .....

**********************

I hope the above information is helpful. In case if you have any queries or concerns or if the issue persists , please share the stack ARN with me or the template so that I can assist you further.
Wishing you a great day ahead:)

References:
[1] AWS::CloudFront::Distribution
https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudfront-distribution.html 

[2] AWS::CloudFront::Distribution DistributionConfig
https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-cloudfront-distribution-distributionconfig.html 

[3] Enabled
https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-cloudfront-distribution-distributionconfig.html#cfn-cloudfront-distribution-distributionconfig-enabled 

[4] aws-refarch-wordpress-04-cloudfront.yaml
https://github.com/aws-samples/aws-refarch-wordpress/blob/master/templates/aws-refarch-wordpress-04-cloudfront.yaml 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Rahul D.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9042117961&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Wed Oct 13 2021
17:16:54 GMT+0530 (India Standard Time)

Translate
This case has been resolved. Please contact us again if you need further assistance.


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Oct 13 2021
11:51:00 GMT+0530 (India Standard Time)
resource CFDistribution with message:#/DistributionConfig: required key [Enabled] not found create: [CFDistribution]. Rollback requested by user.
Stack ID(s) / Stack ARN: 

>>>>>>>>>>>>>>>>>>>>>>>>

99. Chat: is it possible to place source code in s3

Hi,

Thanks for your time over chat session.

I see you are looking to add your custom code to s3 bucket to be used by cloud front as Lambda Edge function has a limitation for code size as seen in [1]

While on chat, you did mention that you are trying to use viewer request function and your code is around 90 MB in size. As per the L@E quotas, viewer request functions can have a maximum compressed size, including libraries is 1 MB which is a hard limit and cannot be increased.

As per your question to store the code in S3, S3 is only an object storage service and can only be used to store objects and retrieve them as required. However, cannot be used to run a code on it. 

Moving forward, if you have any questions, please feel free to reply back and I will be happy to help you.

Stay safe and Have a great day!! 

[1] https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/cloudfront-limits.html#limits-lambda-at-edge  

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Abhilash L.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9037356271&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Oct 12 2021
17:52:52 GMT+0530 (India Standard Time)
00:26:56 PM Abhilash: Hello, my name is Abhilash.  I'm here to help you today.
00:27:07 PM Abhilash: May I have your name while I take a moment to look over the case?
00:27:41 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it possible to put source code in S3 bucket 
00:27:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because my source code is around 90MB 
00:28:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so cannot associate the lambda function to cloudfront due to limitation 
00:28:44 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so can you please help me how to put all source code in S3 bucket
00:29:07 PM Abhilash: Hi, Can I please know your name?
00:30:42 PM Abhilash: I see you trying to add source code to S3 bucket. S3 is used for object storage. You can basically add your code as an object into s3. However, please note that S3 cannot be used to run the code.
00:33:15 PM Abhilash: please take a look at below doc for lambda@edge limitations https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/cloudfront-limits.html#limits-lambda-at-edge 
00:33:42 PM Abhilash: Limits vary for Viewer and Origin related events
00:37:37 PM Abhilash: Please let me know if you any questions from the above.
00:38:31 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment
00:38:57 PM Abhilash: In addition from the ticket correspondence, I see you have mentioned "limitation of 10MB function code size" can you kindly provide me with the reference on it? 
00:39:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am using viewer request only
00:41:37 PM Abhilash: For viewer request function, the compressed code size is 1 MB which is a hard limit
00:42:07 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes yes
00:42:09 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: correct
00:42:30 PM Abhilash: can you let me know what is your use case and the requirement to use a huge lambda function with Cloud Front?
00:42:50 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i cannot reduce the size of code since layer is also not supported
00:42:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: https://github.com/aws-samples/lambdaedge-openidconnect-samples 
00:43:07 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: above link is my requirement
00:43:33 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if i would build the code manually it is comes aroung 90MB of size
00:43:41 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am including node_modules as well
00:47:32 PM Abhilash: can you please guide me which file has the L@E as I cannot figure out that from the YAML template?
00:48:50 PM Abhilash: However, as per my understanding, I see here L@E is only being used for authentication which should not cause any issues. You did mention that you are using some additional modules, which is increasing the size
00:50:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: source code is written in nodejs
00:50:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so i need build the code
00:50:34 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: when i run npm install command to build the code
00:50:49 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: node_modules folder is created and size of 90MB
00:51:14 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am doing it manually not with template file
00:52:11 PM Abhilash: got it, Unfortunately, L@E can only support 1MB for viewer request functions and this is a hard limit and cannot be increased.
00:52:28 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: fine then...
00:52:32 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we connect later 
00:52:46 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because i have to join the another meeting sorry 
00:52:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i will connect chat again
00:53:04 PM Abhilash: Sure, please feel free to reply back 
00:53:07 PM Abhilash: Thank you
00:53:52 PM Abhilash: Stay safe and Have a great day!!



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Oct 12 2021
17:52:39 GMT+0530 (India Standard Time)
is it possible to place source code in s3

since cloudfront is having limitation of 10MB function code size. is it possible to have source code in s3

>>>>>>>>>>>>>>>>>

100. Chat: Loop through Lambda until condition is met

Hi,

Mikhail here again from AWS,

Yes, this should be possible and I would say you could modify the sample state machine I provided to include a counter which you can pass to the function on each iteration, you can setup similar (if not the same) as how it's detailed in [1].

Let me know if you have any other questions or comments.

References:

[1] https://docs.aws.amazon.com/step-functions/latest/dg/tutorial-create-iterate-pattern-section.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Mikhail D.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9031730311&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/ngunasek@optum.com (Role)


Tue Oct 12 2021
20:11:48 GMT+0530 (India Standard Time)
Hello Mikhail,

Thanks for the sample state machine. It worked like a charm. So, there are some additional tweaks that is required in this state machine. Let me update the existing one that is working. 

Updated requirement is that the same function has to be run in loop for a specific number of times only(count). Is this something that could be accomplished through the wait and choice function through a count? Like have a count and increment through each run and pass the value of the count to the Lambda function so I could do some checks or processing in there?

Thanks!


Attachments
Updated_Sfn.txt

Amazon Web Services


Mon Oct 11 2021
21:13:25 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hi Navaneethan,

Mikhail here again from AWS premium support, It was a pleasure chatting to your today :)

Just a quick recap of our chat you mentioned that you are using AWS lambda to check if a file exists in S3 and then looping back to the function after some time if it doesn't, once the file is present you use the same function to process it. You were wondering if using AWS StepFunctions would be a better fit for this use case.

During our chat I explained that I would recommend StepFunctions for this as it will be easier to orchestrate the required steps of your use case. I advised that you could have the state machine invoke you function to check S3, and then depending on if the file is there or not you can send back some information to the state machine that enters the choice state, maybe a 'Yes' or 'No' and depending on the output of the checker lambda function either continue the state machine to another function that processes the file or enter a wait state for some time, then loop back to the checker function.

You mentioned that this is exactly what you are looking for and you are also not too worried about using two or the same function for checking and processing.

I advised that I will try to formulate a state machine that could achieve what you need and provide it to you, please see the attached file called "SampleStateMachine", you can copy the JSON content into the StepFunctions designer to have a look at the functionality of the state machine, you will just have to make sure to replace the place holders for the checker and processor Lambda functions.

That being said, if you do not want to use two functions, you can modify the sample state machine I provided to have the choice state transition to the same function instead of the processor function, you will just need code logic to differentiate the two requests (for example, when you need to check and when you need the function to process).

Let me know if you have any other questions or comments.

To see the file named 'SampleStateMachine' included with this correspondence, please use the case link given below the signature.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Mikhail D.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9031730311&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Attachments
SampleStateMachine

>>>>>>>>>>>>>>>>>>>>>>>>>

101. Chat: AWS CLI update_item failing

Hello Navaneethan,

Thanks for updating the case with further queries. I appreciate it.

I understand that you are querying the table for around 700 items on a whole and for write/update we are doing it in loop which would mean it would be one by one. You would like to know if setting the read capacity to 1000 and write capacity to around 20 for that table would be sufficient.

RCU of 1000 and WCU of 20 would be allowed consumption in a second. If your requests are incoming at the pace which doesn't cause single partition to go over 3000 RCU or 1000 WCU or a combination of both in a second i.e. 3000 IOPS, you will not see hot partition.

Now, RCU of 1000 and WCU of 20 would mean the max consumption for the table can go up to 1000 RCU and 20 WCU and  IOPS per partition as 1000+20*3 - 1060. Hence, if you access is all over the partitions, the throttling will only occur if you have crossed table provisioned capacity units OR if your requests are against one partition, it will throttle only if the incoming traffic is consuming more than 1060 IOPS.

So, as stated, you have to make sure that you are not crossing the above explained limits to avoid throttling. Please consider if all the parallel calls you can make and your request rate to come up with the provisioned capacity for the table. 

Answering your question, if your table has 1000 RCU and 20 WCU and the first you are making the reads which will consume 700 RCU per second and then you are making your write calls which will not cross 20WCU per second, you should not face throttling.

I hope this helps. Meanwhile, please update the case with further queries and I would be happy to assist you with the same.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Anamika K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9011896711&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/ngunasek@optum.com (Role)


Mon Oct 11 2021
18:00:35 GMT+0530 (India Standard Time)
Hi Anamika,

Thanks for your patience and detailed help. After our previous call I've removed the quotes from etag and I was able to successfully update the items.

Sorry forgot to mention about the reads and writes/updates that we are performing in the DynamoDB in our script. So, we are querying the table for around 700 items on a whole and for write/update we are doing it in loop which would mean it would be one by one. Would this be causing any issues if I'd set the read capacity to 1000 and write capacity to around 20 for that table? 

Thanks!


Amazon Web Services


Fri Oct 08 2021
18:24:46 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Navaneethan,

You have been invited to an online meeting, powered by Amazon Chime.

Click to join the meeting: https://chime.aws/8687797289 
Meeting ID: 8687 79 7289
A headset is recommended or you may use your computers microphone and speakers.

Looking forward to it.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Anamika K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9011896711&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 

>>>>>>>>>>>>>>>>>>>

102. Chat: SSM connectivity failure

Hello Pravin,
Thank you for contacting AWS. it was my pleasure chatting with you today. Heres the summary of our conversation.

Upon reviewing the instance i-05dfd4fa294fdeb94 configuration, I initially confirmed the SSM Agent to be in running status successfully and that the instance-profile to have necessary permissions for SSM, but the NAT nat-077625845046658ee attached to the Route Table rtb-08b8412b7391ae8b8 was in BlackHole status, thus causing to drop all traffic.

I have requested you to recreate a new NAT in one of the public subnets (subnet-00667045bde7140be, subnet-09fbadae60b66db6f or subnet-0bce72c0f4df76ddc) and once you did update the route table, you were able to access the instance.
https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-working-with  

Later I have shared the docs https://docs.aws.amazon.com/systems-manager/latest/userguide/troubleshooting-managed-instances.html  for some troubleshooting steps around SSM connectivity and in some cases also worth to review the SSM Agent Logs by accessing them following the steps (1-14) similar to the mentioned ones here in https://aws.amazon.com/premiumsupport/knowledge-center/ec2-linux-unreachable-instance/  

For SSM Agent Logs:
https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-agent-logs.html 

Thank you for your understanding & co-operation.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Kapil T.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9011791261&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Thu Oct 07 2021
22:37:00 GMT+0530 (India Standard Time)
Missed to update instance id which we tested : i-0adffc1750cab4ae4 or i-0adffc1750cab4ae4



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Thu Oct 07 2021
22:35:51 GMT+0530 (India Standard Time)
Please update the steps beyond installing SSM agent, iam role attachment. Image was built using Image builder and it states SSM agent was installed with the AMI's built using Image builder.

Iam role we attached manually. Stil unable to connect using SSM or see instance under managed instance.


AWS_P0001489@optum.com


Thu Oct 07 2021
21:29:59 GMT+0530 (India Standard Time)
05:13:09 PM Kapil B.: Hello, I'm Kapil with AWS. May I please have your name while I pull up the case details?

05:14:51 PM Kapil B.: Hello there
05:15:58 PM Kapil B.: I understand your instances do not show up under SSM Managed Instances
05:16:04 PM Kapil B.: column.
05:19:16 PM Kapil B.: Are we connected?
05:20:06 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi
05:20:19 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Pravin here
05:20:42 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Sorry as it was too long to connect I missed the chat
05:20:58 PM Kapil B.: Hi Pravin, no problem
05:21:08 PM Kapil B.: Im reviewing the case details, the IAM policy attached looks good
05:21:15 PM Kapil B.: please allow me a few moments to review
05:21:18 PM Kapil B.: the routing 
05:21:29 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes I wish to know what are the difference between the two instances 
05:21:29 PM Kapil B.: The 2021/10/07 16:56:47Z: Amazon SSM Agent v3.1.338.0 is running
05:21:51 PM Kapil B.: can you confirm if both are not working?
05:21:55 PM Kapil B.: or one of them is working?
05:22:30 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I can connect to ssm connectivity with i-0adffc1750cab4ae4
05:22:46 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: however does not work with other - i-05dfd4fa294fdeb94
05:23:22 PM Kapil B.: I see, thank you for clarifying
05:23:34 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Sure
05:23:36 PM Kapil B.: Im comparing the  setup
05:24:52 PM Kapil B.: 2021/10/07 17:09:18Z: Amazon SSM Agent v3.1.338.0 is running
05:25:00 PM Kapil B.: on i-05dfd4fa294fdeb94
05:25:16 PM Kapil B.: 0.0.0.0/0 	nat-077625845046658ee 	blackhole
05:25:26 PM Kapil B.: for the Route Table rtb-08b8412b7391ae8b8
05:25:52 PM Kapil B.: ----
The above-mentioned NAT for this Subnet is in blackhole status as you see
05:26:09 PM Kapil B.: can you please check that on your console page ?
05:26:38 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: let me check
05:27:37 PM Kapil B.: yes please check and update the NAT; you can create a new  NAT for the subnet and update the route table rtb-08b8412b7391ae8b8 with it 
05:29:22 PM Kapil B.: You may create a new NAT in any of the following subnets, and link it to the above route-table:
----
subnet-00667045bde7140be
subnet-09fbadae60b66db6f
subnet-0bce72c0f4df76ddc
--

05:32:33 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: can u check and confirm now
05:32:37 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: if nat is fine ?
05:32:38 PM Kapil B.: checking
05:32:40 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I have added
05:32:48 PM Kapil B.: yes is good now
05:32:54 PM Kapil B.: please give it a few minutes
05:33:02 PM Kapil B.: for the SSM Agent to establish communication 
05:33:06 PM Kapil B.: with the SSM End servers
05:33:15 PM Kapil B.: you may try to connect
05:33:16 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes I have reboot the instance
05:33:22 PM Kapil B.: sure
05:33:38 PM Kapil B.: Rest everything looks good at the moment
05:33:47 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: let me see..
05:36:24 PM Kapil B.: Please try now
05:36:29 PM Kapil B.: and let me know your observations 
05:38:00 PM Kapil B.: I apologize, I still see the instance in stop-state
05:38:04 PM Kapil B.: did you start it ?
05:39:40 PM Kapil B.: Pravin, are we connected?
05:40:16 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: just a second
05:40:31 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am trying
05:40:47 PM Kapil B.: okay
05:41:17 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Great it connects now..
05:41:23 PM Kapil B.: awesome 
05:41:26 PM Kapil B.: to hear !
05:41:32 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hope it waS the nat gateway which caused this
05:41:37 PM Kapil B.: yes it was
05:41:41 PM Kapil B.: the NAT in blackhole status
05:41:46 PM Kapil B.: so it drained all your packets
05:41:54 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: is there any troubleshooting steps for this ssm conenctivity failure
05:41:55 PM Kapil B.: without forwarding to the ssm endpoints
05:42:10 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I always see ssm agent isntance, iam role attachment as steps
05:42:32 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: beyond that like nat gateway blackhole.. like this any other trouble shooting steps can u share
05:42:48 PM Kapil B.: yes let me check
05:43:09 PM Kapil B.: This is one https://docs.aws.amazon.com/systems-manager/latest/userguide/troubleshooting-managed-instances.html 
05:43:13 PM Kapil B.: document 
05:43:29 PM Kapil B.: covering all troubleshooting steps for ssm connectivity
05:44:57 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I see 6 steps here
05:45:09 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: hope this should be sufficient to face all the issues
05:45:19 PM Kapil B.: It most likely should be sufficient
05:45:31 PM Kapil B.: But in case it does not help, the approach then would be to 
05:45:38 PM Kapil B.: login via the ec2 serial console
05:45:42 PM Kapil B.: or SSH keypair 
05:45:48 PM Kapil B.: and then review the SSM Agent logs
05:45:56 PM Kapil B.: https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-agent-logs.html 
05:46:17 PM Kapil B.: these logs contain precise information on what's failing, be it for patching or connectivity or upgrades
05:46:26 PM Kapil B.: the logs pinpoint the issue.
05:46:59 PM Kapil B.: You could then run connectivity tests like dig or telnet on ssm endpoints, and check if it is configured properly
05:48:18 PM Kapil B.: sometimes the Anent also has trouble starting or gets hibernated.terminated for some reason
05:48:56 PM Kapil B.: in such case, we usually stop the instance and detach the root volume from it. Then we attach and mount it as secondary volume on a working instance where you can review the agent logs to review the errors.
05:49:04 PM Kapil B.: *Agent
05:49:47 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Great.. some additional ideas I got..
05:50:40 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Thanks for the info. Let me validate and confirm on the same..
05:50:50 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I think it is sufficient for now.
05:50:56 PM Kapil B.: yes you could now simply review the agent logs
05:51:02 PM Kapil B.: and see it will timeout 
05:51:07 PM Kapil B.: * it timed out
05:51:22 PM Kapil B.: while connecting to ssm.(region)
05:51:24 PM Kapil B.: endpoints
05:51:30 PM Kapil B.: in those agent logs.
05:51:39 PM Kapil B.: No problem at all Pravin :)
05:52:02 PM Kapil B.: if you have any questions please feel free to reach out to us anytime opening a case and one of our available engineers shall assist you accordingly
05:53:13 PM Kapil B.: Have a nice day ! 

05:53:44 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Thansk for your help. I am just reading thru the ssm agent log inside the ec2 instance
05:54:31 PM Kapil B.: sure :)
05:54:37 PM Kapil B.: would you like me to be on chat
05:54:42 PM Kapil B.: as you review the logs
05:54:51 PM Kapil B.: or are we good to close the chat for now
05:54:52 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: No you can leave for now
05:54:57 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Thanks again for your help
05:54:58 PM Kapil B.: sure :)
05:55:23 PM Kapil B.: No problem at all :) 
It's pleasure chatting with you today, Pravin !
have a nice day !



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Thu Oct 07 2021
21:29:47 GMT+0530 (India Standard Time)
SSM connectivity failure after IAM roles attachment and unable to find in managed instances.

>>>>>>>>>>>>>>>>>>>

103. Chat: need clarification on how to authenticate user without clicking on IDP providers

Hi,

It was a pleasure talking to you earlier. This is Sravani here from AWS, back with a short summary of our discussion

You reached out to us because you wanted to know if its possible to skip the Hosted UI part and want it to be directed at the console itself. Please note that your could identity_provider parameter with the authorize endpoint. I have also provided the authorization endpoint link below for your reference

>> https://docs.aws.amazon.com/cognito/latest/developerguide/authorization-endpoint.html 

We try to hit this URL and it was working fine for you as expected

>> https://pingidp.auth.us-east-1.amazoncognito.com/login?client_id=6fbvfch7efeqqkkkar861on2rp&scopes=email%2Copenid%2Cphone%2Cprofile&identity_provider=PingIDP&redirect_uri=https%3A%2F%2Fproviderops.optum.com&response_type=code&state=eyJub25jZSI6Ii00NUJBUUxselNfdER0cGVibmZlRTdYSC5NbV9OblZmY1VQM0FubHdpRElZOWRWWnZaeEJYVFRTNk9aZm9kZWEiLCJyZXF1ZXN0ZWRVcmkiOiJodHRwczovL3Byb3ZpZGVyb3BzLm9wdHVtLmNvbS8ifQ&code_challenge_method=S256&code_challenge=oRnewARKp13-3Wt-GmIrf3E1mGFDn4kiTQur2ia_VT8& 


Additionally, please note that code support is out of scope for us. Hope this response was of some help. In case the issue persists or if you have any further queries, please feel free to reach out to us. 

Thank you for your interest and patience. 

Have a great day!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Sravani N.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9009759201&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Oct 07 2021
12:44:28 GMT+0530 (India Standard Time)
07:17:48 AM Sravani: Hello, my name is Sravani.  I'm here to help you today.
07:18:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
07:18:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
07:18:20 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I have created OIDC IDP in cognio
07:18:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and I chosen that OIDC IDP as "supported IDP provider"
07:19:20 AM Sravani: Okay
07:20:27 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so whenever i get login UI
07:20:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is showing that
07:20:47 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but i dont want to display that 
07:21:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime session, so that it would be easier to explain
07:21:12 AM Sravani: Sure
07:22:43 AM Sravani: https://chime.aws/3561483219 
07:23:36 AM Sravani: Please join
07:28:25 AM Sravani: Are we connected?
07:30:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes yes



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Oct 07 2021
12:44:18 GMT+0530 (India Standard Time)
need clarification on how to authenticate user without clicking on IDP providers
IAM User or Role ARN: 
Error: 

>>>>>>>>>>>>>>>>>>>>>

104. Limit Increase: Simple Storage Service (S3)

Hello,
 
 Thank you so much for your patience. I'm happy to inform you that I've completed your S3 Bucket limit increase request.  Please allow up to 15 minutes for this to propagate and become available for use. I'm glad I could take care of this for you today. 

Please note that your customer satisfaction is a top priority for us and if you feel like there's a concern or question that has not been properly addressed please let us know to make sure on getting this answered as soon as possible. 

 I'm going to mark the case as resolved, but feel free to reopen this case should you have any additional questions regarding this case. I hope I was able to provide you with a positive experience. Please have a great rest of your day.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Michael A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9005581781&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWSServiceRoleForServiceQuotas/CaseManager (Role)


Wed Oct 06 2021
19:52:11 GMT+0530 (India Standard Time)
Limit increase request 1
Service: Simple Storage Service (S3)
Region: US East (Northern Virginia)
Limit name: Bucket Limit 
New limit value: 110
------------
Use case description: This support case was created by Service Quotas

>>>>>>>>>>>>>>>>>>

105. Personal Health Dashboard

Hello Pravin,

It was a pleasure working with you today. I wanted to take this time to summarize our call.

When we connected you let me know that you had some questions about the Personal Health Dashboard and configuring event notifications via sns. In order to keep things organized I will break down what we discussed into sections with links to the official documentation.

+++++ Personal Health Dashboard (PHD) +++++++
There are two types of events that you will see in your PHD - Public events and account specific events [1] :
 - Account-specific events are local to either your AWS account or an account in your AWS organization. For example, if there's an issue with an Amazon Elastic Compute Cloud (Amazon EC2) instance type in a Region that you use, AWS Health provides information about the event and the name of the affected resources.
 - Public events are reported service events that aren't specific to an account. For example, if there's a service issue for Amazon Simple Storage Service (Amazon S3) in the US East (Ohio) Region, AWS Health provides information about the event, even if you don't use that service or have S3 buckets in that Region. We recommend that you review public notifications before you take action on them.

+++++ PHD Events +++++
I let you know that Events are region specific, meaning that if you configure alerts for events in US East (N.Virgina) Region, you will only get alerts for that region, even if PHD reports other issues in other regions. I let you know that you would need to configure the alerts in all the regions separately in order to receive alerts from all the regions. [2]

++++++ Alert Configuration [3] ++++++
I showed you in the CloudWatch -> Events -> Alerts page how to configure alerts for health events and you let me know that you had done this already, but the output was not human readable friendly so you were trying to push it to a lamda function to clean it up. I showed you that there was an option in the SNS output to configure custom messages using the output of the events called "Input Transformer". Using input transformer you setup keypair "variables" that you can later integrate into a custom message template fore example:
{ "detail-type" : "$.detail-type" , "region" : "$.region"}

There was a/an <detail-type> in <region>.  which would translate to: There was a/an AWS Health Event in US-East-1.

From here you had a couple of questions about AWS Organizations and how to pull the events in all the PHDs across all the accounts into one account and I let you know that once the accounts have been added into the main account under the org [4] you would then need to aggregate the notifications into the management account of the Org. [5] Please read through the documentation provided to have the proper procedure for aggregating the information as there are some prerequisites from the Org side of things that need to be done. 

Once all this was explained you let me know that I could close this case. Please feel free to reach out in a new case if you have any other questions or concerns and I or the next available engineer will be happy to assist. 


Reference:
[1] https://docs.aws.amazon.com/health/latest/ug/aws-health-concepts-and-terms.html#aws-health-events 
[2] https://docs.aws.amazon.com/health/latest/ug/cloudwatch-events-health.html#choosing-a-region 
[3] https://docs.aws.amazon.com/health/latest/ug/cloudwatch-events-health.html#creating-cloudwatch-events-rule-for-aws-health 
[4] https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_accounts_create.html 
[5] https://docs.aws.amazon.com/health/latest/ug/aggregate-events.html 

Please let us know if we helped resolve your issue: 

 If YES, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9004129361&language=en&questionnaireId=Support-HMD-Yes 

 If NO, click here: 
https://console.aws.amazon.com/support/feedback?eventId=9004129361&language=en&questionnaireId=Support-HMD-No 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Joshua K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9004129361&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Oct 06 2021
22:12:11 GMT+0530 (India Standard Time)
05:05:16 PM Joshua: Hello, my name is Joshua.  I'm here to help you today.
05:05:32 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi Joshua,
05:06:02 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am Pravin. Hope you saw the details from the message
05:06:19 PM Joshua: I am currently going over the previous comments now
05:07:32 PM Joshua: So if I am understanding correctly you are trying to create a lambda function that will read cloudtrail and send emails based on those notifications. is that correct?
05:08:24 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes correct. 
05:08:51 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am trying to read the health events related to Personal Health dashboard and trying to send it as mail
05:09:22 PM Joshua: for a single account or accross your entire ORG?
05:10:00 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: as of now for a single account.
05:10:17 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I tried to open aws organization but I dont see any options to add other accounts. 
05:12:50 PM Joshua: ok i think there is some confusion here. the health notifications come in on CloudWatch, not CloudTrail, so you would simply create an alarm for health events in cloudWatch and specify the recipients for the notification in the alarm
05:14:05 PM Joshua: let me confirm this on my end
05:15:03 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Is it possible for a quick chime chat to get this clarified
05:15:19 PM Joshua: sure one moment let me get you a link
05:15:42 PM Joshua: https://chime.aws/2610023362 
05:16:46 PM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am connecting over there



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Wed Oct 06 2021
22:11:58 GMT+0530 (India Standard Time)
Hi Team,

Thanks for your comments. However I wish to know what the cloud trail event I need to refer in order to customize the lambda function for notifications.

Thanks,
Pravin 


Amazon Web Services


Wed Oct 06 2021
14:50:21 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

My name is Zvonimir and I will be happy to assist you with this case.

I understand that you would like to know if the 'Personal Health Dashboard' notifications you see in you AWS account are limited to the services you use within that particular account or the notifications are common across accounts. Please correct me if I omitted or misunderstood anything regarding this matter.

I have checked information on that and as per our documentation [1], concerning the types of the events that can be seen in 'Personal Health Dashboard', it states following;

"There are two types of AWS Health events:

-Public events are service events that aren't specific to an AWS account. For example, if there is an issue with Amazon Elastic Compute Cloud (Amazon EC2) in an AWS Region, AWS Health provides information about the event, even if you don't use services or resources in that Region.

- Account-specific events are specific to your AWS account or an account in your organization. For example, if there's an issue with an Amazon EC2 instance in a Region that you use, AWS Health provides information about the event and the affected resources in the account."

In the same documentation [1] under the section 'Organizational view', concerning viewing the events from all of the AWS Accounts that are part of AWS Organization, it states following;

"AWS Health integrates with AWS Organizations so that you can view events for all accounts that are part of your organization. This provides you a centralized view for events that appear in your organization. You can use these events to monitor for changes in your resources, services, and applications."

As per the statement above, you must use AWS Organization to view events for all accounts which are part of that organization. In such scenario you could consider usage aggregation of AWS Health events across accounts with organizational view if it suits your desired end-goal. For precise details on that, important notes and what are the pre-requisites to use it, please check here [2].

I hope that the provided information will be helpful.

Should you have any other questions or concerns regarding this matter, please let me and I will be happy to assist you with it.

I wish you a great day.

References:
[1] Getting started with the AWS Personal Health Dashboard - Events types
https://docs.aws.amazon.com/health/latest/ug/getting-started-phd.html#types-of-events 
[2] AWS Health - Aggregating AWS Health events across accounts with organizational view
https://docs.aws.amazon.com/health/latest/ug/aggregate-events.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Zvonimir R.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9004129361&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Wed Oct 06 2021
13:10:00 GMT+0530 (India Standard Time)
Hi Team,

Personal Health Dashboard - Need to confirm if the notification we see in our account are limited to the services we use within this account or the notifications are common across accounts.

We are in phase of using lambda function to trigger the notifications as a mail to different AWS accounts. However, if the PHD notifications are limited to individual accounts then we need to setup the lambda with individual account to get appropriate mails.
Please select which component of the Health service you need assistance with.: Personal Health Dashboard (PHD)
Health Event Amazon Resource Name (ARN): 

>>>>>>>>>>>>>>>>

106. Chat: VPC flow logs will find load balancer error

Hello Surendar,

Thank you for your time on chat. This is Nikhilesh Sompura from AWS Premium Support writing this e-mail to you as a summary of our conversation today.

On chat, You let me know that you want to capture HTTP traffic between ALB and target instance using VPC flow logs. 

I informed you that VPC flow logs only collects layer 4 information (characterized by a 5-tuple on a per network interface basis) that occurs within an aggregation interval, also referred to as a capture window.

Each record is a string with fields separated by spaces. A record includes values for the different components of the IP flow, for example, the source, destination, and protocol.

You can see the below article[1] for more information.

As per over conversation over the chat, I will go ahead and mark the case as Resolved for you. 

I hope the above information was useful. If you have any other queries or require further information, do not hesitate to reach out to us. I would be more than happy to help you out.

Have a nice day!

References:
 [1] https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html#flow-log-records 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Nikhilesh S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=9003902151&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Oct 06 2021
12:11:47 GMT+0530 (India Standard Time)
06:47:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar
06:47:28 AM  Nikhilesh Sompura: Hello, my name is  Nikhilesh Sompura.  I'm here to help you today.
06:47:50 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I have one query, can we have chime session to discuss about it 
06:47:57 AM  Nikhilesh Sompura: Hi Surendar, 
06:47:59 AM  Nikhilesh Sompura: sure
06:48:01 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because it is hard to explain over the chat
06:48:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks a lot
06:48:14 AM  Nikhilesh Sompura: sure let me share the link
06:48:42 AM  Nikhilesh Sompura: https://chime.aws/3734811346 
06:48:48 AM  Nikhilesh Sompura: Please join the above link



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Oct 06 2021
12:11:13 GMT+0530 (India Standard Time)
how vpc flow logs logging the load balancer request to target instances
VPC ID: 
Instance ID(s): 
Region: 
NAT Gateway ID (If Applicable): 
VPC Peering Connection ID (If Applicable): 
VPC Endpoint ID (If Applicable): 

>>>>>>>>>>>>>>>>>>>>

107. Chat: Transfer files within folders in same bucket

Hello Navaneethan 

It was a pleasure speaking with you today.

I am writing this email to summarize the conversation we had for your future reference.

You reached out to us as you want to know how you can copy from your bucket to a different prefix in the same bucket in a timely manner.

As discussed,  this will depend on the object number and the size of the objects. Therefore, you might want to use aws cli and apply cron job as there are very limited option for lambda. You have mentioned that, you do not want to use cli because it will need to keep running on the machine and you want to keep monitoring the files in your S3 and this is what you are able to do with lambda.

In this case you can try these two options:

>> In your lambda function, use multipart uploads.

>> You can use S3 batch operations to copy your objects from source to destination and this does not include lambda for trigger.

Please see the documents below for these options:

>> https://docs.aws.amazon.com/AmazonS3/latest/userguide/batch-ops.html 

>> https://docs.aws.amazon.com/AmazonS3/latest/userguide/mpu-upload-object.html 

You have mentioned that you will check on those options on your end and reach out to me if needed.

It was all that you wanted to be assisted with.

Please feel free to write back to me if you have any other queries or concerns. I will be pleased to assist you again!

Once again thanks for your time Navaneethan   and hope you have a great day further!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Pumlo L.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8999216521&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Oct 05 2021
18:01:45 GMT+0530 (India Standard Time)
00:58:34 PM Pumlo: Hello, my name is Pumlo.  I'm here to help you today.
00:59:48 PM Pumlo: May I know your name please while reviewing your case ?
01:00:48 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Hi. I'm Navaneethan here.
01:01:03 PM Pumlo: Pleasure meeting you Navaneethan
01:01:24 PM Pumlo: I see you would like to move files from one folder to another in the same bucket in a timely manner
01:01:35 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: yes that's right
01:01:42 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: mostly through a Lambda
01:02:05 PM Pumlo: Okay and you mentioned that you lambda is timing out ?
01:02:19 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: yes that's right
01:02:28 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: I tried copy_object and meta.copy functions
01:02:53 PM Pumlo: The issue might not be with the copy functions but with the lambda itself
01:03:12 PM Pumlo: Is your lambda function able to reach internet
01:03:24 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: No, it can reach and is able to copy some of the files
01:03:32 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: after the 15 minute timeout it stops
01:03:35 PM Pumlo: Okay perfect 
01:03:52 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: arn:aws:lambda:us-east-1:165387667510:function:gsutil_lambda
01:03:53 PM Pumlo: Can we check the lambda timeouts ?
01:04:05 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: This is the one.
01:04:26 PM Pumlo: If you are able to transfer some files then it means S3 is open and there might be no indication of the problem as far as S3 is concerned
01:04:41 PM Pumlo: Do you have some log files for the timeout requests ?
01:04:48 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: yes, its just the copy function is taking time.
01:05:05 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: So, wanted to check what would be the best way to move files around within the same bucket.
01:05:33 PM Pumlo: The approach you are using is great for this use case
01:07:50 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Right so even when we are trying to move files within the same bucket it's going to take a lot of time?
01:08:46 PM Pumlo: No it shouldn't take a lot of time, however  this will depend on the object number and the size of the objects
01:09:40 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Ok. For now for 10 GB of files its taking more than 15 minutes.
01:10:31 PM Pumlo: Well that can be expected
01:10:45 PM Pumlo: for 500 files
01:10:57 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Oh ok
01:11:17 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: So, what would be the alternative that could be a bit faster?
01:11:36 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: If you could provide your suggestions for it, that would be helpful
01:13:18 PM Pumlo: So how often are you going to be making these transfers ?
01:13:39 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: it will be mostly on a monthly basis
01:13:48 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: or twice in a month at the maximum
01:14:07 PM Pumlo: Oh okay in that case you can still use aws cli and apply cron job 
01:14:43 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: yes but we would need to have it setup on a machine and run it right?
01:14:58 PM Pumlo: Yes in your ec2 instance
01:15:29 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: instead would an Faragte task be a better option?
01:15:30 PM Pumlo: You will then configure your cli to do multipart uploads 
01:15:42 PM Pumlo: https://aws.amazon.com/premiumsupport/knowledge-center/s3-multipart-upload-cli/ 
01:18:02 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: but the instance has to keep on running and watch for the files to be present right
01:19:37 PM Pumlo: You can stop the instance and only start when you want to make the copy operation 
01:20:07 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: but unfortunately we have to keep watching the S3 path for the arrival of S3 files
01:20:19 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: So, we were thinking of making use of a Lambda for it
01:20:24 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: and that could trigger the copy process
01:20:30 PM Pumlo: Mhh okay got you 
01:22:33 PM Pumlo: In your lambda the best way would be to use multipart uploads
01:22:37 PM Pumlo: https://docs.aws.amazon.com/AmazonS3/latest/userguide/mpu-upload-object.html 
01:25:32 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Ok I'll try to test with that
01:29:08 PM Pumlo: Okay and this is our best practices
01:29:27 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Also it would be helpful if you could share the other best and fastest methods of copying files within the same bucket if there are any available.
01:29:57 PM Pumlo: Yes there other ways for this and this is excluding lambda
01:30:05 PM Pumlo: https://aws.amazon.com/premiumsupport/knowledge-center/s3-large-transfer-between-buckets/ 
01:30:29 PM Pumlo: One which could be suitable for your use case is S3 batch operation
01:30:41 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: yeah I tried checking it
01:30:57 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: but not sure if that could be incorporated within lambda
01:31:25 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: also we have to move files from the source to the destination.
01:31:35 PM Pumlo: With ways to incorperate with lambda, there are very limited options
01:31:53 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: yeah right
01:32:02 PM Pumlo: S3 batch operation on it's can do the copy for you
01:32:09 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: may be then we'll try with the ECS Fargate task. 
01:32:19 PM Pumlo: Okay 
01:32:35 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Is there any documentation for S3 batch operation?
01:32:53 PM Pumlo: Yeah there is 
01:33:04 PM Pumlo: Please hold on, I will share it shortly 
01:33:22 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Sure thanks
01:34:05 PM Pumlo: https://docs.aws.amazon.com/AmazonS3/latest/userguide/batch-ops-create-job.html 

In that document there is also a short video which will show you step by step how to configure S3 batch
01:35:21 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Ok sure let me take a look. I think I saw this sometime. But left it since this required a manifest file kind of
01:36:04 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Is it a mandatory one?
01:38:26 PM Pumlo: Yes manifest file is mandatory
01:39:24 PM Pumlo: So batch operation needs a list of all files that you want it to run action on  and this list will be on manifest file
01:39:56 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: oh ok got it. I'll try it out once and see how this works.
01:45:48 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: I'll try it out and let you know in case of any issues
01:46:12 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Also, one last question can this batch operation be automated through any API call?
01:49:31 PM Pumlo: It can make the copy but there are some API calls that it cannot make 
01:50:04 PM Pumlo: Please see the supported operations here :

https://docs.aws.amazon.com/AmazonS3/latest/userguide/batch-ops-operations.html 
01:52:34 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Ok. So something like the Copy Operation can be triggered through an API call?
01:52:50 PM Pumlo: No
01:53:44 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: oops ok
01:54:09 PM Pumlo: However, I have found something which I think could relate to what you are asking :

01:54:10 PM Pumlo: https://docs.aws.amazon.com/AmazonS3/latest/userguide/batch-ops-invoke-lambda.html 
01:55:40 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: yeah thanks
01:56:05 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: unfortunately this doesn't have options for lambda to trigger the S3 batch operations job 
01:56:18 PM Pumlo: Yeah 
01:56:26 PM Pumlo: Unfortunately
01:56:43 PM Pumlo: I think it is better to try S3 batch and see how it goes
01:58:03 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: yeah ok may be I'll try it out and see how it works for our use case.
01:58:07 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Thanks for your help
01:58:15 PM Pumlo: Pleasure is all mine:)
01:58:25 PM Pumlo: I will send you a summary of this conversation on the case for future reference
01:58:42 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Sure that would be really helpful.
01:58:44 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Thanks again
01:58:46 PM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Bye!



AWS_165387667510_Contributor/ngunasek@optum.com (Role)


Tue Oct 05 2021
18:01:30 GMT+0530 (India Standard Time)
Hi,

We have a use case wherein we would want to transfer S3 files from the same bucket but from one folder to another folder. We would like to know what's the best way to update the Key(folder) of the files in the bucket. We would want to do it through a Lambda(python). It would contain close to 500 files with the total file size of around 500 GB. We tried using copy_object and then delete_object and also the s3.meta.client.copy function available through boto3 but they were taking more time and Lambda gets timed out. So, what would be the best way to handle this scenario?

Thanks!
Bucket(s): 
Request ID(s): 
Extended Request ID(s): 

>>>>>>>>>>>>>>>>>>

108. Chat: Is AWS X-Ray show instance IP address under load balancer

Hi Surendar,

Thank you for your response.  This is Jake.  I am hapyy to provide answers with links to the relevant AWS documentation.  

I understand that you would like confirmation that traces include the instance ID in the following scenarios. Please let me know if I have misunderstood.

Q1. Timeout error
A1. Yes. There are a few ways to get the instance ID from the Timeout Error.  A Timeout Error HTTP response 408 would be present in the Traces and you can drill into the raw data to find the Instance ID as well as sort data by Instance ID.  Please see Viewing Traces [1], and Segment Detail [2] in the references, below.

Q2. Application issue
A2. Yes.  This is much the same answer as Q1.  The response code may be different depending on the HTTP response related to the issue.

Q3. Application service hung
Q3. Yes.  This would result in a timeout, same as Q1.

Q4. Instance in hung state
A4. Most likely, no.  The Daemon may not be able to send traces.

Q5. 404 issue
A5. Yes.  This is also the same answer as Q1 and Q2.  

Also, in this same documentation link, which is the AWS X-Ray Developer's Guide is another way to set up notifications of failures [3].

I hope that you find this information to be helpful.  Should you have any additional questions, you need only to respond to this case and I will be happy to assist.  My working hours are Monday through Friday from 8AM to 5PM EST.  If you need any immediate assistance outside of those hours, please don't hesitate to open a new live chat or call and the next available engineer will be able to assist.  

Have a great day ahead!

=====
References:
[1] https://docs.aws.amazon.com/xray/latest/devguide/xray-console.html#xray-console-traces  : AWS X-Ray console - Viewing traces
[2] https://docs.aws.amazon.com/xray/latest/devguide/xray-console.html#xray-console-segments  : AWS X-Ray console - Viewing segment details
[3] https://docs.aws.amazon.com/xray/latest/devguide/xray-console-insights.html#xray-console-insight-notifications  : Using insights in the AWS X-Ray console - Enable insights notifications

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Jake S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8998948981&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Oct 06 2021
11:51:51 GMT+0530 (India Standard Time)
Hi,

Is it possible to see the instance ID in below issues
1. Timeout error
2. application issue
3. application service hung
4. instance in hung state
5. 404 issue 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Oct 06 2021
10:32:41 GMT+0530 (India Standard Time)
Hi,

Is it possible to see the instance ID in below issues
1. Timeout error
2. application issue
3. application service hung
4. instance in hung state
5. 404 issue 

>>>>>>>>>>>>>>>>>>>>>>>>

109. Chat: how to monitor with Xray

110. Chat: Xray will get instance ID when it is getting error

111. Call: Rule not triggered

Hello Pravin,

This is Shuaib from AWS Premium Support  CloudWatch. It was a pleasure talking to you over the phone today, here is a summary of our discussion.

You initiated a call with AWS Premium Support  CloudWatch as you needed guidance in several matters as below:
    1.	Sending and receiving Amazon EventBridge events between AWS accounts
    2.	Sending custom email instead of the default JSON event using 3rd party mail provider

Over our phone conversation and screenshare we went over how you will be able to send and receive events between AWS accounts using EventBridge service. The links at [1] provide further elaboration and illustration on this topic.

As for using 3rd Party mail provider to send custom email instead of the default JSON event, I shared with you a sample lambda function code EventBridge_CustomEmail.py that uses AWS SNS Topic to send custom emails instead of the default JSON event. You can modify the lambda function to use your own 3rd party mail provider instead of AWS SNS.

Please note that AWS Support does not provide any code support, and that the provided sample code is a personal courtesy to assist you in your use case. Other AWS engineers may not provide you the same courtesy.

As there are no further actions required, I will go ahead and close this case for you. Please feel free to get back with us if you have any additional concerns and one of our available engineers will be more than happy to help you!

Thank you


References:
[1] Sending and receiving Amazon EventBridge events between AWS accounts
    	https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CloudWatchEvents-CrossAccountEventDelivery.html 
    	https://aws.amazon.com/blogs/mt/amazon-cloudwatch-with-amazon-eventbridge-cross-account-event-monitoring/ 
    	https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-cross-account.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Shuaib A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8980624081&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Mon Oct 04 2021
20:08:25 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

https://chime.aws/5875269440 
Meeting ID: 5875 26 9440
U.S. Toll: +1 206-462-5569
Meeting PIN: 5875 26 9440
U.S. Toll-free: +1 855-552-4463
International: https://chime.aws/dialinnumbers/ 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Shuaib A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8980624081&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Mon Oct 04 2021
19:31:43 GMT+0530 (India Standard Time)
 .


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Mon Oct 04 2021
19:30:57 GMT+0530 (India Standard Time)
 .


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Mon Oct 04 2021
19:30:05 GMT+0530 (India Standard Time)
 .

>>>>>>>>>>>>>>>>>>

112. Chat: Unable to connect to the Image when using VPC Endpoint

Hello,

We haven't heard back from you regarding case 8974170451 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=8974170451&displayId=8974170451&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Thu Sep 30 2021
17:14:26 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hi,

Mulalo here, It was a pleasure chatting with you today. To recap, you reached out to AWS Premium Support because you have setup Appstream interface endpoint and but you  are not able to connect to the image builder.

To troubleshoot the issue we looked at the pre requisites [1] and noticed the following:

- the network to which your workstation is connected could not route traffic to the interface endpoint (route table is only allowing traffic from 10.10.0.0/16)
- the security groups associated with the interface endpoint was not allowing inbound access to ports 1400-1499
- the security groups associated with the interface endpoint was not allowing outbound access to ephemeral network ports 1024-65535 (TCP)

As discussed, you are going to launch a new instance in the AppStream Subnet and test the connection.

Please don't hesitate to let me know if you have any queries.

[1] https://docs.aws.amazon.com/appstream2/latest/developerguide/creating-streaming-from-interface-vpc-endpoints.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Mulalo M.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8974170451&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Sep 30 2021
14:49:48 GMT+0530 (India Standard Time)
09:21:34 AM Mulalo: Hello, my name is Mulalo.  I'm here to help you today.
09:21:50 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Hello I'm Navaneethan here.
09:22:03 AM Mulalo: Hi Navaneethan. I trust you are well
09:22:27 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Yes. Hope you're good too.
09:22:45 AM Mulalo: Please share the name of the image builder
09:22:56 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Latest_image
09:22:59 AM Mulalo: Got it
09:23:13 AM Mulalo: Did you follow all the prequisites
09:23:40 AM Mulalo: https://docs.aws.amazon.com/appstream2/latest/developerguide/creating-streaming-from-interface-vpc-endpoints.html 
09:23:44 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Yes, I've created the VPC endpoint and setup SG rule with incoming on 443 and TCP from my IP.
09:23:59 AM Mulalo:  ports 1400-1499 (TCP) from the IP address range from which your users connect.
09:24:56 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: For SG I've added all TCP from my source IP address
09:25:19 AM Mulalo: Give me a moment?
09:25:30 AM Mulalo: Give me a moment
09:25:33 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: sure
09:28:47 AM Mulalo: Source IP 198.203.181.181/32 does not seem to be in the same network as the image builder
09:29:15 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Oh ok. So, what should be the SourceIP?
09:29:51 AM Mulalo: It should be within this range 10.10.0.0/16
09:30:03 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: ok let me try with that
09:30:19 AM Mulalo: This is what I am seeing in your route table
09:30:54 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Should we stop and start the Image again after the SG is updated?
09:31:22 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Because after changing the sourceIp as well its still in connecting state
09:31:23 AM Mulalo: The whole point of VPCe is to contain the traffic within your private network
09:31:33 AM Mulalo: No
09:32:36 AM Mulalo: What is the address of the machine you are trying to connect from?
09:32:54 AM Mulalo: run ipconfig and share the output
09:33:19 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: I'm trying to connect from my local machine through the AWS console
09:33:35 AM Mulalo: No
09:33:56 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Can we get on a call if possible?
09:34:22 AM Mulalo: why not
09:34:32 AM Mulalo: https://chime.aws/7237466117 
09:40:42 AM Mulalo: he network access control list for the subnets must allow outbound traffic from ephemeral network ports 1024-65535 (TCP) to the IP address range from which your users connect.
09:50:09 AM assumed-role/AWS_165387667510_Contributor/ngunasek@optum.com: Thanks



AWS_165387667510_Contributor/ngunasek@optum.com (Role)


Thu Sep 30 2021
14:49:16 GMT+0530 (India Standard Time)
When we are trying to make use of VPC Endpoint to connect to the Images we are not able to connect to it. It spins up in the Connecting page.
The name of the Image Builder: Latest_image
AWS Region of the Image Builder: us-east-1
The Time (in UTC) when you faced this issue: 

>>>>>>>>>>>>>>>>>>>

113. Chat: How to customize the access log

Hello Surendar,

Thank you for your time with me on our chat at AWS Premium Support - Dublin Office today.  Please find below a brief summary of what we discussed.

On our chat I verified what HTTP header 'X-Forwarded-For' function is and how it can be used when logged in a servers access logs [1].

'X-Forwarded-For' is a HTTP header that is included by the client that is sending a HTTP request.....for example to an Application Load Balancer.  The ALB supports this header and the other X-Forwarded HTTP headers and the ALB passes the header to the target application.  The X-Forwarded-For header can then be logged in the target application access logs and it includes the source clients IP address.

ELB Access logs can be used to verify ELB and Target generated 5XX errors that are logged in the 'elb_status_code' and 'target_status_code' respectively [2].  These logs are pushed to an S3 bucket in your account when configured.  Amazon Athena can be used to analyze data in Amazon S3 using standard SQL.  Athena is serverless, so there is no infrastructure to manage, and you pay only for the queries that you run [3].

You can also use Cloudwatch alarms to monitor for 5XX errors.  If ELB or Target 5XX errors are generated, you can have CW alarms [4] monitoring these metrics [5] (HTTPCode_ELB_5XX_Count and HTTPCode_Target_5XX_Count).  If the errors are generated, the configured threshold will be breached and the CW Alarm will be triggered. This alerts you to 5XX errors being generated. You can see these errors in the corresponding metrics and verify the time-frame or time-stamp.  Then you can located the access log lines that will contain the ELB/Target 5XX codes and you can verify what target generated the error or errors.

[1] HTTP headers:-
https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html#availability-zones 

[2] Access logs for your Application Load Balancer:-
https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html 

[3] Amazon Athena:-
https://aws.amazon.com/athena/?whats-new-cards.sort-by=item.additionalFields.postDateTime&whats-new-cards.sort-order=desc 

[4] Using Amazon CloudWatch alarms:-
https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html 

[5] CloudWatch metrics for your Application Load Balancer:-
https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html 

I hope this information will be of help to you and if you have any further questions please do not hesitate to get back in contact with AWS Premium Support.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Trevor W.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8967339491&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Oct 05 2021
14:58:32 GMT+0530 (India Standard Time)
09:30:48 AM Trevor W.: Hello, my name is Trevor W..  
09:32:57 AM Trevor W.: Anyone available?
09:35:29 AM Trevor W.: I cannot remain idle on chat
09:36:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: HI
09:36:23 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
09:36:33 AM Trevor W.: Hello Surendar 
09:37:00 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I wanted to know that, how do we can monitor the requests incoming to load balancer using AWS X-Ray service
09:37:34 AM Trevor W.: X-Ray is not supported by my tram
09:37:37 AM Trevor W.: team*
09:38:13 AM Trevor W.: Sorry, one moment
09:38:20 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok
09:40:20 AM Trevor W.: But I would recommend reviewing the public docs relating to this service if you have not already. And if you have additional questions or need clarification about any part of the service, I would recommend opening a new case and select the X-Ray service and you will be connected to an engineer experienced in that service
09:40:26 AM Trevor W.: https://aws.amazon.com/xray/ 
09:40:35 AM Trevor W.: https://aws.amazon.com/xray/faqs/ 
09:40:47 AM Trevor W.: https://aws.amazon.com/xray/getting-started/ 
09:41:02 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
09:41:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: just tell me 
09:41:16 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: what is client IP in X-Forwarded-For header
09:43:26 AM Trevor W.: It is a HTTP header that is included by the client that is sending a HTTP request.....for example to an Application Load Balancer.  The ALB supports this header and the other X-Forwarded HTTP headers and the ALB passes the header to the target application
09:44:13 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so will it contain the target private IP address
09:44:18 AM Trevor W.: Regarding X-Forwarded-For header, it can be logged in the target application access logs and it includes the source clients IP address
09:44:25 AM Trevor W.: Yes correct
09:44:41 AM Trevor W.: https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html#availability-zones 
09:44:49 AM Trevor W.: Sorry
09:44:56 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we can get the target instance IP address in this  X-Forwarded-For header 
09:45:02 AM Trevor W.: https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html#availability-zones 
09:45:22 AM Trevor W.: Please see the 'HTTP headers' section of that link I added
09:45:55 AM Trevor W.: No you can see the Source Clients IP address that sent the original request
09:46:21 AM Trevor W.: This source IP address is added to the  X-Forwarded-For header
09:46:33 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we cannot see the target instance IP address 
09:46:40 AM Trevor W.: what target
09:46:55 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Ec2 instance running behing load balancer
09:47:03 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: *behind
09:47:25 AM Trevor W.: That target IP address is logged in the LB access logs
09:48:03 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: access log is fine.
09:48:16 AM Trevor W.: For example in ALB, this data is logged in the 'target:port' field
09:48:21 AM Trevor W.: https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html 
09:48:47 AM Trevor W.: and also the 'target:port_list' field
09:49:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Okay
09:49:09 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: my aim is here
09:49:38 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: when i get 5xx error, i want to know which target instance caused 5xx error
09:49:45 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is there any way ?
09:49:48 AM Trevor W.: yes
09:49:52 AM Trevor W.: access logs
09:50:34 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: access logs cannot be exported to cloudwatch , there is no AWS services to export it right... am i right
09:50:36 AM Trevor W.: Acess logs log 'elb_status_code' and also 'target_status_code'
09:51:07 AM Trevor W.: One moment
09:51:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
09:58:01 AM Trevor W.: ELB Access logs can only be pushed to an S3 bucket. They cannot be pushed to Cloudwatch Logs
09:58:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes
09:58:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so is there any way to get Instance IP address when the error occurs 
09:58:45 AM Trevor W.: However you can use the  Amazon Athena service to query data stored in an S3 bucket
09:58:53 AM Trevor W.: https://aws.amazon.com/athena/?whats-new-cards.sort-by=item.additionalFields.postDateTime&whats-new-cards.sort-order=desc 
09:59:14 AM Trevor W.: You can investigate the access logs
09:59:23 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thank
09:59:25 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
10:02:35 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is there anyway
10:02:35 AM Trevor W.: If ELB or Target 5XX errors are generated, you can have CW alarms monitoring these metrics and if the errors are generated, the configured threshold will be breached and the CW Alarm will be triggered. This alerts you to 5XX errors being generated. You can see these errors in the corresponding metrics and verify the time-frame or time-stamp.  Then you can located the access log lines that will contain the ELB/Target 5XX codes and you can verify what target generated the error or errors
10:02:57 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it wont help 
10:03:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if there is no other way we can close the chat
10:04:14 AM Trevor W.: OK sure, have a nice day.
10:04:20 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Oct 05 2021
14:58:24 GMT+0530 (India Standard Time)
connecting again 


>>>>>>>>>>>>>

114. Chat: what is the size unit

The below is s3 event send to lambda , when objected created in S3.

we need clarification on "size': 44962" what is it. is it byte or kb ?

{'Records': [{'eventVersion': '2.1', 'eventSource': 'aws:s3', 'awsRegion': 'us-east-1', 'eventTime': '2021-09-28T13:37:43.479Z', 'eventName': 'ObjectCreated:Put', 'userIdentity': {'principalId': 'AWS:AROASNAO7RA3LQ6VGADQD:surendar.s@optum.com'}, 'requestParameters': {'sourceIPAddress': '198.203.181.181'}, 'responseElements': {'x-amz-request-id': 'VGQ64QA7X1WSPQM0', 'x-amz-id-2': 'CgGxJ0lHezKAKlSBf0V10N51jY5X1CQDm64BPClwX1wHMX9Ix6H2ZlnlObSKA9TvV2oLyWKaJhcX1n4VrYgCdBD4/9zNY3rB'}, 's3': {'s3SchemaVersion': '1.0', 'configurationId': '95a76dbc-dd5c-44cb-8261-35e8edc77c16', 'bucket': {'name': '165387667510-glue-test-arun', 'ownerIdentity': {'principalId': 'A1WFLLUBFXM8WI'}, 'arn': 'arn:aws:s3:::165387667510-glue-test-arun'}, 'object': {'key': 'logs/suren-logs/411002352175_elasticloadbalancing_us-east-1_app.ol-prod-alb.4f06c9a508d0ed72_20210928T0000Z_34.198.178.175_4f1cs1gc.log.gz', 'size': 44962, 'eTag': '160313b3e3d0a32c4adee8038f70063f', 'sequencer': '0061531AAC8171A7D5'}}}]}
Bucket Name: 
Request ID(s): 
Extended Request ID(s): 
Tool (and Version) Used?: 


>>>>>>>>>>>

115. Chat: how to monitor ELB metrics and target instances

Hi Surendar,

It was a pleasure talking to you on the chat. Your query was that you wanted to know how to monitor ELB metrics and target instances. 

As mentioned on the chat, you can use the CloudWatch metrics to do so. Please check the link attached below for further information. [1]

If you have further query regarding the cloudwatch metrics I would suggest opening a case with the CloudWatch team as right now you have opened the case in the AWS Config team. AWS Config is a separate service in itself. 

Now, I will be marking this case as archived for now. However, if you face any issues related to AWS config feel free to open another case with us and we would be glad to assist you.

Have an AWSome day!

References:-
[1] https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
SHASHANK S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8959902121&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Sep 28 2021
11:22:35 GMT+0530 (India Standard Time)
05:56:28 AM SHASHANK: Hello, my name is SHASHANK.  I'm here to help you today.
05:58:01 AM SHASHANK: May I know your name please?
05:59:46 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
05:59:55 AM SHASHANK: Hi Surendar, how are you doing today?
06:00:02 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is there any way to monitor the ELB metrics
06:00:10 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: like 5xx errors
06:00:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am good thanks. hope you doing great
06:01:00 AM SHASHANK: Yes, you can use the CloudWatch metrics to do so. 
06:01:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: actually this 5xx metris doesnt have instance ID dimension, but we need to find which target instance producing the error
06:01:07 AM SHASHANK: Please see: https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html 
06:01:58 AM SHASHANK: Ok, if you have further query regarding the cloudwatch metric i would suggest opening a case with the CloudWatch team as right now you have opened the case in the AWS Config team.
06:02:11 AM SHASHANK: AWS Config is a separate service in itself. 
06:07:11 AM SHASHANK: Are we still connected?
06:12:30 AM SHASHANK: I believe that we are no longer connected so I will be disconnecting this chat and sending a chat summary on the case. 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Sep 28 2021
11:22:06 GMT+0530 (India Standard Time)
need assistance on this 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Sep 28 2021
11:14:52 GMT+0530 (India Standard Time)
how to monitor ELB metrics and target instances

>>>>>>>>>>>>

116. Chat: Need clarification on metric filter and event from cloudwatch log group

Hello,

We haven't heard back from you regarding case 8955757971 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=8955757971&displayId=8955757971&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Wed Sep 29 2021
19:05:11 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

It is Tomasz again from AWS Premium Support. I hope this email finds you well.

After testing the function from the attached GitHub repository I saw that it successfully created a new log group, but no log events were uploaded. It seems that there is a problem with listening for the "close" event on the readline interface (line 184) [1]. The event never gets emitted. 

Unfortunately, we cannot provide support with troubleshooting Lambda source code. You will need to reach out to your software development team in order to find out why your functions are not able to push all the events to CloudWatch. 

From our side, I can confirm that there are no issues with throttling, so the next step would be to troubleshoot the source code.

I hope you will find this information useful. Please do not hesitate to let us know if you have additional questions. 

References:
[1]. https://github.com/amazon-archives/cloudwatch-logs-centralize-logs/blob/ef8e4972f3cb73c6bb92cb53323ca72216dcf38c/index.js#L184 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Tomasz K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8955757971&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Sep 29 2021
10:43:09 GMT+0530 (India Standard Time)
Hi, Thanks for your response. kindly let me know once you have re produced the issue and found fix for this.


Amazon Web Services


Wed Sep 29 2021
05:38:38 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

It is Tomasz again from AWS Premium Support. I hope this email finds you well.

I did some tests on my end and found that there are no issues with pushing hundreds of log events to CloudWatch in a single batch as long as it doesn't exceed the maximum allowed size, which is 1,048,576 bytes. I generated over 500 access log events and pushed them with a single PutLogEvents call without any issues. After a short while, they became available in Logs Insights and I saw that the number of events in my stream was the same as the number that was pushed:

	stats count(*)
	
	Result: 512
	
I also reviewed the history of API calls in your account for the past 12 hours. I did not see any throttled actions, which indicates that the root of the problem might lie somewhere in the source code of that script. 

Currently, there is no mechanism officially supported by AWS to push ELB access logs directly to CloudWatch. Please note that AWS can only provide code samples that need to be modified to match our customers' environments. 

I think the easiest solution here would be to simply monitor the metrics that are already generated by your load balancers [1], primarily the: HTTPCode_Backend_4XX, HTTPCode_Backend_5XX, HTTPCode_ELB_4XX and HTTPCode_ELB_5XX, which already contain information about the number of backend/ELB 5xx and 4xx errors. The downside is that there is no way of extracting the ID of the instance that generated the errors.

Nevertheless, I will test the linked script in my lab environment and try to reproduce this issue. The test that I mentioned previously was performed by executing the put-log-events AWS CLI command, which in turn calls the PutLogEvents API call. Please await my response tomorrow with the result of the test.

I hope you will find this information useful. Please do not hesitate to let us know if you have additional questions. 

References:
[1]. https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/elb-cloudwatch-metrics.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Tomasz K.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8955757971&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 

>>>>>>>>>>>>>>>

117. Chat: Container image is built and component download fails

Hello,

We haven't heard back from you regarding case 8954058001 for a while. For continued support regarding the same issue, you can contact us any time using the following URL:
https://console.aws.amazon.com/support/home?#/case/?caseId=8954058001&displayId=8954058001&language=en 

Please note that no action is required on your part if you wish this case to be resolved. However, if you want to close this case yourself, you could do so via the Support Center. If we haven't heard back from you within the next 72 hours we will mark the case as Resolved, although you can re-open the case any time using the link above.

Best Regards,

Amazon Web Services


Amazon Web Services


Thu Sep 30 2021
20:39:04 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello,

Josh here once more,

I was able to successfully create a dockerimage pipeline, and was able to ensure that the ecr repository had the image after completion. I was not able to induce the same error that you are seeing despite ensuring as best as possible that the same setup was used.

---------------------------------------------------------------------------------
failed to sign request: failed to retrieve credentials: no EC2 IMDS role found, operation error ec2imds: GetMetadata, canceled, context deadline exceeded.
---------------------------------------------------------------------------------

======================================================
In terms of replication, I ensured that the security group had the same rules as yours in the group 'sg-0d52f2cfec462d08b'. I ensured that the route table was configured correctly with the route table of the instance in subnet-0b236cac089949cdc had the default route as the Nat Gateway 'nat-09695e287017cf0e6' this Nat gateway is located in the subnet  subnet-0743006d1d3d85cd2 in the same vpc and has an Internet Gateway (igw) as it's default route. Further I include the s3 gateway endpoint although with the Nat in place the instance can reach the internet. 

I then created the same image recipe, choosing the docker image, and then amazon linux 2, followed by the update-linux component. I also ensured that the same IAM policies of 'EC2InstanceProfileForImageBuilder', 'EC2InstanceProfileForImageBuilderECRContainerBuilds', 'AmazonSSMManagedInstanceCore', and  'AmazonS3FullAccess' were in the role I assigned to the instance config. 
======================================================

In order to gather more information I ask that you please create the pipeline once more, ensuring the the output logs are written to an s3 bucket as we were not seeing them in the cloudwatch log groups and then please send the logs to me on the case for further review. I can suggest as a troubleshooting step that you see if a user with higher privileges is able to run the pipeline, this may give some further insight.

Please let me know if you have any questions on the above.

References:
[1] https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html#instance-metadata-v2-how-it-works 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Joshua L.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8954058001&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Sep 30 2021
14:13:15 GMT+0530 (India Standard Time)
08:50:53 AM Francois: Hello, my name is Francois.  I'm here to help you today.
08:51:16 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi Francois, I am Pravin here..
08:51:29 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hope you saw the case 
08:51:31 AM Francois: Hi Pravin, nice to meet you.
08:51:36 AM Francois: Im currently having a look
08:51:49 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Sure. 
08:53:27 AM Francois: So I see my colleague Joshua had provided a workaround in his previous correspondence. Had you attempted the workaround provided by him?
08:53:53 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: actually I am not clear..
08:54:04 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Do I need to follow the same steps as i did before ?
08:54:34 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: https://docs.aws.amazon.com/imagebuilder/latest/userguide/start-build-container-pipeline.html 
08:56:31 AM Francois: Im just having a look at your previous build attempt, one moment
08:56:40 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: sure sure
09:00:18 AM Francois: Im having some trouble locating the execution you referenced in the case. Can you confirm the pipeline name
09:01:08 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: one second
09:02:55 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Execution ID: 11ca79c9-8878-4398-8a61-e7e42ab284c1
09:03:19 AM Francois: ok one moment. 
09:04:02 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Pipeline name - Dockertest
09:10:17 AM Francois: Ah ok. SO I got a hold of Joshua, he is available so I will transfer you chat through to him (Seeing as he was able to replicate). One moment
09:11:32 AM Josh: Hey Pravin - can we get on a screenshare
09:12:39 AM Josh: https://screenshare.aws/?ak=bf5783d11817e968f759b275569da641 
09:12:40 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes please..



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Thu Sep 30 2021
14:13:01 GMT+0530 (India Standard Time)
Hi Joshua,

Please let me know your available time today to have the image create and tested.

Thanks,
Pravin

>>>>>>>>>>>>>>>>>>>

118. Chat: how to analyze the access log in cloudwatch

Hello Surendar,

Unfortunately the chat got disconnected. Here is a quick recap of the conversation we had for your reference. 

You reached out as you wanted to know if ELB Access logs can be sent to Cloudwatch for analysis to achieve a custom use case.

At the moment there is no feature available as of now to send ALB logs directly to CloudWatch logs, but there is already a feature request in place internally to introduce this feature in future. However, unfortunately, we do not have an ETA as to when this feature will be available. However I do encourage you to keep in touch with our community pages so that when it does get implemented, we will announce the release on our Whats new page [1] or AWS Blog [2].

Another way to analyze access logs is by using AWS Athena. Amazon Athena is an interactive query service that makes it easy to analyze data in Amazon S3 using standard SQL [3]. You mentioned you had already tried Athena and it does not suit your requirement.

I did some research on my end and I was able to find third party article from GitHub [4] that provides information about achieving this use case using a Lambda function. The flow would would be:

ALB-----> S3 -----> Lambda -----> CloudWatch 

Once you have ALB access logs enabled and stored into S3 bucket, to export these logs to CloudWatch you can use a sample script for ALB logs. This script can be customized and by referencing this article from GitHub in which basically a triggered Lambda function (by new S3 objects/logs) pulls your logs from S3 and then sends them to CloudWatch. 

I would like to inform you that the work around is from a third party article and unfortunately I would not be able to comment on the working of it, as it is out of scope of my expertise. I have provided the information to best of my knowledge.

I hope you find this information helpful. Should you have any other queries, please reach out to me and it will be my pleasure to assist you further. 

For Reference:

[1] Whats new page - https://aws.amazon.com/new/ 
[2] AWS Blog - https://aws.amazon.com/blogs/aws/ 
[3] Querying Application Load Balancer Logs  - https://docs.aws.amazon.com/athena/latest/ug/application-load-balancer-logs.html 
[4] https://github.com/amazon-archives/cloudwatch-logs-centralize-logs  ---> CloudWatch Logs Centralize Logs

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Mohammed S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8952996421&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Mon Sep 27 2021
10:23:42 GMT+0530 (India Standard Time)
04:55:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi Mohammed, My name is surendar
04:55:28 AM Mohammed: Hello, my name is Mohammed.  I'm here to help you today.

04:55:37 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I need clarification on ELB access logs
04:55:38 AM Mohammed: Hey Surendar.. how are you doing today
04:55:48 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am good, thanks for asking
04:56:06 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: How to import cloudwatch logs to cloudwatch
04:56:25 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and is there any metrics which with Instance ID dimenstion
04:57:15 AM Mohammed: I understand you want to send ELB Access logs to cloudwatch. Please correct me?
04:57:24 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
04:57:53 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: use case - there are three instance is running under the application load balancer, one specific instance is producing 5xx error. how to find that instance IP or instance ID
04:59:31 AM Mohammed: for your case, you can look into access logs at the time of 5xx errors. In the logs you will see (type of request, time, ALB name, client:port, target:port ....along with more details) 
05:00:05 AM Mohammed: unfortunately you cannot send access logs to cloudwatch. 
05:00:31 AM Mohammed: You need to enable access logs on your ELB, and configure it to send to S3 bucket
05:00:40 AM Mohammed: in the S3 bucket you can see the logs
05:01:05 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so is there any way to find target instance ID which causing the error
05:01:17 AM Mohammed: yes 
05:01:39 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if you want me use some other services, i am agree with use any services
05:02:01 AM Mohammed: once you know the target IP from Access log (type of request, time, ALB name, client:port, target IP:port ....) 
05:02:22 AM Mohammed: you can get the Instace ID from the IP
05:02:32 AM Mohammed: https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html#log-processing-tools 
05:02:43 AM Mohammed: Amazon Athena is an interactive query service that makes it easy to analyze data in Amazon S3 using standard SQL.
05:03:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is there anything apart from athena 
05:03:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because we tried athena already it is not suits for our requirement 
05:04:14 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we need to completely automate - finding the instance ID and use SSM to restart the application service inside the instance and tag it 
05:05:12 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: if issue occurs again on same instance we will verify the tag whether it is present or not. if tag already set then we will deregister that specific instance
05:05:32 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so running athena query is not good one for this 
05:06:08 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we need to analyse the log seamlessly like anomaly detection 
05:06:36 AM Mohammed: let me see if there are any other ways. Please standby
05:07:04 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
05:19:05 AM Mohammed: Appreciate your patience. I found a workaround to push Access logs from ALB to cloudwatch
05:19:14 AM Mohammed: ALB-----> S3 -----> Lambda -----> CloudWatch 
05:19:34 AM Mohammed: you can read more on this here 
05:19:34 AM Mohammed: https://github.com/amazon-archives/cloudwatch-logs-centralize-logs 
05:22:19 AM Mohammed: I would like to mention that this is a third party solution and we can not really support this however you may wish to explore this option for your use case. 
05:22:35 AM Mohammed: let me know if you have further queries
05:23:15 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: one moment 
05:23:42 AM Mohammed: yes sure
05:28:57 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: this is repo is archive right
05:29:01 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: will it work
05:29:30 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: because cloudwatch logs are json formated, ELB access log is not json type right



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Mon Sep 27 2021
10:22:55 GMT+0530 (India Standard Time)
how to analyze the access log in cloudwatch

Is there any metric which with InstanceID dimenstion
ELB FQDN: 

>>>>>>>>>>>>>>>>>>>>

119. Call: Code build fails to spin EC2 from AMI

Hello Pravin, 

Thank you for your time on call. It was nice talking to you. 

You reached out as your codebuild was failing to create EC2 instances for building AMIs via packer. 

Over screenshare, you have mentioned that the base AMI being used is a custom AMI and we tried to launch an instance directly from EC2 console using that AMI. The instance launched failed immediately and the instance was terminated. 

I checked the instance timeline on my end and I could see that it tried to attach a volume but then terminated. I checked the volume properties and could see that it is encrypted with a KMS key. You then checked that KMS key and found that it is in Pending deletion state. 

You have a theory on what could be causing this as you are using terraform and it is deleting the resources it previously created there by causing issues when dependent resources are trying to access the already deleted resources. I suggested you to keep the KMS key outside your terraform stack which needs to be destroyed after use. You can refer the below link to import existing KMS keys. 

https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key#import 

Like I said, helping with terraform scripts falls out of our support scope [1] and you mentioned that you can try this on your end. Thank you for your understanding. 

Further, we have checked the KMS key used in one of your successful builds but couldn't find that key in your console. I tried to check the key with its ID using the resource name filter in CloudTrail and also via the API calls ScheduleKeyDeletion [2], DisableKey [3] but unfortunately I could not find the key. I checked for the API calls over the last 90 days. You can reach out to our KMS key as they are well equipped to help you on KMS related issues. 

As agreed, I am closing this case since there is no pending action from codebuild and the build is failing due to reasons external to codebuild. Feel free to reach out on new cases for any new queries or concerns. We will be glad to assist. 

Have a great day ahead !! 

Reference links :
[1] https://aws.amazon.com/premiumsupport/#Scope_of_AWS_Support 
[2] https://docs.aws.amazon.com/kms/latest/APIReference/API_ScheduleKeyDeletion.html 
[3] https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Rajath V.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8944267711&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Sat Sep 25 2021
10:20:49 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hello Pravin, 

Please join here : https://chime.aws/9179139073 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Rajath V.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8944267711&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_165387667510_Contributor/pravinks@optum.com (Role)


Sat Sep 25 2021
10:10:53 GMT+0530 (India Standard Time)
Hi Team,

Code build fails to spin EC2 from AMI. However the same ami worked fine earlier when spinning the EC2 instance. Need to confirm if the volume related to ami is deleted or how.

Thanks,
Pravin
Region: 
Project Name: 
Build Run: 
Have you attached the buildspec.yml: 

>>>>>>>>>>>>>>

120. Chat: Traffic from EC2 instance over :5000

Hello Wyatt, 

Thank you for contacting AWS Premium Support. It was a pleasure having you over the chat/call today. 

To summarize our conversation over the chat/call, you wanted to know more information on why  the traffic from one EC2 Instance is egressing on port 5000.

As per our discussion, We have discussed few possibilities of this happening
1.) Some  one SSHed into the Instance and did a telent on port and IP.
2.) Also, as we only see 1 flow logs pattern and Instance is deleted,  I recommended you to observe any such pattern in any other EC2 Instances and take a packet capture so that we can get more information on what's happening.

Please let me know if I can further clarify any of the above, or answer any additional questions.

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Ravi Chandra Sekhar B.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8941524341&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Sat Sep 25 2021
00:39:09 GMT+0530 (India Standard Time)

Translate
This case has been resolved. Please contact us again if you need further assistance.


AWS_165387667510_Owner/wyatt_andersen@optum.com (Role)


Fri Sep 24 2021
22:29:35 GMT+0530 (India Standard Time)
(Adding the log event for reference.)

1632388115000,5 165387667510 eni-03adf45840f55b6e2 156.240.66.32 20.0.130.195 5000 5732 6 3 180 1632388115 1632388123 ACCEPT OK vpc-0a517404b810ce6e1 subnet-0e8f19953b5797aab - 18 IPv4 156.240.66.32 20.0.130.195 us-east-1 use1-az6 - - - - ingress -
1632388115000,5 165387667510 eni-03adf45840f55b6e2 20.0.130.195 156.240.66.32 5732 5000 6 3 120 1632388115 1632388123 ACCEPT OK vpc-0a517404b810ce6e1 subnet-0e8f19953b5797aab - 4 IPv4 20.0.130.195 156.240.66.32 us-east-1 use1-az6 - - - - egress 8


AWS_P0001489@optum.com


Fri Sep 24 2021
21:57:58 GMT+0530 (India Standard Time)
04:40:40 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Hi!
04:40:43 PM Ravi Chandra Sekhar: Hello, my name is Ravi Chandra Sekhar.  I'm here to help you today.
04:40:54 PM Ravi Chandra Sekhar: May I have your name please..?
04:41:19 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Wyatt
04:42:02 PM Ravi Chandra Sekhar: Hi Wyatt, Allow me a moment while i can review your case notes
04:42:09 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Thanks1
04:44:54 PM Ravi Chandra Sekhar: I do see that you are seeing Egress communication over the port 5000. I don't have access to see your flow logs so can we do a screenshare..?
04:47:09 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Sounds good, send me a link and I'll get on.
04:48:06 PM Ravi Chandra Sekhar: https://screenshare.aws/?ak=12ac4cff68603b6db9a9524c865cc713 
04:51:48 PM Ravi Chandra Sekhar: can you share those flow logs on the chat window both of them
05:03:58 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: 
1632388115000,5 165387667510 eni-03adf45840f55b6e2 156.240.66.32 20.0.130.195 5000 5732 6 3 180 1632388115 1632388123 ACCEPT OK vpc-0a517404b810ce6e1 subnet-0e8f19953b5797aab - 18 IPv4 156.240.66.32 20.0.130.195 us-east-1 use1-az6 - - - - ingress -
1632388115000,5 165387667510 eni-03adf45840f55b6e2 20.0.130.195 156.240.66.32 5732 5000 6 3 120 1632388115 1632388123 ACCEPT OK vpc-0a517404b810ce6e1 subnet-0e8f19953b5797aab - 4 IPv4 20.0.130.195 156.240.66.32 us-east-1 use1-az6 - - - - egress 8
05:05:09 PM Ravi Chandra Sekhar: So Wyatt, I have reviewed them looks from the flow first one is ingress 
05:05:36 PM Ravi Chandra Sekhar: in other words we are seeing TCP Connection coming from the Source IP 156.240.66.32
05:08:33 PM Ravi Chandra Sekhar: if the IP doesn't look familiar, we recommend you to restrict the Instance's Security groups for the incoming port and IP's
05:12:41 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: I'm going back in the cloud trail logs, but I thought that SG did not allow ingress on :5000, are you saying it did? 
05:14:45 PM Ravi Chandra Sekhar: The EC2 Instance that you have sent me "i-02d486bd799507eff" has been tereminated, So i don't have access to see to what SG and NACL's it was associated ..
05:14:55 PM Ravi Chandra Sekhar: ealier
05:15:00 PM Ravi Chandra Sekhar: earlier*
05:15:10 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: sg-011f9c625999f72a9

05:18:05 PM Ravi Chandra Sekhar: Checking
05:20:05 PM Ravi Chandra Sekhar: is this the VPC vpc-0a517404b810ce6e1 the Instance was part of..? 
05:20:48 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Yes
05:21:07 PM Ravi Chandra Sekhar: because I don't see this VPC in this AWS Account..
05:21:26 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Right, the VPC, SG, EC2 instance, etc. have all been deleted.
05:21:42 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: I'm just looking at logs. 
05:22:34 PM Ravi Chandra Sekhar: Unfortunatley, we don't have access to the above VPC and SG's once they were deleted
05:23:20 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Can you see the CloudTrail events? 
05:23:39 PM Ravi Chandra Sekhar: Yes, I was checking them to see if i can see any details
05:23:43 PM Ravi Chandra Sekhar: or not
05:30:10 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Thanks, my read is that this SG never allowed ingress on :5000. At first I thought that it EGRESSED on :5000 which it would have been allowed to do by the SG, but I don't know why it would have done that (that's why I opened the ticket). If you're saying this was INGRESS then I want to confirm that the SG should have blocked that.  
05:31:16 PM Ravi Chandra Sekhar: Sure please give me your phone number, I can call you
05:31:38 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: Can I send you a teams invite? 
05:31:43 PM Ravi Chandra Sekhar: Sure
05:32:25 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: https://teams.microsoft.com/l/meetup-join/19%3ameeting_NGJjYTEzNTQtOTQwYS00ODQyLWE5MDctYmUzZWFkNTBjYmU1%40thread.v2/0?context=%7b%22Tid%22%3a%22db05faca-c82a-4b9d-b9c5-0f64b6755421%22%2c%22Oid%22%3a%227d34456d-2191-46a9-b436-2418312aa38a%22%7d 
05:44:32 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: August 26, 2021, 08:11:46 (UTC-05:00)
06:01:37 PM assumed-role/AWS_165387667510_Owner/wyatt_andersen@optum.com: August 26, 2021, 08:17:48 (UTC-05:00)



AWS_165387667510_Owner/wyatt_andersen@optum.com (Role)


Fri Sep 24 2021
21:57:52 GMT+0530 (India Standard Time)
I see egress from an EC2 instance over :5000, I'm wondering if that's "normal" - https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Flp$252Fcl$252Fvpcflowlogs/log-events/eni-03adf45840f55b6e2-all$3Fstart$3D-259200000$26filterPattern$3D156.240.66.32 . The EC2 is just running an AWS base image (ami-0ab4d1e9cf9a1215a). We've spun the instance down, this was just up for a POC.
VPC ID: vpc-0a517404b810ce6e1
Instance ID(s): i-02d486bd799507eff
Region: 
NAT Gateway ID (If Applicable): 
VPC Peering Connection ID (If Applicable): 
VPC Endpoint ID (If Applicable): 

>>>>>>>>>>>>>>>>>>>>>

121. Chat: Need Clarification on integration

Hi Surendar,

This is Sheeja here from AWS. I hope you are well. Please see below a quick summary of our call. 

You reached out to us because you wants clarify few details regarding Cognito userpool. Apologies for the delay in getting back to you. 

You have setup federation to your Cognito userpool using Ping and noticed that a user getting created in Cognito userpool when the federated user sign in to AWS cognito and I confirmed that this is normal behaviour as outlined here[1]. 

You wanted to know what is the significance of the Last Modified property of the user created in the userpool. When a user signs in through an identity provider, Cognito updates the mapped attributes with the latest information from the identity provider. Amazon Cognito updates each mapped attribute, even if its current value already matches the latest information. Cognito updates this time stamp every time a user sign in through an Identity Provider. If Amazon Cognito can't update the attribute, it throws an error. Please refer to this link[2] for more information on this. 

You also wanted to know where does Cognito store the Access and ID tokens. AWS Cognito does not store any of these tokens. If you choose the Implicit grant flow, the tokens are returned in the redirect URL. If you choose, Authorization code grant flow, Cognito will return an Authorization code in the redirect url which your application then use to request for Access and ID token. AWS strongly recommended that you secure all tokens in transit and storage in the context of your application. 

I hope the information provided is helpful to you. Please let me know if you have any further questions and I will be happy to assist. 

References:
[1] OIDC User Pool IdP Authentication Flow  - https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-oidc-flow.html 
[2] Specifying Identity Provider Attribute Mappings for Your User Pool  - Things to know about mappings - https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-specifying-attribute-mapping.html#cognito-user-pools-specifying-attribute-mapping-requirements 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Sheeja S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8940309561&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


Amazon Web Services


Fri Sep 24 2021
22:48:04 GMT+0530 (India Standard Time)
Was this response helpful? Click here to rate:


Translate

Hi Surendar,

Thank you for contacting AWS Premium Support. 

You have setup your Cognito userpool with federated access using Ping. You have some questions that you are looking to get some explanations to know how certain things work in Cognito. As agreed, I will call you tomorrow at 4 pm IST to discuss. Please let me know if there is any change.   

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Sheeja S.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8940309561&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Fri Sep 24 2021
17:08:36 GMT+0530 (India Standard Time)
00:02:51 PM Sheeja: Hello, my name is Sheeja.  I'm here to help you today.
00:03:14 PM Sheeja: May I know your name please while I review your case?
00:03:27 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: HI 
00:03:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
00:03:41 PM Sheeja: Hi Surendar, How are you ?#
00:04:00 PM Sheeja: Can you please elaborate on your query?
00:04:20 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have setup cognito with PING federate
00:04:27 PM Sheeja: ok
00:04:46 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: whenever user accessing the application user name is created at user pools
00:04:57 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is it normal behaviour
00:05:10 PM Sheeja: Yes
00:05:11 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and can we have chime session to understand the workflow of cognito
00:05:29 PM Sheeja: Sure
00:06:21 PM Sheeja: Click to join the meeting: https://chime.aws/9790020732 
00:07:36 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: joining in
00:17:10 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: 8608888285
00:17:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: +91-8608888285
00:18:40 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: surendar.s@optum/.com
00:18:47 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: surendar.s@optum.com 

>>>>>>>>>>>>>>>>>>>>>>

122. Chat: how to find the faulty instance under load balancer when 5xx error occur

04:31:11 PM Usamah: Hello, my name is Usamah.  I'm here to help you today.
04:32:00 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
04:32:05 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: My name is surendar
04:32:18 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i am facing one issue
04:32:31 PM Usamah: How are you
04:32:40 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: not bad
04:32:44 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how are you
04:32:55 PM Usamah: I am doing well
04:33:16 PM Usamah: you want  to find out EC2 instnace which is faulty in the backend 
04:33:27 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes yes
04:33:30 PM Usamah: behind your load balancer
04:33:37 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
04:33:40 PM Usamah: Xray service is being used
04:33:47 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: not yet
04:34:11 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: first just wanted to know whether it is possible , if yes i wil implement
04:34:58 PM Usamah: can you clarify your use case with Xray
04:36:19 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i just wanted to use xray service to monitor all the request coming in to load balancer and if any 5xx error occurs, i want to see which backend instance caused this error
04:38:13 PM Usamah: thank you
04:38:14 PM Usamah: checking
04:38:23 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: ok
04:41:30 PM Usamah: you can track HTTP requests from clients to targets or other services.
04:42:05 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: okay
04:42:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: will it be helpful to get instance ID when it producing 5xx error
04:45:57 PM Usamah: we can see the by obtaining the x-amzn-trace-id but I am not seeing option to see the instance id
04:46:01 PM Usamah: which you are looking for
04:47:06 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we can confirm that we will not able to see instance ID when 5xx error occurs
04:47:09 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: am i right
04:47:41 PM Usamah: correct, checking few more options
04:47:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: kindly check 
04:48:07 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: and help me
04:58:09 PM Usamah: yes I done confirming
04:58:29 PM Usamah: you can see the errors in xay but not the instance id to point it towards



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Sun Sep 26 2021
21:58:20 GMT+0530 (India Standard Time)
is there any update


AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Fri Sep 24 2021
15:26:17 GMT+0530 (India Standard Time)
we have three instance running under load balancer. 15+ application running on instances.

we have configured the health check with one application out of 15 in target group.

issue is when the any application apart from the health configured application, load balancer is not marking the faulty instance as unhealhy
Region: 
Have you attached the X-Ray agent logs?: 

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

123. Chat: How to use application insight for application running on ec2

Hello Surendar,

Thanks for your time on chat today. I wanted to summarize our discussion and provide you some resources below for your reference.

You reached out to AWS Support to follow up on questions regarding CloudWatch Application Insights and determining the individual instance ID associated with "Problems Detected" in the console, for example "ALB: Backend 5XX errors".

During our chat, we reviewed the metrics available for the underlying Application Load Balancer "suren-Appli-4XYFBROT115R-1672460292.us-east-1.elb.amazonaws.com" which CloudWatch Application Insights uses.

The HTTPCode_Target_4XX_Count & HTTPCode_Target_5XX_Count metrics used to evaluate 4XX and 5XX errors returned by your backend target EC2 instances do not include a dimension for InstanceId per the documentation at [1] below. They include AvailabilityZone dimension however, so you can narrow the datapoints down to target instances in a specific AZ. For example, your current target instances are as follows:

Target group:  suren-ALBTa-194PP17WMKTN5 
i-0c7195a9fee912151 (us-east-1d)
i-00d8ef23608612c27 (us-east-1f)

You can view the HTTPCode_Target_4XX_Count metric in your CloudWatch console for us-east-1d [2] and us-east-1f [3] at the referenced links below.

To determine specific instances returning 4XX errors, you can either review the Load Balancer access logs [4] which includes this granular data, or you could consider customizing your CloudWatch agent configuration to collect log/metric data directly from the backend instances. In case you are using Microsoft IIS server, you can review Microsoft's guidance on troubleshooting 4XX errors including log locations at [5] below.

Lastly, I clarified the internal request we raised to our CloudWatch Application Insights team to submit a feature request to include InstanceId detail in "Problems Detected" in the console, such as the "ALB: Backend 5XX errors" identified issue you were working with.

I hope this information is helpful. Please feel free to reach back out if you have any other questions and I'll be glad to assist you further.


References:
[1] CloudWatch metrics for your Application Load Balancer - Application Load Balancer metrics - https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html#load-balancer-metrics-alb 

[2] us-east-1d - https://console.aws.amazon.com/cloudwatch/deeplink.js?region=us-east-1#metricsV2:graph=%7B%22metrics%22%3A%5B%5B%22AWS%2FApplicationELB%22%2C%22HTTPCode_Target_4XX_Count%22%2C%22LoadBalancer%22%2C%22app%2Fsuren-Appli-4XYFBROT115R%2Fc0775ff361f90783%22%2C%22AvailabilityZone%22%2C%22us-east-1d%22%5D%5D%2C%22stat%22%3A%22Sum%22%2C%22period%22%3A300%2C%22start%22%3A%222021-09-21T14%3A10%3A55Z%22%2C%22end%22%3A%222021-09-26T14%3A10%3A55Z%22%2C%22region%22%3A%22us-east-1%22%7D 

[3] us-east-1f - https://console.aws.amazon.com/cloudwatch/deeplink.js?region=us-east-1#metricsV2:graph=%7B%22metrics%22%3A%5B%5B%22AWS%2FApplicationELB%22%2C%22HTTPCode_Target_4XX_Count%22%2C%22LoadBalancer%22%2C%22app%2Fsuren-Appli-4XYFBROT115R%2Fc0775ff361f90783%22%2C%22AvailabilityZone%22%2C%22us-east-1f%22%5D%5D%2C%22stat%22%3A%22Sum%22%2C%22period%22%3A300%2C%22start%22%3A%222021-09-21T14%3A10%3A55Z%22%2C%22end%22%3A%222021-09-26T14%3A10%3A55Z%22%2C%22region%22%3A%22us-east-1%22%7D 

[4] Access logs for your Application Load Balancer - https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html 

[5] https://docs.microsoft.com/en-us/iis/troubleshoot/diagnosing-http-errors/troubleshooting-http-400-errors-in-iis 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Adam C.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8939423601&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Sun Sep 26 2021
19:10:57 GMT+0530 (India Standard Time)
01:49:47 PM Adam: Hello, my name is Adam.  I'm here to help you today.
01:49:52 PM Adam: May I have your name please?
01:51:44 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: HI
01:51:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i just follow up this case actually
01:52:27 PM Adam: Okay sure. Is this Surendar? I was just reviewing your case history
01:52:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Actually i setup the application insight, it is detecting 4xx status code error. but application insight is not showing target instance 
01:53:04 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes i am surendar
01:54:31 PM Adam: Okay thanks for the details. I see earlier in the case there was some confusion regarding the appropriate support team to engage
01:55:16 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes 
01:55:26 PM Adam: I see we did reach out to an internal CloudWatch team with questions about locating a specific instance ID that is passing 5xx errors, but that team has not responded yet (likely due to weekend hours)
01:55:46 PM Adam: So your current Application Insights config is monitoring an ELB with backend web instances, correct?
01:56:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes yes
01:56:58 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: it is detecting the 4xx error 
01:57:10 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but it is not showing target instance 
01:57:30 PM Adam: Could you confirm for me the region these resources are in? And if possible what type of Load Balancer you are using or the metric name?
01:57:40 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: us-east-1
01:58:47 PM Adam: Thanks, I see two ALB type load balancers in this region:

Sonarqube-test-1721225011.us-east-1.elb.amazonaws.com

suren-Appli-4XYFBROT115R-1672460292.us-east-1.elb.amazonaws.com
01:59:32 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes yes
01:59:34 PM Adam: Are you working with the second one?
01:59:39 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: suren-Appli-4XYFBROT115R-1672460292.us-east-1.elb.amazonaws.com
01:59:41 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
01:59:53 PM Adam: Thanks, I'm checking to see what details I can help with on the metrics
02:00:41 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes please
02:01:17 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i wanted to detect the 5xx or 4xx errors in elb ,and i need which target instance caused the error
02:04:28 PM Adam: Understood thanks
02:05:25 PM Adam: So checking the metrics available from the ALB itself, the 4xx and 5xx error metrics are in aggregate only from what I see: https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html#load-balancer-metrics-alb 
02:05:51 PM Adam: In other words, those metrics do not include a dimension for InstanceId
02:06:29 PM Adam: So instead I did a search for the CW metrics published in your account with a dimension for the target instances:

i-0c7195a9fee912151 and i-00d8ef23608612c27
02:07:24 PM Adam: I see several metrics being published by CloudWatch Agent config but I am not sure if any provide the detail you need for the 4xx or 5xx errors
02:07:56 PM Adam: Just for example there is a metric " ASP.NET Applications Requests in Application Queue "
02:08:22 PM Adam: So if the target instance was returning 5xx errors from a .NET application it's possible you might see this metric increasing at that time
02:08:48 PM Adam: Do you have a time frame when you were seeing 4xx or 5xx errors from the ALB?
02:09:46 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i can do that now also
02:12:29 PM Adam: Okay. I'm actually not seeing any data metrics for HTTPCode_Target_5XX_Count in your account in this region
02:12:31 PM Adam: Only 4xx
02:12:57 PM Adam: Checking a timeframe since 2021-09-21, this is what I can see in your load balancer: https://console.aws.amazon.com/cloudwatch/deeplink.js?region=us-east-1#metricsV2:graph=%7B%22metrics%22%3A%5B%5B%22AWS%2FApplicationELB%22%2C%22HTTPCode_Target_4XX_Count%22%2C%22LoadBalancer%22%2C%22app%2Fsuren-Appli-4XYFBROT115R%2Fc0775ff361f90783%22%5D%5D%2C%22stat%22%3A%22Sum%22%2C%22period%22%3A300%2C%22start%22%3A%222021-09-21T14%3A10%3A55.776Z%22%2C%22end%22%3A%222021-09-26T14%3A10%3A55.776Z%22%2C%22region%22%3A%22us-east-1%22%7D 
02:13:05 PM Adam: Let me know if you have any issues pulling that CW console link up
02:14:43 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: even it it is 4xx it suppose to show target instance right
02:15:43 PM Adam: InstanceID isn't a dimension in the HTTPCode_Target_4XX_Count metric from CloudWatch, but we do publish a dimension for AvailabilityZone that may help you isolate it
02:15:54 PM Adam: I am trying to get you a CloudWatch metric link now
02:16:02 PM Adam: Any specific time frame you are reviewing?
02:16:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: just now i produced the 4xx error code
02:17:40 PM Adam: Okay, so the metric link I shared above was the overall sum of 4xx errors from your ALB target group (both instances)
02:17:53 PM Adam: However we can also view the metric split by the AvailabilityZone metric
02:18:25 PM Adam: us-east-1b - https://console.aws.amazon.com/cloudwatch/deeplink.js?region=us-east-1#metricsV2:graph=%7B%22metrics%22%3A%5B%5B%22AWS%2FApplicationELB%22%2C%22HTTPCode_Target_4XX_Count%22%2C%22TargetGroup%22%2C%22targetgroup%2Fsonarqube%2Fe1525c890841fc21%22%2C%22LoadBalancer%22%2C%22app%2FSonarqube-test%2Fd5449ad0cf72e02e%22%2C%22AvailabilityZone%22%2C%22us-east-1b%22%5D%5D%2C%22stat%22%3A%22Sum%22%2C%22period%22%3A300%2C%22start%22%3A%222021-09-21T14%3A10%3A55Z%22%2C%22end%22%3A%222021-09-26T14%3A10%3A55Z%22%2C%22region%22%3A%22us-east-1%22%7D 

us-east-1f - https://console.aws.amazon.com/cloudwatch/deeplink.js?region=us-east-1#metricsV2:graph=%7B%22metrics%22%3A%5B%5B%22AWS%2FApplicationELB%22%2C%22HTTPCode_Target_4XX_Count%22%2C%22TargetGroup%22%2C%22targetgroup%2Fsuren-ALBTa-194PP17WMKTN5%2F3c0785f5f7d19757%22%2C%22LoadBalancer%22%2C%22app%2Fsuren-Appli-4XYFBROT115R%2Fc0775ff361f90783%22%2C%22AvailabilityZone%22%2C%22us-east-1f%22%5D%5D%2C%22stat%22%3A%22Sum%22%2C%22period%22%3A300%2C%22start%22%3A%222021-09-21T14%3A10%3A55Z%22%2C%22end%22%3A%222021-09-26T14%3A10%3A55Z%22%2C%22region%22%3A%22us-east-1%22%7D 
02:18:49 PM Adam: These equate to your instances here:

i-0c7195a9fee912151 (us-east-1d)
i-00d8ef23608612c27 (us-east-1f)
02:19:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: but if suppose i have multiple instance in availability zone we cannot  assume it 
02:19:39 PM Adam: Right, it's not granular to the instance ID level
02:20:02 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so we need to get correct instance id , we are should not assume 
02:21:18 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: is there any solution, that how to get instance ID when it produced 5xx and 4xx error
02:22:59 PM Adam: The metrics provided by ALB to CloudWatch are fixed and cannot be customized, but you can customize your CloudWatch agent configuration from each instance
02:23:50 PM Adam: So the two ways I would recommend checking, to see if they suit your use case, would be either A) enabling collection of HTTP logs/metrics on target EC2 instances in CloudWatch agent, or B) Enabling detailed access logs in the ALB
02:25:10 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: both solution will need some scripts to find the faulty target instance
02:25:55 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: how about cloudwatch anamoly detection service
02:26:03 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: will it helpful for me
02:26:58 PM Adam: There is a feature called Anomaly Detection in CloudWatch that will analyze an existing metric. I think that is more to help you automatically analyze whether metric datapoints are expected or unusual behavior
02:27:35 PM Adam: Your configuration is already collecting detailed metrics from your target instances using CloudWatch Agent
02:28:06 PM Adam: For example you are collecting metrics for:

 ASP.NET Application Restarts 
 Memory Available Mbytes 
 .NET CLR Exceptions # of Exceps Thrown / Sec 
02:28:34 PM Adam: If you need to collect more detail for your web developers to analyze failures, then I would recommend to add additional metrics or log collection in your CloudWatch Agent config
02:29:07 PM Adam: I am not able to tell what webserver config you use on your instances, but if you have Windows-level metrics (such as in perfmon) or logs that you can parse, you should be able to collect web responses such as 4xx or 5xx errors
02:29:56 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have a call 
02:30:42 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: chime session
02:31:58 PM Adam: We can do that
02:32:39 PM Adam: https://chime.aws/2665726849 

02:49:17 PM Adam: https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Anomaly_Detection.html 



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Sun Sep 26 2021
19:07:23 GMT+0530 (India Standard Time)
Is there any update on this case

>>>>>>>>>>>>>>>>>>>>>>>>>>>

124. Long running windows update

Hello Pravin

Teshaylan from AWS here, I trust you are well

Thank you for your time on chat earlier today, it was a pleasure speaking with you

In summary, you reached out for assistance with your Codebuild job which runs Windows updates were taking longer than usual, which was working faster previously 
On the call we reviewed the logs and we could see that when the build ran successfully, there were 2 windows updates that needed to be performed with a total download size of 800MB+, with CPU usage not exceeding 70-80%

With the current build run we could see that the windows updates required were 6 updates in total with over 2500MB+ in size, this was also causing the CPU usage to 100% which would cause the builds to run slower than usual.

As you mentioned on chat you will be increasing the capacity of the build instance an test if this works without the same issues we see in the current build, 
As you are using the Build image BUILD_GENERAL1_SMALL which has 2 vCPUs, i would suggest testing with a build image like BUILD_GENERAL1_MEDIUM which has 4 vCPU's. [1]

Once this has been tested please let me know if the issue still persists and we can investigate this further

If you have any further questions, you can attach them to your response and I will be happy to assist you further

Wishing you a great day ahead, Take care

--Resources--

[1] https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-compute-types.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Teshaylan P.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8893479041&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Sep 16 2021
13:26:44 GMT+0530 (India Standard Time)
07:58:20 AM Teshaylan P: Hello, my name is Teshaylan P.  I'm here to help you today.
07:58:28 AM Teshaylan P: May I know your name please?
08:02:15 AM Teshaylan P: I see from the case correspondence, you are updating your windows ec2 instance via Codebuild  and it is taking longer than usual?
08:03:09 AM Teshaylan P: Hello are we connected?
08:03:34 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: Hi Teshaylan, sorry missed the chat
08:03:40 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I am Pravin
08:04:15 AM Teshaylan P: No worries, Nice to meet you Pravin... Can you share the build ID where this is running?
08:06:03 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes actually codebuild is trying to run windows update by spinning instance and installing into it. It was working fine, however since yesterday I notice 
08:06:05 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: packer-amznwindows-codebuild:30d71c42-9a89-4da8-bbba-a6eabd6678f0
08:06:32 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: I tried to remove Windows update and run, it ran successfully then.
08:06:51 AM Teshaylan P: Ok sure, taking a look
08:08:02 AM Teshaylan P: I see there is currently a build running
08:08:40 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes correct.. if you see the logs
08:09:24 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com:  Windows Builder: Waiting for operation to complete (system performance: 100 % cpu; 87 % memory)...
08:09:59 AM Teshaylan P: Hmm so it seems the instance is maxing out the CPU
08:11:37 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: not sure is it because of instance capacity the windows update is failing
08:11:58 AM Teshaylan P: Checking the Cloudwatch logs, let me see what I can find
08:11:59 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: you can refer earlier failed logs too
08:16:11 AM Teshaylan P: Sure, few moments while i go through
08:16:49 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: sure
08:21:12 AM Teshaylan P: Can you share the build logs from this current running build
08:21:59 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#logEvent:group=/aws/codebuild/packer-amznwindows-codebuild;stream=30d71c42-9a89-4da8-bbba-a6eabd6678f0 
08:22:12 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: hope this helps
08:24:12 AM Teshaylan P: Unfortunately I will not be able to see view the logs from the link due to security reasons, are you able to download these logs and upload them to the case?
08:24:29 AM Teshaylan P: Alternatively we can jump on a quick screenshare?
08:25:12 AM assumed-role/AWS_165387667510_Contributor/pravinks@optum.com: yes sure u can provide me link for sharing
08:25:21 AM Teshaylan P: Ok sure, one moment
08:26:04 AM Teshaylan P: Click to join the meeting: https://chime.aws/3404345757 
Meeting ID: 3404 34 5757



AWS_165387667510_Contributor/pravinks@optum.com (Role)


Thu Sep 16 2021
13:26:30 GMT+0530 (India Standard Time)
Using code build to run the windows update within EC2 instance. Since yesterday notice the windows update running for longer time and fails. Same build went successful earlier.

>>>>>>>>>>>>>

125. Chat: need clarification on deploying lambda

Good Day Surendar,

I hope you have kept well since our chat the previous day.

Query: You had called in with the request of assistance in understanding the 'custom Lambda'  resources being created by sample template [1] provided by 'aws-samples'. This was due to the need of recreating / translating the solution into a 'serverless Terraform' execution.

During the call we observed and discussed the following:
1. Assistance with the Terraform technology is out-of-scope of AWS Premium support and we therefore assisted on a best-effort basis as we do not possess the necessary knowledge, tools for the issue.
2. I requested a secondary case be created with the DMS Lambda team in order to provide expertise in creating a standalone solution, which would thereafter be translated to Terraform.
3. We noted that it was not possible to directly convert a CloudFormation template custom resource & CFN Lambda Function definition to Terraform.
4. Since the 'aws-samples' template provided both Lambda functions as well as custom code update functions it made it extremely difficult to programmatic-ally convert to terraform even whilst built standalone without CloudFormation.
5. Both the assisting Lambda engineer and I agreed that the best course of action would be to make an exception and use CFN template as is provided by 'aws-samples' rather than convert it.
6. I also suggested the possible use of CloudFormation Command Runner in performing the role of update functions. However, this would still require the use of some CloudFormation resources which was being avoided due to company preference.


We ended the call agreeing that you would test rebuilding the solution in Terraform and if this does not succeed, consult with others regarding the use of the CFN template [1], directly. 
Should you have any further questions of concerns please let me know.
Till then, wishing you good health and safety this COVID-19 period

References:
[1] CloudFront authorization@edge
https://github.com/aws-samples/cloudfront-authorization-at-edge/blob/5635cfd7b2333c6d8b1d1eea3a6d5e809e28296e/template.yaml 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Mohammed G.
Amazon Web Services

===============================================================

To contact us again about this case, please return to the AWS Support Center using the following URL:

https://console.aws.amazon.com/support/home#/case/?displayId=8888147661&language=en 

(If you are connecting by federation, log in before following the link.)

*Please note: this e-mail was sent from an address that cannot accept incoming e-mail. Please use the link above if you need to contact us again about this same issue.

====================================================================
Learn to work with the AWS Cloud. Get started with free online videos and self-paced labs at 
http://aws.amazon.com/training/ 
====================================================================

Amazon Web Services, Inc. is an affiliate of Amazon.com, Inc. Amazon.com is a registered trademark of Amazon.com, Inc. or its affiliates.


AWS_P0001489@optum.com


Wed Sep 15 2021
16:41:52 GMT+0530 (India Standard Time)
11:20:34 AM Mohammed  : Hello, my name is Mohammed  .  I'm here to help you today.
11:20:41 AM Mohammed  : May I please have your name?
11:22:19 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My name is surendar
11:22:26 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have doubt in cloudformation template 
11:22:51 AM Mohammed  : Hey Surendar how are you?
Sure please let me know what you need assistance with
11:23:07 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime session
11:23:17 AM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: bcoz it is little complicated to explain in chat
11:23:37 AM Mohammed  : sure let me create the details
11:24:53 AM Mohammed  : Meeting Link: https://chime.aws/3032299771 
Meeting ID: 3032 29 9771
U.S. Toll: +1 206-462-5569
Meeting PIN: 3032 29 9771
U.S. Toll-free: +1 855-552-4463
International: https://chime.aws/dialinnumbers/ 

As soon as you join the chime meet you may disconnect from here thanks



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Sep 15 2021
16:41:32 GMT+0530 (India Standard Time)
need clarification on deploying lambda
Stack ID(s) / Stack ARN: 

>>>>>>>>>>>>>>>>>>>>>

126. Chat: need assistance on deployment

Hey!

This is Dominik from AWS Premium Support, pleasure chatting with you today.

I understand that you are implementing this [1] blog, however it is being done in Terraform due to organizational constraints as you mentioned.

You had a query related to "cloudformation resources Type: Custom::LambdaCodeUpdate" as seen within the GitHub template [2].

This is a custom resource within CloudFormation [3]. AWS CloudFormation calls a Lambda API to invoke the function and to pass all the request data (such as the request type and resource properties) to the function. The power and customizability of Lambda functions in combination with AWS CloudFormation enable a wide range of scenarios, such as dynamically looking up AMI IDs during stack creation.

In this case it was pushing the ARN's and substituting them from the CFN stack -> Invoking "lambda-code-update" function -> Creating a file configuration.json on the other Lambda functions package with the following ARN's from CFN.
This is done due to the whole application being integrated, and the ARN's coming from the stack itself, there will be issues if you try directly copying the file into the package as the ARN's will be incorrect (As they are different ARN's integrated with the other stack).

This Lambda is invoked multiple times, with multiple different substituted parameters from this stack itself
For example on line 672 in the template.yaml "ParseAuthHandlerCodeUpdate", the following values are pushed to a Lambda function which in turn updates the other package contents.

{
              "userPoolArn": "${UserPoolArn}",
              "clientId": "${ClientId}",
              "clientSecret": "${ClientSecret}",
              "oauthScopes": ${OAuthScopesJsonArray},
              "cognitoAuthDomain": "${UserPoolDomainLookup}",
              "redirectPathSignIn": "${RedirectPathSignIn}",
              "redirectPathSignOut": "${RedirectPathSignOut}",
              "redirectPathAuthRefresh": "${RedirectPathAuthRefresh}",
              "cookieSettings": ${CookieSettings},
              "mode": "${Mode}",
              "httpHeaders": ${HttpHeaders},
              "logLevel": "${LogLevel}",
              "nonceSigningSecret": "${NonceSigningSecret}",
              "cookieCompatibility": "${CookieCompatibility}",
              "additionalCookies": ${AdditionalCookies},
              "requiredGroup": "${UserPoolGroupName}"
            }
 
I don't believe custom resources are supported in Terraform as investigated, I highly recommend taking a look at some of the direct Terraform modules for this solution rather than implementing an AWS Solution into Terraform, as that will cause issues trying to port it.
I do want to mention that terraform is out of scope as it is a 3rd party service, and the support and troubleshooting provided today was done on a best-effort basis.

Here are a couple I found during our call that may fit the use case -
https://registry.terraform.io/modules/vainkop/cloudfront-auth/aws/latest 
https://github.com/scalefactory/terraform-cloudfront-auth 
https://transcend.io/blog/lambda-edge-functions-in-terraform 


I do also recommend using the CFN Template as that solution works out-of-the box in this case, or the direct Serverless Application as seen here [4]

Please don't hesitate to get back to me if you come across any issues with Lambda, I'm happy to help.

Have a great day ahead !

[1] https://aws.amazon.com/blogs/networking-and-content-delivery/authorizationedge-using-cookies-protect-your-amazon-cloudfront-content-from-being-downloaded-by-unauthenticated-users/ 

[2] https://github.com/aws-samples/cloudfront-authorization-at-edge/blob/master/template.yaml 

[3] AWS Lambda-backed custom resources - 
https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html 

[4] https://console.aws.amazon.com/lambda/home?region=us-east-1#/create/app?applicationId=arn:aws:serverlessrepo:us-east-1:520945424137:applications/cloudfront-authorization-at-edge 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Dominik D.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8886836571&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Sep 15 2021
17:26:26 GMT+0530 (India Standard Time)
11:59:13 AM Dominik Dobrowolski: Hello, my name is Dominik! Hope you are keeping well, may I know your name please while I take a look at the case ?
00:01:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi
00:02:12 PM Dominik Dobrowolski: Hey ! 
00:02:22 PM Dominik Dobrowolski: Is this Surendar?
00:03:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Yes
00:03:32 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i will share the Chime ID
00:03:40 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: kindly join the meetin 
00:03:52 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i have cloudformation team also on the call
00:03:53 PM Dominik Dobrowolski: Firstly, can you let me know what the problem is?
00:04:01 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Meeting Link: https://chime.aws/3032299771 
Meeting ID: 3032 29 9771
U.S. Toll: +1 206-462-5569
Meeting PIN: 3032 29 9771
U.S. Toll-free: +1 855-552-4463
International: https://chime.aws/dialinnumbers/ 

00:04:20 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: we just wanted to know how lambda code update is working in cloudformation
00:04:36 PM Dominik Dobrowolski: Right, I see it's related to Type: Custom::LambdaCodeUpdate ?
00:05:37 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
00:05:38 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
00:06:12 PM Dominik Dobrowolski: Cool, let me do a quick investigation on this and I will join the call
00:06:34 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure thanks
00:09:39 PM Dominik Dobrowolski: Joining in now
00:10:16 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thnks



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Wed Sep 15 2021
17:26:18 GMT+0530 (India Standard Time)
Need clarificatioin on     cloudformation resources Type: Custom::LambdaCodeUpdate

>>>>>>>>>>>>>>>>>>>

127. Chat: S3/BucketBlockPublicAccessDisabled is not working properly

Hello,

Felicita here from AWS premium support, it was a pleasure working with you today. This is a quick recap of our conversation earlier.

You reached out to us for assistance in understanding the GuardDuty finding you received for your S3 bucket. With regards to this, we discussed that the 'Policy:S3/BucketBlockPublicAccessDisabled'[1]  finding is generated when an IAM entity in your AWS account disables the public access block settings of a given S3 bucket in your account . The name of the S3 bucket and the IAM user/ole who disabled the particular setting is available in your GuardDuty finding. 

Further with regards to your query on whether these findings get generated when enabling the block public access setting, I was able to confirm that the S3 related findings generated are mostly generated only for scenarios where the S3 bucket is made publicly accessible, either by disabling the bucket level public block access control, the account level public block access control, ACL's or policies, you will not receive any findings when enabling the block public access call.  

We also discussed that the particular finding is generated based on the API call recorded in Cloudtrail, so whenever any user makes use of the 'DeleteBucketPublicAccessBlock' API to disable the block public access settings , this finding is generated. It does not necessarily mean your S3 bucket is public but rather it just means that an IAM entity made the call to disable the setting at the bucket level, you can review the finding and take the necessary remediation action required.  

Please note that the findings will not disappear upon enabling the block public access setting, Guardduty's findings once generated remain in your console till 90days. if you believe that you have taken the necessary remediation action for the finding you can go ahead archive the particular finding[2].

With that being said, with regards to your query on the ' block public access settings' effect while applied on bucket and account level, I suggested reaching out to the S3 team as they will be at a better position in addressing the same for you. 

I hope our discussion was useful. Please feel free to get back to us in case you have any further concerns or queries.

Good day and  stay safe :)

References:
=========

[1] https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-s3.html#policy-s3-bucketblockpublicaccessdisabled 
[2] https://docs.aws.amazon.com/guardduty/latest/ug/findings_suppression-rule.html 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Felicita A.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8886840871&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Wed Sep 15 2021
11:43:11 GMT+0530 (India Standard Time)
06:14:36 AM Felicita: Hello, my name is Felicita.  I'm here to help you today.
06:14:44 AM Felicita: May I know your name
06:15:43 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Hi
06:15:46 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: My name is Arun
06:16:05 AM Felicita: Hi Arun, how are you today
06:16:46 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Im doing great. How about you?
06:17:10 AM Felicita: I'm good too, thanks for asking. Can you give me a quick minute to pull up your case at my end
06:18:29 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure. Please take your time.
06:26:23 AM Felicita: Thank you for your patience. So the 'Policy:S3/BucketBlockPublicAccessDisabled' finding is triggered when an IAM entity in your AWS account disables the public access block settings of a given S3 bucket in your account . The name of the S3 bucket and the IAM user/ole who disabled the particular setting is available in your GuardDuty finding
06:27:38 AM Felicita: So upon investigating one of your findings, I was able to see that the user 'AWS_165387667510_Owner' disabled the public access block setting for the S3 bucket '165387667510-packer-amznwindows-codebuild'
06:27:48 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok. So, does it happen even if we enable public block at the account level?
06:28:20 AM Felicita: Let me check on that, can you please hold for a moment
06:28:31 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure.
06:31:37 AM Felicita: Reviewing the document below, I can confirm that there are S3 related findings generated only for scenarios where the S3 bucket is made publically accessible, either by disabling the bucket level public block access control, the account level public block access control, ACL's or policies. 
https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-s3.html#policy-s3-bucketpublicaccessgranted 
06:32:01 AM Felicita: It does not generate any findings when enabling the public block access control
06:34:24 AM Felicita: As you can see from the doc, When the Public block access control is enabled, S3 Block Public Access settings are used to filter the policies or access control lists (ACLs) applied to buckets as a security measure to prevent inadvertent public exposure of data. When disabled for a bucket, access to the bucket is controlled by the policies or ACLs applied to it. This particular finding is to ensure that you are aware of the particular action on the bucket to see if it is a legitimate action
06:35:48 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: So, my understanding is that is if we enable public block access at the account level, then by default all the s3 buckets should be blocked publicly.
06:36:17 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: So, do you mean we can overwrite the global settings?
06:37:26 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: So, even if we enable it at the account level, we want to enable public block at the bucket so that that violation will not be shown in the Guardduty. is my understanding correct?
06:40:22 AM Felicita: Yeah so the finding itself is shown at the individual bucket level, so I believe the enablement also requires to be at both Account and bucket level. However, in order to better understand the block public access control, I would recommend reaching out to the S3 team, as my knowledge on this is limited and they will be the best resource in guiding you on the same.
06:46:15 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok.
06:47:27 AM Felicita: Is there anything else you need from my end?
06:48:41 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: The main thing i was looking for is this
06:48:59 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: I have explored the guarduty finding details provided in the console.
06:49:15 AM Felicita: Also when researching I believe your understanding on this is right 'my understanding is that is if we enable public block access at the account level, then by default all the s3 buckets should be blocked publicly.'. But I do recommend checking with the S3 for a more specific info on block public access settings
06:49:27 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: but still can't understand why it is being shown in the Guardduity console even after it is enabled at the account level.
06:50:41 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok. got it.
06:50:49 AM Felicita: can you give me a minute
06:53:43 AM Felicita: Okay, so regarding your query on why the findings still exists. Guardduty's findings once generated remain in your console till 90days. if you believe that you have taken the necessary resolution for the finding you can go ahead archive the particular finding
06:55:42 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: ok. But this finding was capture yesterday but i have enabled public block access setting a week back. Is it possible for you to assing this case to S3 team
06:56:46 AM Felicita: let me try reaching out to the team for a transfer, please give me a few moments
06:57:58 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Ok Sure. 
06:58:08 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: It doesn't have to be a live chat.
06:58:35 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: You can take time on this and can assign to other folks who can given an explanation on this
06:58:50 AM Felicita: Also , as mentioned earlier the particular finding is generated based on the cloudtrail logs, whenever the 'DeleteBucketPublicAccessBlock' is called , this finding is generated. It does not necessarily mean your S3 bucket is public but rather it just means that an IAm entity made the call to disable the setting at the bucket level
06:59:30 AM Felicita: ''DeleteBucketPublicAccessBlock'' action *
07:00:13 AM Felicita: while I am trying to reach out to the team, can you please confirm if the above mentioned detail helps understanding the finding.
07:01:27 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: yeah. i understand this. this is helpful.
07:01:58 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Still, i will have to dig deep into this 
07:03:30 AM Felicita: I tried reaching out to the team for a transfer, but I couldn't get any response from them. Also since you mentioned that you would like to deep dive on this issue, I would suggest creating a new case with all the queries you have for them and referencing this case on the other case for their visibility.
07:04:12 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Can you please keep this case open for now
07:04:27 AM Felicita: Yeah sure, I will keep this case open from my end
07:04:29 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Im still not convinced and may follow-up on this
07:04:37 AM Felicita: Sure thing
07:05:13 AM Felicita: Can we close this chat for now
07:05:40 AM assumed-role/AWS_165387667510_Owner/arunkumar@optum.com: Sure. Thanks for your time. It was helpful.
07:05:53 AM Felicita: My pleasure :)
07:06:15 AM Felicita: Have a good day



AWS_165387667510_Owner/arunkumar@optum.com (Role)


Wed Sep 15 2021
11:42:52 GMT+0530 (India Standard Time)
Hi Team,

We found that there are many findings shown in the AWS Guardduty findings in the below category. 
severity-low
Policy:S3/BucketBlockPublicAccessDisabled

Hence, to resolve that we have enabled "Block all public access" via "Block Public Access settings for this account" a week back but we are still seeing the violations in the Guardduty.

Just wanted to know how this works. Can you please clarify on this?

Regards,
Arun Kumar R

>>>>>>>>>>>>>>>>>

128. Chat: redirect requests using lambda@edge

Hello Surendar,

Aakash from AWS Premium Support. Thanks for your time on the call today. Per our conversation, I understand you were experiencing below error message when deploying a CloudFront distribution through Terraform. 

----------
Error: error creating CloudFront Distribution: InvalidLambdaFunctionAssociation: Lambda@Edge cannot retrieve the specified Lambda function. Update the IAM policy to add permission: lambda:GetFunction for resource: arn:aws:lambda:us-east-1:165387667510:function:surenIDP-test-HttpHeadersHandler:1 and try again. status code: 400, request id: 2bc53dc1-c2ca-42aa-95c8-69d941374f79
----------

While we were on call, we verified permissions of Lambda execution role and found it had necessary permissions. Later, you identified that the incorrect version number of Lambda function has been passed in the Terraform, which you then corrected to successfully deploy a CloudFront distribution. I understand the error message displayed here is misleading and as discussed on call, I would pass your feedback to our internal team to review the error response.

I hope I was able to assist you with the queries you had for me today. Please feel free to let us know if you have additional questions or concerns, we will be more than happy to assist you. 

Have a goodnight!

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Aakash G.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8880419851&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Tue Sep 14 2021
20:46:17 GMT+0530 (India Standard Time)
03:33:08 PM Aakash: Hello, my name is Aakash.  I'm here to help you today.
03:33:15 PM Aakash: May I know your name please?
03:33:24 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi 
03:33:32 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime session for this issue
03:34:06 PM Aakash: Sure thing but please allow me to go through case details before jumping on a call
03:35:22 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: in an half an hour][[
03:35:34 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sorry wrongly typed
03:35:40 PM Aakash: I understand you are using Lambda@Edge to perform redirection however you're observing an issue when creating a distribution with a Lambda function due to IAM permissions. 
03:35:49 PM Aakash: Let me get chime link
03:35:55 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes you are correct
03:36:20 PM Aakash: Click to join the meeting: https://chime.aws/9882297016 
Meeting ID: 9882 29 7016
03:36:30 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Joining in
03:36:42 PM Aakash: Sure



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Tue Sep 14 2021
20:46:05 GMT+0530 (India Standard Time)
Hi Need clarify on IAM Role usage

Error: error creating CloudFront Distribution: InvalidLambdaFunctionAssociation: Lambda@Edge cannot retrieve the specified Lambda function. Update the IAM policy to add permission: lambda:GetFunction for resource: arn:aws:lambda:us-east-1:165387667510:function:surenIDP-test-HttpHeadersHandler:1 and try again.
        status code: 400, request id: 2bc53dc1-c2ca-42aa-95c8-69d941374f79
	
	>>>>>>>>>>>>>>>>
	
129. Chat: how to update the S3 bucket policy using cloudformation

Hello Surendar, 

This is Nabin from AWS Premium Support, it was nice talking to you earlier in the chat. 
What follows is a quick summary of our discussion as a  future reference. 

As you were trying to create a S3 bucket with S3 bucket policy through CloudFormation, the stack was failing to create the S3BukcetPolicy resource with an error message"The bucket policy already exists on bucket serverlessrepo-suren-sso-s3bucket-1e80vdwbbejpu". 
As discussed during the chat, CloudFormation will first verify if there are any existing policies on the bucket and will fail to add new policy if there are any existing policies. So as you mentioned, your company compliance assigns a policy to the s3 bucket during its creation and that has been a reason here that when there is an existing s3 policy to the bucket attached, we cannot assign another one to the same. 

Now to overcome this scenario, either we can perform a manual action with two step CloudFormation Create and Update approach, where first we can create only the S3 bucket resource not the policy, so after the bucket gets created during first stack creation action, we manually delete the attached bucket policy from s3 bucket through console/CLI/API then next would be updating the CloudFormation stack to create a bucket policy to assign it to the before created s3 bucket.

Next approach would be to make this workaround more automatic as discussed, Using Lambda backed custom resource[1] in CloudFormation template, where the lambda function would delete the bucket policy attached to the bucket that got created then once the policy deletion event completes, we can create the S3 bucket policy resource referencing the s3 bucket whose policy got deleted by the Custom resource earlier. We have to make sure first the Custom resource create completes than S3BucketPolicy gets started creating which can be achieved using the DependsOn[2] attribute to S3BucketPolicy resource for CustomResource. So once the Custom resource creation completes, then the S3BucketPolicy resource starts creating. 

Regarding the sample of Custom Resource with CloudFormation for S3 event, I provided you a knowledge-center article over the topic "use custom resources with Amazon S3 buckets in CloudFormation"[3]. 
It has s3 bucket use case with custom resource in CloudFormation, you can take the example template in the article as a reference. 

Next as you requested to find similar use case example, unfortunately, I wasn't able to find the exact but was able to find a near one. 
Below is the GitHub link for the sample template defining custom resource to delete a s3 bucket created by the same stack, Please feel free to take a look of it and try using it as a reference for your use case of deleting the s3 bucket policy. 
          custom-resource-s3-bucket-delete/custom-resource.yml:- https://github.com/mike-mosher/custom-resource-s3-bucket-delete/blob/master/custom-resource.yml  (Not AWS verified, please test it before using it in your environment)

Hopefully this information helps, please feel free to reach us out if you have any other concerns or queries, we would be glad to assist you further. 

I wish you a nice day ahead!

Ref:-
      [1]. Custom Resource:- https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cfn-customresource.html 
      [2]. DependsOn attribute:- https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-dependson.html 
      [3]. Use Custom Resources with Amazon S3 buckets in CloudFormation:- https://aws.amazon.com/premiumsupport/knowledge-center/cloudformation-s3-custom-resources/ 

We value your feedback. Please share your experience by rating this correspondence using the AWS Support Center link at the end of this correspondence. Each correspondence can also be rated by selecting the stars in top right corner of each correspondence within the AWS Support Center.

Best regards,
Nabin L.
Amazon Web Services

===============================================================

To share your experience or contact us again about this case, please return to the AWS Support Center using the following URL: https://console.aws.amazon.com/support/home#/case/?displayId=8855915991&language=en 

Note, this e-mail was sent from an address that cannot accept incoming e-mails.
To respond to this case, please follow the link above to respond from your AWS Support Center.

===============================================================

AWS Support:
https://aws.amazon.com/premiumsupport/knowledge-center/ 

AWS Documentation:
https://docs.aws.amazon.com/ 

AWS Cost Management:
https://aws.amazon.com/aws-cost-management/ 

AWS Training:
http://aws.amazon.com/training/ 

AWS Managed Services:
https://aws.amazon.com/managed-services/ 


AWS_P0001489@optum.com


Thu Sep 09 2021
19:01:02 GMT+0530 (India Standard Time)
02:08:21 PM Nabin: Hello, my name is Nabin.  I'm here to help you today.
02:08:45 PM Nabin: May I know your kind name please?
02:10:40 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hi My Name is surendar
02:10:51 PM Nabin: Hello Surendar!
02:10:53 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: Hope you are doing great
02:10:57 PM Nabin: How are you doing today?
02:11:03 PM Nabin: I am doing well, thanks for asking. 
02:11:13 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i just wanted to know, that how we can replace the existing bucekt policy
02:11:26 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: I am good, thank you for asking
02:11:32 PM Nabin: I was pulling the case details and understand that you would like to edit the s3 bucket policy using CloudFormation
02:11:48 PM Nabin: I would like to know, is that S3 bucket managed through CloudFormation?
02:12:10 PM Nabin: I mean created through cloudformation?
02:12:43 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes, it is created by cloudfromation but due to organization level policy, bucket policy created whenever it is created.
02:13:02 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: moment bucket created, it will be updated with the policy 
02:13:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: so cloudformation is getting error, "bucket policy already"
02:13:39 PM Nabin: Can you pass me the Cloudformation stack arn please?
02:14:10 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: oh 
02:14:15 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i deleted it
02:14:20 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can i create it again
02:14:25 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: give me five minuted
02:14:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: *minutes
02:14:32 PM Nabin: you can pass the deleated stack arn as well
02:14:39 PM Nabin: pass me the stack name 
02:14:42 PM Nabin: I can pull it
02:16:50 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: onemoment
02:16:52 PM Nabin: sure
02:16:55 PM Nabin: take your time
02:18:29 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: "arn:aws:cloudformation:us-east-1:165387667510:stack/serverlessrepo-suren-sso/32387330-1157-11ec-a0ce-0a4f97d4255b"
02:18:34 PM Nabin: thank you
02:20:00 PM Nabin: Please allow me a moment to go through the resource specification. 
02:20:40 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure
02:20:41 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: sure
02:25:19 PM Nabin: I can confirm that CloudFormation will first verify if there are any existing policies on the bucket and will fail to add new policy if there are any existing policies. 
02:25:35 PM Nabin: As you said, your company policies will add some policies during the creation of the bucket
02:25:51 PM Nabin: What about editing the policy through the stack that created the bucket?
02:26:59 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: yes
02:27:05 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: i need your help to do that
02:28:04 PM Nabin: So you should be able to edit the bucket policy with the stack that created the bucket
02:28:14 PM Nabin: do you have that stack that created the bucket?
02:28:22 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: can we have chime call to do this
02:28:36 PM Nabin: sure allow me a moment, I will create a meeting and will pass you the id. 
02:28:39 PM Nabin: one moment. 
02:28:54 PM assumed-role/AWS_165387667510_Contributor/surendar.s@optum.com: thanks
02:30:38 PM Nabin: https://chime.aws/4639594747 
02:30:44 PM Nabin: pleasee use this link ot connect



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Sep 09 2021
19:00:53 GMT+0530 (India Standard Time)
How to update the existing bucket policy in cloudformation



AWS_165387667510_Contributor/surendar.s@optum.com (Role)


Thu Sep 09 2021
17:45:52 GMT+0530 (India Standard Time)
how to update the S3 bucket policy using cloudformation
Stack ID(s) / Stack ARN: 

>>>>>>>>>>>>>>>>>>>>>>

130. 
